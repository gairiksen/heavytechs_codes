!function(){window.initTestCafeRecorderUI=function(t){var e=t.HammerheadClient,i=t.TestCafeClient,o=t.document;i.define("UI.DraggingBehavior",function(){var i=e.get("Hammerhead"),o=i.$,n=i.Util,s=i.ShadowUI,r=i.EventSandbox,a=this.exports=function(t,e,i){this.$dragArea=t,this.$draggable=e,this.handlers=i,this.dragging=!1,this.draggingStopped=!1,this.dragEventRaised=!1,this.maxTop=null,this.dragOffsetX=0,this.dragOffsetY=0,this._init()};a.prototype._init=function(){function e(e){if(a.dragging){a.dragEventRaised||(a.handlers&&a.handlers.onDragStart&&a.handlers.onDragStart(),a.dragEventRaised=!0);var i=Math.max(e.clientX-a.dragOffsetX,0),s=Math.max(e.clientY-a.dragOffsetY,0),r=a.$draggable.width(),l=a.$draggable.height(),d=o(t).width(),c=o(t).height();return i+r>d&&(i=d-r),s+l>c&&(s=c-l),a.$draggable.css({left:Math.max(i,0),top:null!==a.maxTop?Math.min(a.maxTop,Math.max(s,0)):Math.max(s,0)}),a.handlers&&a.handlers.onMove&&a.handlers.onMove(),n.preventDefault(e),!1}}function i(t){a.dragging&&(a.dragging=!1,a.dragEventRaised&&(a.handlers&&a.handlers.onDragEnd&&a.handlers.onDragEnd(),a.dragEventRaised=!1),n.preventDefault(t))}var a=this;this.$dragArea.css("cursor","move"),s.bind(this.$dragArea,"mousedown",function(t){if(!a.draggingStopped){a.dragging=!0;var e=n.getOffsetPosition(a.$draggable[0]);return a.dragOffsetX=(t.pageX||t.x)-e.left,a.dragOffsetY=(t.pageY||t.y)-e.top,n.preventDefault(t),!1}}),r.addInternalEventListener(t,["mousemove"],function(t,i){i||e(t)}),r.addInternalEventListener(t,["mouseup"],function(t,e){e||i(t)})},a.prototype.resetDragging=function(){this.$dragArea&&(this.$dragArea.css("cursor","auto"),this.draggingStopped=!0)},a.prototype.restoreDragging=function(){this.$dragArea.css("cursor","move"),this.draggingStopped=!1},a.prototype.setMaxTop=function(t){this.maxTop=t}}),i.define("UI.Recorder",function(i,n){function s(){return dt?dt:(dt=L("<div>").appendTo(P.getRoot()),P.addClass(dt,et),dt)}function r(t,e){_t()?(k.show(),k.showLoadingIcon(),lt.emit(n.SAVE_TEST_EVENT,{callback:function(){k.hideLoadingIcon(),k.hide()},complete:t||!1})):(c(),a(e,t))}function a(t,e){ht=!0,H.init(s(),t||{}),ht=!1,ct=H,ct.events.on(H.CANCEL_SAVE_BUTTON_CLICK_EVENT,function(){ct=null,h()}),ct.events.on(H.SAVE_TEST_BUTTON_CLICK_EVENT,function(t){ct.blind(!0),k.showLoadingIcon(),lt.emit(n.SAVE_TEST_EVENT,{callback:function(t){t?(k.hideLoadingIcon(),ct.blind(!1),H.onError(t)):ct.closeDialog(function(){k.hideLoadingIcon(),ct=null,e||h(!0)})},testName:t.testName,complete:e||!1})})}function l(t){ht=!0,W.init(s(),t),ht=!1,ct=W,ct.events.on(W.CANCEL_BUTTON_CLICK_EVENT,function(){ct=null,h(!0)}),ct.events.on(W.EXIT_BUTTON_CLICK_EVENT,function(){ct=null,lt.emit(n.EXIT_RECORDING_EVENT,{skipCheckChanges:!0})}),ct.events.on(W.SAVE_BUTTON_CLICK_EVENT,function(){ct=null,r(!0)})}function d(t,e,i,o){U.updateExpandStepsButtonAppearance(!0),o||U.setExpandStepsButtonState(!1),M.openStepWithError(t,e,o),!mt&&i&&(mt=!0,M.events.on(M.SKIP_STEP_BUTTON_CLICK_EVENT,function(t){h({sendStepsInfo:!0,showToolbar:!1}),Ct||(M.hide(),U.updateExpandStepsButtonAppearance(Ct)),U.setExpandStepsButtonState(!0),i&&i.skipStep&&i.skipStep(t.hasChanges)}),M.events.on(M.REPLAY_STEP_BUTTON_CLICK_EVENT,function(t){h({sendStepsInfo:!0,showToolbar:!1}),Ct||(M.hide(),U.updateExpandStepsButtonAppearance(Ct)),U.setExpandStepsButtonState(!0),i&&i.resumePlayback&&i.resumePlayback(t.hasChanges)}))}function c(t){k.show(t),n.hideToolbar(),ut&&ut.css("visibility","hidden"),pt&&pt.css("visibility","hidden"),lt.emit(n.POPUP_DIALOG_OPENING_EVENT,{})}function h(t){var e=t||{},i="undefined"!=typeof e.sendStepsInfo&&e.sendStepsInfo,o="undefined"!=typeof e.cancelAction&&e.cancelAction,s="undefined"==typeof e.showToolbar||e.showToolbar;k.hide(),s&&n.showToolbar(),ut&&(o?(ut.remove(),ut=null):ut.css("visibility","visible")),pt&&pt.css("visibility","visible"),lt.emit(n.POPUP_DIALOG_CLOSED_EVENT,{needSendStepsInfo:i})}function p(){lt.emit(n.ADD_HOVER_ACTION_EVENT)}function u(){lt.emit(n.ADD_WAIT_ACTION_EVENT)}function f(){lt.emit(n.ADD_SCREENSHOT_ACTION_EVENT)}function g(t){lt.emit(n.ADD_ASSERTIONS_STEP_EVENT,t)}function E(){It&&lt.emit(n.RUN_PLAYBACK_EVENT)}function v(){vt()&&r(!1)}function _(t){lt.emit(n.EXIT_RECORDING_EVENT,t)}function m(){U.events.on(U.ADD_HOVER_ACTION_BUTTON_PRESSED_EVENT,p),U.events.on(U.ADD_WAIT_ACTION_BUTTON_PRESSED_EVENT,u),U.events.on(U.ADD_ASSERTIONS_STEP_EVENT,g),U.events.on(U.ADD_SCREENSHOT_ACTION_BUTTON_PRESSED_EVENT,f),U.events.on(U.RUN_PLAYBACK_BUTTON_PRESSED_EVENT,E),U.events.on(U.SAVE_TEST_BUTTON_PRESSED_EVENT,v),U.events.on(U.EXIT_RECORDING_BUTTON_PRESSED_EVENT,_)}function C(){M.events.on(M.STEPS_INFO_CHANGED_EVENT,function(t){t.draft||lt.emit(n.SEND_STEPS_INFO_EVENT),n.updateToolbarButtons()}),M.events.on(M.ALL_STEPS_DELETED_EVENT,function(){D.asyncServiceMsg({cmd:R.WERE_ACTIONS_RECORDED},function(t){t&&(c(),Y.hideAll(),ht=!0,F.init(s()),ht=!1,ct=F,ct.events.on(F.BACK_TO_INITIAL_PAGE_EVENT,function(){k.showLoadingIcon(),ct=null,lt.emit(n.RESTART_RECORDING_EVENT)}))})}),M.events.on(M.EDIT_ASSERTION_START_EVENT,function(t){n.hideToolbar(),t.showBackground&&k.show()}),M.events.on(M.EDIT_ASSERTION_COMPLETE_EVENT,function(t){n.showToolbar(!0),t.hideBackground&&k.hide()}),M.events.on(M.START_PICKING_ELEMENT_EVENT,function(t){lt.emit(n.START_PICKING_ELEMENT_EVENT,t)}),M.events.on(M.STEP_INFO_SHOWN_EVENT,function(t){U.updateMaxTopForDragging(t.$el),lt.emit(n.STEP_EDITING_STARTED,{})}),M.events.on(M.STEP_INFO_HIDDEN_EVENT,function(t){U.updateMaxTopForDragging(null),t.editingFinished&&lt.emit(n.STEP_EDITING_FINISHED,{})}),M.events.on(M.STEPS_PANEL_BLINDED_EVENT,function(t){U.setBlind(t.blind)})}function T(t){var e=L("<div></div>").attr("title",nt).appendTo(s());return P.addClass(e,it),P.addClass(e,ot),I(e,t),e}function S(t){var e=L("<div></div>").attr("title",rt).appendTo(s());return P.addClass(e,it),P.addClass(e,st),I(e,t),e}function I(t,e){t.css({top:e.top-t.height(),left:e.left+e.width-t.width()})}function y(){n.Shortcuts[z]=p,n.Shortcuts[j]=u,n.Shortcuts[X]=f,n.Shortcuts[q]=g,n.Shortcuts[J]=E,n.Shortcuts[Q]=v,n.Shortcuts[Z]=_,n.Shortcuts[tt]=function(){"function"==typeof ft?ft():"function"==typeof gt&&gt()}}function $(){N.addEventListener.call(o,"undefined"!=typeof o.onwheel?"wheel":"mousewheel",function(t){var e=L(t.target);!A.isShadowUIElement(t.target)||P.hasClass(e,B.ELEMENT_PICKING_CLASSES.elementFrame)||P.hasClass(e,B.ELEMENT_PICKING_CLASSES.elementFramePart)||P.select("."+B.ELEMENTS_MARKER_CLASS).has(e).length||A.preventDefault(t)},!1)}function b(t){var e=s(),i={stepsInfo:Et(),hasChanges:vt(),toolbarPosition:{left:V.RECORDER_TOOLBAR_POS_LEFT,top:V.RECORDER_TOOLBAR_POS_TOP},collapsedMode:t===at.playback,shortcuts:{addHover:z,addWait:j,addScreenshot:X,addAssertion:q,playback:J,saveTest:Q,exitRecording:Z},showSteps:Ct,enableStepListInteractive:t===at.recording};U.init(e,i),U.events.on(U.TOOLBAR_MOVED_EVENT,function(t){var e={cmd:R.TOOLBAR_POSITION_SET,toolbarPosition:t.toolbarPosition};D.queuedAsyncServiceMsg(e)}),U.events.on(U.STEPS_PANEL_VISIBILITY_CHANGED,function(t){Ct=t.shown;var e={cmd:R.CHANGE_SHOW_STEPS,show:t.shown};D.queuedAsyncServiceMsg(e)}),C()}var x=e.get("Hammerhead"),L=x.$,A=x.Util,w=x.EventSandbox,N=x.NativeMethods,P=x.ShadowUI,D=i("Base.Transport"),R=i("Shared.ServiceCommands"),V=i("Settings"),O=i("Automation"),B=i("Recorder.Util"),k=i("UI.ModalBackground"),U=i("UI.RecorderWidgets.Toolbar"),M=i("UI.RecorderWidgets.StepsPanel"),H=i("UI.RecorderWidgets.SetTestNameDialog"),W=i("UI.RecorderWidgets.UnsavedChangesDialog"),F=i("UI.RecorderWidgets.BackToInitialPage"),K=i("UI.RecorderWidgets.AddActionDialog"),G=i("Recorder.ElementPicker"),Y=i("UI.RecorderWidgets.Tooltip"),z=O.ADD_ACTION_SHORTCUTS.hover,j=O.ADD_ACTION_SHORTCUTS.wait,X=O.ADD_ACTION_SHORTCUTS.screenshot,q="Ctrl+R",J="Ctrl+D",Q="Ctrl+S",Z="Ctrl+E",tt="Ctrl+G",et="recorder",it="complete-icon",ot="typing",nt="Complete Typing ("+tt+")",st="click",rt="Complete Click ("+tt+")";n.ADD_HOVER_ACTION_EVENT="addHoverAction",n.ADD_WAIT_ACTION_EVENT="addWaitAction",n.ADD_SCREENSHOT_ACTION_EVENT="addScreenshotAction",n.ADD_ASSERTIONS_STEP_EVENT="addAssertionsStep",n.RUN_PLAYBACK_EVENT="runPlayback",n.SAVE_TEST_EVENT="saveTest",n.EXIT_RECORDING_EVENT="exitRecording",n.SEND_STEPS_INFO_EVENT="sendStepsInfo",n.RESTART_RECORDING_EVENT="restartRecording",n.RESUME_PLAYBACK_EVENT="resumePlayback",n.POPUP_DIALOG_OPENING_EVENT="popupDialogOpening",n.POPUP_DIALOG_CLOSED_EVENT="popupDialogClosed",n.START_PICKING_ELEMENT_EVENT="startPickingElement",n.STOP_PICKING_ELEMENT_EVENT="stopPickingElement",n.STEP_EDITING_STARTED="stepEditingStarted",n.STEP_EDITING_FINISHED="stepEditingFinished",n.Shortcuts={},n.Shortcuts[z]=null,n.Shortcuts[j]=null,n.Shortcuts[X]=null,n.Shortcuts[q]=null,n.Shortcuts[J]=null,n.Shortcuts[Q]=null,n.Shortcuts[Z]=null,n.Shortcuts[tt]=null;var at={initialized:"initializedMode",playback:"playbackMode",recording:"recordingMode"},lt=new A.EventEmitter,dt=null,ct=null,ht=!1,pt=null,ut=null,ft=null,gt=null,Et=null,vt=null,_t=null,mt=!1,Ct=!0,Tt=null,St=!1,It=!1;n.init=function(t,e,i,o){Et=t,vt=e,_t=i,Ct=o,Tt=at.initialized,St=!0},n.isInitialized=function(){return St},n.events={on:function(t,e){lt.on(t,e)}},n.activateRecordingMode=function(){var e=function(t,e,i,o,n){(!ct||ct.popup&&ct.popup.isHidden())&&!ht||(o(),A.isShadowUIElement(t.target)||n())};w.addInternalEventListener(t,A.DOM_EVENTS,e),w.addInternalEventListener(o,A.DOM_EVENTS,e),Tt===at.initialized?b(at.recording):Tt===at.playback&&(M.turnOffPlaybackMode(),M.activateInteractive()),U.expand(),m(),y(),$(),n.updateToolbarButtons(),Tt=at.recording},n.activatePlaybackMode=function(){Tt===at.initialized&&b(at.playback),$(),Tt=at.playback},n.highlightStep=function(t){M.highlightItem(t)},n.confirmAction=function(t,e,i){c(!e.isAssertion),ht=!0;var o=new K(s(),t,e);ct=o,ht=!1,o.on(K.ADD_ACTION_BUTTON_CLICK_EVENT,function(t){ct=null,h(),i(!0,t.stepInfo)}),o.on(K.CANCEL_BUTTON_CLICK_EVENT,function(){ct=null,h({cancelAction:!0}),i(!1)}),o.on(K.START_PICKING_ELEMENT_EVENT,function(t){lt.emit(n.START_PICKING_ELEMENT_EVENT,t)})},n.stepAdded=function(t){t.isAssertion||Ct||U.addActionIndicator(t.actionDescriptor.type),M.addItem()},n.handlerAdded=function(t){Ct||U.addActionIndicator(t)},n.onTypingStateChanged=function(t,e,i){t?(i=i||A.getElementRectangle(A.getActiveElement()),pt?I(pt,i):(ut&&(ut.remove(),ut=null,gt=null),pt=T(i)),ft=function(){pt.remove(),ft=null,e()},P.bind(pt,"mousedown",function(t){A.preventDefault(t),ft()})):pt&&(pt.remove(),pt=null)},n.onClickEditorStateChanged=function(t,e,i){t?(i=i||A.getElementRectangle(A.getActiveElement()),ut?I(ut,i):ut=S(i),gt=function(){ut.remove(),ut=null,gt=null,e()},P.bind(ut,"mousedown",function(t){A.preventDefault(t),gt()})):ut&&(ut.remove(),ut=null)},n.onStartPickElement=function(){n.hideToolbar(),ct&&(ct.popup.hide(),k.hide()),G.setRecorderUI(s())},n.onStopPickElement=function(){ct?ct.popup&&ct.popup.isHidden()&&(ct.popup.show(),k.show(ct.step&&!ct.step.getStepInfo().isAssertion)):n.showToolbar()},n.hideToolbar=function(){U.hide(),M.hide()},n.showToolbar=function(t){U.show(),Ct&&M.show(t),n.updateToolbarButtons()},n.setToolbarBlind=function(t){U.setBlind(t)},n.updateToolbarButtons=function(){var t=!1,e=Et();It=!!e.length;for(var i=0;i<e.length;i++)if(e[i].error){t=!0,It=!1;break}U.updateState(vt(),!!e.length,t)},n.updateSteps=function(){M.updateSteps()},n.openStepWithError=d,n.openChangesWarningDialog=function(t){c(),l(t)}}),i.define("UI.SortingBehavior",function(t,i){var n=e.get("Hammerhead"),s=n.$,r=n.Util,a=n.ShadowUI,l="sortable",d="place-holder",c={handlers:{},waitSortingStart:!1,itemTag:"",itemClass:"",draggableClass:"",exceptClass:""},h=null,p=null,u=null,f=null,g={},E=null,v=null,_=null,m=null,C="",T=!1,S=function(t){var e=s(t).parents(),i=null;if(h.exceptClass&&a.hasClass(s(t),h.exceptClass))return null;if(h.draggableClass&&!a.hasClass(s(t),h.draggableClass)){var o=e.filter(function(){return a.hasClass(s(this),h.draggableClass)});if(!o.length)return null}else if((!h.draggableClass||h.draggableClass===h.itemClass)&&a.hasClass(s(t),h.itemClass))return s(t);return s.each(e,function(t,e){if(a.hasClass(s(e),h.itemClass))return i=s(e),!1}),i},I=function(){return s(p).children(h.itemTag).map(function(t,e){return a.hasClass(s(e),h.itemClass)?e:null})},y=function(){var t=[],e=I(),i=null;e=e.map(function(t,e){return a.hasClass(s(e),l)||a.hasClass(s(e),d)?null:e}),e.each(function(e,o){i=r.getOffsetPosition(o),i.right=i.left+s(o).outerWidth(),i.bottom=i.top+s(o).outerHeight(),i.el=o,t[e]=i}),v=t},$=function(t,e){var i=e-g.top,o=t-g.left;i=Math.min(E.bottom,Math.max(i,E.top)),o=Math.min(E.right,Math.max(o,E.left));var n=u.parents();n.each(function(t,e){if("static"!==s(e).css("position")&&(!r.isMozilla||"table"!==s(e).css("display"))){var n=r.getOffsetPosition(e);return i-=n.top,o-=n.left,!1}}),u.css({top:i,left:o})},b=function(){for(var t=r.getOffsetPosition(u[0]),e=t.top+g.top,i=0;i<v.length;i++)if(e>=v[i].top&&e<=v[i].bottom)return v[i].el;return null},x=function(){var t=Math.floor(s(p).outerHeight());E=r.getOffsetPosition(p),E.right=E.left+s(p).outerWidth()-u.outerWidth(),E.bottom=E.top+t-u.outerHeight()},L=function(t){if(t.button===r.BUTTON.LEFT&&!T){var e=S(t.target);if(e&&e.length){r.preventDefault(t),null!==u&&N(),u=e;var i=r.getElementMargin(u),n=r.getOffsetPosition(u[0]),c=u.height(),p=u.width();m=I().index(u),g.top=(t.pageY||t.y)-n.top+(isNaN(i.top)?0:i.top),g.left=(t.pageX||t.x)-n.left+(isNaN(i.left)?0:i.left),x(),u.after("<"+h.itemTag+">&nbsp</"+h.itemTag+">"),f=u.next(),a.addClass(f,h.itemClass),a.addClass(f,d),f.css({height:c,width:p}),C=u.attr("style")||"",a.addClass(u,l),y(),a.bind(s(o),"mousemove",w),a.bind(s(o),"mouseup",N),a.bind(s(o),"undefined"!=typeof o.onwheel?"wheel":"mousewheel",A),h.handlers&&h.handlers.onDragStart&&h.handlers.onDragStart(u,m)}}},A=function(t){return h.handlers&&h.handlers.onMouseWheel&&h.handlers.onMouseWheel(t),w(t),r.preventDefault(t),!1},w=function(t){if(null===u)return!1;var e=t.pageX||t.x,i=t.pageY||t.y;$(e,i),h.handlers&&h.handlers.onItemMoved&&h.handlers.onItemMoved(u),y(),x();var o=b();return null!==o&&(null===_||_>i?s(o).before(f):s(o).after(f),y(),_=i,!1)},N=function(){if(null!==u){a.removeClass(u,l),""!==C?u.attr("style",C):u.removeAttr("style"),f.before(u),f.remove(),f=null;var t=I().index(u);return h.handlers&&h.handlers.onDragEnd&&h.handlers.onDragEnd(m,t),u=null,a.unbind(s(o),"mousemove",w),a.unbind(s(o),"mouseup",N),a.unbind(s(o),"undefined"!=typeof o.onwheel?"wheel":"mousewheel",A),!1}};i.init=function(t,e){p=t,h=s.extend({},c,e);var i=s(p).children(":first")[0];i&&(h.itemTag||(h.itemTag=s(p).children(":first")[0].tagName.toLowerCase()),h.waitSortingStart||a.bind(s(p),"mousedown",L))},i.startSorting=function(t){L(t)},i.stopSorting=function(){T=!0},i.resumeSorting=function(){T=!1}}),i.define("UI.UXLog",function(t,e){var i=t("Base.Transport"),o=t("Shared.ServiceCommands");e.write=function(t){var e={cmd:o.UXLOG,msg:t};i.asyncServiceMsg(e)}}),i.define("UI.ValidationMessageFactory",function(t,i){function o(t){var e=s("<div></div>").insertAfter(t);return s("<span></span>").appendTo(e),t.data(a,e),r.addClass(e,c),e}var n=e.get("Hammerhead"),s=n.$,r=n.ShadowUI,a="validation-element",l="error",d="warning",c="validation",h="error-message",p="warning-message",u="wide";i.error=function(t,e,i){if(e){var n=t.data(a)||o(t),s=n.find("span");s.text(e),r.removeClass(n,p),r.addClass(n,h),i&&r.addClass(s,u)}r.removeClass(t,d),r.addClass(t,l)},i.warning=function(t,e){var i=t.data(a)||o(t);i.find("span").html(e),r.removeClass(i,h),r.addClass(i,p),r.removeClass(t,l),r.addClass(t,d)},i.success=function(t){var e=t.data(a);e&&(e.find("span").html(""),r.removeClass(e,h),r.removeClass(e,p)),r.removeClass(t,l),r.removeClass(t,d)}}),i.define("UI.RecorderWidgets.ActionDialogsEditor",function(t){function i(t){a.addClass(s("<div></div>").appendTo(t),x)}var n=e.get("Hammerhead"),s=n.$,r=n.Util,a=n.ShadowUI,l=t("Shared.Errors"),d=t("Recorder.Util"),c=t("UI.RecorderWidgets.DialogProperty"),h=t("UI.RecorderWidgets.Checkbox"),p=t("UI.RecorderWidgets.RadioGroup"),u="Browser dialogs",f=["alert","confirm","prompt","beforeUnload"],g=d.BROWSER_DIALOG_INDEXES,E="prompt",v="confirm",_="action-dialogs-editor",m="editor-button",C="editor-button-text",T="editor-popup",S="separator",I="opened",y="dialog-area",$="editor-area",b="dialog-index",x="clear",L="failed",A=["ok","cancel"],w={ok:!0,cancel:!1},N=this.exports=function(t,e){var i=this;this.stepInfo=e,this.dialogNameWithError=e.dialogError?e.dialogError.dialog:null,this.$editor=null,this.$button=null,this.$popup=null,this.$dialogAreaWithError=null,this.eventEmitter=new r.EventEmitter,this.on=function(t,e){i.eventEmitter.on(t,e)},this._createMarkup(t),this._init()};N.OPTION_CHANGED_EVENT="optionChangedEvent",N.prototype._createMarkup=function(t){this.$editor=s("<div></div>").appendTo(t),a.addClass(this.$editor,_),this.$button=s("<div></div>").appendTo(this.$editor),a.addClass(this.$button,m);var e=s("<div></div>").text(u).appendTo(this.$button);a.addClass(e,C),this.dialogNameWithError&&s.inArray(this.dialogNameWithError,f)!==-1&&a.addClass(this.$button,L)},N.prototype._createSeparator=function(){if(this.$popup.children().length){var t=s("<div></div>").appendTo(this.$popup);a.addClass(t,S)}},N.prototype._createUncheckedDialog=function(t){this._createSeparator(),this._createDialogProperty(null,t)},N.prototype._createPopup=function(){this.$popup=s("<div></div>").appendTo(this.$editor),a.addClass(this.$popup,T);for(var t=0;t<f.length;t++)this._createDialogs(f[t]);this.$popup.css("left",this.$button.position().left-this.$popup.width()+this.$button[0].offsetWidth)},N.prototype._createDialogs=function(t){var e=this,i=this.stepInfo.nativeDialogHandlers,o=g[t],n=i&&i[o]?i[o]:null;if(!n||!n.length)return void this._createUncheckedDialog(t);var s=!1;return n.forEach(function(i,o){i&&(s=!0,e._createSeparator(),e._createDialogProperty(i,t,o))}),s?void(this.dialogNameWithError&&this.dialogNameWithError.toLowerCase()===t.toLowerCase()&&this.stepInfo.dialogError.code===l.API_UNEXPECTED_DIALOG&&(e._createSeparator(),e._createDialogProperty(null,t,n.length))):void this._createUncheckedDialog(t)},N.prototype._createDialogProperty=function(t,e,i){var o=this,n=null;if(e===E)n=this._createPromptDialogProperty(t);else if(e===v)n=this._createConfirmDialogProperty(t);else{var s=new h(this.$popup,(!!t),e);n=s.$checkboxContainer,s.on(h.STATE_CHANGED_EVENT,function(t){t.state?o._createDialogHandler(n.data(b),e):o._deleteDialogHandler(n.data(b),e),o.eventEmitter.emit(N.OPTION_CHANGED_EVENT,{dialog:e,state:t.state})})}"undefined"!=typeof i&&n.data(b,i),!this.dialogNameWithError||this.dialogNameWithError.toLowerCase()!==e.toLowerCase()||this.$dialogAreaWithError||t&&this.stepInfo.dialogError.code===l.API_UNEXPECTED_DIALOG||(a.addClass(n,L),this.$dialogAreaWithError=n)},N.prototype._createPromptDialogProperty=function(t){var e=this,o=s("<div></div>").appendTo(this.$popup),n=null,r=null,l=null;return a.addClass(o,y),n=new h(o,(!!t),E),n.on(h.STATE_CHANGED_EVENT,function(t){t.state?(l.enable(),l.isValid()&&e._createDialogHandler(o.data(b),E,null===l.getEditorText()?null:l.getEditorText())):(l.disable(),e._deleteDialogHandler(o.data(b),E)),e.eventEmitter.emit(N.OPTION_CHANGED_EVENT,{dialog:E,state:t.state})}),r=s("<div></div>").appendTo(o),a.addClass(r,$),t?l=new c(r,"",null===t.retValue?"null":t.retValue):(l=new c(r,"",""),l.disable()),l.on(c.VALUE_CHANGED_EVENT,function(t){var i=g[E],n=o.data(b);l.isValid()&&(e.stepInfo.nativeDialogHandlers[i]["undefined"==typeof n?0:n]={dialog:E,retValue:"null"===t.value?null:t.value},e.eventEmitter.emit(N.OPTION_CHANGED_EVENT,{}))}),i(o),o},N.prototype._createConfirmDialogProperty=function(t){var e=this,o=s("<div></div>").appendTo(this.$popup),n=null,r=null,l=null;return a.addClass(o,y),n=new h(o,(!!t),v),n.on(h.STATE_CHANGED_EVENT,function(t){t.state?(l.enable(),e._createDialogHandler(o.data(b),v,w[A[l.checkedIndex]])):(l.disable(),e._deleteDialogHandler(o.data(b),v)),e.eventEmitter.emit(N.OPTION_CHANGED_EVENT,{dialog:v,state:t.state})}),r=s("<div></div>").appendTo(o),a.addClass(r,$),l=new p(r,A,t&&t.retValue!==!0?1:0),t||l.disable(),l.on(p.CHECKED_INDEX_CHANGED,function(t){var i=g[v],n=o.data(b);e.stepInfo.nativeDialogHandlers[i]["undefined"==typeof n?0:n]={dialog:v,retValue:w[A[t.checkedIndex]]},e.eventEmitter.emit(N.OPTION_CHANGED_EVENT,{})}),i(o),o},N.prototype._init=function(){var t=this;this.$button.mousedown(function(){t.$popup&&"hidden"!==t.$popup.css("visibility")?t.hidePopup():t.showPopup()})},N.prototype._createDialogHandler=function(t,e,i){var o=g[e],n={dialog:e,retValue:i};this.stepInfo.nativeDialogHandlers||(this.stepInfo.nativeDialogHandlers=[]),this.stepInfo.nativeDialogHandlers[o]||(this.stepInfo.nativeDialogHandlers[o]=[]),this.stepInfo.nativeDialogHandlers[o]["undefined"==typeof t?0:t]=n},N.prototype._deleteDialogHandler=function(t,e){var i=g[e];if(this.stepInfo.nativeDialogHandlers[i][t]?(delete this.stepInfo.nativeDialogHandlers[i][t],this.stepInfo.nativeDialogHandlers[i].length||delete this.stepInfo.nativeDialogHandlers[i]):this.stepInfo.nativeDialogHandlers[i]&&delete this.stepInfo.nativeDialogHandlers[i],this.stepInfo.nativeDialogHandlers.length){var o=!0;s.each(this.stepInfo.nativeDialogHandlers,function(t,e){if(e&&e.length)return o=!1,!1}),o&&delete this.stepInfo.nativeDialogHandlers}else delete this.stepInfo.nativeDialogHandlers},N.prototype.removeError=function(){this.dialogNameWithError=null,this.$dialogAreaWithError&&(a.removeClass(this.$dialogAreaWithError,L),a.removeClass(this.$button,L)),this.$dialogAreaWithError=null},N.prototype.showPopup=function(){var t=this;this.$popup?this.$popup.css("visibility",""):this._createPopup(),a.addClass(this.$button,I),a.bind(s(o),"mousedown",function(e){t.$editor.find(e.target).length||(a.unbind(s(o),"mousedown",arguments.callee),t.hidePopup())})},N.prototype.hidePopup=function(){this.$popup&&(this.$popup.css("visibility","hidden"),a.removeClass(this.$button,I))}}),i.define("UI.RecorderWidgets.ActionOptionsEditor",function(t){var i=e.get("Hammerhead"),n=i.$,s=i.Util,r=i.ShadowUI,a=t("UI.RecorderWidgets.DialogProperty"),l=t("UI.RecorderWidgets.Checkbox"),d=["ctrl","alt","shift","meta","caretPos","offsetX","offsetY"],c="offsetX",h="offsetY",p="X:",u="Y:",f="Use offsets",g="action-options-editor",E="editor-button",v="editor-popup",_="separator",m="opened",C="offsets-area",T="offset-editors-area",S=this.exports=function(t,e){var i=this;this.stepInfo=e,this.$editor=null,this.$button=null,this.$popup=null,this.propertyEditors=[],this.offsetPropertyEditors=[],this.eventEmitter=new s.EventEmitter,this.on=function(t,e){i.eventEmitter.on(t,e)},this._createMarkup(t),this._init()};S.OPTION_CHANGED_EVENT="optionChangedEvent",S.prototype._createMarkup=function(t){this.$editor=n("<div></div>").appendTo(t),r.addClass(this.$editor,g),this.$button=n("<div></div>").appendTo(this.$editor),r.addClass(this.$button,E);var e=n("<div></div>").text("Options").appendTo(this.$button);r.addClass(e,"editor-button-text")},S.prototype._createPopup=function(){var t=this,e=!1;this.$popup=n("<div></div>").appendTo(this.$editor),r.addClass(this.$popup,v);for(var i=0;i<d.length;i++){var o=d[i],s=o===c||o===h;if(this.stepInfo.actionDescriptor.apiArguments.options.hasOwnProperty(o)){if(s&&e)continue;if(this.$popup.children().length){var a=n("<div></div>").appendTo(this.$popup);r.addClass(a,_)}s?(this._createOffsetsArea(),e=!0):this._createOption(o,o,this.$popup)}}t._updateOffsetOptionsEditability(),this.$popup.css("left",this.$button.position().left-this.$popup.width()+this.$button[0].offsetWidth)},S.prototype._createOffsetsArea=function(){var t=this,e=n("<div></div>").appendTo(this.$popup);r.addClass(e,C);var i=new l(e,this.stepInfo.useOffsets,f);i.on(l.STATE_CHANGED_EVENT,function(e){t.stepInfo.useOffsets=e.state,t._updateOffsetOptionsEditability(),t.eventEmitter.emit(S.OPTION_CHANGED_EVENT,{})});var o=n("<div></div>").appendTo(e);r.addClass(o,T),this.offsetPropertyEditors.push(this._createOption(c,p,o)),this.offsetPropertyEditors.push(this._createOption(h,u,o))},S.prototype._createOption=function(t,e,i){var o=this,n=this.stepInfo.actionDescriptor.apiArguments.options;if("boolean"==typeof n[t]){var s=new l(i,n[t],e);return s.on(l.STATE_CHANGED_EVENT,function(e){n[t]=e.state,o.eventEmitter.emit(S.OPTION_CHANGED_EVENT,{})}),s}var r=new a(i,e,n[t],{isNumericProperty:!0,isNotNegativeNumericProperty:!0});return this.propertyEditors.push(r),r.on(a.VALUE_CHANGED_EVENT,function(e){r.isValid()&&(n[t]=e.value),o.eventEmitter.emit(S.OPTION_CHANGED_EVENT,{})}),r},S.prototype._updateOffsetOptionsEditability=function(){for(var t=0;t<this.offsetPropertyEditors.length;t++)this.stepInfo.useOffsets&&this.offsetPropertyEditors[t].isDisabled?this.offsetPropertyEditors[t].enable():this.stepInfo.useOffsets||this.offsetPropertyEditors[t].isDisabled||this.offsetPropertyEditors[t].disable()},S.prototype._init=function(){var t=this;this.$button.mousedown(function(){t._isPopupVisible()?t._hidePopup():t._showPopup()})},S.prototype._showPopup=function(){var t=this;this.$popup?this.$popup.css("visibility",""):this._createPopup(),r.addClass(this.$button,m),r.bind(n(o),"mousedown",function(e){t.$editor.find(e.target).length||(r.unbind(n(o),"mousedown",arguments.callee),t._hidePopup())})},S.prototype._hidePopup=function(){this.$popup&&(this.$popup.css("visibility","hidden"),r.removeClass(this.$button,m))},S.prototype._isPopupVisible=function(){return this.$popup&&"hidden"!==this.$popup.css("visibility")},S.prototype.isValid=function(){for(var t=0;t<this.propertyEditors.length;t++)if(!this.propertyEditors[t].isValid())return!1;return!0}}),i.define("UI.RecorderWidgets.ActionStep",function(t){function i(t){return{isReadOnly:/^files/i.test(t),isKeysProperty:/^key/.test(t.toLowerCase()),isNumericProperty:!/text|^key/.test(t.toLowerCase()),isPositiveNumericProperty:/^ms$/.test(t.toLowerCase()),maximizeInput:"text"===t.toLowerCase(),smallInput:/startPos|endPos|ms|keys/i.test(t)}}var o=e.get("Hammerhead"),n=o.$,s=o.Util,r=o.ShadowUI,a=t("Shared.Errors"),l=t("Shared.Const"),d=t("UI.RecorderWidgets.BaseStep"),c=o.TextSelection,h=t("UI.RecorderWidgets.Combobox"),p=t("UI.RecorderWidgets.DialogProperty"),u=t("UI.RecorderWidgets.ActionOptionsEditor"),f=t("UI.RecorderWidgets.ActionDialogsEditor"),g=t("UI.RecorderWidgets.SelectorEditor"),E=t("UI.RecorderWidgets.ElementsMarker"),v={click:["options"],rclick:["options"],dblclick:["options"],drag:["options","dragOffsetX","dragOffsetY"],hover:["options"],type:["options","text"],press:["keysCommand"],wait:["ms"],select:["startPos","endPos"],upload:["files"],screenshot:[]},_="action-step",m="selector-editor-container",C="arguments",T="options",S="action-type",I="action-icon",y="dialog-property",$="selector-area",b="arguments-container",x="IFrame selector:",L="Target selector:",A=100,w=100,N=this.exports=function(t,e,i,o){o=o||{},this.options={enableFloatMode:o.enableFloatMode||!1,$floatingParent:o.$floatingParent||null,enableSelectorValidation:o.enableSelectorValidation||!1,enableElementsMarking:o.enableElementsMarking||!1,stretchSelectorEditor:o.stretchSelectorEditor||!1,allowVisibleElementsOnly:o.allowVisibleElementsOnly||!1,dialogError:o.dialogError||i.dialogError},d.apply(this,[t,e,i,this.options]),this.actionDescriptor=i.actionDescriptor,this.argumentPropertyEditors=[],this.optionsEditor=null,this.dialogsEditor=null,this.selectorEditor=null,this.iFrameSelectorEditor=null,this.$argumentsContainer=null,this._createMarkup(),this._init()};s.inherit(N,d),N.STEP_NAME_CHANGED_EVENT=d.STEP_NAME_CHANGED_EVENT,N.STEP_INFO_CHANGED_EVENT=d.STEP_INFO_CHANGED_EVENT,N.SELECTOR_EDITOR_FOCUSED_EVENT="selectorEditorFocused",N.SELECTOR_EDITOR_BLURED_EVENT="selectorEditorBlured",N.prototype._createMarkup=function(){r.addClass(this.$step,_),this._createBackground(),this._createArguments(this.$step),"undefined"!=typeof this.stepInfo.selectors&&this._createSelectorArea(this.$step)},N.prototype._createComboBoxProperty=function(t,e,i){var o=n("<div></div>").appendTo(t);r.addClass(o,y);var s=l.PROPERTY_PREFIX+e+Math.random().toString().replace("0.","-");return this._createLabel(o,e,s),new h(o,["true","false"],i,s)},N.prototype._createArgumentsProperty=function(t,e,o,n){var s=this,r=new p(t,this._getArgumentPropertyLabelText(e),o,i(e));this.argumentPropertyEditors.push(r),r.on(p.VALUE_CHANGED_EVENT,function(t){n[e]=t.value,s._onChangePropertyValue()})},N.prototype._getArgumentPropertyLabelText=function(t){return/keyscommand/i.test(t)?"Keys:":t+":"},N.prototype._createArgumentsContainer=function(t){this.$argumentsContainer=n("<div></div>").appendTo(t),r.addClass(this.$argumentsContainer,b)},N.prototype._createOptionsEditor=function(t){var e=this;this.$argumentsContainer||this._createArgumentsContainer(t),this.optionsEditor=new u(this.$argumentsContainer,this.stepInfo),this.optionsEditor.on(u.OPTION_CHANGED_EVENT,function(){e._onChangePropertyValue()})},N.prototype._createBrowserDialogsEditor=function(t){var e=this;this.$argumentsContainer||this._createArgumentsContainer(t),this.dialogsEditor=new f(this.$argumentsContainer,this.stepInfo),this.dialogsEditor.on(f.OPTION_CHANGED_EVENT,function(t){e._hasNativeDialogError()&&t.dialog&&(e.options.dialogError.code===a.API_EXPECTED_DIALOG_DOESNT_APPEAR&&e.options.dialogError.dialog===t.dialog&&!t.state||e.options.dialogError.code===a.API_UNEXPECTED_DIALOG&&e.options.dialogError.dialog===t.dialog&&t.state)&&(e.options.dialogError=null,e.stepInfo.dialogError=null,e.dialogsEditor.removeError()),e._onChangePropertyValue()})},N.prototype._createArguments=function(t){var e=this,o=n("<div></div>").appendTo(t);r.addClass(o,C);var s=n("<div></div>").appendTo(o);r.addClass(s,S);var a=this.actionDescriptor.type.toLowerCase();n("<span></span>").text(a).appendTo(s);var l=n("<div></div>").appendTo(s);r.addClass(l,I),r.addClass(l,a);var d=null,c=v[e.actionDescriptor.type],h=e.actionDescriptor.apiArguments;c.length||e._createBrowserDialogsEditor(o);for(var p=0;p<c.length;p++){var u=c[p],f=i(u),g=h[u],E=!g||(g.join?!g.join(""):!g);f.isReadOnly&&E||null!==g&&("options"===u?(e._createOptionsEditor(o),e._createBrowserDialogsEditor(o)):(this.dialogsEditor||e._createBrowserDialogsEditor(o),d||(d=n("<div>").appendTo(o),r.addClass(d,T)),e._createArgumentsProperty(d,u,g,h)))}},N.prototype._createSelectorArea=function(t){var e=n("<div></div>").appendTo(t);r.addClass(e,$),this.stepInfo.iFrameSelectors&&this._createIFrameSelectorEditor(e),this._createElementSelectorEditor(e)},N.prototype._createSelectorProperty=function(t,e){var i=n("<div></div>").appendTo(t);r.addClass(i,y);var o=this._createLabel(i,e);o.css("textTransform","none")},N.prototype._createIFrameSelectorEditor=function(t){this._createSelectorProperty(t,x);var e=n("<div></div>").appendTo(t);r.addClass(e,m),this.iFrameSelectorEditor=new g(e,{width:"100%",height:w,selectors:this.stepInfo.iFrameSelectors,currentSelectorIndex:this.stepInfo.currentIFrameSelectorIndex,allowEdit:!0,enableFloatMode:!1,enableValidation:!1,enableElementsMarking:!1})},N.prototype._createElementSelectorEditor=function(t){this._createSelectorProperty(t,L);var e=n("<div></div>").appendTo(t);r.addClass(e,m);var i=this.iFrameSelectorEditor&&this.iFrameSelectorEditor.getParsedSelector().length?this.iFrameSelectorEditor.getParsedSelector().$elements[0].contentWindow:null;this.selectorEditor=new g(e,{width:"100%",height:A,selectors:this.stepInfo.selectors,currentSelectorIndex:this.stepInfo.currentSelectorIndex,allowEdit:!0,enableFloatMode:this.options.enableFloatMode,$floatingParent:this.options.$floatingParent,enableValidation:this.options.enableSelectorValidation,enableElementsMarking:this.options.enableElementsMarking,allowVisibleElementsOnly:this.options.allowVisibleElementsOnly,context:i})},N.prototype._createBackground=function(){this.options.enableElementsMarking&&E.mark(this.options.$floatingParent||this.$step,n())},N.prototype._init=function(){var t=this;
this._hasNativeDialogError()&&this.dialogsEditor.showPopup(),"undefined"!=typeof t.stepInfo.selectors&&this._initSelectorEditor(),this.iFrameSelectorEditor&&this._initIFrameSelectorEditor(),this.selectorEditor&&(this.selectorEditor.on(g.FOCUS_EVENT,function(){t.eventEmitter.emit(N.SELECTOR_EDITOR_FOCUSED_EVENT)}),this.selectorEditor.on(g.BLUR_EVENT,function(){t.eventEmitter.emit(N.SELECTOR_EDITOR_BLURED_EVENT)})),"wait"===this.actionDescriptor.type&&this._initWaitActionDialogSpecificBehavior()},N.prototype._initWaitActionDialogSpecificBehavior=function(){function t(t){return"Wait "+t+" milliseconds"}function e(e,i){return t(e)===i}for(var i=this,o=null,s=0;s<this.argumentPropertyEditors.length;s++)/^ms:$/i.test(this.argumentPropertyEditors[s].getLabelText())&&(o=this.argumentPropertyEditors[s].getInputElement());o.focus(),c.select(o);var r=o.value;n(o).bind("input",function(){e(r,i.stepNamePropertyEditor.getEditorText())&&i.stepNamePropertyEditor.setEditorText(t(o.value)),r=o.value})},N.prototype._initIFrameSelectorEditor=function(){var t=this;this.iFrameSelectorEditor.on(g.SELECTOR_CHANGED_EVENT,function(e){t.stepInfo.currentIFrameSelectorIndex=e.index,t.eventEmitter.emit(N.STEP_INFO_CHANGED_EVENT,{stepInfo:t.stepInfo})})},N.prototype._initSelectorEditor=function(){var t=this;this.selectorEditor.on(g.SELECTOR_CHANGED_EVENT,function(e){t.actionDescriptor.selector=e.parsedSelector.selector,t.actionDescriptor.element=null,t.stepInfo.currentSelectorIndex=e.index,t.eventEmitter.emit(N.STEP_INFO_CHANGED_EVENT,{selector:e.text})})},N.prototype._onChangePropertyValue=function(){this.eventEmitter.emit(N.STEP_INFO_CHANGED_EVENT,{stepInfo:this.stepInfo})},N.prototype._hasPropertyError=function(){for(var t=0;t<this.argumentPropertyEditors.length;t++)if(!this.argumentPropertyEditors[t].isValid())return!0;return!1},N.prototype._hasNativeDialogError=function(){return this.options.dialogError&&this.options.dialogError.dialog&&(this.options.dialogError.code===a.API_EXPECTED_DIALOG_DOESNT_APPEAR||this.options.dialogError.code===a.API_UNEXPECTED_DIALOG)},N.prototype.getParsedSelector=function(){return this.selectorEditor?this.selectorEditor.getParsedSelector():null},N.prototype.isValid=function(t){return!this._hasPropertyError()&&(!(!t&&this._hasNativeDialogError())&&(!(this.optionsEditor&&!this.optionsEditor.isValid())&&(!this.selectorEditor||!(this.iFrameSelectorEditor&&!this.iFrameSelectorEditor.isValid(t))&&this.selectorEditor.isValid(t))))},N.prototype.destroy=function(){this.selectorEditor&&this.selectorEditor.destroy(),E.clear()}}),i.define("UI.RecorderWidgets.AddActionDialog",function(t){var i=e.get("Hammerhead"),o=i.$,n=i.Util,s=i.ShadowUI,r=t("UI.RecorderWidgets.Popup"),a=t("UI.RecorderWidgets.Button"),l=t("UI.RecorderWidgets.BaseStep"),d=t("UI.RecorderWidgets.ActionStep"),c=t("UI.RecorderWidgets.AssertionsStep"),h="buttons",p="number",u=550,f=606,g=this.exports=function(t,e,i){var o=this;this.popup=null,this.step=null,this.$addActionButton=null,this.$cancelButton=null,this.eventEmitter=new n.EventEmitter,this.on=function(t,e){o.eventEmitter.on(t,e)},this._createDialog(t,e,i),this._init()};g.ADD_ACTION_BUTTON_CLICK_EVENT="addActionButtonClick",g.CANCEL_BUTTON_CLICK_EVENT="cancelButtonClick",g.START_PICKING_ELEMENT_EVENT="startPickingElement",g.prototype._createDialog=function(t,e,i){var n=o("<div></div>"),s={width:i.isAssertion?f:u,headerIconText:e,headerIconClass:p,headerText:i.name,content:n,footerContent:this._createButtons(i),backgroundOpacity:!0,showAtWindowCenter:!0,footerWithoutTopMargins:i.isAssertion};if(this.popup=new r(t,s),i.isAssertion)this.step=new c(n,e,i,{enableAssertionsValidation:!0,parentPopup:this.popup}),this.popup.showAtWindowCenter();else{this.step=new d(n,e,i,{enableFloatMode:!0,$floatingParent:this.popup.getContainer(),enableSelectorValidation:!0,enableElementsMarking:!0});var a=this.step.getParsedSelector();a&&a.length&&a.$elements&&this.popup.disposeRelativeToElement(a.$elements)}},g.prototype._createButtons=function(){var t=o("<div></div>");return s.addClass(t,h),this.$addActionButton=a.create(t,"OK"),this.$cancelButton=a.create(t,"Cancel"),t},g.prototype._onError=function(){this.$addActionButton.attr("disabled","disabled")},g.prototype._onSuccess=function(){this.$addActionButton.removeAttr("disabled")},g.prototype._init=function(){var t=this;s.bind(this.$addActionButton,"click",function(){t._close(function(){t.eventEmitter.emit(g.ADD_ACTION_BUTTON_CLICK_EVENT,{stepInfo:t.step.getStepInfo()})})}),s.bind(this.$cancelButton,"click",function(){t._close(function(){t.eventEmitter.emit(g.CANCEL_BUTTON_CLICK_EVENT,{})})}),this.popup.onkeydown(function(e){e.keyCode===n.KEYS_MAPS.SPECIAL_KEYS.enter&&(t.$addActionButton&&"hidden"!==t.$addActionButton.css("visibility")&&t.$addActionButton.trigger("click"),n.preventDefault(e)),e.keyCode===n.KEYS_MAPS.SPECIAL_KEYS.esc&&(t.$cancelButton.trigger("click"),n.preventDefault(e)),e.target===t.popup.$popup[0]&&n.isArrowKey(e.keyCode)&&n.preventDefault(e)},!0),this.step.on(l.STEP_INFO_CHANGED_EVENT,function(){t.step.isValid()?t._onSuccess():t._onError()}),this.step.on(l.STEP_NAME_CHANGED_EVENT,function(e){t.popup.setHeaderText(e.name)}),this.step.getStepInfo().isAssertion?this.step.on(c.START_PICKING_ELEMENT_EVENT,function(e){t.eventEmitter.emit(g.START_PICKING_ELEMENT_EVENT,e)}):(this.step.on(d.SELECTOR_EDITOR_FOCUSED_EVENT,function(){t.popup.$header.css("cursor","default"),t.popup.blind(!0)}),this.step.on(d.SELECTOR_EDITOR_BLURED_EVENT,function(){t.popup.blind(!1),t.popup.$header.css("cursor","move"),t.popup.getContainer().focus()})),t.step.isValid()||t._onError()},g.prototype._close=function(t){this.step.destroy(),this.popup.close(t)}}),i.define("UI.RecorderWidgets.AuthenticationDialog",function(t,i){var o=e.get("Hammerhead"),n=o.$,s=o.Util,r=o.ShadowUI,a=t("UI.ValidationMessageFactory"),l=t("UI.RecorderWidgets.Popup"),d=t("UI.RecorderWidgets.Button"),c="Authentication Required",h="Log In",p="Cancel",u="User Name:",f="Password:",g="<p>The %s website requires authentication. Please fill in the username and password to log in.</p><br /><p>The login information will be saved to the fixture file.</p>",E="logInButtonClick",v="cancelButtonClick",_="authentication-dialog-area",m="credentials-area",C="login-area",T="message",S="field",I="value",y="input",$="input-separator",b="buttons",x=null,L=null,A=null,w=null,N=null,P=function(t,e){return g.replace("%s",t).replace("%s",e)},D=function(t,e){var o=e.originUrl,n=e.serverMessage||"",r=e.username||"",a=e.password||"",d=e.errorMessage,h={width:750,content:R(P(o,n),r,a),headerText:c,footerContent:V(e.cancelButtonText),showAtWindowCenter:!0,notDialog:!0};d&&i.showErrorMessage(d),L=new l(t,h),L.onkeydown(function(t){t.keyCode===s.KEYS_MAPS.SPECIAL_KEYS.enter&&(s.getActiveElement().blur(),O(),s.preventDefault(t))}),A.focus()},R=function(t,e,i){var o="tcc-uni-1b73311b",a="tcc-pi-a7c77c94",l=n("<div>"),d=n("<div>").appendTo(l),c=n("<div>").appendTo(d),h=n("<div>").appendTo(d),p=n("<div>").appendTo(d),g=n("<label>").attr("for",o).html(u).appendTo(h),E=n("<div>").appendTo(h),v=n("<label>").attr("for",a).html(f).appendTo(p),b=n("<div>").appendTo(p);if(A=n("<input>").attr("id",o).attr("value",e).appendTo(E),w=n('<input type="password">').attr("id",a).attr("value",i).appendTo(b),N=n("<div>").insertAfter(h),r.addClass(l,_),r.addClass(d,m),r.addClass(c,T),r.addClass(h,C),r.addClass(N,$),r.addClass(g,S),r.addClass(v,S),r.addClass(E,I),r.addClass(b,I),r.addClass(A,y),r.addClass(w,y),s.isWebKit||n.browser.opera){var x={position:"relative",top:"1px"};g.css(x),v.css(x)}return l},V=function(t){var e=n("<div>");return d.create(e,h).click(O),d.create(e,t||p).click(function(){x.emit(v,{})}),r.addClass(e,b),e},O=function(){var t=A.attr("value");if(t)a.success(A),x.emit(E,{username:t,password:w.attr("value")});else{var e=function(){a.success(A),A.unbind("change",e)};a.error(A),A.bind("change",e)}a.success(w),N.css("visibility","hidden")};i.init=function(t,e){x=new s.EventEmitter,D(t,e)},i.close=function(t){L.close(t)},i.blind=function(t){L.blind(t)},i.showErrorMessage=function(t){N.css("visibility","visible"),a.error(A),a.error(w,t,!0)},i.events={on:function(t,e){x.on(t,e)}}}),i.define("UI.RecorderWidgets.BackToInitialPage",function(t,i){var o=e.get("Hammerhead"),n=o.$,s=o.Util,r=o.ShadowUI,a=t("UI.RecorderWidgets.ConfirmDialog"),l=t("UI.RecorderWidgets.Button"),d="back-to-initial",c="buttons",h=["The tested page state was changed by the test steps, which are now deleted. Please return to the initial test page."];i.BACK_TO_INITIAL_PAGE_EVENT="backToInitialPageButtonClick";var p=null,u=null,f=null,g=function(){var t=n("<div></div>");return r.addClass(t,c),f=l.create(t,"Go back to initial page"),t},E=function(t){p=new a(t,{message:h,footerContent:g(),popupWidth:540}),r.addClass(p.popup.$popup,d),v()},v=function(){r.bind(f,"click",function(){_(function(){u.emit(i.BACK_TO_INITIAL_PAGE_EVENT)})}),p.popup.onkeydown(function(t){t.keyCode===s.KEYS_MAPS.SPECIAL_KEYS.enter&&(f.trigger("click"),s.preventDefault(t)),t.target===p.popup.$popup[0]&&s.isArrowKey(t.keyCode)&&s.preventDefault(t)},!0)},_=function(t){p.popup.close(t)};i.init=function(t){u=new s.EventEmitter,E(t)},i.events={on:function(t,e){u.on(t,e)}}}),i.define("UI.RecorderWidgets.BaseStep",function(t){var i=e.get("Hammerhead"),o=i.$,n=i.Util,s=i.ShadowUI,r=t("UI.RecorderWidgets.DialogProperty"),a="step",l="field",d="separator",c=this.exports=function(t,e,i,o){var s=this;this.options=o||{},this.$step=null,this.stepNamePropertyEditor=null,this.stepInfo=i,this.stepNum=e,this.eventEmitter=new n.EventEmitter,this.on=function(t,e){s.eventEmitter.on(t,e)},this._createBaseStep(t),this._initBaseStep()};c.STEP_NAME_CHANGED_EVENT="stepNameChanged",c.STEP_INFO_CHANGED_EVENT="stepInfoChanged",c.prototype._createBaseStep=function(t){this.$step=o("<div></div>").appendTo(t),s.addClass(this.$step,a),this._createStepName(this.$step)},c.prototype._createLabel=function(t,e,i){var n=o("<label></label>").appendTo(t).text(e);return s.addClass(n,l),i&&n.attr("for",i),n},c.prototype._createStepName=function(t){this.stepNamePropertyEditor=new r(t,"Name:",this.stepInfo.name,{maximizeInput:!0});var e=o("<div></div>").appendTo(t);s.addClass(e,d)},c.prototype._initBaseStep=function(){var t=this;this.stepNamePropertyEditor.on(r.VALUE_CHANGED_EVENT,function(e){t.stepNamePropertyEditor.isValid()&&(t.stepInfo.name=e.value,t.eventEmitter.emit(c.STEP_NAME_CHANGED_EVENT,{name:t.stepInfo.name}))})},c.prototype.isValid=function(){return!0},c.prototype.getStepInfo=function(){return this.stepInfo},c.prototype.destroy=function(){}}),i.define("UI.RecorderWidgets.Button",function(){var t=e.get("Hammerhead"),i=t.$,o=t.Util,n=t.ShadowUI,s="button",r="button-icon";this.exports.create=function(t,e,a){var l=i("<button></button>").appendTo(t);if(a){n.addClass(i("<div></div>").appendTo(l),r);var d=i("<span></span>").html(e).appendTo(l);o.isSafari&&d.css({position:"relative",top:"2px"})}else l.html(e),o.isSafari&&l.css({paddingTop:"2px",paddingBottom:"0px"});return n.addClass(l,s),l}}),i.define("UI.RecorderWidgets.Checkbox",function(){var t=e.get("Hammerhead"),i=t.$,o=t.Util,n=t.ShadowUI,s="checkbox",r="checkbox-icon",a="checkbox-title",l="pressed",d=this.exports=function(t,e,i){var n=this;this.$checkbox=null,this.$checkboxTitle=null,this.$checkboxContainer=null,this.state=e||!1,this.eventEmitter=new o.EventEmitter,this.on=function(t,e){n.eventEmitter.on(t,e)},this._create(t,i),this._init()};d.STATE_CHANGED_EVENT="stateChanged",d.prototype._create=function(t,e){this.$checkboxContainer=i("<div></div>").appendTo(t),n.addClass(this.$checkboxContainer,s),this.$checkbox=i("<div></div>").appendTo(this.$checkboxContainer),n.addClass(this.$checkbox,r),this.state&&n.addClass(this.$checkbox,l),e&&(this.$checkboxTitle=i("<span></span>").html(e).appendTo(this.$checkboxContainer),n.addClass(this.$checkboxTitle,a),o.isIE&&9===o.browserVersion&&this.$checkboxTitle[0].setAttribute("unselectable","on")),this._init()},d.prototype._init=function(){var t=this,e=function(e){t.changeState(),o.preventDefault(e)};n.bind(this.$checkboxContainer,"click",e)},d.prototype.changeState=function(){this.state?n.removeClass(this.$checkbox,l):n.addClass(this.$checkbox,l),this.state=!this.state,this.eventEmitter.emit(d.STATE_CHANGED_EVENT,{state:this.state})},d.prototype.getContainer=function(){return this.$checkbox}}),i.define("UI.RecorderWidgets.CodeEditor",function(i){var n=e.get("Hammerhead"),s=n.$,r=n.Util,a=n.ShadowUI,l=n.NativeMethods,d=i("Recorder.KeyEventParser"),c=i("UI.RecorderWidgets.CodeFormatter"),h="codeEditor",p="editable",u="scrollable",f="line",g="editorCursor",E="editorTextarea",v="letter-width-finder",_="selection",m="start",C="end",T="disabled",S=400,I=150,y=80,$=4,b=4,x=500,L=500,A="    ",w=100,N=[40,91,123],P=[41,93,125],D=r.isMacPlatform?"meta":"ctrl",R=this.exports=function(t,e){this.$editor=null,this.$scrollLayout=null,this.$editLayout=null,this.$cursor=null,this.$textarea=null,this.$lines=[],this.$selectionStart=null,this.$selectionCenter=null,this.$selectionEnd=null,this.editorWidth=0,this.editorHeight=0,this.fixedHeight=!0,this.floatingWidth=!1,this.expandDirection=null,this.holdFocus=!1,this.inPaste=!1,this.state={lineIndex:0,position:0,selectionRegion:{startPosition:0,startLine:0,endPosition:0,endLine:0,inverse:!1}},this.stateStack=[],this.stateIndex=0,this.mouseLeftButtonPressed=!1,this.mouseRightButtonPressed=!1,this.allowEdit=!0,this.expanded=!1,this.buffer=[],this.changes={modified:[],added:[],removed:[]},this.lineHeight=null,this.letterWidth=null,this.codeFormatter=new c,this._init(t,e)};R.CHANGE_EVENT="change",R.FOCUS_EVENT="focus",R.BLUR_EVENT="blur",R.prototype._createEditor=function(t){this.$editor=t,a.addClass(this.$editor,h),this.$scrollLayout=s("<div>").appendTo(this.$editor),a.addClass(this.$scrollLayout,u),this.$editLayout=s("<div>").appendTo(this.$scrollLayout),a.addClass(this.$editLayout,p)},R.prototype._createCursor=function(){this.$cursor=s("<div>").appendTo(this.$scrollLayout),a.addClass(this.$cursor,g),this.$cursor.css({height:this._getLineHeight(),opacity:0})},R.prototype._createTextArea=function(){this.$textarea=s("<textarea>").appendTo(this.$editor),this.$textarea.css("width",21),r.isIE&&(this.$textarea.css("background-color","red"),this.$textarea.css("font-size","0em")),a.addClass(this.$textarea,E)},R.prototype._createSelectionAreas=function(){this.$selectionStart=s("<div>").appendTo(this.$scrollLayout),a.addClass(this.$selectionStart,_),a.addClass(this.$selectionStart,m),this.$selectionStart.css("height",this._getLineHeight()),this.$selectionCenter=s("<div>").appendTo(this.$scrollLayout),a.addClass(this.$selectionCenter,_),this.$selectionCenter.css("width",this.$scrollLayout[0].clientWidth),this.$selectionCenter.css("height",0),this.$selectionEnd=s("<div>").appendTo(this.$scrollLayout),a.addClass(this.$selectionEnd,_),a.addClass(this.$selectionEnd,C),this.$selectionEnd.css("height",this._getLineHeight())},R.prototype._createLines=function(t,e){if(!e.length)return[];var i=null,o="<div><span></span></div>";s.each(e,function(t,e){var n=s(o);n.children("span").text(e||""),a.addClass(n,f),i=i?i.add(n):n});var n=this.$editLayout.children(":nth-child("+t+")");return 0===t?i.prependTo(this.$editLayout):n.length?i.insertAfter(n):i.appendTo(this.$editLayout),i},R.prototype._highlight=function(t){this.codeFormatter&&this.codeFormatter.highlight(this.$lines,t,this.state.lineIndex)},R.prototype._init=function(t,e){var i=this;e=e||{},e={width:e.width||S,height:e.height||I,fixedHeight:"undefined"==typeof e.fixedHeight||e.fixedHeight,text:e.text||"",allowEdit:"undefined"==typeof e.allowEdit||e.allowEdit,floatingWidth:e.floatingWidth||!1,expandDirection:e.expandDirection||"right"},i.eventEmitter=new r.EventEmitter,i.events={on:function(t,e){i.eventEmitter.on(t,e)}},i._createEditor(t),i._initEditor(e),e.text?i._setEditorText(e.text):i._addLine(void 0,""),i._createCursor(),i._createTextArea(),i._initTextArea(),i._createSelectionAreas(),i._initSelectionAreas(),i._setCursor(0,0),r.isIE&&r.setUnselectableAttributeRecursive(i.$scrollLayout[0]),i._clearChanges(),i._textChanged()},R.prototype._initEditor=function(t){var e=this;"string"==typeof t.width&&t.width.indexOf("%")!==-1?e.editorWidth=Math.floor(e.$editor.parent().width()*t.width.substring(0,t.width.indexOf("%"))/100):e.editorWidth=t.width,"string"==typeof t.height&&t.height.indexOf("%")!==-1?e.editorHeight=Math.floor(e.$editor.parent().height()*t.height.substring(0,t.height.indexOf("%"))/100):e.editorHeight=t.height,e.fixedHeight=t.fixedHeight,e.allowEdit=t.allowEdit,e.floatingWidth=t.floatingWidth,e.expandDirection=t.expandDirection,e.allowEdit||a.addClass(this.$editor,T),e.$scrollLayout.css("width",e.editorWidth),e.$editor.css("height",e.editorHeight),e.$scrollLayout.css("height",e.editorHeight),e.fixedHeight||e.$scrollLayout.css("overflowY","visible"),e.$scrollLayout.mousedown(function(t){return e._mousedown(t),!1}),e.$scrollLayout.dblclick(function(t){return e._dblclick(t),!1}),a.bind(s(o),"mouseup",function(){e.stopSelectionProcess()}),e.$scrollLayout.mouseup(function(){if(e.mouseRightButtonPressed=!1,e.mouseLeftButtonPressed=!1,!r.isMozilla)return!1}),a.bind(s(o),"mousemove",function(t){e._mousemove(t)}),a.bind(e.$scrollLayout,"undefined"!=typeof o.onwheel?"wheel":"mousewheel",function(t){var e=-t.wheelDelta||(t.originalEvent?8*t.originalEvent.deltaY:100*t.deltaY),i=s(this),o=i.scrollTop(),n=r.getBordersWidth(i),a=this.scrollHeight-this.clientHeight,l=Math.min(Math.max(o+e,0),a);return this.scrollHeight!==this.clientHeight+n.top+n.bottom&&i.scrollTop(l),r.preventDefault(t),!1})},R.prototype._expandEditor=function(){this.expanded=!0,a.addClass(this.$editor,"expanded"),this.$editLayout.width()<=this.$scrollLayout.width()||this._updateEditorSize()},R.prototype._collapseEditor=function(){this.expanded=!1,a.removeClass(this.$editor,"expanded"),"left"===this.expandDirection&&(this.$scrollLayout.css("marginLeft",0),this.$scrollLayout.css("position","relative")),this.$scrollLayout.width(this.editorWidth),this._updateEditorSize()},R.prototype._initTextArea=function(){var e=this;e._initEventParser(),a.bind(e.$textarea,"blur",function(){e._blur()}),a.bind(e.$textarea,"focus",function(){e._focus()}),a.bind(e.$textarea,"contextmenu",function(){l.setTimeout.call(t,function(){e.$textarea.css("z-index",0),r.isIE&&e.$textarea.css("font-size","0em"),r.isMozilla||r.isIE||(e.$textarea[0].value="")},0)}),a.bind(e.$textarea,"copy",function(){e._onCopyCodeEditorText()}),a.bind(e.$textarea,"paste",function(){e._onPasteCodeEditor()}),a.bind(e.$textarea,"cut",function(){e._onCutCodeEditor()})},R.prototype._getShortcutHandlers=function(){var t=this,e={};return e.left=function(){t._shortcutHandlers().left()},e.right=function(){t._shortcutHandlers().right()},e.up=function(){t._shortcutHandlers().up()},e.down=function(){t._shortcutHandlers().down()},e.enter=function(){t._shortcutHandlers().enter()},e.backspace=function(){t._shortcutHandlers().backspace()},e["delete"]=function(){t._shortcutHandlers()["delete"]()},e.home=function(){t._shortcutHandlers().home()},e.end=function(){t._shortcutHandlers().end()},e.tab=function(){t._shortcutHandlers().tab()},e["shift+tab"]=function(){t._shortcutHandlers().shiftTab()},e["shift+left"]=function(){t._shortcutHandlers().shiftLeft()},e["shift+right"]=function(){t._shortcutHandlers().shiftRight()},e["shift+up"]=function(){t._shortcutHandlers().shiftUp()},e["shift+down"]=function(){t._shortcutHandlers().shiftDown()},e["shift+home"]=function(){t._shortcutHandlers().shiftHome()},e["shift+end"]=function(){t._shortcutHandlers().shiftEnd()},e[D+"+left"]=function(){t._shortcutHandlers().ctrlLeft()},e[D+"+right"]=function(){t._shortcutHandlers().ctrlRight()},e[D+"+home"]=function(){t._shortcutHandlers().ctrlHome()},e[D+"+end"]=function(){t._shortcutHandlers().ctrlEnd()},e[D+"+backspace"]=function(){t._shortcutHandlers().ctrlBackspace()},e[D+"+delete"]=function(){t._shortcutHandlers().ctrlDelete()},e[D+"+shift+left"]=function(){t._shortcutHandlers().ctrlShiftLeft()},e["shift+"+D+"+left"]=function(){t._shortcutHandlers().ctrlShiftLeft()},e[D+"+shift+right"]=function(){t._shortcutHandlers().ctrlShiftRight()},e["shift+"+D+"+right"]=function(){t._shortcutHandlers().ctrlShiftRight()},e[D+"+shift+up"]=function(){t._shortcutHandlers().ctrlShiftUp()},e["shift+"+D+"+up"]=function(){t._shortcutHandlers().ctrlShiftUp()},e[D+"+shift+down"]=function(){t._shortcutHandlers().ctrlShiftDown()},e["shift+"+D+"+down"]=function(){t._shortcutHandlers().ctrlShiftDown()},e[D+"+x"]=function(){t._shortcutHandlers().ctrlX()},e[D+"+c"]=function(){t._shortcutHandlers().ctrlC()},e[D+"+v"]=function(){t._shortcutHandlers().ctrlV()},e[D+"+a"]=function(){t._shortcutHandlers().ctrlA()},e[D+"+z"]=function(){t._shortcutHandlers().ctrlZ()},e[D+"+shift+z"]=function(){t._shortcutHandlers().ctrlShiftZ()},e["shift+"+D+"+z"]=function(){t._shortcutHandlers().ctrlShiftZ()},e},R.prototype._initEventParser=function(){var t=this;t.keyEventParser=new d,t.keyEventParser.init({symbolPressed:function(e){t._letterPressed(e)},shortcutHandlers:t._getShortcutHandlers()});var e=["keydown","keypress","keyup"];s.each(e,function(){t.$textarea[this](function(e){if((t.allowEdit||/key(down|up)/.test(e.type)&&(17===e.keyCode||65===e.keyCode||67===e.keyCode))&&t.keyEventParser.pushEvent(e),/key(down|up)/.test(e.type)&&r.isWebKit&&(37===e.keyCode||39===e.keyCode)&&e.preventDefault(),"keydown"===e.type&&"esc"===r.KEYS_MAPS.REVERSED_SPECIAL_KEYS[e.keyCode]&&l.blur.call(t.$textarea[0]),e.stopPropagation(),"keypress"===e.type&&(!(3===e.charCode||r.isMozilla&&118===e.charCode||22===e.charCode||24===e.charCode)||!e.ctrlKey)||"keydown"===e.type&&(9===e.keyCode||8===e.keyCode||16===e.keyCode))return!1})})},R.prototype._initSelectionAreas=function(){var t=this;this.$selectionStart.mousedown(function(e){return t._mousedown(e),!1}),this.$selectionCenter.mousedown(function(e){return t._mousedown(e),!1}),this.$selectionEnd.mousedown(function(e){return t._mousedown(e),!1})},R.prototype._updateScroll=function(){var e=this.$cursor[0],i=r.getOffsetPosition(e),o=r.offsetToClientCoords({x:i.left,y:i.top});o.top<0?e.scrollIntoView():o.top+this._getLineHeight()>=s(t).height()&&e.scrollIntoView(!1);var n={left:parseInt(this.$cursor.css("left").replace("px","")),top:parseInt(this.$cursor.css("top").replace("px",""))};n.left<this.$scrollLayout.scrollLeft()?this.$scrollLayout.scrollLeft(n.left):n.left>=this.$scrollLayout.scrollLeft()+this.$scrollLayout[0].clientWidth-this._getVerticalScrollWidth()&&this.$scrollLayout.scrollLeft(n.left-this.$scrollLayout[0].clientWidth+this._getVerticalScrollWidth()+$),this.fixedHeight&&(n.top<this.$scrollLayout.scrollTop()?this.$scrollLayout.scrollTop(n.top):n.top+this._getLineHeight()>=this.$scrollLayout.scrollTop()+this.editorHeight-this._getHorizontalScrollHeight()&&this.$scrollLayout.scrollTop(n.top+this._getLineHeight()-this.editorHeight+this._getHorizontalScrollHeight()+b))},R.prototype._textChanged=function(){this._updateEditorSize(),this.changes.added.length||this.changes.removed.length?this._highlight():this._highlight(s.map(this.changes.modified,function(t){return t.index})),this._saveState(!1),this.eventEmitter.emit(R.CHANGE_EVENT,{text:this.getText()})},R.prototype._focus=function(){this.holdFocus||(this._showSelection(),this.floatingWidth&&this._expandEditor(),this._enableCursor(),this.eventEmitter.emit(R.FOCUS_EVENT))},R.prototype._blur=function(){this.holdFocus||(this._hideSelection(),this._disableCursor(),this.floatingWidth&&this._collapseEditor(),this.eventEmitter.emit(R.BLUR_EVENT))},R.prototype._enableCursorBlinking=function(){var e=this;e.cursorInterval=l.setInterval.call(t,function(){e.$cursor.css("opacity","1"===e.$cursor.css("opacity")?0:1)},x)},R.prototype._enableCursor=function(){this.allowEdit&&!this.$cursor.data("enabled")&&(this._enableCursorBlinking(),this.$cursor.data("enabled",!0),this.$cursor.css("opacity",1))},R.prototype._disableCursor=function(){if(this.allowEdit){var e=this;e.cursorInterval&&t.clearInterval(e.cursorInterval),e.cursorTimeout&&t.clearTimeout(e.cursorTimeout),e.cursorInterval=null,e.cursorTimeout=null,e.$cursor.css("opacity",0),e.$cursor.data("enabled",!1)}},R.prototype._suspendCursorBlinking=function(){if(this.allowEdit&&this.$cursor.data("enabled")){var e=this;e.cursorInterval&&t.clearInterval(e.cursorInterval),e.cursorTimeout&&t.clearTimeout(e.cursorTimeout),e.$cursor.css("opacity",1),e.cursorTimeout=l.setTimeout.call(t,function(){e._enableCursorBlinking()},L)}},R.prototype._setCursor=function(t,e,i,o){o?(this._setSelection(t,e),t=this.state.selectionRegion.inverse?this.state.selectionRegion.startLine:this.state.selectionRegion.endLine,e=this.state.selectionRegion.inverse?this.state.selectionRegion.startPosition:this.state.selectionRegion.endPosition):this._clearSelection(t,e),this.state.lineIndex=t,this.state.position=e,this._setElementPosition(this.$cursor,t,e),this._updateScroll(),this.$textarea.css({left:this.$cursor[0].offsetLeft-this.$scrollLayout[0].scrollLeft+this.$scrollLayout[0].offsetLeft-this.letterWidth,top:this.$cursor[0].offsetTop-this.$scrollLayout[0].scrollTop+this.$scrollLayout[0].offsetTop}),this._suspendCursorBlinking(),i&&this._saveState(!0)},R.prototype._setTextarea=function(t,e){var i=this._getElementPosition(t,e).left-this.$scrollLayout[0].scrollLeft+this.$scrollLayout[0].offsetLeft-this.letterWidth,o=this._getElementPosition(t,e).top-this.$scrollLayout[0].scrollTop+this.$scrollLayout[0].offsetTop;this.$textarea.css({left:i>this.$scrollLayout.width()+this.$scrollLayout[0].offsetLeft?this.$scrollLayout.width()+this.$scrollLayout[0].offsetLeft:i,top:o>this.$scrollLayout.height()+this.$scrollLayout[0].offsetTop?this.$scrollLayout.height()+this.$scrollLayout[0].offsetTop:o})},R.prototype._addLine=function(t,e,i){e=i?A+e:e,this._addLines(t,[e])},R.prototype._addLines=function(t,e){var i,o,n,a=this,l=null,d=a._createLines(t,e);s.each(d,function(e,d){var c=s(d);"undefined"!=typeof t?(a.$lines.splice(t,0,c),i=t,o=a._getLineText(i),n=a._getStateIndex(a.changes.removed,i),t++):(a.$lines.push(c),i=a.$lines.length-1,o=a._getLineText(i),n=a._getStateIndex(a.changes.removed,i)),"undefined"==typeof n?a.changes.added.push({index:i,value:o}):(a.changes.modified.push({index:i,oldValue:a.changes.removed[n].value,newValue:o}),a.changes.removed.splice(n,1)),l||(l=a._getLineHeight()),c.css("height",l),r.isIE&&r.setUnselectableAttributeRecursive(d)})},R.prototype._removeLine=function(t){var e=this._getLineText(t),i=this._getStateIndex(this.changes.added,t),o=this._getStateIndex(this.changes.modified,t);"undefined"!=typeof i?this.changes.added.splice(i,1):("undefined"!=typeof o&&this.changes.modified.splice(o,1),this.changes.removed.push({index:t,value:e})),this.$lines[t].remove(),this.$lines.splice(t,1)},R.prototype._setLineText=function(t,e){var i=this._getLineText(t),o=this._getStateIndex(this.changes.modified,t),n=this._getStateIndex(this.changes.added,t);this.$lines[t]&&this.$lines[t].children("span:first").text(e),"undefined"!=typeof o?this.changes.modified[o].newValue=e:"undefined"!=typeof n?this.changes.added[n].value=e:this.changes.modified.push({index:t,oldValue:i,newValue:e})},R.prototype._getLineText=function(t){return this.$lines[t]?this.$lines[t].text():""},R.prototype._setSelection=function(t,e){var i=this.state.selectionRegion.inverse?this.state.selectionRegion.endLine:this.state.selectionRegion.startLine,o=this.state.selectionRegion.inverse?this.state.selectionRegion.endPosition:this.state.selectionRegion.startPosition;t===i&&e===o?this._clearSelection(t,e):t<i||t===i&&e<o?(this.state.selectionRegion.endLine=i,this.state.selectionRegion.endPosition=o,this.state.selectionRegion.startLine=t,this.state.selectionRegion.startPosition=e,this.state.selectionRegion.inverse=!0):(this.state.selectionRegion.startLine=i,this.state.selectionRegion.startPosition=o,this.state.selectionRegion.endLine=t,this.state.selectionRegion.endPosition=e,this.state.selectionRegion.inverse=!1),this._updateSelectionAreas()},R.prototype._shiftSelection=function(t,e){t&&(this.state.selectionRegion.startLine+=t,this.state.selectionRegion.endLine+=t),e&&(this.state.selectionRegion.startPosition+=e,this.state.selectionRegion.endPosition+=e),this._updateSelectionAreas()},R.prototype._moveLines=function(t){var e=null;if(this._hasSelection(this.state)?this._hasSelection(this.state)&&t===-1?e=this.state.selectionRegion.startLine-1:this._hasSelection(this.state)&&1===t&&(e=this.state.selectionRegion.endLine+1):e=this.state.lineIndex+t,this.$lines[e]){var i=this._getLineText(e);if(this._hasSelection(this.state)&&this.state.selectionRegion.startLine!==this.state.selectionRegion.endLine)if(t===-1){for(var o=this.state.selectionRegion.startLine-1;o<this.state.selectionRegion.endLine;o++)this._setLineText(o,this._getLineText(o+1));this._setLineText(this.state.selectionRegion.endLine,i)}else{for(var n=this.state.selectionRegion.endLine+1;n>this.state.selectionRegion.startLine;n--)this._setLineText(n,this._getLineText(n-1));this._setLineText(this.state.selectionRegion.startLine,i)}else this._setLineText(this.state.lineIndex+t,this._getLineText(this.state.lineIndex)),this._setLineText(this.state.lineIndex,i);this._shiftSelection(t),this._setCursor(this.state.lineIndex+t,this.state.position,!1,!0),this._textChanged()}},R.prototype._updateSelectionAreas=function(){var t=this.state.selectionRegion.startLine,e=this.state.selectionRegion.endLine,i=this.state.selectionRegion.startPosition,o=this.state.selectionRegion.endPosition;if(t===e){this._clearSelectionArea(this.$selectionCenter),this._clearSelectionArea(this.$selectionEnd);var n=Math.abs(Math.floor(o*this._getLetterWidth(t))-Math.floor(i*this._getLetterWidth(t)));this._setElementPosition(this.$selectionStart,t,Math.min(o,i)),this.$selectionStart.css("width",n)}else{var s=Math.floor(this.$editLayout.width()-i*this._getLetterWidth(t)),r=Math.floor(o*this._getLetterWidth(e));if(1===Math.abs(e-t))this._clearSelectionArea(this.$selectionCenter);else{var a=(Math.abs(e-t)-1)*this._getLineHeight();this._setElementPosition(this.$selectionCenter,t+1,0),this.$selectionCenter.css("height",a+"px")}this._setElementPosition(this.$selectionStart,t,i),this._setElementPosition(this.$selectionEnd,e,0),this.$selectionStart.css("width",s),this.$selectionEnd.css("width",r)}},R.prototype._removeSelectionContent=function(){var t=this._getLineText(this.state.selectionRegion.startLine).substring(0,this.state.selectionRegion.startPosition),e=this._getLineText(this.state.selectionRegion.endLine).substring(this.state.selectionRegion.endPosition,this._getLineLength(this.state.selectionRegion.endLine));this._setLineText(this.state.selectionRegion.startLine,t+e);for(var i=this.state.selectionRegion.endLine;i>this.state.selectionRegion.startLine;i--)this._removeLine(i);this._setCursor(this.state.selectionRegion.startLine,this.state.selectionRegion.startPosition)},R.prototype._getSelectionTextAsArray=function(){var t=[];if(this._hasSelection(this.state)){t.push(this._getLineText(this.state.selectionRegion.startLine).substring(this.state.selectionRegion.startPosition,this.state.selectionRegion.startLine===this.state.selectionRegion.endLine?this.state.selectionRegion.endPosition:this._getLineLength(this.state.selectionRegion.startLine)));for(var e=this.state.selectionRegion.startLine+1;e<this.state.selectionRegion.endLine;e++)t.push(this._getLineText(e));this.state.selectionRegion.startLine!==this.state.selectionRegion.endLine&&t.push(this._getLineText(this.state.selectionRegion.endLine).substring(0,this.state.selectionRegion.endPosition))}return t},R.prototype._clearSelection=function(t,e){this.state.selectionRegion={startLine:t,startPosition:e,endLine:t,endPosition:e,inverse:!1},this._clearSelectionArea(this.$selectionStart),this._clearSelectionArea(this.$selectionCenter),this._clearSelectionArea(this.$selectionEnd)},R.prototype._clearSelectionArea=function(t){t.css("left",0),
t===this.$selectionCenter?t.css("height",0):t.css("width",0),t.css("top",0)},R.prototype._hideSelection=function(){this.$selectionStart.css("visibility","hidden"),this.$selectionCenter.css("visibility","hidden"),this.$selectionEnd.css("visibility","hidden")},R.prototype._showSelection=function(){this.$selectionStart.css("visibility",""),this.$selectionCenter.css("visibility",""),this.$selectionEnd.css("visibility","")},R.prototype._moveRight=function(t,e){var i=this.state.lineIndex,o=this.state.position;if(this._getLineLength(this.state.lineIndex)>=this.state.position+1)o++;else{if(!this.$lines[this.state.lineIndex+1])return void(this._hasSelection(this.state)&&this._setCursor(i,o,t,e));i++,o=0}this._setCursor(i,o,t,e)},R.prototype._moveLeft=function(t){var e=this.state.lineIndex,i=this.state.position;if(this.state.position-1===-1){if(this.state.lineIndex-1===-1)return void(this._hasSelection(this.state)&&this._setCursor(e,i,!0,t));e--,i=this._getLineLength(e)}else i--;this._setCursor(e,i,!0,t)},R.prototype._moveUp=function(t){var e=this.state.lineIndex,i=this.state.position;if(this.state.lineIndex-1===-1){if(this.state.position-1===-1)return void(this._hasSelection(this.state)&&this._setCursor(e,i,!0,t));i=0}else this._getLineLength(this.state.lineIndex-1)<=this.state.position?(e--,i=this._getLineLength(e)):e--;this._setCursor(e,i,!0,t)},R.prototype._moveDown=function(t){var e=this.state.lineIndex,i=this.state.position;if(this.$lines[this.state.lineIndex+1])this._getLineLength(this.state.lineIndex+1)<=this.state.position?(e++,i=this._getLineLength(e)):e++;else{if(this.state.position===this._getLineLength(this.$lines.length-1))return void(this._hasSelection(this.state)&&this._setCursor(e,i,!0,t));i=this._getLineLength(this.$lines.length-1)}this._setCursor(e,i,!0,t)},R.prototype._mousedown=function(e){var i=this,n=e.pageX,s=e.pageY,a=this.$scrollLayout[0].scrollLeft,d=this.$scrollLayout[0].scrollTop,c=o.activeElement===this.$textarea[0];if(n=n-this._getEditorOffset().left+a,s=s-this._getEditorOffset().top+d,!(s>this.$scrollLayout[0].offsetHeight+d-this._getHorizontalScrollHeight()||n>this.$scrollLayout[0].offsetWidth+a-this._getVerticalScrollWidth())){var h=this._getCodeEditorRelativePosition(n,s),p=this._selectionContains({lineIndex:h.lineIndex,position:h.position}),u=function(){c||(i.$scrollLayout[0].scrollLeft=a,i.$scrollLayout[0].scrollTop=d),r.BUTTON.LEFT===e.button?i.mouseLeftButtonPressed=!0:r.BUTTON.RIGHT===e.button&&(r.isIE&&i.$textarea.css("font-size","1em"),i.$textarea.css("z-index",10),i.mouseRightButtonPressed=!0,i._hasSelection(i.state)&&p&&i._createSelectionObject()),i.mouseRightButtonPressed?i._hasSelection(i.state)?(p||(i._clearSelection(h.cursorLineIndex,h.cursorPosition),i.$textarea[0].value="",i._setCursor(h.cursorLineIndex,h.cursorPosition,!0,e.shiftKey)),i._setTextarea(h.lineIndex,h.position)):(i._setCursor(h.cursorLineIndex,h.cursorPosition,!0,e.shiftKey),h.cursorLineIndex===h.lineIndex&&h.cursorPosition===h.position||i._setTextarea(h.lineIndex,h.position)):i._setCursor(h.cursorLineIndex,h.cursorPosition,!0,e.shiftKey),c||l.focus.call(i.$textarea[0]),r.preventDefault(e)};r.isIE?l.setTimeout.call(t,u,0):u()}},R.prototype._dblclick=function(t){var e=t.originalEvent||t,i=e.pageX||e.clientX,o=e.pageY||e.clientY;if(i=i-this._getEditorOffset().left+this.$scrollLayout[0].scrollLeft,o=o-this._getEditorOffset().top+this.$scrollLayout[0].scrollTop,!(o>this.$scrollLayout[0].offsetHeight+this.$scrollLayout[0].scrollTop-this._getHorizontalScrollHeight()||i>this.$scrollLayout[0].offsetWidth+this.$scrollLayout[0].scrollLeft-this._getVerticalScrollWidth())){var n=this._findCurrentWordPosition(this.state.lineIndex,this.state.position),s=this._findCurrentWordEndPosition(this.state.lineIndex,this.state.position),r=this._findCurrentWordPosition(this.state.lineIndex,s),a=this._findCurrentWordEndPosition(this.state.lineIndex,n);this.state.position===r?n=this.state.position:this.state.position===a&&(s=this.state.position),this._setCursor(this.state.lineIndex,n,!1),this._setCursor(this.state.lineIndex,n,!0,!1),this._setCursor(this.state.lineIndex,s,!0,!0),t.preventDefault()}},R.prototype._mousemove=function(t){if(this.mouseLeftButtonPressed||this.mouseRightButtonPressed){var e=t.target,i=s(e),o=t.pageX,n=t.pageY,r=0,a=0,l=null;this.$editor.has(i).length||i.is(this.$editor)?(o=o-this._getEditorOffset().left+this.$scrollLayout[0].scrollLeft,n=n-this._getEditorOffset().top+this.$scrollLayout[0].scrollTop,l=this._getCodeEditorRelativePosition(o,n),r=l.cursorLineIndex,a=l.cursorPosition):(n>this._getEditorOffset().top+this.$editor.height()?(r=this.$lines.length-1,a=this._getLineLength(r)):n>this._getEditorOffset().top&&(r=Math.min(Math.floor((n+this.$scrollLayout[0].scrollTop-this._getEditorOffset().top)/this._getLineHeight()),this.$lines.length-1),o=o-this._getEditorOffset().left+this.$scrollLayout[0].scrollLeft,a=Math.min(this._getLineLength(r),Math.round(o/this._getLetterWidth(r)))),t.pageX<this._getEditorOffset().left&&(a=0)),r===this.state.lineIndex&&a===this.state.position||(this.mouseLeftButtonPressed?this._setCursor(r,a,!0,!0):l&&this._setTextarea(l.lineIndex,l.position))}},R.prototype._letterPressed=function(t){this._hasSelection(this.state)&&this._removeSelectionContent();var e=String.fromCharCode(t),i=this._getLineText(this.state.lineIndex),o=i.charCodeAt(this.state.position);if(s.inArray(t,N)!==-1||39===t||34===t){var n=i.length===this.state.position||32===o||59===o||s.inArray(o,P)!==-1;if(n)switch(t){case 40:e+=String.fromCharCode(41);break;case 91:e+=String.fromCharCode(93);break;case 123:e+=String.fromCharCode(125);break;case 39:e+=String.fromCharCode(39);break;case 34:e+=String.fromCharCode(34)}}return t!==o||s.inArray(o,P)===-1&&39!==o&&34!==o?(this._setLineText(this.state.lineIndex,i.substring(0,this.state.position)+e+i.substring(this.state.position,i.length)),this._moveRight(),void this._textChanged()):void this._moveRight()},R.prototype._shortcutHandlers=function(){var t=this;return{left:function(){t._hasSelection(t.state)&&!t.state.selectionRegion.inverse?t._setCursor(t.state.selectionRegion.startLine,t.state.selectionRegion.startPosition,!0):t._moveLeft()},up:function(){t._moveUp()},right:function(){t._hasSelection(t.state)&&t.state.selectionRegion.inverse?t._setCursor(t.state.selectionRegion.endLine,t.state.selectionRegion.endPosition,!0):t._moveRight(!0)},down:function(){t._moveDown()},enter:function(){t._hasSelection(t.state)&&t._removeSelectionContent();var e=t._getLineText(t.state.lineIndex),i=e.substring(t.state.position,e.length),o=e.substring(0,t.state.position),n=/\S/g,s=n.exec(o),r=s?n.lastIndex-1:o.length,a=[""];a.length+=r,a=a.join(" "),t._setLineText(t.state.lineIndex,o),t._checkBracketPairCharCodes(e.charCodeAt(t.state.position-1),i.charCodeAt(0))?(r+=4,t._addLine(t.state.lineIndex+1,A+a),t._addLine(t.state.lineIndex+2,a+i)):t._addLine(t.state.lineIndex+1,a+i),t._setCursor(t.state.lineIndex+1,r),t._textChanged()},backspace:function(){if(t._hasSelection(t.state))t._removeSelectionContent();else{var e=t._getLineText(t.state.lineIndex);if(0===t.state.position){if(!t.$lines[t.state.lineIndex-1])return;var i=t._getLineLength(t.state.lineIndex-1);t._setLineText(t.state.lineIndex-1,t._getLineText(t.state.lineIndex-1)+e),t._removeLine(t.state.lineIndex),t._setCursor(t.state.lineIndex-1,i)}else t._checkBracketPairCharCodes(e.charCodeAt(t.state.position-1),e.charCodeAt(t.state.position))||t._checkQuotesPairCharCodes(e.charCodeAt(t.state.position-1),e.charCodeAt(t.state.position))?t._setLineText(t.state.lineIndex,e.substring(0,t.state.position-1)+e.substring(t.state.position+1,e.length)):t._setLineText(t.state.lineIndex,e.substring(0,t.state.position-1)+e.substring(t.state.position,e.length)),t._setCursor(t.state.lineIndex,t.state.position-1)}t._textChanged()},"delete":function(){if(t._hasSelection(t.state))t._removeSelectionContent();else{var e=t._getLineText(t.state.lineIndex);if(t.state.position===t._getLineLength(t.state.lineIndex)){if(!t.$lines[t.state.lineIndex+1])return;t._setLineText(t.state.lineIndex,e+t._getLineText(t.state.lineIndex+1)),t._removeLine(t.state.lineIndex+1)}else t._setLineText(t.state.lineIndex,e.substring(0,t.state.position)+e.substring(t.state.position+1,e.length))}t._textChanged()},home:function(){var e=t._getLineSpaceCount(t.state.lineIndex),i=0;(0===t.state.position||t.state.position>e)&&(i=e),t._setCursor(t.state.lineIndex,i,!0)},end:function(){t.state.position!==t._getLineLength(t.state.lineIndex)&&t._setCursor(t.state.lineIndex,t._getLineLength(t.state.lineIndex),!0)},tab:function(){var e=t._getLineText(t.state.lineIndex);if(t._hasSelection(t.state)){for(var i=t.state.selectionRegion.startLine;i<=t.state.selectionRegion.endLine;i++)0!==t._getLineLength(i)&&t._setLineText(i,A+t._getLineText(i));t._shiftSelection(0,A.length),t._setCursor(t.state.lineIndex,t.state.position+A.length>e.length?e.length:t.state.position+A.length,!1,!0)}else{for(var o=4-t.state.position%4,n="",s=0;s<o;s++)n+=" ";t._setLineText(t.state.lineIndex,e.substring(0,t.state.position)+n+e.substring(t.state.position,e.length)),t._setCursor(t.state.lineIndex,t.state.position+o,!1)}t._textChanged()},shiftTab:function(){var e=4,i=t._getLineSpaceCount(t.state.lineIndex),o=i>=e?e:i,n=!1;if(t._hasSelection(t.state)){for(var s=t.state.selectionRegion.startLine;s<=t.state.selectionRegion.endLine;s++)t._removeLineTabIndent(s)&&(n=!0);t._shiftSelection(0,-o)}else n=t._removeLineTabIndent(t.state.lineIndex);t._setCursor(t.state.lineIndex,t.state.position-o>0?t.state.position-o:0,!1,t._hasSelection(t.state)),n&&t._textChanged()},shiftLeft:function(){t._moveLeft(!0)},shiftRight:function(){t._moveRight(!0,!0)},shiftUp:function(){t._moveUp(!0)},shiftDown:function(){t._moveDown(!0)},shiftHome:function(){var e=t._getLineSpaceCount(t.state.lineIndex),i=0;(0===t.state.position||t.state.position>e)&&(i=e),t._setCursor(t.state.lineIndex,i,!0,!0)},shiftEnd:function(){t._setCursor(t.state.lineIndex,t._getLineLength(t.state.lineIndex),!0,!0)},ctrlLeft:function(){var e=t._findWordBoundary("left");t.state.lineIndex===e.lineIndex&&t.state.position===e.position||t._setCursor(e.lineIndex,e.position,!0)},ctrlRight:function(){var e=t._findWordBoundary("right");t.state.lineIndex===e.lineIndex&&t.state.position===e.position||t._setCursor(e.lineIndex,e.position,!0)},ctrlBackspace:function(){if(t._hasSelection(t.state))t._removeSelectionContent();else{var e=t.state.lineIndex,i=t.state.position;if(0===e&&0===i)return;var o=t._findWordBoundary("left"),n=t._getLineText(e);t._setCursor(o.lineIndex,o.position),o.lineIndex===e?t._setLineText(e,n.substring(0,o.position)+n.substring(i,t._getLineLength(e))):(t._setLineText(o.lineIndex,t._getLineText(o.lineIndex)+n.substring(i,t._getLineLength(e))),t._removeLine(e))}t._textChanged()},ctrlDelete:function(){if(t._hasSelection(t.state))t._removeSelectionContent();else{var e=t.state.lineIndex,i=t.state.position,o=t._getLineText(e);if(e===t.$lines.length-1&&i===o.length)return;var n=t._findWordBoundary("right");n.lineIndex===e?t._setLineText(e,o.substring(0,i)+o.substring(n.position,t._getLineLength(e))):(t._setLineText(e,t._getLineText(e)+t._getLineText(n.lineIndex).substring(n.position,t._getLineLength(n.lineIndex))),t._removeLine(n.lineIndex))}t._textChanged()},ctrlHome:function(){0===t.state.lineIndex&&0===t.state.position||t._setCursor(0,0,!0)},ctrlEnd:function(){t.state.lineIndex===t.$lines.length-1&&t.state.position===t._getLineLength(t.$lines.length-1)||t._setCursor(t.$lines.length-1,t._getLineLength(t.$lines.length-1),!0)},ctrlShiftLeft:function(){var e=t._findWordBoundary("left");t.state.lineIndex===e.lineIndex&&t.state.position===e.position||t._setCursor(e.lineIndex,e.position,!0,!0)},ctrlShiftRight:function(){var e=t._findWordBoundary("right");t.state.lineIndex===e.lineIndex&&t.state.position===e.position||t._setCursor(e.lineIndex,e.position,!0,!0)},ctrlShiftUp:function(){t._moveLines(-1)},ctrlShiftDown:function(){t._moveLines(1)},ctrlX:function(){t._onCutCodeEditor()},ctrlC:function(){t._hasSelection(t.state)&&(t.buffer=t._getSelectionTextAsArray(),t._onCopyCodeEditorText())},ctrlV:function(){t._onPasteCodeEditor()},ctrlA:function(){var e=t.$lines.length-1,i=t._getLineLength(e);t._setCursor(0,0),t._setCursor(e,i,!0,!0)},ctrlZ:function(){t.stateStack[t.stateIndex-1]&&(t._undoState(t.stateIndex),t.stateIndex=t.stateIndex-1)},ctrlShiftZ:function(){t.stateStack[t.stateIndex+1]&&(t._redoState(t.stateIndex),t.stateIndex=t.stateIndex+1)}}},R.prototype._createSelectionObject=function(){var e=this,i=null;t.getSelection?(i=t.getSelection(),i.removeAllRanges()):(i=o.selection,i.clear()),e.$textarea[0].value=r.isMozilla?e._getSelectionTextAsArray().join("\n"):"12",e.$textarea[0].select()},R.prototype._onCopyCodeEditorText=function(e){var i,n=this;t.getSelection?(i=t.getSelection(),i.removeAllRanges()):(i=o.selection,i.clear()),n.holdFocus=!0;var s=n._createTextareaForCopyCodeEditorText(e);try{s[0].select()}catch(r){s[0].select()}l.setTimeout.call(t,function(){s.remove(),l.focus.call(n.$textarea[0]),l.setTimeout.call(t,function(){n.holdFocus=!1},0)},0)},R.prototype._onPasteCodeEditor=function(){var e=this;e.inPaste||(e.inPaste=!0,l.setTimeout.call(t,function(){var t=e.$textarea[0].value;if(t){e.buffer=[];var i=t.replace(/\r\n/g,"\n"),o=i.split("\n");s.each(o,function(t,i){e.buffer.push(i)}),e.$textarea[0].value=""}e._insertText(e.buffer),e.inPaste=!1},0))},R.prototype._insertText=function(t){if(t.length){var e=this._getLineText(this.state.lineIndex);if(this._hasSelection(this.state)&&(this._removeSelectionContent(),e=this._getLineText(this.state.lineIndex)),1===t.length)this._setLineText(this.state.lineIndex,e.substring(0,this.state.position)+t[0]+e.substring(this.state.position,e.length)),this._setCursor(this.state.lineIndex,this.state.position+t[0].length);else{this._setLineText(this.state.lineIndex,e.substring(0,this.state.position)+t[0]);var i=e.substring(this.state.position);this._addLines(this.state.lineIndex+1,t.slice(1,t.length-1)),this.state.lineIndex+=t.length-1,this._addLine(this.state.lineIndex,t[t.length-1]+i),this._setCursor(this.state.lineIndex,t[t.length-1].length)}this._textChanged()}},R.prototype._onCutCodeEditor=function(){var t=this;if(t._hasSelection(t.state))t.buffer=t._getSelectionTextAsArray(),t._onCopyCodeEditorText(),t._removeSelectionContent();else if(t.buffer[0]=t._getLineText(t.state.lineIndex),t.buffer[1]="",t._onCopyCodeEditorText(t.state.lineIndex),t.state.lineIndex!==t.$lines.length-1){t._removeLine(t.state.lineIndex);var e=t._getLineLength(t.state.lineIndex)>t.state.position?t.state.position:t._getLineLength(t.state.lineIndex);t._setCursor(t.state.lineIndex,e,!1)}else{if(0===t._getLineText(t.state.lineIndex).length)return;t._setLineText(t.state.lineIndex,""),t._setCursor(t.state.lineIndex,0)}t._textChanged()},R.prototype._getLetterWidth=function(t){var e=this.$lines[t].children("span"),i=e.text().length,o=i?e.width()/i:0;return this.letterWidth||(this.letterWidth=this._calculateLetterWidth()),o||this.letterWidth},R.prototype._calculateLineHeight=function(){var t=this.$lines[0],e=s("<span>").text("a").css("fontFamily",t.css("fontFamily")).css("fontSize",t.css("fontSize")).css("position","absolute").appendTo(a.getRoot()),i=e.height();return e.remove(),i},R.prototype._calculateLetterWidth=function(){var t=s("<span></span>").text("1234567890").css("position","absolute").appendTo(this.$editor);a.addClass(t,v);var e=t.width()/t.text().length;return t.remove(),e},R.prototype._getLineHeight=function(){var t=this;return t.lineHeight||(t.lineHeight=t._calculateLineHeight()),t.lineHeight},R.prototype._removeLineTabIndent=function(t){var e=this._getLineText(t),i=4,o=this._getLineSpaceCount(t),n=o>=i?i:o;return!!n&&(this._setLineText(t,e.substring(n,e.length)),!0)},R.prototype._getLineSpaceCount=function(t){for(var e=this._getLineText(t),i=e.length,o=0,n=0;n<i&&/\s/.test(e[n]);n++)o++;return o},R.prototype._getCodeEditorRelativePosition=function(t,e){var i=this,o={lineIndex:0,position:0,cursorLineIndex:0,cursorPosition:0};o.lineIndex=Math.floor(e/i._getLineHeight()),o.cursorLineIndex=o.lineIndex>=i.$lines.length?i.$lines.length-1:o.lineIndex;var n=o.lineIndex>=i.$lines.length?this.letterWidth:i._getLetterWidth(o.lineIndex);return o.position=Math.round(t/n),o.cursorPosition=o.position>i._getLineLength(o.cursorLineIndex)?i._getLineLength(o.cursorLineIndex):o.position,o},R.prototype._findWordBoundary=function(t){var e="left"===t?-1:1,i={lineIndex:this.state.lineIndex,position:this.state.position};return e===-1&&0===i.position||1===e&&i.position===this._getLineLength(i.lineIndex)?this.$lines[i.lineIndex+e]&&(i.lineIndex=i.lineIndex+e,i.position=e===-1?this._getLineLength(i.lineIndex):0):i.position=e===-1?this._findCurrentWordPosition(i.lineIndex,i.position):this._findNextWordPosition(i.lineIndex,i.position),i},R.prototype._findCurrentWordPosition=function(t,e){var i=/(\b\S)|$|(\s[\W]+)/g,o=this._getLineText(t),n=o.substring(0,e),s="",r="",a="";do s=a,r=i.lastIndex,a=i.exec(n)[0],/^\s+$/.test(a)||(a=a.replace(/^\s+/,""));while(a);return r-s.length},R.prototype._findCurrentWordEndPosition=function(t,e){var i=/(\S\b)|$|(\s[\W]+)/g,o=this._getLineText(t),n=o.substring(e,o.length);return i.exec(n)[0].replace(/^\s+/,""),e+=i.lastIndex,e>this._getLineLength(t)?this._getLineLength(t):e},R.prototype._findNextWordPosition=function(t,e){var i=/(\b\S)|$|(\s[\W]+)/g,o=this._getLineText(t),n=o.substring(e,o.length),s=i.exec(n)[0].replace(/^\s+/,"");return i.lastIndex<2&&(s=i.exec(n)[0].replace(/^\s+/,"")),e+=i.lastIndex-s.length,e>this._getLineLength(t)?this._getLineLength(t):e},R.prototype._findLongerLineIndex=function(){var t=this;if(t.$lines.length){var e=0,i=t._getLineLength(0);return s.each(t.$lines,function(o){t._getLineLength(o)>i&&(e=o,i=t._getLineLength(o))}),e}return 0},R.prototype._getEditorOffset=function(){return r.getOffsetPosition(this.$scrollLayout[0])},R.prototype._updateEditorSize=function(){var t=this._findLongerLineIndex(),e=parseInt(this.$scrollLayout.css("borderLeftWidth"))+parseInt(this.$scrollLayout.css("borderRightWidth")),i=Math.max(this.editorWidth-e,this._getLineLength(t)*this._getLetterWidth(t)+this.$cursor.width());if(this.expanded){var o=Math.min(i,this._getLetterWidth(t)*y+this.$cursor.width())+e;this.$editLayout.css("width",i),"left"===this.expandDirection&&(this.$scrollLayout.css("marginLeft",this.editorWidth-o),this.$scrollLayout.css("position","absolute")),this.$scrollLayout.width(o),this.$scrollLayout.css("overflow-x",o<i+e?"scroll":"hidden")}else{var n=this.$scrollLayout[0].clientWidth||this.$scrollLayout.width();i>n?(this.$editLayout.css("width",i),this.$scrollLayout.css("overflow-x",this.floatingWidth?"hidden":"scroll")):(this.$editLayout.css("width",n),this.$scrollLayout.css("overflow-x","hidden"))}var s=this.$lines.length*this._getLineHeight(),r=this._getHorizontalScrollHeight();if(this.fixedHeight)s+r>this.editorHeight?(this.$editLayout.css("height",s),this.$scrollLayout.css("overflowY","scroll")):(this.$editLayout.css("height",this.editorHeight-r),this.$scrollLayout.css("overflowY","hidden"));else{var a=Math.max(this.editorHeight,s+r)+b;this.$editLayout.css("height",""),this.$editor.css("height",a),this.$scrollLayout.css("height",a),this.$editLayout.css("height",this.$scrollLayout.height()-r-b)}this.$selectionCenter.css("width",this.$editLayout.width()+"px")},R.prototype._getLineLength=function(t){return this.$lines[t]?this._getLineText(t).length:0},R.prototype._getElementPosition=function(t,e){var i=t>=this.$lines.length?this.letterWidth:this._getLetterWidth(t);return{left:e*i,top:t*this._getLineHeight()}},R.prototype._setElementPosition=function(t,e,i){var o=this._getElementPosition(e,i);t.css("left",Math.floor(o.left)),this.$lines[e]&&t.css("top",o.top)},R.prototype._getVerticalScrollWidth=function(){var t=parseInt(this.$scrollLayout.css("borderLeftWidth").replace("px",""))+parseInt(this.$scrollLayout.css("borderRightWidth").replace("px",""));return this.$scrollLayout[0].offsetWidth-this.$scrollLayout[0].clientWidth-t},R.prototype._getHorizontalScrollHeight=function(){var t=parseInt(this.$scrollLayout.css("borderTopWidth").replace("px",""))+parseInt(this.$scrollLayout.css("borderBottomWidth").replace("px",""));return this.$scrollLayout[0].offsetHeight-this.$scrollLayout[0].clientHeight-t},R.prototype._hasSelection=function(t){return!(t.selectionRegion.startLine===t.selectionRegion.endLine&&t.selectionRegion.startPosition===t.selectionRegion.endPosition)},R.prototype._selectionContains=function(t){return(t.lineIndex>this.state.selectionRegion.startLine||t.lineIndex===this.state.selectionRegion.startLine&&t.position>=this.state.selectionRegion.startPosition)&&(t.lineIndex<this.state.selectionRegion.endLine||t.lineIndex===this.state.selectionRegion.endLine&&t.position<=this.state.selectionRegion.endPosition)},R.prototype._createTextareaForCopyCodeEditorText=function(t){var e=this,i=o.createElement("textarea"),n=s(i);n.appendTo(a.getRoot()),n.css({overflow:"hidden",width:"1px",height:"1px",position:"absolute",top:"-999px",left:"-999px"});var r="undefined"!=typeof t?e._getLineText(t)+"\r\n":this._getSelectionTextAsArray().join("\n");return n.text(r),n},R.prototype._checkBracketPairCharCodes=function(t,e){return 40===t&&41===e||91===t&&93===e||123===t&&125===e},R.prototype._checkQuotesPairCharCodes=function(t,e){return 39===t&&39===e||34===t&&34===e},R.prototype._getEditorText=function(){var t=this,e=s.map(t.$lines,function(e,i){return t._getLineText(i)});return e.join("\r\n").replace(/\xA0/g," ")},R.prototype._setEditorText=function(t){if(this.$lines.length)for(this._clearSelection(0,0);this.$lines.length;)this._removeLine(0);var e=t.replace(/\r\n/g,"\n");this._addLines(void 0,e.split("\n"))},R.prototype._saveState=function(t){this.changes.removed.sort(function(t,e){return t.index-e.index}),this.changes.added.sort(function(t,e){return t.index-e.index});var e=this.stateStack[this.stateIndex],i={lineIndex:this.state.lineIndex,position:this.state.position,selectionRegion:{startPosition:this.state.selectionRegion.startPosition,startLine:this.state.selectionRegion.startLine,endPosition:this.state.selectionRegion.endPosition,endLine:this.state.selectionRegion.endLine,inverse:this.state.selectionRegion.inverse},isCursor:t,changes:this.changes};if(this._clearChanges(),!t||i.changes.added.length||i.changes.modified.length||i.changes.removed.length||i.lineIndex!==e.lineIndex||i.position!==e.position){if(e&&this.stateIndex!==this.stateStack.length-1){if(t)return;for(;this.stateIndex<this.stateStack.length-1;)this.stateStack.pop()}t&&e&&e.isCursor&&this.stateStack.pop(),this.stateStack.length===w&&this.stateStack.shift(),this.stateStack.push(i),this.stateIndex=this.stateStack.length-1}},R.prototype._redoState=function(t){for(var e=this,i=e.stateStack[t+1],o=0;o<i.changes.modified.length;o++)e._setLineText(i.changes.modified[o].index,i.changes.modified[o].newValue);for(var n=0;n<i.changes.added.length;n++)e._addLine(i.changes.added[n].index,i.changes.added[n].value);for(var s=i.changes.removed.length-1;s>=0;s--)e._removeLine(i.changes.removed[s].index);e._applyState(i),this.eventEmitter.emit(R.CHANGE_EVENT,{text:this.getText()})},R.prototype._undoState=function(t){for(var e=this,i=e.stateStack[t].changes,o=e.stateStack[t-1],n=0;n<i.modified.length;n++)e._setLineText(i.modified[n].index,i.modified[n].oldValue);for(var s=i.added.length-1;s>=0;s--)e._removeLine(i.added[s].index);for(var r=0;r<i.removed.length;r++)e._addLine(i.removed[r].index,i.removed[r].value);e._applyState(o),this.eventEmitter.emit(R.CHANGE_EVENT,{text:this.getText()})},R.prototype._applyState=function(t){var e=this;if(this._clearChanges(),e._updateEditorSize(),e._hasSelection(t)){var i=t.selectionRegion.inverse?t.selectionRegion.endLine:t.selectionRegion.startLine,o=t.selectionRegion.inverse?t.selectionRegion.endPosition:t.selectionRegion.startPosition;e._setCursor(i,o),e.state.selectionRegion.inverse=t.inverse,e._setCursor(t.lineIndex,t.position,!1,!0)}else e._setCursor(t.lineIndex,t.position);e._updateScroll(),e._highlight()},R.prototype._clearChanges=function(){this.changes={modified:[],added:[],removed:[]}},R.prototype._getStateIndex=function(t,e){var i;return s.each(t,function(t,o){if(o.index===e)return i=t,!1}),i},R.prototype.enableEdit=function(t){this.allowEdit!==t&&(this.allowEdit=t,t?(this.keyEventParser||this._initEventParser(),a.removeClass(this.$editor,T)):a.addClass(this.$editor,T))},R.prototype.getText=function(){return this._getEditorText()},R.prototype.setText=function(t){var e=this._getEditorText();e!==t&&(this._setEditorText(t),this._setCursor(this.$lines.length-1,this._getLineLength(this.$lines.length-1)),this._textChanged())},R.prototype.insertText=function(t){this._insertText(t.replace(/\r\n/g,"\n").split("\n"))},R.prototype.addClass=function(t){a.addClass(this.$editor,t)},R.prototype.removeClass=function(t){a.removeClass(this.$editor,t)},R.prototype.getContainer=function(){return this.$scrollLayout},R.prototype.blur=function(){var t=l.blur.call(this.$textarea[0]);return this.eventEmitter.emit(R.BLUR_EVENT),t},R.prototype.focus=function(){return l.focus.call(this.$textarea[0])},R.prototype.setCursorToEnd=function(){var t=this.$lines.length-1;this._setCursor(t,this._getLineLength(t))},R.prototype.stopSelectionProcess=function(){if(this.mouseRightButtonPressed=!1,this.mouseLeftButtonPressed=!1,this._hasSelection(this.state)||(this.state.selectionRegion.endLine=this.state.lineIndex,this.state.selectionRegion.endPosition=this.state.position),!r.isMozilla)return!1}}),i.define("UI.RecorderWidgets.CodeFormatter",function(){function i(t,e){return e?new RegExp(""+t.join("|"),"g"):new RegExp("\\b("+t.join("|")+")\\b","g")}function o(){var t=l.map(L,function(t){return t+"(?=\\(([^\\)]*\\))?)"});return new RegExp("\\b"+t.join("|"),"g")}function n(){var t=l.map(A,function(t){return"\\."+t});return new RegExp(t.join("|")+"\\b","g")}function s(t){return"~~~C"+t+"~~~"}function r(t,e){var i=l("<span>").html(e);return c.addClass(i,t),i.wrap("<p>").parent().html()}var a=e.get("Hammerhead"),l=a.$,d=a.Util,c=a.ShadowUI,h=a.NativeMethods,p=20,u="comment",f="keyword",g="string",E="operator",v="literal",_="argument",m="functionName",C="function",T="property",S="language",I="number",y="object",$=["break","case","catch","continue","debugger","default","delete","do","else","finally","for","function","if","in","instanceof","new","return","switch","this","throw","try","typeof","var","void","while","with"],b=["&lt;","&gt;","=","\\!","\\+","\\-","\\*","\\%","&amp;","\\|","\\b[0-9]+\\b","\\$(?=\\.|\\()"],x=["null","true","false","undefined","NaN","Infinity"],L=["alert","eval","toString","apply","call","test","toLocaleString","concat","join","pop","push","reverse","shift","slice","sort","slice","unshift","indexOf","lastIndexOf","fromCharCode","valueOf","charAt","charCodeAt","match","replace","search","slice","split","substring","substr","toLowerCase","toLocaleLowerCase","toUpperCase","toLocaleUpperCase","trim","abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","random","round","sin","sqrt","tan","parse","UTC","now","toDateString","toTimeString","toLocaleString","toLocaleDateString","toLocaleTimeString","getTime","getFullYear","getUTCFullYear","getMonth","getUTCMonth","getDate","getUTCDate","getDay","getUTCDay","getHours","getUTCHours","getMinutes","getUTCMinutes","getSeconds","getUTCSeconds","getMilliseconds","getUTCMilliseconds","getTimezoneOffset","setTime","setMilliseconds","setUTCMilliseconds","setSeconds","setUTCSeconds","setMinutes","setUTCMinutes","setHours","setUTCHours","setDate","setUTCDate","setMonth","setUTCMonth","setFullYear","setUTCFullYear","toUTCString","toJSON","exec","test","parse","stringify","parseInt","parseFloat","isNaN","isFinite"],A=["length","constructor","prototype","MAX_VALUE","MIN_VALUE","NEGATIVE_INFINITY","POSITIVE_INFINITY","E","LN10","LN2","LOG2E","LOG10E","PI","SQRT1_2","SQRT2","name"],w=["Array","Boolean","Date","Math","Number","Object","RegExp","String","window"],N={"<":"&lt;",">":"&gt;","&":"&amp;"},P=this.exports=function(){this.commentsState=[],this.prevCommentsState=[],this.lineStartPositions=[],this.timeouts=[]};P.prototype._clearTimeouts=function(){for(;this.timeouts.length;)t.clearTimeout(this.timeouts.pop())},P.prototype._getLineFromTextPosition=function(t){for(var e=0;this.lineStartPositions[e+1];){if(t<=this.lineStartPositions[e+1])return e;e++}return e},P.prototype._isCommentsStateChanged=function(t){var e=function(t){return l.map(t,function(t){return""+t.start.line+":"+t.start.position+"-"+t.end.line+":"+t.end.position}).join(" ")};return e(t)!==e(this.commentsState)},P.prototype._isLineCommentsStateChanged=function(t){var e=function(t){var e="";return l.map(t,function(t){e=e.concat("undefined"==typeof t.start?"start":t.start,"-","undefined"==typeof t.end?"end":t.end)}),e};return e(this._getLineCommentsState(t,!0))!==e(this._getLineCommentsState(t,!1))},P.prototype._updateCommentsState=function(t){for(var e=/(?:\/\*)|(?:\/\/)|(?:'|")|(\\n)/gm,i=-1,o=-1,n=!1,s=!1,r=e.exec(t),a=null,l=null,d=null,c=null,h=null,p=[],u=function(n){var r=t.indexOf(n,e.lastIndex),a=t.indexOf("\n",e.lastIndex)-1;a<0&&(a=t.length-1);var l=r<0?a:Math.min(a,r);i=e.lastIndex-1,o=l,s=!0};r;){var f=r[0];if(n||s){if(e.lastIndex-f.length<=o){"//"===r[0]&&e.lastIndex--,r=e.exec(t);continue}n=!1,s=!1}switch(f){case"/*":var g=t.indexOf("*/",e.lastIndex);a=g<0?t.length-1:g,i=e.lastIndex-"/*".length,o=a+(g<0?0:1),l=this._getLineFromTextPosition(i),d=i-this.lineStartPositions[l],c=this._getLineFromTextPosition(o),h=o-this.lineStartPositions[c],p.push({start:{line:l,position:d,multiline:!0},end:{line:c,position:h}}),n=!0;break;case"//":a=t.indexOf("\n",e.lastIndex-1),a<0&&(a=t.length-1),i=e.lastIndex-"//".length,o=a,l=this._getLineFromTextPosition(i),d=i-this.lineStartPositions[l],c=this._getLineFromTextPosition(o),h=o-this.lineStartPositions[c],"\n"===t[a]&&h--,p.push({start:{line:l,position:d},end:{line:c,position:h}}),n=!0;break;case"'":u("'");break;case'"':u('"')}r=e.exec(t)}return!!this._isCommentsStateChanged(p)&&(this.prevCommentsState=this.commentsState,this.commentsState=p,!0)},P.prototype._getLineCommentsState=function(t,e){var i=[];return l.each(e?this.prevCommentsState:this.commentsState,function(e,o){o.start.line===t?o.end.line===t?i.push({start:o.start.position,end:o.end.position}):i.push({start:o.start.position}):o.end.line===t?i.push({end:o.end.position}):o.start.line<t&&o.end.line>t&&i.push({start:0})}),i},P.prototype._highlightLine=function(t,e){var a=t.replace(/[<>&]/g,function(t){return N[t]}),d=this._getLineCommentsState(e),c=a.length;d=l.map(d,function(t){return{start:t.start||0,end:t.end||c-1}});var h=[],p=0,L=l.map(d,function(t,e){var i=t.start+p,o=t.end+p+1,n=o-i,r=s(e),l=a.substring(i,o);return p+=r.length-n,a=a.substring(0,i)+r+a.substring(o,a.length),{replacer:r,value:l}});return a=a.replace(/(^|[^\\])((?:'(?:\\'|[^'])*(?:'|$))|(?:"(?:\\"|[^"])*(?:"|$)))/g,function(t,e,i){var o=h.length;return h.push(i),e+"~~~S"+o+"~~~"}).replace(i(b,!0),function(t){return t[0]>="0"&&t[0]<="9"?r(I,t):r(E,t)}).replace(/(\S+)(\.\S+\s?(?:<[^>]+>)?=(?:<[^>]+>)?\s?function\s?\([^\)]*\))/g,function(t,e,i){return r(y,e)+i}).replace(/(\S+)(\.prototype\.\S+\s?(?:<[^>]+>)?=(?:<[^>]+>)?)/g,function(t,e,i){return r(y,e)+i}).replace(/(\bfunction(?:\s?|(?:\s[^\(]+))\()([^\)]+)(\))/g,function(t,e,i,o){return e+r(_,i)+o}).replace(/(\bfunction\s)(\w+)(\([^\)]*\))/g,function(t,e,i,o){return e+r(m,i)+o}).replace(/(\s|^|\.)(\w+)(\s?(?:(?:\s?(?:<[^>]+>)?=(?:<[^>]+>)?\s?)|=)\s?function\s?\([^\)]*\))/g,function(t,e,i,o){return e+r(m,i)+o}).replace(i($),function(t){return r(f,t)}).replace(i(x),function(t){return r(v,t)}).replace(o(),function(t){return r(C,t)}).replace(n(),function(t){return"."+r(T,t.substring(1))}).replace(i(w),function(t){return r(S,t)}).replace(/~~~(S)(\d+)~~~/g,function(t,e,i){return r(g,h[i])}),l.each(L,function(t,e){var i=r(u,e.value);
a=a.replace(e.replacer,i)}),a},P.prototype._highlightLines=function(e,i,o,n){var s=this,r=null;if(void 0===i||0===i.length||n)s._clearTimeouts(),r={start:0,end:e.length-1};else if(1===i.length)r={start:i[0],end:i[0]};else{var a=i.sort();r={start:a[0],end:a[i.length-1]}}var c=function(e,o,n){var r=Math.min(p,e.length),a=n?e.splice(e.length-r,r):e.splice(0,r),u=l.map(a,function(t){return t.text()});l.each(a,function(t,e){var a=n?o-r+t+1:o+t;if(!i||!i.length||l.inArray(a,i)>-1||s._isLineCommentsStateChanged(a)){var c=s._highlightLine(u[t],a),h=e.children("span:first");h.html(c),d.isIE&&d.setUnselectableAttributeRecursive(h[0])}}),e.length&&s.timeouts.push(h.setTimeout.call(t,function(){c(e,o+r*(n?-1:1),n)},0))},u=e.slice(r.start,r.end+1);u.length>2*p&&o>r.start&&o<r.end?(c(u.slice(r.start,o),o-1,!0),c(u.slice(o),o)):c(u,r.start)},P.prototype.highlight=function(t,e,i){var o=this;o.lineStartPositions=[0];var n=0,s=l.map(t,function(t){var e=t.text();return n+=e.length+1,o.lineStartPositions.push(n),e}).join("\n"),r=o._updateCommentsState(s);o._highlightLines(t,e,i,r)}}),i.define("UI.RecorderWidgets.Combobox",function(){var i=e.get("Hammerhead"),n=i.$,s=i.Util,r=i.NativeMethods,a=i.ShadowUI,l=i.TextSelection,d="combobox",c="dropdown-button",h="dropdown-img",p="pressed",u="hovered",f="items",g="item",E=3,v="valueChanged",_=this.exports=function(t,e,i,o){var n=this;this.$combobox=null,this.$dropdownButton=null,this.$input=null,this.$itemList=null,this.items=[],this.itemListCreated=null,this.eventEmitter=new s.EventEmitter,this.events={on:function(t,e){n.eventEmitter.on(t,e)}},this._createCombobox(t,e,i,o)};_.prototype._createCombobox=function(t,e,i,o){this.$combobox=n("<div></div>").appendTo(t),a.addClass(this.$combobox,d),this.items=e,this.$input=n('<input type="text">').appendTo(this.$combobox).attr("id",o).attr("value",i),this.$dropdownButton=n("<div></div>").appendTo(this.$combobox),a.addClass(this.$dropdownButton,c);var s=n("<div></div>").appendTo(this.$dropdownButton);a.addClass(s,h),this._init()},_.prototype._createItemList=function(){var t=this;t.itemListCreated=!0,this.$itemList=n("<div></div>").appendTo(this.$combobox),a.addClass(this.$itemList,f),n.each(this.items,function(e,i){var o=n("<div></div>").text(i).appendTo(t.$itemList);a.addClass(o,g),0===e&&o.css("margin-top","6px"),o.mouseenter(function(){a.removeClass(t._getHoveredItem(),u),a.addClass(o,u)}),o.click(function(){t._setValue(o.text()),t._hideItemList()})}),this.$itemList.css({width:this.$combobox.width(),display:"none"}),a.addClass(t.$dropdownButton,p),this._updateItemListPosition()},_.prototype._onArrowPressed=function(t){var e=this,i=e._getHoveredItem(),o=i.text(),s=n.inArray(o,e.items),r=e._getValue(),l=n.inArray(r,e.items),c=e.itemListCreated&&e.$itemList.is(":visible"),h=c?s:l;(1===t&&h!==-1&&h!==e.items.length-1||t===-1&&h!==-1&&0!==h)&&(c&&(a.removeClass(e._getHoveredItem(),u),a.addClass(a.select("."+d+">."+f+">."+g+":visible").eq(h+t),u)),e._setValue(e.items[h+t]))},_.prototype._init=function(){var t=this,e=function(e){var i=t.$input[0].value.length;e.button!==s.BUTTON.LEFT&&!s.hasTouchEvents||t.itemListCreated||t._createItemList(),(e.button===s.BUTTON.LEFT||s.hasTouchEvents)&&(t.$itemList.is(":visible")?t._hideItemList():t._showItemList()),r.focus.call(t.$input[0]),l.select(t.$input[0],i,i),s.preventDefault(e)};a.bind(this.$input,"mousedown",e),a.bind(this.$dropdownButton,"mousedown",e),a.bind(this.$input,"focus",function(){var e=t.$input[0].value.length;r.focus.call(t.$input[0]),l.select(t.$input[0],e,e)}),a.bind(this.$input,"keydown",function(e){var i=e.keyCode;return s.isCharByKeyCode(i,s.isShadowUIElement)||/^(backspace|delete)$/.test(s.KEYS_MAPS.REVERSED_SPECIAL_KEYS[i])?void s.preventDefault(e):void(/^(down|right)$/.test(s.KEYS_MAPS.REVERSED_SPECIAL_KEYS[i])?(t._onArrowPressed(1),s.preventDefault(e)):/^(up|left)$/.test(s.KEYS_MAPS.REVERSED_SPECIAL_KEYS[i])?(t._onArrowPressed(-1),s.preventDefault(e)):/^(enter|esc)$/.test(s.KEYS_MAPS.REVERSED_SPECIAL_KEYS[i])&&t.$itemList&&"none"!==t.$itemList.css("display")?(t._hideItemList(),s.preventDefault(e)):t.itemListCreated&&t._hideItemList())})},_.prototype._setValue=function(t){this.$input.attr("value")!==t&&(this.$input.attr("value",t),this.eventEmitter.emit(v,{value:t}))},_.prototype._getValue=function(){return this.$input.attr("value")},_.prototype._updateItemListPosition=function(){var e=n(t),i=s.getOffsetPosition(this.$combobox[0]),o=this.$itemList.height(),r=i.top-e.scrollTop()+this.$combobox.height();if(r+o>e.scrollTop()+e.height()){var a=i.top-E-o;a>=e.scrollTop()&&(r=a)}this.$itemList.css({left:i.left-e.scrollLeft(),top:r})},_.prototype._showItemList=function(){var e=this,i=function(l){var d=l.target||l.srcElement;e.$combobox.has(d).length||(e._hideItemList(),a.unbind(n(o),"mousedown",i),a.unbind(n(o),"scroll",r),a.unbind(n(t),"resize",s))},s=function(){e.itemListCreated&&e.$itemList.is(":visible")&&(e._hideItemList(),a.unbind(n(o),"mousedown",i),a.unbind(n(o),"scroll",r)),a.unbind(n(t),"resize",s)},r=function(){e._hideItemList(),a.unbind(n(o),"mousedown",i),a.unbind(n(o),"scroll",r),a.unbind(n(t),"resize",r)};this._updateItemListPosition(),this.$itemList.css("display","");var l=this.$itemList.children().filter(function(){return n(this).text()===e._getValue()});return a.addClass(l,u),a.addClass(e.$dropdownButton,p),a.bind(n(o),"mousedown",i),a.bind(n(o),"scroll",r),a.bind(n(t),"resize",s),!1},_.prototype._hideItemList=function(){return a.removeClass(this._getHoveredItem(),u),this.$itemList.css("display","none"),a.removeClass(this.$dropdownButton,p),!1},_.prototype._getHoveredItem=function(){return a.select("."+d+">."+f+">."+g+"."+u)}}),i.define("UI.RecorderWidgets.ConfirmDialog",function(t){var i=e.get("Hammerhead"),o=i.$,n=i.ShadowUI,s=t("UI.RecorderWidgets.Popup"),r="confirm",a="confirm-message",l="justify-text",d=this.exports=function(t,e){this.options=e,this.popup=null,this.headerText="",this.confirmMessage=[],this._createDialog(t)};d.prototype._createDialog=function(t){this.headerText=this.options.headerText||"",this.confirmMessage=this.options.message||"";var e={width:this.options.popupWidth||528,content:this._createContent(o("<div></div>")),footerContent:this.options.footerContent,headerText:this.options.headerText,showAtWindowCenter:!0};this.popup=new s(t,e)},d.prototype._createContent=function(t){var e=this;n.addClass(t,r);var i=o("<div></div>").appendTo(t);n.addClass(i,a);var s=null;return this.confirmMessage.length?o.each(this.confirmMessage,function(t,r){s=o("<span></span>").appendTo(i).html(r),e.options.justifyText&&n.addClass(s,l)}):(s=o("<span></span>").appendTo(i).html(this.confirmMessage),e.options.justifyText&&n.addClass(s,l)),t},d.prototype.closeDialog=function(t){this.popup.close(t)},d.prototype.blind=function(t){this.popup.blind(t)}}),i.define("UI.RecorderWidgets.DialogProperty",function(i){var o=e.get("Hammerhead"),n=o.$,s=o.Util,r=o.ShadowUI,a=o.EventSandbox,l=o.NativeMethods,d=i("UI.ValidationMessageFactory"),c=i("Shared.Const"),h=o.TextSelection,p="dialog-property",u="maximized",f="small",g="field",E="value",v="readonly_property",_="input",m="disabled",C="Incorrect keys",T=333,S=52,I=this.exports=function(t,e,i,o){var n=this;this.options=o||{},this.labelText=e,this.isDisabled=!1,this.hasError=!1,this.$container=t,this.$property=null,this.$field=null,this.$value=null,this.$input=null,this.eventEmitter=new s.EventEmitter,this.on=function(t,e){n.eventEmitter.on(t,e)},this._createProperty(i),this.options.isReadOnly||(this._initPropertyInput(),this._validate())};I.VALUE_CHANGED_EVENT="valueChangedEvent",I.prototype._createProperty=function(t){this.$property=n("<div></div>").appendTo(this.$container),r.addClass(this.$property,p),this.options.maximizeInput&&r.addClass(this.$property,u),this.options.smallInput&&r.addClass(this.$property,f);var e=c.PROPERTY_PREFIX+this.labelText+Math.random().toString().replace("0.","-");this._createLabel(e),this.options.isReadOnly?(r.addClass(this.$property,v),this._createTextView(t)):this._createTextInput(e,t)},I.prototype._createLabel=function(t){this.$field=n("<label></label>").appendTo(this.$property).text("caretPos"===this.labelText?"caretPos:":this.labelText),r.addClass(this.$field,g),this.$field.attr("for",t)},I.prototype._createTextView=function(t){"string"==typeof t&&(t=[t]),this.$value=n("<div>").appendTo(this.$property);for(var e=0;e<t.length;e++)n("<span>").text(t[e]).appendTo(this.$value),n("<br>").appendTo(this.$value);r.addClass(this.$value,E)},I.prototype._createTextInput=function(t,e){this.$value=n("<div></div>").appendTo(this.$property),r.addClass(this.$value,E),this.$input=n('<input type="text">').appendTo(this.$value).attr("id",t).attr("value",e),r.addClass(this.$input,_),this.options.maximizeInput&&this.$input.width(this.$container.width()-S)},I.prototype._initPropertyInput=function(){var e=this,i=null;this.$input.bind("focus",function(t){if(e.isDisabled){var i=r.select("."+_,e.$container),o=n.inArray(e.$input[0],i);do o=o===i.length-1?0:o++;while(i[o]!==e.$input[0]&&r.hasClass(i.eq(o),m));i[o]!==e.$input[0]&&i.eq(o).focus(),s.preventDefault(t)}}),this.$input.bind("mousedown",function(t){e.isDisabled&&s.preventDefault(t)}),a.addInternalEventListener(t,["keydown"],function(t){if(t.target===e.$input[0]){if(e.isDisabled)return s.preventDefault(t),!1;var i=t.keyCode,o=189===i||109===i,n=!t.shiftKey&&i>=48&&i<=57||i>=96&&i<=105,r=s.isCharByKeyCode(i);r?e.options.isNumericProperty&&(n||o?(e.options.isNotNegativeNumericProperty||e.options.isPositiveNumericProperty)&&o&&s.preventDefault(t):s.preventDefault(t)):e._preventInputScrolling(t)}}),a.addInternalEventListener(t,["keypress","keyup"],function(t){t.target===e.$input[0]&&s.stopPropagation(t)}),this.$input.bind("input",function(){i&&(t.clearTimeout(i),i=null);var o=e._isValid();o?(e._onSuccess(),e._onChange()):i=l.setTimeout.call(t,function(){e._onError(),e._onChange()},T)})},I.prototype._validate=function(){this._isValid()?this._onSuccess():this._onError()},I.prototype._isValid=function(){if(this.isDisabled||!this.options.isKeysProperty&&!this.options.isNumericProperty)return!0;var t=this.$input[0].value;if(!t.length)return!!this.options.isNotNegativeNumericProperty;if(this.options.isKeysProperty&&s.parseKeysString(t).error)return!1;if(this.options.isNumericProperty&&!/^(-)?\d+$/.test(n.trim(t)))return!1;if(this.options.isNotNegativeNumericProperty||this.options.isPositiveNumericProperty){var e=parseInt(n.trim(t));if(e<0)return!1;if(this.options.isPositiveNumericProperty&&0===e)return!1}return!0},I.prototype._onError=function(){d.error(this.$input,this.options.isKeysProperty?C:null),this.hasError=!0},I.prototype._onSuccess=function(){this.hasError&&(d.success(this.$input),this.hasError=!1)},I.prototype._onChange=function(){var t={};t.value=this.options.isNumericProperty&&this.$input[0].value.length?parseInt(this.$input[0].value):this.$input[0].value,this.eventEmitter.emit(I.VALUE_CHANGED_EVENT,t)},I.prototype._preventInputScrolling=function(t){if(s.isWebKit){var e=h.getSelectionStart(this.$input[0]),i=h.getSelectionEnd(this.$input[0]);e===i&&(t.keyCode===s.KEYS_MAPS.SPECIAL_KEYS.left&&0===e||t.keyCode===s.KEYS_MAPS.SPECIAL_KEYS.right&&e===this.$input[0].value.length)&&s.preventDefault(t)}},I.prototype.disable=function(){this.isDisabled=!0,this.$input&&(r.addClass(this.$input,m),s.isIE&&9===s.browserVersion||this.$input.attr("disabled","disabled"))},I.prototype.enable=function(){this.isDisabled=!1,this.$input&&(r.removeClass(this.$input,m),s.isIE&&9===s.browserVersion||this.$input.removeAttr("disabled"))},I.prototype.isValid=function(){return!this.hasError},I.prototype.getLabelText=function(){return this.labelText},I.prototype.getInputElement=function(){if(this.$input)return this.$input[0]},I.prototype.getEditorText=function(){if(this.$input)return this.$input[0].value},I.prototype.setEditorText=function(t){this.$input&&(this.$input[0].value=t,this._onChange())}}),i.define("UI.RecorderWidgets.ElementsMarker",function(i,o){function n(t,e){var i=B.getElementRectangleForMarking(t[0],e,K);return new ht(i.left,i.top,i.width,i.height)}function s(){var t=[];return O.each(arguments,function(e,i){O.each(i,function(e,i){O.inArray(i,t)<0&&t.push(i)})}),t}function r(t,e){for(var i=e+1;i<t.length;i++)for(var o=0;o<t[e].length;o++)if(O.inArray(t[e][o],t[i])>=0)return i;return-1}function a(t){for(var e=t.concat(),i=0;i<e.length;i++){var o=r(e,i);o>0&&(e[i]=s(e[i],e[o]),e.splice(o,1),i--)}return e}function l(t){for(var e=[],i=0;i<t.length;i++){for(var o=[t[i]],n=i+1;n<t.length;n++)t[i].intersectsWith(t[n])&&o.push(t[n]);o.length>1&&e.push(o)}return a(e)}function d(t){for(var e=[],i=0;i<t.length;i++)for(var o=i+1;o<t.length;o++)e=e.concat(t[i].getIntersectionPoints(t[o]));for(var n=0;n<e.length-1;n++)for(var s=n+1;s<e.length;s++)e[n].left===e[s].left&&e[n].right===e[s].left&&e.splice(s--,1);return e}function c(t,e,i){for(var o=0;o<i.length;o++)if(i[o]!==e){if(i[o].contains(t,!0))return!1;if(i[o].contains(t))if(t.isTop&&t.isLeft){if(i[o].top===t.top?i[o].left!==t.left:i[o].left===t.left)return!1}else if(t.isTop){if(i[o].top===t.top?i[o].right!==t.left:i[o].right===t.left)return!1}else if(t.isLeft){if(i[o].bottom===t.top?i[o].left!==t.left:i[o].left===t.left)return!1}else if(i[o].bottom===t.top?i[o].right!==t.left:i[o].right===t.left)return!1}return!0}function h(t,e){for(var i=0;i<e.length;i++)if(e[i].left===t.left&&e[i].top===t.top&&e[i].isTop===t.isTop&&e[i].isLeft===t.isLeft)return!0;return!1}function p(t){for(var e=[],i=0;i<t.length;i++){var o={left:t[i].left,top:t[i].top,isLeft:!0,isTop:!0},n={left:t[i].right,top:t[i].top,isTop:!0},s={left:t[i].left,top:t[i].bottom,isLeft:!0},r={left:t[i].right,top:t[i].bottom};c(o,t[i],t)&&!h(o,e)&&e.push(o),c(n,t[i],t)&&!h(n,e)&&e.push(n),c(s,t[i],t)&&!h(s,e)&&e.push(s),c(r,t[i],t)&&!h(r,e)&&e.push(r)}return e}function u(t){for(var e=t[0],i=1;i<t.length;i++)t[i].top<e.top?e=t[i]:t[i].top===e.top&&t[i].left<e.left&&(e=t[i]);return e}function f(t,e){var i=null;return t.directionRight?O.each(e,function(e,o){o.top===t.top&&o.left>t.left&&(!i||o.left<i.left)&&(i=o)}):t.directionDown?O.each(e,function(e,o){o.left===t.left&&o.top>t.top&&(!i||o.top<i.top)&&(i=o)}):t.directionLeft?O.each(e,function(e,o){o.top===t.top&&o.left<t.left&&(!i||o.left>i.left)&&(i=o)}):t.directionUp&&O.each(e,function(e,o){o.left===t.left&&o.top<t.top&&(!i||o.top>i.top)&&(i=o)}),i}function g(t){var e=d(t).concat(p(t)),i=u(e);e.splice(e.indexOf(i),1),i.directionRight=!0;for(var o=[i];e.length;){var n=f(i,e);if(!n)break;n.directionRight=n.isIntersection?i.directionDown:i.directionUp,n.directionLeft=n.isIntersection?i.directionUp:i.directionDown,n.directionUp=n.isIntersection?i.directionRight:i.directionLeft,n.directionDown=n.isIntersection?i.directionLeft:i.directionRight,i=n,e.splice(e.indexOf(n),1),o.push(i)}for(var s=" M "+o[0].left+","+o[0].top,r=1;r<o.length;r++)s+=o[r-1].directionLeft||o[r-1].directionRight?" H "+o[r].left:" V "+o[r].top;return s+=" z "}function E(t,e){var i=null,o=null,n=null,s=e.getIntersectionPoints({start:e.getCenter(),end:t.getCenter()});if(s.length){var r=s[0];r.isLeft||r.isRight?(i=r.left,o=Math.min(Math.max(r.top,e.top+z/2),e.bottom-z/2)):(r.isTop||r.isBottom)&&(o=r.top,i=Math.min(Math.max(r.left,e.left+z/2),e.right-z/2),n=!0)}return{left:i,top:o,isHorizontal:n}}function v(t,e){var i=null,o=null,n=t.getIntersectionPoints({start:e.getCenter(),end:t.getCenter()});if(n.length){var s=n[0];i=s.left,o=s.top,s.isLeft?i-=K/2:s.isRight?i+=K/2:s.isTop?o-=K/2:s.isBottom&&(o+=K/2)}return{left:i,top:o}}function _(t,e){var i=E(t,e),o=v(t,e);return{pointerStart:i,pointerEnd:o}}function m(){return nt=O("<div></div>").appendTo(k.getRoot()),k.addClass(nt,X),nt}function C(t,e){var i=[];O.each(e,function(e,o){t.intersectsWith(o)||i.push(_(o,t))});var o=[it];return o.push(T(e)),o.push(y(t,Q)),O.each(e,function(t){o.push(y(e[t],tt))}),o.push(I(t,J)),O.each(e,function(t){o.push(I(e[t],Z))}),O.each(i,function(t){o.push($(i[t]))}),o.push(ot),o.join("")}function T(t){for(var e=[],i=l(t),o=0;o<t.length;o++){for(var n=!1,s=0;s<i.length;s++)if(O.inArray(t[o],i[s])>=0){n=!0;break}n||e.push(t[o])}var r=['<path class="'+k.patchClassNames(q)+'" d="M 0,0 H ',B.getDocumentElementWidth()," V ",B.getDocumentElementHeight()," H 0 z "];return O.each(e,function(t,e){r.push(S(e))}),O.each(i,function(t,e){r.push(g(e))}),r.push('"/>'),r.join("")}function S(t){return" M "+t.left+","+t.top+" H "+t.right+" V "+t.bottom+" H "+t.left+" z "}function I(t,e){var i=e===Z?K:F;return['<rect class="'+k.patchClassNames(e)+'" x="',t.left,'" y="',t.top,'" width="',t.width,'" height="',t.height,'"','style="stroke-width:',i,';"/>'].join("")}function y(t,e){var i=e===tt?K:F;return['<path class="'+k.patchClassNames(e)+'" d="M',t.left+t.width,t.top+Y,"H",t.left+t.width+Y,"V",t.bottom+Y,"H",t.left+Y,"V",t.bottom,'"','style="stroke-width:',i,';"/>'].join(" ")}function $(t){return['<path class="'+k.patchClassNames(et)+'" d="M',t.pointerStart.isHorizontal?t.pointerStart.left-z/2:t.pointerStart.left,t.pointerStart.isHorizontal?t.pointerStart.top:t.pointerStart.top-z/2,"L",t.pointerStart.isHorizontal?t.pointerStart.left+z/2:t.pointerStart.left,t.pointerStart.isHorizontal?t.pointerStart.top:t.pointerStart.top+z/2,"L",t.pointerEnd.left,t.pointerEnd.top,"Z",'" />'].join(" ")}function b(t,e){if(at)return at=!1,!0;if(!lt||!dt||!t.equals(lt))return!0;if(e.length!==dt.length)return!0;for(var i=0;i<e.length;i++)if(!e[i].equals(dt[i]))return!0;return!1}function x(t,e){return dt&&(t.length!==e.length||t.length!==dt.length)}function L(t,e){for(var i=[],o=0;o<e.length;o++)e[o].width>1&&e[o].height>1&&B.isElementVisible(t[o])&&i.push(e[o]);return i}function A(t,e,i){var s=n(t);if(b(s,i)){x(e,i)&&ct.emit(o.ELEMENT_RECTANGLES_COUNT_CHANGED,{}),lt=s,dt=i;var r=C(s,i),a=O(r).width(B.getDocumentElementWidth()).height(B.getDocumentElementHeight()).css("position","absolute");nt.append(a),D(),st=a}}function w(t,e){var i=O.map(e,function(t){return n(O(t),G)}),o=L(e,i);A(t,i,o)}function N(){at=!0}function P(){rt&&(t.clearInterval(rt),rt=null)}function D(){st&&st.remove()}function R(){nt||m(),ct=new B.EventEmitter,P()}var V=e.get("Hammerhead"),O=V.$,B=V.Util,k=V.ShadowUI,U=V.MessageSandbox,M=V.NativeMethods,H=i("Recorder.Util"),W=i("Base.JavascriptExecutor"),F=0,K=4,G=3,Y=4,z=20,j=17,X=H.ELEMENTS_MARKER_CLASS,q="background",J="pointersBaseFrame",Q="pointersBaseFrameShadow",Z="elementFrame",tt="elementFrameShadow",et="pointer",it='<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',ot="</svg>";o.ELEMENT_RECTANGLES_COUNT_CHANGED="elementRectanglesCountChanged";var nt=null,st=null,rt=null,at=!1,lt=null,dt=null,ct=null,ht=function(t,e,i,o){this.top=e,this.left=t,this.width=i,this.height=o,this.right=t+i,this.bottom=e+o};ht.prototype.intersectsWith=function(t){return t.left<this.right&&this.left<t.right&&t.top<this.bottom&&this.top<t.bottom},ht.prototype.getIntersectionPoints=function(t){var e=[];if(t instanceof ht)t.top<this.top&&t.bottom>this.top&&(t.left>this.left&&t.left<this.right&&e.push({left:t.left,top:this.top,isTop:!0,isIntersection:!0}),t.right>this.left&&t.right<this.right&&e.push({left:t.right,top:this.top,isTop:!0,isIntersection:!0})),t.top<this.bottom&&t.bottom>this.bottom&&(t.left>this.left&&t.left<this.right&&e.push({left:t.left,top:this.bottom,isBottom:!0,isIntersection:!0}),t.right>this.left&&t.right<this.right&&e.push({left:t.right,top:this.bottom,isBottom:!0,isIntersection:!0})),t.left<this.left&&t.right>this.left&&(t.top>this.top&&t.top<this.bottom&&e.push({left:this.left,top:t.top,isLeft:!0,isIntersection:!0}),t.bottom>this.top&&t.bottom<this.bottom&&e.push({left:this.left,top:t.bottom,isLeft:!0,isIntersection:!0})),t.left<this.right&&t.right>this.right&&(t.top>this.top&&t.top<this.bottom&&e.push({left:this.right,top:t.top,isRight:!0,isIntersection:!0}),t.bottom>this.top&&t.bottom<this.bottom&&e.push({left:this.right,top:t.bottom,isRight:!0,isIntersection:!0}));else if(t.start&&t.end){var i=t.start,o=t.end,n=i.top+(o.top-i.top)*(this.left-i.left)/(o.left-i.left),s=i.top+(o.top-i.top)*(this.right-i.left)/(o.left-i.left),r=i.left+(o.left-i.left)*(this.top-i.top)/(o.top-i.top),a=i.left+(o.left-i.left)*(this.bottom-i.top)/(o.top-i.top);n<=this.bottom&&n>=this.top&&n<=Math.max(i.top,o.top)&&n>=Math.min(i.top,o.top)&&this.left>Math.min(i.left,o.left)&&this.left<Math.max(i.left,o.left)&&e.push({left:this.left,top:n,isLeft:!0,isIntersection:!0}),s<=this.bottom&&s>=this.top&&s<=Math.max(i.top,o.top)&&s>=Math.min(i.top,o.top)&&this.right>Math.min(i.left,o.left)&&this.right<Math.max(i.left,o.left)&&e.push({left:this.right,top:s,isRight:!0,isIntersection:!0}),r<=this.right&&r>=this.left&&r<=Math.max(i.left,o.left)&&r>=Math.min(i.left,o.left)&&this.top>Math.min(i.top,o.top)&&this.top<Math.max(i.top,o.top)&&e.push({left:r,top:this.top,isTop:!0,isIntersection:!0}),a<=this.right&&a>=this.left&&a<=Math.max(i.left,o.left)&&a>=Math.min(i.left,o.left)&&this.bottom>Math.min(i.top,o.top)&&this.bottom<Math.max(i.top,o.top)&&e.push({left:a,top:this.bottom,isBottom:!0,isIntersection:!0})}return e},ht.prototype.contains=function(t,e){return t instanceof ht?e?this.left<t.left&&t.right<this.right&&this.top<t.top&&t.bottom<this.bottom:this.left<=t.left&&t.right<=this.right&&this.top<=t.top&&t.bottom<=this.bottom:e?this.left<t.left&&t.left<this.right&&this.top<t.top&&t.top<this.bottom:this.left<=t.left&&t.left<=this.right&&this.top<=t.top&&t.top<=this.bottom},ht.prototype.equals=function(t){return t&&this.left===t.left&&this.top===t.top&&this.width===t.width&&this.height===t.height},ht.prototype.getCenter=function(){return{left:this.left+this.width/2,top:this.top+this.height/2}},o.mark=function(e,i){R(),w(e,i),rt=M.setInterval.call(t,function(){w(e,i)},j),O(t).on("resize",N),O(t).on("scroll",N)},o.markInContext=function(e,i,o,n){R(),ft=o,gt=e;var s={cmd:pt,selector:i,parseDomElementsOrJqueryObjectsOnly:n};U.sendServiceMsg(s,o),rt=M.setInterval.call(t,function(){U.sendServiceMsg(s,o)},j)},o.clear=function(){ft=null,gt=null,P(),D(),lt=null,dt=null,O(t).unbind("resize",N),O(t).unbind("scroll",N)},o.events={on:function(t,e){ct.on(t,e)}};var pt="getElementRectanglesRequest",ut="getElementRectanglesResponse",ft=null,gt=null;U.on(U.SERVICE_MSG_RECEIVED,function(e){var i=e.message;switch(i.cmd){case pt:var o=W.parseSelectorSync(i.selector,i.parseDomElementsOrJqueryObjectsOnly).$visibleElements,s=O.map(o,function(t){var e=n(O(t),G),i=B.offsetToClientCoords({x:e.left,y:e.top});return e.left=i.x,e.top=i.y,e}),r=L(o,s),a={cmd:ut,elementRectangles:s,correctedRectangles:r};U.sendServiceMsg(a,t.top);break;case ut:ft===e.source&&A(gt,O.map(i.elementRectangles,function(t){var i=B.getFixedPosition({x:t.left,y:t.top},e.source);return new ht(i.x,i.y,t.width,t.height)}),O.map(i.correctedRectangles,function(t){var i=B.getFixedPosition({x:t.left,y:t.top},e.source);return new ht(i.x,i.y,t.width,t.height)}))}})}),i.define("Recorder.IFrameContextLabel",function(t,i){var o=e.get("Hammerhead"),n=o.$,s=o.ShadowUI,r="remove-icon",a="context-label",l="IFrame: ";i.create=function(t,e,i,o){var d=n("<label></label>").text(l+e).appendTo(t),c=o?n("<div></div>").appendTo(t):null;s.addClass(d,a),c&&(s.addClass(c,r),c.click(function(){t.remove(),"function"==typeof i&&i()}))}}),i.define("UI.RecorderWidgets.ObjectViewer",function(t){function i(t,e){var i=Object.prototype.toString.call(e).slice(8,-1);return"undefined"!=typeof e&&null!==e&&i===t}function n(t,e){return{str:t,title:e||""}}function s(t,e,i){var o=[n("[")],s=null;return I.each(t,function(r){s=v(e+"["+r+"]",i),"Object"===s.type&&(s.rows[0].str=s.rows[0].str.substring(0,s.rows[0].str.length-1)),o.push("String"===s.type?s.rows[0]:s),r!==t.length-1&&o.push(n(", "))}),o.push(n("]")),o}function r(t){var e=[];for(var i in t)"fileCreatedDate"!==i&&"fileModifiedDate"!==i&&(y.isIE&&"external"===i?e.push([i,"Object {}"]):e.push([i,t[i]]));e.sort();var o={};return I.each(e,function(t,e){o[e[0]]=e[1]}),o}function a(t,e){var i=e||"Object";return i+=Object.getOwnPropertyNames(t).length?" {...} ":" {} ",[n(i)]}function l(t){var e=t.tagName.toLowerCase();return"<"+e+"> ... </"+e+">"}function d(t){return t.outerHTML.replace(t.innerHTML,"")}function c(t,e,i){var o=I("<span></span>").text(e).appendTo(t);return $.addClass(o,w),i&&o.attr("title",i),o}function h(t,e,i,o){var n=i?g(t,""):c(t,"");return I.each(e.rows,function(t,e){e.type?"Array"===e.type?h(n,e,!1,o):p(n,e,!1,o):c(n,e.str,e.title)}),n}function p(t,e,i,o){var n=i?g(t,""):c(t,""),s=g(n,e.rows[0].str);return $.addClass(s,D),u(n,e.stringValue,e.getInheritedProperties,o),n}function u(t,e,i,o){var n=$.select("."+D,t),s=n.text();$.bind(n,"click",function(){if("opened"!==I.data(t,"state"))R.getObjectPropertiesRows(e,i,o,function(e){e.length&&(n.text(s.substring(0,s.indexOf("{")+1)+"    "),s.indexOf(",")!==-1&&(e[e.length-1].str+=","),f(t,e,o),I.data(t,"state","opened"))});else{var r=t.children("span, div"),a=r.last(),l=a.text();n.text(s.substring(0,s.indexOf("{")+1)+"...}"+(l.indexOf(",")!==-1?", ":"")),I.each(r,function(t,e){e!==n[0]&&I(e).remove()}),I.data(t,"state","closed")}})}function f(t,e,i){var o=null;I.each(e,function(n,s){s.type?("Array"===s.type?o=h(t,s,!0,i):(o=p(t,s,!0,i),$.addClass(o,P)),E(o)):(o=g(t,s.str,s.title),n!==e.length-1&&E(o))})}function g(t,e,i){var o=I("<div></div>").text(e).appendTo(t);return $.addClass(o,N),i&&o.attr("title",i),o}function E(t){t.css({position:"relative",left:"25px"})}function v(t,e){var o={rows:[],type:"",stringValue:t,parsedValue:null,getInheritedProperties:!1,error:null,isReproducibleValue:!1},c=n("");if(o.parsedValue=x.eval(t,function(t){o.error=t.message}),!o.error&&o.parsedValue)try{void o.parsedValue.constructor}catch(h){o.error=h.message}if(o.error)return o;if(o.isReproducibleValue=m(o.parsedValue),i("Array",o.parsedValue)||y.isJQueryObj(o.parsedValue))o.type="Array",o.rows=s(o.parsedValue,t,e);else if(y.isDocumentInstance(o.parsedValue)||y.isWindowInstance(o.parsedValue)){var p=r(o.parsedValue);o.type="Object",o.getInheritedProperties=!0,o.rows=a(p,o.parsedValue.constructor?o.parsedValue.constructor.name:"Object")}else if(i("Object",o.parsedValue))o.type="Object",o.rows=a(o.parsedValue,o.parsedValue.constructor?o.parsedValue.constructor.name:"Object");else{if(o.type="String",null===o.parsedValue)c.str="null";else if("undefined"==typeof o.parsedValue)c.str="undefined";else if(y.isDomElement(o.parsedValue))c.str=l(o.parsedValue),c.title=d(o.parsedValue);else if(i("String",o.parsedValue)){var u=o.parsedValue.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\xA0/g,"\\xA0");u=u.indexOf('"')<0?'"'+u+'"':u.indexOf("'")<0?"'"+u+"'":'"'+u.replace(/"/g,'\\"')+'"',c.str=u}else c.str=o.parsedValue.toString();o.rows.push(c)}return o}function _(t,e){var o=[],s=null,a=null,l=r(x.eval(t));if(0===Object.getOwnPropertyNames(l).length)return o;for(var d in l)if(l.hasOwnProperty(d)||e)if(a=d+": ",s=v(t+'["'+d+'"]'),"String"===s.type)if(i("Function",l[d])){var c=s.rows[0].str;c=a+c.substring(0,c.indexOf("{")+1)+" ... ,",o.push(n(c))}else o.push(n(a+s.rows[0].str+",",s.rows[0].title));else"Object"===s.type?s.rows[0].str=a+s.rows[0].str.substring(0,s.rows[0].str.length-1)+", ":(s.rows[0].str=a+s.rows[0].str,s.rows[s.rows.length-1].str+=", "),o.push(s);var h=o.length-1;if(o[h].type)if("Object"===o[h].type)o[h].rows[0].str=o[h].rows[0].str.substring(0,o[h].rows[0].str.length-2);else{var p=o[h].rows.length-1,u=o[h].rows[p].str;o[h].rows[p].str=u.substring(0,u.length-2)}else o[h].str=o[h].str.substring(0,o[h].str.length-1);return o.push(n("}")),o}function m(t){return C(t)||T(t)}function C(t){return/^(string|number|boolean|undefined)$/.test(typeof t)}function T(t){if(I.isArray(t)){for(var e=0;e<t.length;e++)if(!m(t[e]))return!1;return!0}return!1}var S=e.get("Hammerhead"),I=S.$,y=S.Util,$=S.ShadowUI,b=S.MessageSandbox,x=t("Base.JavascriptExecutor"),L=t("Base.CrossDomainMessages"),A="container",w="argument-value-span",N="argument-value-div",P="embedded-in-object",D="title",R=this.exports=function(t){this.$viewer=I("<div></div>").appendTo(t),$.addClass(this.$viewer,A),this._init()};R.prototype._init=function(){$.bind(this.$viewer,"undefined"!=typeof o.onwheel?"wheel":"mousewheel",function(t){var e=t.wheelDelta||(t.originalEvent?8*-t.originalEvent.deltaY:100*-t.deltaY),i=parseInt(I(this).css("top").replace("px","")),o=this.scrollHeight-this.clientHeight,n=Math.max(Math.min(i+e,0),-o);return I(this).css("top",n+"px"),y.preventDefault(t),!1})},R.getObjectView=function(t,e,i){function o(e){e.message.cmd===L.OBJECT_VIEWER_GET_OBJECT_VIEW_RESPONSE_CMD&&e.message.stringValue===t&&(i(e.message.objectView),b.off(b.SERVICE_MSG_RECEIVED,o))}if(e){var n={cmd:L.OBJECT_VIEWER_GET_OBJECT_VIEW_REQUEST_CMD,stringValue:t};b.on(b.SERVICE_MSG_RECEIVED,o),b.sendServiceMsg(n,e)}else i(v(t,e))},R.getObjectPropertiesRows=function(t,e,i,o){function n(e){e.message.cmd===L.OBJECT_VIEWER_GET_OBJECT_PROPERTIES_ROWS_RESPONSE_CMD&&e.message.stringValue===t&&(o(e.message.rows),b.off(b.SERVICE_MSG_RECEIVED,n))}if(i){var s={cmd:L.OBJECT_VIEWER_GET_OBJECT_PROPERTIES_ROWS_REQUEST_CMD,getInheritedProperties:e,stringValue:t};b.on(b.SERVICE_MSG_RECEIVED,n),b.sendServiceMsg(s,i)}else o(_(t,e))},R.prototype.show=function(t,e,i){var o=this;R.getObjectView(t,e,function(t){o.$viewer[0].innerHTML="",o.$viewer.css("top",0),t.error||("String"===t.type?c(o.$viewer,t.rows[0].str,t.rows[0].title):"Array"===t.type?h(o.$viewer,t,!1,e):"Object"===t.type&&p(o.$viewer,t,!1,e)),i(t)})},R.prototype.clear=function(){this.$viewer[0].innerHTML="",this.$viewer.css("top",0)},R.prototype.getText=function(){return this.$viewer.text()}}),i.define("UI.RecorderWidgets.PlaybackErrorMessages",function(t,i){function o(t){var e=l("<div></div>").text("The following unhandled JavaScript errors occurred within the page: ").appendTo(t);d.addClass(e,g)}function n(t,e){for(var i=l("<ul></ul>").appendTo(t),o=0;o<e.length;o++){if(!(o<_)){l("<li></li>").text("...").appendTo(i);break}l("<li></li>").text(e[o]).appendTo(i)}}function s(t){m.close(),m=null,c.restoreState(C,!0,function(){"function"==typeof t&&t()})}function r(t,e){var i=l("<div></div>").appendTo(t);d.addClass(i,E),p.create(i,v).click(function(){s(e)})}var a=e.get("Hammerhead"),l=a.$,d=a.ShadowUI,c=a.PageState,h=t("UI.RecorderWidgets.Popup"),p=t("UI.RecorderWidgets.Button"),u="playback-result",f="error",g="error-message",E="button-container",v="Resume playback",_=5,m=null,C=null;i.show=function(t,e){m&&s(),C=c.saveState();var i=l("<div></div>");d.addClass(i,u),d.addClass(i,f),o(i),n(i,t),r(i,e),m=new h(d.getRoot(),{width:530,content:i,showAtWindowCenter:!0,defaultStyle:!1})}}),i.define("UI.RecorderWidgets.PlaybackResult",function(t,i){function o(t,e){var o=p("<div></div>").text(e===i.STATES.FINISHED?b:x).appendTo(t);u.addClass(o,C)}function n(t){var e=p("<div></div>").appendTo(t);u.addClass(e,T)}function s(t,e,o,n){var s=p("<div></div>").appendTo(t);u.addClass(s,S),n===i.STATES.FINISHED?s.text(o?o+"/"+e:e):s.text(o)}function r(t,e,o,n){e===i.STATES.FINISHED?a(t,o?A:L,n):a(t,"Step "+o+" "+w,n)}function a(t,e,i){var o=p("<div></div>").appendTo(t);u.addClass(o,I),i&&u.addClass(o,i),o.text(e)}function l(t,e){var i=p("<div></div>").appendTo(t);u.addClass(i,$),i.text(e)}function d(t){P.close(),P=null,f.restoreState(D,!0,function(){"function"==typeof t&&t()})}function c(t,e){E.create(t,N).click(function(){d(e)})}var h=e.get("Hammerhead"),p=h.$,u=h.ShadowUI,f=h.PageState,g=t("UI.RecorderWidgets.Popup"),E=t("UI.RecorderWidgets.Button"),v="playback-result",_="success",m="failed",C="header",T="separator",S="count",I="text",y="top",$="error-text",b="Test completed",x="Test failed",L="steps played successfully",A="steps failed",w="failed with an error:",N="Return to recording",P=null,D=null;i.STATES={FINISHED:"finished",FAILED:"failed"},i.show=function(t,e){var a=e.total,h=e.failed,E=e.onClosed,C=e.failedStepNum,T=e.error;P&&d(),D=f.saveState();var S=p("<div></div>");u.addClass(S,v),u.addClass(S,h||C?m:_),o(S,t),n(S),t===i.STATES.FINISHED&&s(S,a,C||h,t),
r(S,t,C||h,t===i.STATES.FAILED?y:null),T&&l(S,T),n(S),c(S,E),P=new g(u.getRoot(),{width:530,content:S,showAtWindowCenter:!0,defaultStyle:!1})}}),i.define("UI.RecorderWidgets.Popup",function(i){var n=e.get("Hammerhead"),s=n.$,r=n.Util,a=n.NativeMethods,l=n.ShadowUI,d=n.EventSandbox,c=n.PageState,h=n.TextSelection,p=i("UI.DraggingBehavior"),u="popup",f="header",g="content",E="footer",v="blind",_="default",m="no-borders",C="no-top-margin",T="separator",S="title",I="close-button",y="hide-icon",$="opacity",b=null,x=this.exports=function(t,e){var i=this;e=e||{},this.options={width:e.width||"",headerText:e.headerText||"",headerIconText:e.headerIconText||"",headerIconClass:e.headerIconClass||"",headerCloseButton:e.headerCloseButton||!1,headerHideIcon:e.headerHideIcon||!1,headerTextSize:e.headerTextSize||"",content:e.content,footerContent:e.footerContent||null,backgroundOpacity:e.backgroundOpacity||!1,showAtWindowCenter:e.showAtWindowCenter||!1,notDialog:e.notDialog||!1,prevActiveElement:e.prevActiveElement||r.getActiveElement(),restoreActiveElement:"undefined"==typeof e.restoreActiveElement||e.restoreActiveElement,defaultStyle:"undefined"==typeof e.defaultStyle||e.defaultStyle,noBordersStyle:e.noBordersStyle||!1,prependToContainer:e.prependToContainer||!1,footerWithoutTopMargins:e.footerWithoutTopMargins||!1,hasParentPopup:e.hasParentPopup||!1},this.$popup=null,this.$header=null,this.$headerTitle=null,this.$content=null,this.$footer=null,this.$closeButton=null,this.$hideIcon=null,this.selectionState=null,this.$focusableElement=null,this.popupBlurHandler=null,this.eventEmitter=new r.EventEmitter,this.on=function(t,e){i.eventEmitter.on(t,e)},this._createPopup(t),this._init()};x.CLOSE_BUTTON_CLICK_EVENT="closeButtonClick",x.HIDE_BUTTON_CLICK_EVENT="hideButtonClick",x.DRAG_STARTED_EVENT="dragStarted",x.MOVED_EVENT="moved",x.prototype._getPopupRelativePosition=function(e){var i=10,o=50,n=500,a=s(t),l=a.height(),d=a.width(),c=a.scrollTop(),h=a.scrollLeft(),p=r.getElementRectangle(e[0]),u=Math.max(p.left-h,0),f=Math.min(p.left+p.width-h,d),g=f-u,E=Math.floor(g/2+u),v=Math.max(p.top-c,0),_=Math.min(p.top+p.height-c,l),m=_-v,C=Math.floor(m/2+v),T=this.$popup.width(),S=this.$popup.height(),I=0,y=0,$="",b=0,x="",L=0,A=v,w=l-v-m;A-w>=0?(A>=S+i&&($="top"),b=A):(w>=S+i&&($="bottom"),b=w);var N=u,P=d-u-g;return N-P>=0?(N>=T+i&&(x="left"),L=N):(P>=T+i&&(x="right"),L=P),!$||x&&L-b>n?x?(y="left"===x?Math.max(u-o-T,i):Math.min(u+g+o,d-T-i),I=Math.floor((l-S)*(C/l))):(y=Math.floor((d-T)*(E/d)),I=Math.floor((l-S)*(C/l))):(I="top"===$?Math.max(v-o-S,i):Math.min(v+m+o,l-S-i),y=Math.floor((d-T)*(E/d))),{left:y,top:I}},x.prototype._createPopup=function(t){var e=this,i=this.options.hasParentPopup||!!l.select("."+u).length;this.$popup=s("<div></div>").width(this.options.width).attr("tabindex",1),this.options.prependToContainer?this.$popup.prependTo(t):this.$popup.appendTo(t),l.addClass(this.$popup,u),this.options.noBordersStyle&&l.addClass(this.$popup,m),this.options.defaultStyle&&l.addClass(this.$popup,_),this.options.notDialog||(i||(this.selectionState=c.saveState()),r.isIE&&r.isTextEditableElement(e.options.prevActiveElement)&&h.select(e.options.prevActiveElement,0,0),d.disableOuterFocusHandlers(),this._bindPopupBlurHandler(this.$popup)),(this.options.headerIconText||this.options.headerText||this.options.headerIconClass)&&this._createHeader(),this._createContent(),this.options.footerContent&&this._createFooter(),this.options.showAtWindowCenter&&this._disposeRelativeToWindowCenter()},x.prototype._createHeader=function(){var e=this,i=null,o=0;if(this.$header=s("<div></div>").appendTo(this.$popup),l.addClass(this.$header,f),this.options.headerIconClass){i=s("<div></div>").appendTo(this.$header),this.options.headerIconText&&i.text(this.options.headerIconText),l.addClass(i,this.options.headerIconClass),o+=i.width(),this.options.headerTextSize&&this.$headerTitle.css("fontSize",this.options.headerTextSize);var n=s("<div></div>").appendTo(this.$header);l.addClass(n,T),o+=n.width()}this.$headerTitle=s("<div></div>").appendTo(this.$header),l.addClass(this.$headerTitle,S),(r.isWebKit||s.browser.opera)&&(i&&i.css("marginTop","-1px"),this.$headerTitle.css("marginTop","-1px")),this.options.headerTextSize&&this.$headerTitle.css("fontSize",this.options.headerTextSize),this.options.headerCloseButton&&(this.$closeButton=s("<div></div>").appendTo(this.$header),l.addClass(this.$closeButton,I),o+=this.$closeButton.width()),this.options.headerHideIcon&&(this.$hideIcon=s("<div></div>").appendTo(this.$header),l.addClass(this.$hideIcon,y),o+=this.$hideIcon.width()),a.setTimeout.call(t,function(){var t=r.getElementPadding(e.$popup),i=r.getElementPadding(e.$headerTitle),n=e.$popup.width()-(t.left+t.right)-o-(i.left+i.right);e.$headerTitle.css("max-width",n),e.setHeaderText(e.options.headerText)},0)},x.prototype._createContent=function(){this.$content=s("<div></div>").appendTo(this.$popup),l.addClass(this.$content,g),this.options.backgroundOpacity&&l.addClass(this.$content,$),this.options.content&&s(this.options.content).appendTo(this.$content)},x.prototype._createFooter=function(){this.$footer=s("<div></div>").appendTo(this.$content),l.addClass(this.$footer,E),this.options.footerWithoutTopMargins&&l.addClass(this.$footer,C),s(this.options.footerContent).appendTo(this.$footer)},x.prototype._onResizeHandler=function(){if(this.options.showAtWindowCenter&&this._disposeRelativeToWindowCenter(),this.positionElement&&r.isElementVisible(this.positionElement)){var t=r.getOffsetPosition(this.$popup[0]);t.left>=0&&t.top>=0&&this.disposeRelativeToElement(s(this.positionElement))}},x.prototype._init=function(){var e=this;this.$closeButton&&this.$closeButton.click(function(){e.close(),e.eventEmitter.emit(x.CLOSE_BUTTON_CLICK_EVENT,{})}),this.$hideIcon&&this.$hideIcon.click(function(){e.eventEmitter.emit(x.HIDE_BUTTON_CLICK_EVENT,{})}),this.$header&&new p(this.$header,this.$popup,{onDragStart:function(){e.eventEmitter.emit(x.DRAG_STARTED_EVENT,{})},onMove:function(){e.eventEmitter.emit(x.MOVED_EVENT,{})}}),b=function(){e._onResizeHandler()},l.bind(s(t),"resize",b),"function"==typeof d.fixHoveredElement&&d.fixHoveredElement()},x.prototype._disposeRelativeToWindowCenter=function(){var e=s(t),i=Math.round(e.height()/2-this.$popup.height()/2),o=Math.round(e.width()/2-this.$popup.width()/2);this.$popup.css({top:i,left:o})},x.prototype._bindPopupBlurHandler=function(e){var i=this,n=null;i.$focusableElement=e,d.focus(i.$focusableElement[0],function(){i.popupBlurHandler=function(){a.setTimeout.call(t,function(){n=o.activeElement,(n===s("body")[0]||i.$focusableElement!==i.$popup&&n===i.$popup[0]||r.isIE&&r.isShadowUIElement(n)&&(l.hasClass(s(n),"modal-background")||"svg"===n.tagName.toLowerCase()||n===l.getRoot()[0]))&&a.focus.call(i.$focusableElement[0])},50)},l.bind(i.$focusableElement,"blur",i.popupBlurHandler)},!0)},x.prototype.close=function(e){var i=e?e:function(){};this.options.notDialog||l.unbind(this.$focusableElement,"blur",this.popupBlurHandler),d.enableOuterFocusHandlers(),this.keydownHandler&&a.removeEventListener.call(this.$popup[0],"keydown",this.keydownHandler,!1),this.$popup.remove(),l.unbind(s(t),"resize",b),this.options.restoreActiveElement?this.selectionState?c.restoreState(this.selectionState,!0,i):this.options.prevActiveElement&&(r.isShadowUIElement(this.options.prevActiveElement)?(a.focus.call(this.options.prevActiveElement),i()):d.focus(this.options.prevActiveElement,i,!0)):i(),"function"==typeof d.freeHoveredElement&&d.freeHoveredElement()},x.prototype.getContainer=function(){return this.$popup},x.prototype.setHeaderText=function(t){this.$headerTitle&&this.$headerTitle.text(t)},x.prototype.getHeaderHeight=function(){return this.$header.outerHeight()},x.prototype.blind=function(t){t?(l.addClass(this.$popup,v),this.$popup.css("zIndex",this.$popup.css("zIndex")-3)):(l.removeClass(this.$popup,v),this.$popup.css("zIndex",""))},x.prototype.hide=function(){l.unbind(this.$focusableElement,"blur",this.popupBlurHandler),this.$popup.css("visibility","hidden"),d.enableOuterFocusHandlers()},x.prototype.show=function(){this.$popup.css("visibility",""),d.disableOuterFocusHandlers(),this._bindPopupBlurHandler(this.$focusableElement)},x.prototype.isHidden=function(){return"hidden"===this.$popup.css("visibility")},x.prototype.moveTo=function(e,i,o){var n=s(t),r=n.width(),a=n.height(),l=this.$popup.width(),d=this.$popup.height();"undefined"!=typeof o&&null!==o?e=Math.max(e,o):e+l>r&&(e=r-l),i+d>a&&(i=a-d),this.$popup.css({left:e,top:i})},x.prototype.getPosition=function(){return{left:parseInt(this.$popup.css("left").replace("px","")),top:parseInt(this.$popup.css("top").replace("px",""))}},x.prototype.disposeRelativeToElement=function(t){this.positionElement=t[0];var e=this._getPopupRelativePosition(t);this.moveTo(e.left,e.top)},x.prototype.showAtWindowCenter=function(){this._disposeRelativeToWindowCenter()},x.prototype.changeFocusableElement=function(t){!this.options.notDialog&&t.length&&(l.unbind(this.$focusableElement,"blur",this.popupBlurHandler),this._bindPopupBlurHandler(t))},x.prototype.onkeydown=function(t,e){var i=this;this.keydownHandler=e?function(e){e.keyCode===r.KEYS_MAPS.SPECIAL_KEYS.backspace&&e.target===i.$popup[0]?r.preventDefault(e):t(e),r.stopPropagation(e)}:t,a.addEventListener.call(this.$popup[0],"keydown",this.keydownHandler,!1),a.addEventListener.call(this.$popup[0],"keypress",function(t){r.stopPropagation(t)}),a.addEventListener.call(this.$popup[0],"keyup",function(t){r.stopPropagation(t)})}}),i.define("UI.RecorderWidgets.RadioGroup",function(){var t=e.get("Hammerhead"),i=t.$,o=t.Util,n=t.ShadowUI,s="radio-group",r="radio-button",a="icon",l="title",d="pressed",c="disabled",h=this.exports=function(t,e,i){var n=this;this.$radioGroup=null,this.$radioButtons=[],this.titles=e,this.checkedIndex=e&&e.length?Math.min(Math.max(0,i),e.length-1):-1,this.isDisabled=!1,this.eventEmitter=new o.EventEmitter,this.on=function(t,e){n.eventEmitter.on(t,e)},this._create(t),this._init()};h.CHECKED_INDEX_CHANGED="checkedIndexChanged",h.prototype._create=function(t){var e=this,c=null,h=null,p=null;this.$radioGroup=i("<div></div>").appendTo(t),n.addClass(this.$radioGroup,s),i.each(this.titles,function(t,s){c=i("<div></div>").appendTo(e.$radioGroup),e.$radioButtons.push(c),n.addClass(c,r),h=i("<div></div>").appendTo(c),n.addClass(h,a),p=i("<span></span>").html(s).appendTo(c),n.addClass(p,l),o.isIE&&9===o.browserVersion&&p[0].setAttribute("unselectable","on")}),this.checkedIndex!==-1&&n.addClass(e.$radioButtons[this.checkedIndex],d),this._init()},h.prototype._init=function(){var t=this;i.each(this.$radioButtons,function(e,s){n.bind(i(s),"click",function(i){t.changeState(e),o.preventDefault(i)})})},h.prototype.changeState=function(t){this.isDisabled||t===this.checkedIndex||(n.removeClass(this.$radioButtons[this.checkedIndex],d),n.addClass(this.$radioButtons[t],d),this.checkedIndex=t,this.eventEmitter.emit(h.CHECKED_INDEX_CHANGED,{checkedIndex:this.checkedIndex}))},h.prototype.disable=function(){this.isDisabled=!0,n.addClass(this.$radioGroup,c)},h.prototype.enable=function(){this.isDisabled=!1,n.removeClass(this.$radioGroup,c)}}),i.define("UI.RecorderWidgets.ScrollBar",function(){var t=e.get("Hammerhead"),i=t.$,n=t.Util,s=t.ShadowUI,r="scrollContainer",a="scroll",l=this.exports=function(t,e){this.$container=t,this.state={disabled:!1,containerInnerHeight:0,scrollBarHeight:0,sizeDifference:0,factor:0,inScroll:!1,startY:0,startScrollTop:0},this.onScroll=e,this.minScroll=null,this.maxScroll=null,this.$scrollBarContainer=i("<div></div>").appendTo(this.$container),s.addClass(this.$scrollBarContainer,r),this.$scrollBar=i("<div></div>").appendTo(this.$scrollBarContainer),s.addClass(this.$scrollBar,a),this.$scrollBarContainer.css("display","none")};l.prototype._setScroll=function(t){var e=Math.max(t,-this.state.sizeDifference);null!==this.minScroll&&Math.abs(e)<this.minScroll&&(e=e/Math.abs(e)*this.minScroll),null!==this.maxScroll&&Math.abs(e)>this.maxScroll&&(e=e/Math.abs(e)*this.maxScroll);var i=-e*this.state.factor;this.$scrollBar.css("top",Math.floor(i)),this.$scrollableContent.css("top",Math.floor(e)),"function"==typeof this.onScroll&&this.onScroll()},l.prototype._getRelativeItemTop=function(t){var e=n.getOffsetPosition(t[0]),o=t.parents(),s=e.top;return o.each(function(t,e){if("static"!==i(e).css("position")&&(!n.isMozilla||"table"!==i(e).css("display"))){var o=n.getOffsetPosition(e);return s-=o.top,!1}}),s},l.prototype.init=function(t,e){this.$scrollableContainer=t,this.$scrollableContent=e;var r=this;this.recalculateSize(),this.state.sizeDifference<=0&&(this.state.disabled=!0),s.bind(r.$container,"undefined"!=typeof o.onwheel?"wheel":"mousewheel",function(t){r.updateOnMouseWheel(t)}),s.bind(r.$scrollBarContainer,"mousedown",function(t){if(!r.state.disabled)return r.state.startY=t.clientY,r.state.startScrollTop=parseInt(r.$scrollBar.css("top").replace("px","")),r.state.inScroll=!0,n.preventDefault(t),!1}),s.bind(i(o),"mouseup",function(){if(!r.state.disabled)return r.state.inScroll=!1,!1}),s.bind(i(o),"mousemove",function(t){if(r.state.inScroll&&!r.state.disabled){var e=Math.min(Math.max(t.clientY-r.state.startY+r.state.startScrollTop,0),r.state.containerInnerHeight-r.state.scrollBarHeight);return r._setScroll(-e/r.state.factor),n.preventDefault(t),!1}})},l.prototype.isVisible=function(){return"none"!==this.$scrollBarContainer.css("display")},l.prototype.updateScroll=function(t){if(!this.state.disabled){var e=i(t),o=n.getOffsetPosition(e[0]),s=e.height()+n.getElementMargin(e).bottom,r=parseInt(this.$scrollBar.css("top").replace("px","")),a=n.getElementPadding(this.$scrollableContainer),l=this.$container.height()-(a.top+a.bottom),d=n.getOffsetPosition(this.$container),c=this.$container.height(),h=o.top<d.top,p=o.top+s>d.top+c,u=null;if(this.state.factor=l/this.$scrollableContent.height(),0===this._getRelativeItemTop(e)&&(h=!0,u=0),h||p){var f=h?o.top-d.top:o.top+s-d.top-c;u=0===u?0:Math.min(Math.max(this.state.factor*f+r,0),l-Math.floor(l*this.state.factor)),this._setScroll(-u/this.state.factor)}}},l.prototype.restoreScroll=function(t){var e=n.getElementPadding(this.$scrollableContainer),i=this.$container.height()-(e.top+e.bottom),o=i/this.$scrollableContent.height(),s=Math.min(t,i-Math.floor(i*o));this.$scrollBar.css("top",s),this.$scrollableContent.css("top",Math.floor(-s/o))},l.prototype.recalculateSize=function(){var t=n.getElementPadding(this.$scrollableContainer),e=this.$scrollableContent.height();return this.state.containerInnerHeight=this.$container.height()-(t.top+t.bottom),this.state.sizeDifference=e-this.state.containerInnerHeight,this.state.factor=this.state.containerInnerHeight/e,this.state.sizeDifference<=0?("none"!==this.$scrollBarContainer.css("display")&&this.$scrollBarContainer.css("display","none"),0!==this.$scrollBar.height()&&this.$scrollBar.height(0),void(this.state.disabled=!0)):(this.state.disabled=!1,this.$scrollBarContainer.css("display",""),this.state.scrollBarHeight=Math.floor(this.state.containerInnerHeight*this.state.factor),this.$scrollBarContainer.height(this.state.containerInnerHeight),this.$scrollBar.height(this.state.scrollBarHeight),void this.restoreScroll(parseInt(this.$scrollBar.css("top").replace("px",""))))},l.prototype.updateOnMouseWheel=function(t){if(!this.state.disabled){var e=t.wheelDelta||(t.originalEvent?8*-t.originalEvent.deltaY:100*-t.deltaY),i=parseInt(this.$scrollableContent.css("top").replace("px","")),o=Math.min(i+e,0);return this._setScroll(o),n.preventDefault(t),!1}},l.prototype.setMinScroll=function(t){this.minScroll=t},l.prototype.setMaxScroll=function(t){this.maxScroll=t}}),i.define("UI.RecorderWidgets.SelectorEditor",function(i){var o=e.get("Hammerhead"),n=o.$,s=o.ShadowUI,r=o.Util,a=o.NativeMethods,l=i("Recorder.SelectorGenerator.Rules"),d=i("UI.RecorderWidgets.CodeEditor"),c=i("UI.RecorderWidgets.SelectorSwitcher"),h=i("UI.RecorderWidgets.Popup"),p=i("UI.RecorderWidgets.ElementsMarker"),u=i("Base.JavascriptExecutor"),f=i("UI.ValidationMessageFactory"),g="selector-editor",E="selector-switcher-container",v="code-editor-container",_="active",m="Target selector",C=18,T="Selector doesn't contain any element",S="Selector contains more than one element",I="Selector contains more than one element (one or more are invisible)",y="Selector contains an invisible element",$="Custom expression",b=this.exports=function(t,e){var i=this;if(this.options={width:e.width||"100%",height:e.height||"100%",selectors:e.selectors||[],currentSelectorIndex:e.currentSelectorIndex||0,allowEdit:e.allowEdit||!1,expandDirection:e.expandDirection||"right",enableFloatMode:e.enableFloatMode||!1,enableValidation:e.enableValidation||!1,$floatingParent:e.$floatingParent||null,enableElementsMarking:e.enableElementsMarking||!1,allowVisibleElementsOnly:e.allowVisibleElementsOnly||!1,context:e.context||null,parseDomElementsOrJqueryObjectsOnly:e.parseDomElementsOrJqueryObjectsOnly||!1,allowMultipleElements:e.allowMultipleElements||!1},"string"==typeof this.options.width&&this.options.width.indexOf("%")>-1){var o=parseInt(this.options.width.replace("%",""));isNaN(o)||(this.options.width=Math.round(t.width()*o/100))}if("string"==typeof this.options.height&&this.options.height.indexOf("%")>-1){var n=parseInt(this.options.height.replace("%",""));isNaN(n)||(this.options.height=Math.round(t.height()*n/100))}this.$selectorEditor=null,this.$selectorSwitcherContainer=null,this.$codeEditorContainer=null,this.selectorSwitcher=null,this.codeEditor=null,this.selectorEditorPopup=null,this.parsedSelector=null,this.hasJSErrors=!1,this.hasVisibilityErrors=!1,this.eventEmitter=new r.EventEmitter,this.$container=t,this._createMarkup(),this._initBehavior(),u.parseSelector(this.codeEditor.getText(),i.options.parseDomElementsOrJqueryObjectsOnly,function(t){i.parsedSelector=t,i._validate(),i._markElements()},this.options.context)};b.INIT_EVENT="init",b.SELECTOR_CHANGED_EVENT="selectorChanged",b.FOCUS_EVENT="focus",b.BLUR_EVENT="blur",b.prototype._createMarkup=function(){this.$selectorEditor=n("<div></div>").appendTo(this.$container),s.addClass(this.$selectorEditor,g),this.$selectorSwitcherContainer=n("<div></div>").appendTo(this.$selectorEditor),s.addClass(this.$selectorSwitcherContainer,E),this.$codeEditorContainer=n("<div></div>").appendTo(this.$selectorEditor),s.addClass(this.$codeEditorContainer,v),this.selectorSwitcher=new c(this.$selectorEditor,this.$selectorSwitcherContainer,this.options.selectors,this.options.currentSelectorIndex,this.options.height);var t=n("<div></div>").appendTo(this.$codeEditorContainer);this.codeEditor=new d(t,{width:this.options.width-this.$selectorSwitcherContainer.width(),height:this.options.height,text:this.options.selectors[this.options.currentSelectorIndex].selector,allowEdit:this.options.allowEdit,expandDirection:this.options.expandDirection})},b.prototype._markElements=function(){var t=this;if(this.options.enableElementsMarking){var e=this.selectorEditorPopup&&this.selectorEditorPopup.getContainer()||this.options.$floatingParent||this.$selectorEditor;this.parsedSelector&&this.parsedSelector.visibleLength?this.options.context?p.markInContext(e,this.parsedSelector.selector,this.options.context,this.options.parseDomElementsOrJqueryObjectsOnly):p.mark(e,this.parsedSelector.$visibleElements):p.mark(e,n()),p.events.on(p.ELEMENT_RECTANGLES_COUNT_CHANGED,function(){u.parseSelector(t.codeEditor.getText(),t.options.parseDomElementsOrJqueryObjectsOnly,function(e){t.parsedSelector=e,t._validate()},t.options.context)})}},b.prototype._onCodeEditorChange=function(){var t=this,e=this.codeEditor.getText();t.inChanging=!0;var i=t.options.selectors,o=t.options.currentSelectorIndex;if(i[o].selector!==e){for(var n=0,s=!1;n<i.length;n++)i[n].selector===e&&(t.selectorSwitcher._setValue(i[n]),t.options.currentSelectorIndex=n,s=!0);if(!s)for(n=0;n<i.length;n++)i[n].id===l.ruleIDs.USER_INPUT&&(i[n].selector=e,t.selectorSwitcher._setValue(i[n]),t.options.currentSelectorIndex=n,s=!0);if(!s){var r={id:l.ruleIDs.USER_INPUT,selector:e,description:$};i.splice(0,0,r),t.selectorSwitcher._setValue(i[0]),t.options.currentSelectorIndex=0}}u.parseSelector(e,t.options.parseDomElementsOrJqueryObjectsOnly,function(i){t.parsedSelector=i,t._validate(),t.eventEmitter.emit(b.SELECTOR_CHANGED_EVENT,{text:e,index:t.options.currentSelectorIndex,selectors:t.options.selectors,parsedSelector:t.parsedSelector}),t._markElements(),t.inChanging=!1},t.options.context)},b.prototype._initBehavior=function(){var t=this;this.inChanging=!1,this.selectorSwitcher.on(c.VALUE_CHANGED_EVENT,function(e){e.value&&(t.options.currentSelectorIndex=t.options.selectors.indexOf(e.value),t.inChanging||(t.codeEditor.setText(e.value.selector),t.codeEditor._textChanged()))}),this.codeEditor.events.on(d.CHANGE_EVENT,function(e){t._onCodeEditorChange(e.text)}),this.options.enableFloatMode&&(this.codeEditor.events.on(d.FOCUS_EVENT,function(){t._enableFloat(),t.floatModifications||t.eventEmitter.emit(b.FOCUS_EVENT,{})}),this.codeEditor.events.on(d.BLUR_EVENT,function(){t._disableFloat(),t.floatModifications||t.eventEmitter.emit(b.BLUR_EVENT,{})}))},b.prototype._enableFloat=function(){if(!this["float"]&&!this.floatModifications){this.floatModifications=!0,this["float"]=!0;var e=this,i=n(t),o=this.$codeEditorContainer.offset();this.selectorEditorPopup=new h(s.getRoot(),{headerText:m,headerHideIcon:!0,content:this.$codeEditorContainer,headerTextSize:C,notDialog:!0,restoreActiveElement:!1}),a.setTimeout.call(t,function(){e.floatModifications=!1,e.codeEditor.focus()},0);var r=this.selectorEditorPopup.getContainer(),l=this.selectorEditorPopup.getHeaderHeight()+(r.outerHeight()-r.innerHeight())/2,d=(r.outerWidth()-r.innerWidth())/2;if(this.selectorEditorPopup.moveTo(o.left-d-i.scrollLeft(),o.top-l-i.scrollTop()),s.addClass(this.selectorEditorPopup.getContainer(),_),e.selectorEditorPopup.on(h.HIDE_BUTTON_CLICK_EVENT,function(){e._disableFloat(!0)}),this.options.$floatingParent){var c={left:o.left-this.options.$floatingParent.offset().left,top:o.top-this.options.$floatingParent.offset().top};e.selectorEditorPopup.on(h.MOVED_EVENT,function(){var t=e.$codeEditorContainer.offset();e.options.$floatingParent.css({left:t.left-c.left-i.scrollLeft(),top:t.top-c.top-i.scrollTop()})})}this._markElements()}},b.prototype._disableFloat=function(t){this["float"]&&!this.floatModifications&&(this.floatModifications=!0,this["float"]=!1,(r.isIE||r.isMozilla)&&this.codeEditor.blur(),this.$codeEditorContainer.css({left:0,top:0,position:""}).appendTo(this.$selectorEditor),this.selectorEditorPopup.close(),this.selectorEditorPopup=null,this._markElements(),this.floatModifications=!1,t&&!r.isIE&&this.codeEditor.blur())},b.prototype._validate=function(){this._jsValidation(),!this.hasJSErrors&&this.options.enableValidation&&this._elementsValidation()},b.prototype._jsValidation=function(){this.parsedSelector.error?(f.error(this.codeEditor.getContainer(),this.parsedSelector.error),this.hasJSErrors=!0):(f.success(this.codeEditor.getContainer(),this.parsedSelector.error),this.hasJSErrors=!1)},b.prototype._elementsValidation=function(){if(this.hasVisibilityErrors=!1,this.parsedSelector){if(!this.parsedSelector.length)return void(this.options.allowVisibleElementsOnly?(this.hasVisibilityErrors=!0,f.error(this.codeEditor.getContainer(),T)):f.warning(this.codeEditor.getContainer(),T));if(this.parsedSelector.length>1){this.options.allowMultipleElements||(this.hasVisibilityErrors=!0);var t=this.parsedSelector.length!==this.parsedSelector.visibleLength?I:S;return void(this.options.allowMultipleElements?f.warning(this.codeEditor.getContainer(),t):f.error(this.codeEditor.getContainer(),t))}return this.parsedSelector.length!==this.parsedSelector.visibleLength?void(this.options.allowVisibleElementsOnly?(this.hasVisibilityErrors=!0,f.error(this.codeEditor.getContainer(),y)):f.warning(this.codeEditor.getContainer(),y)):void f.success(this.codeEditor.getContainer())}},b.prototype.on=function(t,e){this.eventEmitter.on(t,e)},b.prototype.getParsedSelector=function(){return this.parsedSelector},b.prototype.isValid=function(t){return t?!this.hasJSErrors:!this.hasJSErrors&&!this.hasVisibilityErrors},b.prototype.destroy=function(){p.clear()},b.prototype.setContext=function(t){this.options.context=t,this._onCodeEditorChange()},b.prototype.enableElementsMarking=function(){this.options.enableElementsMarking=!0,this._markElements()}}),i.define("UI.RecorderWidgets.SelectorSwitcher",function(t){var i=e.get("Hammerhead"),n=i.$,s=i.Util,r=i.ShadowUI,a=t("UI.RecorderWidgets.ScrollBar"),l="selector-switcher",d="bar",c="arrow",h="drop-down",p="hovered",u="item-list",f="items",g="item",E="icon",v="description",_="text-container",m="highlighted",C="icon-",T="icon-grey-",S="separator",I="gradient",y=80,$=150,b=this.exports=function(t,e,i,o,a){var d=this;this.$selectorArea=t,this.$selectorSwitcherContainer=e,this.$switcher=n("<div></div>").appendTo(e),r.addClass(this.$switcher,l),a&&this.$switcher.height(a),this.$bar=null,this.$dropDown=null,this.$items=null,this.items=i.slice(0),this.value=null,this.dropDownOpened=!1,this.eventEmitter=new s.EventEmitter,this.on=function(t,e){d.eventEmitter.on(t,e)},this._createBar(),this._setValue(i[o])};b.VALUE_CHANGED_EVENT="valueChanged",b.prototype._createBar=function(){var t=this,e=null;this.$bar=n("<div></div>").appendTo(this.$switcher),r.addClass(this.$bar,d);var i=n("<div></div>").appendTo(this.$bar);r.addClass(i,E),t.$barIconImg=n("<div></div>").appendTo(i);var o=n("<div></div>").appendTo(this.$bar);r.addClass(o,c),this.$bar.height()>=y&&(e=n("<div></div>").appendTo(this.$bar),r.addClass(e,I),e.css("left",this.$selectorSwitcherContainer.position().left+"px"),e.css("top",this.$selectorSwitcherContainer.position().top+this.$selectorSwitcherContainer.height()-e.height()+"px"));var a=function(e){(e.button===s.BUTTON.LEFT||s.hasTouchEvents)&&(t.dropDownOpened?t._hideItemList():t._showItemList()),s.preventDefault(e)};r.bind(this.$bar,"click",a),r.bind(this.$switcher,"keydown",function(e){var i=e.keyCode;return s.isCharByKeyCode(i,s.isShadowUIElement)||/^(backspace|delete)$/.test(s.KEYS_MAPS.REVERSED_SPECIAL_KEYS[i])?void s.preventDefault(e):void(/^(down|right)$/.test(s.KEYS_MAPS.REVERSED_SPECIAL_KEYS[i])?s.preventDefault(e):/^(up|left)$/.test(s.KEYS_MAPS.REVERSED_SPECIAL_KEYS[i])?s.preventDefault(e):/^(enter|esc)$/.test(s.KEYS_MAPS.REVERSED_SPECIAL_KEYS[i])&&t.dropDownOpened&&(t._hideItemList(),s.preventDefault(e)))})},b.prototype._createItemList=function(){var t=this;this.$dropDown=n("<div></div>"),this.$dropDown.css("visibility","hidden"),this.$dropDown.appendTo(this.$switcher),r.addClass(this.$dropDown,h);var e=s.getElementPadding(this.$dropDown),i=s.getBordersWidth(this.$dropDown);this.$dropDown.css("width",this.$selectorArea.width()-e.left-e.right-i.left-i.right+"px"),this.$dropDown.css("max-height",Math.max($,this.$selectorArea.height()-e.top-e.bottom-i.top-i.bottom)+"px");var o=r.select("."+c,t.$bar).position();this.$dropDown.css({left:o.left,top:o.top}),this.scrollBar=new a(this.$dropDown);var l=n("<div></div>").appendTo(this.$dropDown);r.addClass(l,u),this.$items=n("<div></div>").appendTo(l),r.addClass(this.$items,f),n.each(t.items,function(e,i){var o=n("<div></div>").data("item",i).appendTo(t.$items);r.addClass(o,g),o.mouseenter(function(){t._setHoveredItem(o)}),o.click(function(){t._setValue(o.data("item")),t._hideItemList()});var s=n("<div></div>").appendTo(o);r.addClass(s,E);var a=n("<div></div>").appendTo(s);r.addClass(a,T+i.id);var l=n("<div></div>").appendTo(o);r.addClass(l,v);var d=n("<div>"+i.description+"</div>");if(r.addClass(d,_),d.width(l.width()),d.appendTo(l),r.addClass(d.find("span"),m),e!==t.items.length-1){var c=n("<div></div>").appendTo(t.$items);r.addClass(c,S)}}),this.scrollBar.init(l,this.$items),this.scrollBar.isVisible()&&n.each(this.$items.children(),function(){n(this).css("padding-right","0px")}),this._setDropDownSelectedItem(this.value),this._setHoveredItem(this._getDropDownItem(this.value))},b.prototype._setValue=function(t){this.value!==t&&(this.items.indexOf(t)<0&&(this.items.splice(0,0,t),this.$dropDown&&(this.$dropDown.remove(),this.$dropDown=null)),this._setBarSelectedItem(t),this.$dropDown&&(this._setDropDownSelectedItem(t),this._setHoveredItem(this._getDropDownItem(t))),this.value=t,this.eventEmitter.emit(b.VALUE_CHANGED_EVENT,{value:t}))},b.prototype._setBarSelectedItem=function(t){this.value&&r.removeClass(this.$barIconImg,C+this.value.id),r.addClass(this.$barIconImg,C+t.id)},b.prototype._setDropDownSelectedItem=function(t){if(this.value){var e=r.select("."+C+this.value.id,this.$items);r.removeClass(e,C+this.value.id),r.addClass(e,T+this.value.id)}var i=r.select("."+T+t.id,this.$items);r.removeClass(i,T+t.id),r.addClass(i,C+t.id)},b.prototype._getDropDownItem=function(t){for(var e=this.$items.children(),i=0;i<e.length;i++)if(e.eq(i).data("item")===t)return e.eq(i)},b.prototype._setHoveredItem=function(t){var e=r.select("."+p,this.$items);r.removeClass(e,p),r.addClass(t,p)},b.prototype._showItemList=function(){var t=this;t.$dropDown||t._createItemList();var e=function(){t._hideItemList(),r.unbind(n(o),"mousedown",i)},i=function(i){var o=i.target||i.srcElement;t.$switcher.has(o).length||e()};this.$dropDown.css("visibility",""),r.bind(n(o),"mousedown",i),this.dropDownOpened=!0},b.prototype._hideItemList=function(){this.$dropDown.css("visibility","hidden"),this.dropDownOpened=!1}}),i.define("UI.RecorderWidgets.SetTestNameDialog",function(i,o){var n=e.get("Hammerhead"),s=n.$,r=n.Util,a=n.ShadowUI,l=n.NativeMethods,d=n.TextSelection,c=i("UI.ValidationMessageFactory"),h=i("UI.RecorderWidgets.Popup"),p=i("UI.RecorderWidgets.Button"),u="989b5ac6-476f-4c86-a53b-37c9decad66b-test-name",f="buttons",g="small",E="test-name-area",v="test-name",_="field",m="value",C="input",T="Save test",S="Test name:";o.SAVE_TEST_BUTTON_CLICK_EVENT="saveTestButtonClick",o.CANCEL_SAVE_BUTTON_CLICK_EVENT="cancelSaveButtonClick";var I=null,y=null,$=null,b=null,x=null,L=null,A=null,w=function(t,e){L=e.selectedStepNum,A=e.actualStepNum;var i={width:608,content:N(s("<div></div>")),headerText:T,footerContent:P(),showAtWindowCenter:!0};y=new h(t,i),D()},N=function(e){a.addClass(e,E);var i=s("<div></div>").appendTo(e);a.addClass(i,v);var o=s("<label></label>").appendTo(i).text(S).attr("for",u);a.addClass(o,_),(r.isWebKit||s.browser.opera)&&(o.css("position","relative"),o.css("top","1px"));var n=s("<div></div>").appendTo(i);return a.addClass(n,m),x=s('<input type="text">').appendTo(n).attr("id",u),a.addClass(x,C),l.setTimeout.call(t,function(){l.focus.call(x[0]),l.setTimeout.call(t,function(){y.changeFocusableElement(x)},0)},0),e},P=function(){var t=s("<div></div>");return a.addClass(t,f),$=p.create(t,"Save"),b=p.create(t,"Cancel"),a.addClass($,g),a.addClass(b,g),t},D=function(){a.bind(b,"click",function(){R(function(){I.emit(o.CANCEL_SAVE_BUTTON_CLICK_EVENT,{selectedStepNum:L,actualStepNum:A})})}),a.bind($,"click",function(){I.emit(o.SAVE_TEST_BUTTON_CLICK_EVENT,{testName:x.val()})}),y.onkeydown(function(t){var e=d.getSelectionStart(x[0]),i=d.getSelectionEnd(x[0]);t.keyCode===r.KEYS_MAPS.SPECIAL_KEYS.enter&&($.trigger("click"),r.preventDefault(t)),t.keyCode===r.KEYS_MAPS.SPECIAL_KEYS.esc&&(b.trigger("click"),r.preventDefault(t)),r.isWebKit&&e===i&&(t.keyCode===r.KEYS_MAPS.SPECIAL_KEYS.left&&0===e||t.keyCode===r.KEYS_MAPS.SPECIAL_KEYS.right&&e===x[0].value.length)&&r.preventDefault(t)})},R=function(t){y.close(t)};o.onError=function(t){c.error(x,t),l.focus.call(x[0])},o.blind=function(t){y.blind(t)},o.init=function(t,e){I=new r.EventEmitter,w(t,e)},o.closeDialog=function(t){y.close(t)},o.events={on:function(t,e){I.on(t,e)}}}),i.define("UI.RecorderWidgets.StepsPanel",function(i,n){function s(){S(),q.init(Wt,{itemClass:dt,draggableClass:dt,waitSortingStart:!0,handlers:{onItemMoved:function(t){Yt.updateScroll(t[0]),jt.css("top",t.offset().top-fe.scrollTop())},onMouseWheel:function(t){Yt.updateOnMouseWheel(t)},onDragStart:function(t,e){A(e);var i=2,o=i+"px solid "+t.css("backgroundColor"),n=t.offset();
jt=W("<div></div>").css({width:t.width(),height:t.height(),top:n.top-fe.scrollTop(),left:n.left-fe.scrollLeft()-i,borderLeft:o,borderRight:o}).appendTo(K.getRoot()),K.addClass(jt,Tt)},onDragEnd:function(t,e){jt.remove(),jt=null,oe=null;var i=te.splice(t,1)[0];if(te.splice(e,0,i),i=ee.splice(t,1)[0],ee.splice(e,0,i),i=ie.splice(t,1)[0],ie.splice(e,0,i),null!==se)se=W.inArray(g()[0],ee);else if(ae.length){var o=E();W.each(o,function(t,e){ae[t]=W.inArray(e,ee)})}de&&(oe=W.inArray(ne,ee)),_(),et.write("Steps panel: an item is moved"),kt.emit(n.STEPS_INFO_CHANGED_EVENT,{})}}})}function r(t,e){Mt=W("<div></div>").appendTo(t),K.addClass(Mt,ot),K.addClass(Mt,nt),a(e),e&&s()}function a(t){Ht=W("<div></div>").appendTo(Mt),K.addClass(Ht,at),Wt=W("<div></div>").appendTo(Ht),K.addClass(Wt,lt),W.each(te,function(t){l(t)}),Yt=new Y(Mt,function(){ge&&ge()}),Yt.init(Ht,Wt),ae.length&&ee.length?A(ae[0]):p(),d(),ee.length&&t?c():h()}function l(t){var e=te[t],i=W("<div></div>").appendTo(Wt);K.addClass(i,dt),e.failed&&K.addClass(i,At);var o=W("<div></div>").appendTo(i);K.addClass(o,ct);var n=W("<div></div>").appendTo(o);K.addClass(n,ht);var s=W("<div></div>").appendTo(n);K.addClass(s,pt);var r=W("<div>").appendTo(o);K.addClass(r,ut),r.text(t+1);var a=W("<div></div>").appendTo(o);K.addClass(a,ft);var l=W("<div></div>").appendTo(i);K.addClass(l,gt);var d=W("<div></div>").appendTo(l);K.addClass(d,Et),e.isAssertion?K.addClass(d,vt):K.addClass(d,e.actionDescriptor.type.toLocaleLowerCase());var c=W("<div></div>").appendTo(i);K.addClass(c,_t),c.text(e.name),ee.push(i[0]),ie.push({$item:i,$sortableArea:o,$number:r,$separator:a,$icon:l,$name:c})}function d(){Ft=W("<div></div>").appendTo(Ut),Kt=W("<div></div>").appendTo(Ft);var t=W("<div></div>").appendTo(Kt),e=W("<div></div>").text(Pt).appendTo(Kt);K.addClass(Ft,St),K.addClass(Kt,It),K.addClass(t,yt),K.addClass(e,$t),K.bind(Kt,"click",y)}function c(){Ft&&Ft.css("visibility","visible")}function h(){Ft&&Ft.css("visibility","hidden")}function p(){Gt=W("<div></div>").appendTo(Wt),K.addClass(Gt,Nt),W("<div></div>").appendTo(Gt).text("There are"),W("<div></div>").appendTo(Gt).text("no recorded steps")}function u(){Gt&&Gt.length&&(Gt.remove(),Gt=null)}function f(t){var e=W(t).parents(),i=null;return K.hasClass(W(t),dt)?W(t):(W.each(e,function(t,e){if(K.hasClass(W(e),dt))return i=W(e),!1}),i)}function g(){return K.select("."+dt+"."+bt)}function E(){return K.select("."+dt+"."+xt)}function v(){return K.select("."+dt+"."+Lt)}function _(){W.each(ie,function(t,e){W.trim(e.$number.text())!==(t+1).toString()&&e.$number.text(t+1)})}function m(){var t=g();if(zt&&(zt.remove(),zt=null),pe&&t.length){var e=t.offset(),i=t.position(),o=Jt.getPosition().left>=e.left;zt=W("<div></div>").appendTo(K.getRoot()),K.addClass(zt,o?mt:Ct),K.hasClass(t,At)&&K.addClass(zt,At),zt.css({left:(o?e.left+t.width():e.left-zt.width())-fe.scrollLeft(),top:e.top-fe.scrollTop()}),Yt.setMinScroll(t.height()+i.top-Ut.height()+Ft[0].offsetHeight),Yt.setMaxScroll(i.top)}else Yt.setMinScroll(null),Yt.setMaxScroll(null)}function C(t){var e=t.pageY||t.y;Math.abs(e-ve)>Bt&&(q.startSorting(_e),T())}function T(){_e=null,ve=null,K.unbind(Wt,"mousemove",C),K.unbind(W(o),"mouseup",T)}function S(){K.bind(Wt,"mousedown",function(t){var e=f(t.target),i=e&&e.length?W.inArray(e[0],ee):-1;if(t.button===F.BUTTON.LEFT&&i!==-1)return K.hasClass(W(t.target),ct)||ie[i].$sortableArea.has(t.target).length?void q.startSorting(t):void(t.ctrlKey||t.shiftKey||(_e=t,ve=t.pageY||t.y,K.bind(Wt,"mousemove",C),K.bind(W(o),"mouseup",T)))}),K.bind(Wt,"click",function(t){var e=f(t.target),i=e&&e.length?W.inArray(e[0],ee):-1;t.button!==F.BUTTON.LEFT||i===-1||K.hasClass(W(t.target),ct)||ie[i].$sortableArea.has(t.target).length||(t.ctrlKey||t.shiftKey?de||i===se||(t.ctrlKey?(W.inArray(i,ae)===-1?(et.write("Steps panel: an item is selected"),b(i,!0)):ae.length>1&&(et.write("Steps panel: an item is unselected"),L(i,!0)),le=i):(W.inArray(i,ae)===-1||ae.length>1)&&(et.write("Steps panel: several items are selected"),x(le,i))):null!==se&&i===se&&Jt?(et.write("Steps panel: an item is closed"),n.closeItem(),de?w(i):A(i)):(et.write("Steps panel: an item is opened"),$(i)),F.preventDefault(t,!0))})}function I(t){var e=W.inArray(t[0],ee),i=parseInt(Yt.$scrollBar.css("top").replace("px","")),o=parseInt(Wt.css("top").replace("px","")),s=t.height(),r=F.getElementMargin(t),a=g(),l=e===se;e<=oe&&(oe=null),e===te.length-1&&(1===te.length?kt.emit(n.ALL_STEPS_DELETED_EVENT):te[e].isAssertion||Z.show(Dt)),te.splice(e,1),l&&(ce=!0,n.closeItem()),W(ee[e]).remove(),ee.splice(e,1),ie.splice(e,1),_(),l||null===se||(se=W.inArray(a,ee)),o<0&&Wt.css("top",Math.min(o+s+r.top+r.bottom,0)),Yt.recalculateSize(),te.length&&ee&&ee.length?(e=Math.min(e,te.length-1),A(e),Yt.restoreScroll(i),Yt.updateScroll(ee[e])):(ae=[],le=null,p(),h())}function y(){var t=E();!de&&t.length&&(et.write("Steps panel: delete step button is pressed"),W.each(t,function(t,e){I(W(e))}),kt.emit(n.STEPS_INFO_CHANGED_EVENT,{}))}function $(t,e){var i=W(ee[t]),o=E(),s=v();n.closeItem(),se=t,ae=[],le=t,W.each(o,function(t,e){K.removeClass(W(e),xt)}),s&&K.removeClass(s,Lt),K.addClass(i,bt),Yt.updateScroll(i[0]),e&&K.addClass(i,At),O(e)}function b(t,e){W.inArray(t,ae)===-1&&(ae.push(t),K.addClass(W(ee[t]),xt)),e&&Yt.updateScroll(W(ee[t]))}function x(t,e){var i=t>e,o=Math.min(t,e),n=Math.max(t,e),s=E(),r=null;W.each(s,function(o,n){r=W.inArray(n,ee),(i&&(r>t||r<e)||!i&&(r<t||r>e))&&L(r)});for(var a=o;a<=n;a++)b(a);Yt.updateScroll(W(ee[e]))}function L(t,e){var i=W.inArray(t,ae);i!==-1&&ae.splice(i,1),K.removeClass(W(ee[t]),xt),e&&Yt.updateScroll(W(ee[t]))}function A(t){var e=E(),i=v();W.each(e,function(t,e){K.removeClass(W(e),xt)}),ae=[],ae.push(t),le=t,K.addClass(W(ee[t]),xt),i&&K.removeClass(i,Lt),n.closeItem(),Yt.updateScroll(W(ee[t]))}function w(t){var e=W(ee[t]),i=v(),o=E();re=t,ae=[],le=null,i&&K.removeClass(i,Lt),W.each(o,function(t,e){K.removeClass(W(e),xt)}),K.addClass(e,Lt),Yt.updateScroll(e[0])}function N(t,e){var i=-15,o=90,n=t.offset(),s=F.offsetToClientCoords({x:n.left,y:n.top}),r=t.width(),a=fe.width(),l=s.x+r,d=s.y+i,c=l+e>a&&s.x-e>=0||fe.width()-l<=o;return{top:d,left:c?s.x-e:l,minLeft:c?null:l}}function P(t,e,i,o,n){F.isShadowUIElement(t.target||t.srcElement)||"mouseup"===t.type&&Yt&&Yt.state.inScroll||(F.isMozilla&&"mouseup"===t.type&&ue&&(ue=!1,Zt.selectorEditor.codeEditor.stopSelectionProcess()),n(),i())}function D(){A(se),n.closeItem()}function R(t,e,i,o,n){var s=t.target||t.srcElement,r=g();Zt.selectorEditor&&Zt.selectorEditor.codeEditor&&(Zt.selectorEditor.codeEditor.$editor[0]===t.target||Zt.selectorEditor.codeEditor.$editor.has(t.target).length)&&(ue=!0),F.isShadowUIElement(s)&&Ut.has(s).length&&!r.has(s).length&&s!==r[0]&&(i(),n())}function V(t,e,i,o,s){var r=t.target||t.srcElement,a=g();if(!F.isMozilla&&ue)ue=!1,Zt.selectorEditor.codeEditor.stopSelectionProcess(),i(),s();else if(F.isShadowUIElement(r)){if(Ee||Qt.has(r).length||a[0]===r||a.has(r).length)return;A(se),et.write("Steps panel: an item is closed"),n.closeItem()}else A(se),et.write("Steps panel: an item is closed"),n.closeItem(),i(),s()}function O(e,i){Qt=W("<div></div>"),K.addClass(Qt,wt);var o={width:Ot,content:Qt,footerContent:de?B():null,noBordersStyle:!0,prependToContainer:!0,hasParentPopup:i},s=N(ie[se].$item,o.width);Jt=new tt(K.getRoot(),o);var r=(de||null!==oe)&&se===oe||te[se].isAssertion&&se===te.length-1;e&&(te[se].failed=!0,e.dialog&&(te[se].dialogError=e)),te[se].isAssertion?(Zt=new j(Qt,se,te[se],{enableAssertionsValidation:r,updateAssertionsState:r&&!!e,parentPopup:Jt}),Zt.on(j.START_PICKING_ELEMENT_EVENT,function(t){kt.emit(n.START_PICKING_ELEMENT_EVENT,t)}),Zt.on(j.EDIT_ASSERTION_START_EVENT,function(){kt.emit(n.EDIT_ASSERTION_START_EVENT,{showBackground:!0})}),Zt.on(j.EDIT_ASSERTION_COMPLETE_EVENT,function(){kt.emit(n.EDIT_ASSERTION_COMPLETE_EVENT,{hideBackground:!de}),Xt&&Zt.isValid(!0)&&Xt.removeAttr("disabled")}),de&&Q.show()):(Zt=new X(Qt,se,te[se],{enableFloatMode:r&&de,enableSelectorValidation:r&&!(e&&e.dialog),enableElementsMarking:r&&de,stretchSelectorEditor:!0,allowVisibleElementsOnly:!0,dialogError:r?e:null}),Zt.on(X.SELECTOR_EDITOR_FOCUSED_EVENT,function(){M(!0),Ee=!0}),Zt.on(X.SELECTOR_EDITOR_BLURED_EVENT,function(){M(!1),Ee=!1}),de?se!==oe?Q.show():Q.hide():Zt.$step.css("paddingBottom","18px"),Jt.$content.css("minHeight","234px")),Zt.on(z.STEP_NAME_CHANGED_EVENT,function(t){ce=!0,he=!0,ie[se].$name.text(t.name)}),Zt.on(z.STEP_INFO_CHANGED_EVENT,function(){if(ce=!0,he=!0,Zt.isValid(se!==oe)){var t=!0;if(te[se].isAssertion)for(var e=0;e<te[se].blocks.length&&t;e++)for(var i=0;i<te[se].blocks[e].assertions.length;i++)te[se].blocks[e].assertions[i].failed&&(t=!1);!de&&t&&(K.removeClass(ie[se].$item,At),zt&&K.removeClass(zt,At),Zt&&Zt.dialogsEditor&&Zt.dialogsEditor.removeError()),te[se].failed=!t,te[se].error=!1,Xt&&Xt.removeAttr("disabled"),qt&&qt.removeAttr("disabled")}else K.addClass(ie[se].$item,At),zt&&K.addClass(zt,At),te[se].failed=!0,te[se].error=!Zt.isValid(!0),Xt&&Xt.attr("disabled","disabled"),!qt||te[se].isAssertion&&te[se].blocks.length||qt.attr("disabled","disabled");kt.emit(n.STEPS_INFO_CHANGED_EVENT,{draft:!0})}),Jt.moveTo(s.left,s.top,s.minLeft),s=Jt.getPosition(),ge||(ge=function(){var t=N(ie[se].$item,o.width),e=Jt.getPosition();t.left===e.left&&t.top===e.top||(s=t,Jt.moveTo(s.left,s.top,s.minLeft),m())},K.bind(fe,"resize",ge)),m(),kt.emit(n.STEP_INFO_SHOWN_EVENT,{$el:Jt?Jt.$popup:null}),de||(G.addInternalEventListener(t,["mousedown"],R),G.addInternalEventListener(t,["click"],V),G.addInternalEventListener(t,["unload"],D),G.addInternalEventListener(t,F.RECORDING_LISTENED_EVENTS,P))}function B(){var t=W("<div></div>");if(K.addClass(t,Vt),de){var e=se;qt=J.create(t,"Skip step"),Xt=J.create(t,"Replay step").attr("disabled","disabled"),K.bind(qt,"click",function(){n.closeItem(),w(e),kt.emit(n.SKIP_STEP_BUTTON_CLICK_EVENT,{hasChanges:he}),he=!1}),K.bind(Xt,"click",function(){n.closeItem(),w(e),K.removeClass(ie[oe].$item,At),kt.emit(n.REPLAY_STEP_BUTTON_CLICK_EVENT,{hasChanges:he}),he=!1})}return t}function k(){var e=function(){Jt=null,Zt&&Zt.destroy(),ce&&(et.write("Steps panel: step info is changed"),kt.emit(n.STEPS_INFO_CHANGED_EVENT,{})),ce=!1,de&&Q.hide(),ge&&K.unbind(fe,"resize",ge),ge=null};Jt?(Jt.close(e),kt.emit(n.STEP_INFO_HIDDEN_EVENT,{editingFinished:null===se}),G.removeInternalEventListener(t,["click"],V),G.removeInternalEventListener(t,["mousedown"],R),G.removeInternalEventListener(t,["unload"],D),G.removeInternalEventListener(t,F.RECORDING_LISTENED_EVENTS,P)):e()}function U(){var t=g();t.length&&K.removeClass(t,bt)}function M(t){Jt.blind(t),zt&&(t?K.addClass(zt,Rt):K.removeClass(zt,Rt)),kt.emit(n.STEPS_PANEL_BLINDED_EVENT,{blind:t})}var H=e.get("Hammerhead"),W=H.$,F=H.Util,K=H.ShadowUI,G=H.EventSandbox,Y=i("UI.RecorderWidgets.ScrollBar"),z=i("UI.RecorderWidgets.BaseStep"),j=i("UI.RecorderWidgets.AssertionsStep"),X=i("UI.RecorderWidgets.ActionStep"),q=i("UI.SortingBehavior"),J=i("UI.RecorderWidgets.Button"),Q=i("UI.ModalBackground"),Z=i("UI.RecorderWidgets.Tooltip"),tt=i("UI.RecorderWidgets.Popup"),et=i("UI.UXLog"),it="steps-panel",ot="step-list-panel",nt="scrollable",st="hidden",rt="disabled",at="container",lt="content",dt="item",ct="sortable-area",ht="sortable-icon-container",pt="sortable-icon",ut="number",ft="list-separator",gt="icon-container",Et="action-icon",vt="assertion",_t="name",mt="item-arrow-right",Ct="item-arrow-left",Tt="dragging-item-shadow",St="delete-step-button-area",It="delete-step-button",yt="delete-step-icon",$t="label",bt="opened",xt="selected",Lt="highlighted",At="failed",wt="stepInfo-panel",Nt="no-steps-title",Pt="Delete step(s)",Dt="Deletion of the last step might affect the tested page's state making it not actual.<br>Before adding new test steps, it is recommended to replay the test to check its integrity.",Rt="blind",Vt="buttons",Ot=475,Bt=5;n.STEPS_INFO_CHANGED_EVENT="stepsInfoChanged",n.ALL_STEPS_DELETED_EVENT="allStepsDeleted",n.EDIT_ASSERTION_COMPLETE_EVENT="editAssertionComplete",n.EDIT_ASSERTION_START_EVENT="editAssertionStart",n.START_PICKING_ELEMENT_EVENT="startPickingElement",n.SKIP_STEP_BUTTON_CLICK_EVENT="skipStepButtonClick",n.REPLAY_STEP_BUTTON_CLICK_EVENT="replayStepButtonClick",n.STEP_INFO_SHOWN_EVENT="stepInfoShown",n.STEP_INFO_HIDDEN_EVENT="stepInfoHidden",n.STEPS_PANEL_BLINDED_EVENT="stepsPanelBlinded";var kt=null,Ut=null,Mt=null,Ht=null,Wt=null,Ft=null,Kt=null,Gt=null,Yt=null,zt=null,jt=null,Xt=null,qt=null,Jt=null,Qt=null,Zt=null,te=null,ee=[],ie=[],oe=null,ne=null,se=null,re=null,ae=[],le=null,de=!1,ce=!1,he=!1,pe=!1,ue=!1,fe=W(t),ge=null,Ee=!1,ve=null,_e=null;n.init=function(t,e){kt=new F.EventEmitter,pe=e.show,te=e.stepsInfo,te&&te.length&&ae.push(te.length-1),Ut=W("<div></div>").appendTo(t||K.getRoot()),K.addClass(Ut,it),e.show||K.addClass(Ut,st),r(Ut,e.enableHandlers),e.enableHandlers||K.addClass(Ut,rt)},n.events={on:function(t,e){kt.on(t,e)}},n.activateInteractive=function(){s(),c(),K.removeClass(Ut,rt)},n.turnOffPlaybackMode=function(){de=!1,oe=null,ne=null,q.resumeSorting(),te&&te.length&&A(te.length-1)},n.openStepWithError=function(t,e,i){pe=!0,de=!i,oe=t,ne=ee[t],Ut&&Ut.length&&K.removeClass(Ut,st),i||q.stopSorting(),$(t,e)},n.hide=function(){pe=!1,Ut&&Ut.length&&(K.addClass(Ut,st),null!==se&&(k(),m()))},n.show=function(t){if(pe=!0,Ut&&Ut.length){K.removeClass(Ut,st),Yt.recalculateSize();var e=E();e.length&&Yt.updateScroll(e.last()[0]),null!==se&&(O(null,t),m())}},n.addItem=function(){var t=te.length-1;oe=null,u(),l(t),c(),Yt.recalculateSize(),A(t)},n.highlightItem=function(t){t>=ee.length||t!==re&&w(t)},n.closeItem=function(){null!==se&&(U(),se=null,m(),k(),Xt&&Xt.remove(),qt&&qt.remove())},n.isVisible=function(){return!K.hasClass(Ut,st)},n.updateStepInfoPanelPosition=function(){ge&&ge()},n.updateSteps=function(){for(var t=0;t<ie.length;t++)te[t].failed?K.addClass(ie[t].$item,At):K.removeClass(ie[t].$item,At)}}),i.define("UI.RecorderWidgets.Tabs",function(){function t(t,e){var i=o("<div></div>").text(e).appendTo(t);s.addClass(i,a);var n=o("<div></div>").appendTo(i);return s.addClass(n,"tab-underline"),i}var i=e.get("Hammerhead"),o=i.$,n=i.Util,s=i.ShadowUI,r="tabs-panel",a="tab",l="selected",d=this.exports=function(t,e){var i=this;this.titles=e.titles||[],this.getContentCallback=e.getContentCallback||null,this.eventEmitter=new n.EventEmitter,this.on=function(t,e){i.eventEmitter.on(t,e)},this.$tabs=[],this.$contentContainer=null,this.$contents=[],this.activeTabIndex=-1,this._createTabs(t),this._createContentContainer(t),this._init()};d.prototype._createTabs=function(e){var i=o("<div></div>").appendTo(e);s.addClass(i,r);for(var n=0;n<this.titles.length;n++)this.$tabs.push(t(i,this.titles[n]))},d.prototype._createContentContainer=function(t){this.$contentContainer=o("<div></div>").appendTo(t);for(var e=0;e<this.titles.length;e++)this.$contents.push(o("<div></div>").css("display","none").appendTo(this.$contentContainer))},d.prototype._init=function(){var t=this;o.each(this.$tabs,function(e,i){i.click(function(){t._selectTab(e)})}),this._selectTab(0)},d.prototype._selectTab=function(t){function e(){o>-1&&(i.$contents[o].css("display","none"),s.removeClass(i.$tabs[o],l))}var i=this,o=this.activeTabIndex,n=this.$contents[t];this.activeTabIndex=t,n.data("filled")||"function"!=typeof this.getContentCallback?(e(),this.$contents[this.activeTabIndex].css("display","")):(this.getContentCallback(this.activeTabIndex,function(t,o){t.appendTo(n),e(),i.$contents[i.activeTabIndex].css("display",""),o()}),n.data("filled",!0)),s.addClass(this.$tabs[this.activeTabIndex],l)}}),i.define("UI.RecorderWidgets.Toolbar",function(i,o){function n(t){return t?" ("+t+")":""}function s(t){b.addClass(y("<div></div>").appendTo(t),Tt)}function r(){Xt=y("<div></div>").appendTo(jt),b.addClass(Xt,st);var t=y("<div></div>").appendTo(Xt);b.addClass(t,rt),qt=y("<div></div>").appendTo(Xt),b.addClass(qt,at)}function a(t,e){var i=y("<div></div>").appendTo(t);b.addClass(i,Ct),e&&b.addClass(i,"vertical")}function l(t,e,i,o){var n=y("<div></div>").appendTo(t);b.addClass(n,_t),n.attr("title",e);var s=y("<div></div>").appendTo(n);b.addClass(s,i);var r=y("<span></span>").html(o).appendTo(n);return b.addClass(r,mt),n}function d(){Jt=y("<div></div>").appendTo(jt),b.addClass(Jt,ht),s(zt);var t=y("<div></div>").appendTo(Jt);b.addClass(t,pt);var e=y("<div></div>").appendTo(t);b.addClass(e,ut),b.addClass(e,ft),te=l(e,V+n(re.addAssertion),wt,X),Qt=l(e,D+n(re.addHover),Lt,z),Zt=l(e,R+n(re.addWait),At,j);var i=L.LINUX_PLATFORM?B:O+n(re.addScreenshot);ee=l(e,i,Nt,q),L.LINUX_PLATFORM&&b.addClass(ee,ct),a(t);var o=y("<div></div>").appendTo(t);b.addClass(o,ut),b.addClass(o,gt),ie=l(o,k+n(re.playback),Pt,J),a(o,!0),oe=l(o,"",Dt,Q),a(o,!0),ne=l(o,K+n(re.exitRecording),Rt,Z),a(t)}function c(t,e){Yt=y("<div></div>").appendTo(t),b.addClass(Yt,it),e&&e.left&&e.top&&Yt.css({left:e.left,top:e.top})}function h(t,e,i){zt=y("<div></div>").appendTo(Yt),b.addClass(zt,ot),jt=y("<div></div>").appendTo(zt),b.addClass(jt,nt),r(),s(jt),d(t,e,i);var o=y("<div></div>").appendTo(jt);b.addClass(o,ut),b.addClass(o,e?vt:Et),se=e?l(o,Y,Ot,et):l(o,G,Vt,tt),s(Jt),N.init(zt,{stepsInfo:t,show:e,enableHandlers:i})}function p(t){var e=y("<div></div>").appendTo(Yt);b.addClass(e,$t),y("<span></span>").html(t.charAt(0).toUpperCase()+t.slice(1)).appendTo(e),"beforeUnload"===t&&b.addClass(e,xt);var i=y("<div></div>").appendTo(e);return b.addClass(i,bt),b.addClass(i,t),e}function u(){var e=!1;x.setTimeout.call(t,function(){var i=y(t),n=i.width(),s=i.height(),r=$.getOffsetPosition(zt[0]),a=$.offsetToClientCoords({x:r.left,y:r.top}),l=zt.height(),d=zt.width();a.x+d>n&&(Yt.css("left",Math.max(n-d,0)),e=!0),a.y+l>s&&(Yt.css("top",Math.max(s-l,0)),e=!0),e&&(N.updateStepInfoPanelPosition(),Ut.emit(o.TOOLBAR_MOVED_EVENT,{toolbarPosition:{left:Yt.css("left"),top:Yt.css("top")}}))},0)}function f(){Mt=new w(Xt,Yt,{onDragStart:function(){L.PLAYBACK||N.closeItem(),Ht=!0},onMove:function(){L.PLAYBACK&&N.updateStepInfoPanelPosition()},onDragEnd:function(){Ht=!1,Ut.emit(o.TOOLBAR_MOVED_EVENT,{toolbarPosition:{left:Yt.css("left"),top:Yt.css("top")}})}})}function g(){N.hide(),o.updateExpandStepsButtonAppearance(),Ut.emit(o.STEPS_PANEL_VISIBILITY_CHANGED,{shown:!1})}function E(){N.show(),o.updateExpandStepsButtonAppearance(!0),Ut.emit(o.STEPS_PANEL_VISIBILITY_CHANGED,{shown:!0})}function v(){P.write("Toolbar: run playback button is pressed"),Ut.emit(o.RUN_PLAYBACK_BUTTON_PRESSED_EVENT,{})}function _(){P.write("Toolbar: exit button is pressed"),Ut.emit(o.EXIT_RECORDING_BUTTON_PRESSED_EVENT)}function m(){P.write("Toolbar: exit recording button is pressed but there is an error in the steps"),Ut.emit(o.EXIT_RECORDING_BUTTON_PRESSED_EVENT,{hasErrors:!0})}function C(){b.bind(Yt,"mousedown",function(t){Wt=$.getActiveElement(),$.isTextEditableElement(Wt)&&(Ft=A.getSelectionStart(Wt),Kt=A.getSelectionEnd(Wt),Gt=A.hasInverseSelection(Wt)),$.isShadowUIElement(Wt)||$.preventDefault(t,!0)}),b.bind(Qt,"click",function(){P.write("Toolbar: add hover action button is pressed"),Ut.emit(o.ADD_HOVER_ACTION_BUTTON_PRESSED_EVENT,{prevActiveElement:Wt,prevSelectionStart:Ft,prevSelectionEnd:Kt,prevSelectionInverse:Gt})}),b.bind(Zt,"click",function(){P.write("Toolbar: add wait action button is pressed"),Ut.emit(o.ADD_WAIT_ACTION_BUTTON_PRESSED_EVENT,{prevActiveElement:Wt,prevSelectionStart:Ft,prevSelectionEnd:Kt,prevSelectionInverse:Gt})}),b.bind(ee,"click",function(){b.hasClass(ee,ct)||(P.write("Toolbar: add screenshot action button is pressed"),Ut.emit(o.ADD_SCREENSHOT_ACTION_BUTTON_PRESSED_EVENT,{prevActiveElement:Wt,prevSelectionStart:Ft,prevSelectionEnd:Kt,prevSelectionInverse:Gt}))}),b.bind(te,"click",function(){P.write("Toolbar: add assertion button is pressed"),Ut.emit(o.ADD_ASSERTIONS_STEP_EVENT,{prevActiveElement:Wt,prevSelectionStart:Ft,prevSelectionEnd:Kt,prevSelectionInverse:Gt})}),b.bind(se,"click",function(){b.hasClass(se,ct)||(N.isVisible()?(P.write("Toolbar: hide steps button is pressed"),g()):(P.write("Toolbar: show steps button is pressed"),E()))})}function T(e){x.setTimeout.call(t,function(){e.fadeOut(kt,function(){e.remove()})},Bt)}function S(){P.write("Toolbar: save button is pressed"),Ut.emit(o.SAVE_TEST_BUTTON_PRESSED_EVENT,{})}var I=e.get("Hammerhead"),y=I.$,$=I.Util,b=I.ShadowUI,x=I.NativeMethods,L=i("Settings"),A=I.TextSelection,w=i("UI.DraggingBehavior"),N=i("UI.RecorderWidgets.StepsPanel"),P=i("UI.UXLog"),D="Add a step containing the hover action",R="Add a step containing the wait action",V="Add a step containing one or more assertions",O="Add a step containing the screenshot action",B="This action is not supported in the Linux version",k="Playback the test step by step from the beginning",U="No changes to save",M="No steps to playback",H="Cannot start playback due to one or more incorrect step(s)",W="Cannot save the test due to one or more incorrect step(s)",F="Save the test",K="Exit test recording",G="Display a list of the recorded steps",Y="Hide a list of the recorded steps",z="Add hover",j="Add wait",X="Add assertions",q="Add screenshot",J="Playback",Q="Save",Z="Exit",tt="Show steps",et="Hide steps",it="toolbar-area",ot="toolbar",nt="top-container",st="drag-area",rt="logo-icon",at="state-icon",lt="icon record",dt="icon playback",ct="disable",ht="button-bar",pt="content",ut="buttons-container",ft="add-actions-area",gt="bottom-buttons-area",Et="show-steps-buttons-area",vt="hide-steps-buttons-area",_t="button-area",mt="title",Ct="separator",Tt="clear",St="hidden",It="blind",yt="buttons-hidden",$t="action-indicator",bt="action-icon",xt="wide-size",Lt="toolbar-icon hover",At="toolbar-icon wait",wt="toolbar-icon add-assertions",Nt="toolbar-icon screenshot",Pt="toolbar-icon playback",Dt="toolbar-icon save",Rt="toolbar-icon exit",Vt="toolbar-icon show-steps",Ot="toolbar-icon hide-steps",Bt=2e3,kt=3e3;o.ADD_HOVER_ACTION_BUTTON_PRESSED_EVENT="addHoverActionButtonPressed",o.ADD_WAIT_ACTION_BUTTON_PRESSED_EVENT="addWaitActionButtonPressed",o.ADD_ASSERTIONS_STEP_EVENT="addAssertionsStepButtonPressed",o.ADD_SCREENSHOT_ACTION_BUTTON_PRESSED_EVENT="addScreenshotActionButtonPressed",o.RUN_PLAYBACK_BUTTON_PRESSED_EVENT="runPlaybackButtonPressed",o.SAVE_TEST_BUTTON_PRESSED_EVENT="saveTestButtonPressed",o.EXIT_RECORDING_BUTTON_PRESSED_EVENT="exitRecordingButtonPressed",o.TOOLBAR_MOVED_EVENT="toolbarMoved",o.STEPS_PANEL_VISIBILITY_CHANGED="stepsPanelVisibilityChanged";var Ut=null,Mt=null,Ht=!1,Wt=null,Ft=null,Kt=null,Gt=null,Yt=null,zt=null,jt=null,Xt=null,qt=null,Jt=null,Qt=null,Zt=null,te=null,ee=null,ie=null,oe=null,ne=null,se=null,re=null;o.init=function(e,i){var n={stepsInfo:[],hasChanges:!1,toolbarPosition:{left:0,top:0},collapsedMode:!1,shortcuts:{},showSteps:!0,enableStepListInteractive:!0},s=i||n;Ut=new $.EventEmitter,re=s.shortcuts||{},Yt||(c(e,s.toolbarPosition),h(s.stepsInfo,s.showSteps,s.enableStepListInteractive),f(),C(),b.bind(y(t),"resize",u)),o.updateState(s.hasChanges,!!s.stepsInfo.length),s.collapsedMode?o.collapse():o.expand()},o.events={on:function(t,e){Ut.on(t,e)}},o.expand=function(){b.removeClass(qt,dt),b.addClass(qt,lt),b.removeClass(jt,yt)},o.collapse=function(){b.removeClass(qt,lt),b.addClass(qt,dt),b.addClass(jt,yt)},o.hide=function(){Yt&&(b.addClass(Yt,St),Mt.resetDragging(),b.unbind(y(t),"resize",u))},o.show=function(){b.removeClass(Yt,St),u(),Mt.restoreDragging(),b.bind(y(t),"resize",u)},o.setBlind=function(t){Yt&&(t?(Mt.resetDragging(),b.addClass(Yt,It)):(b.removeClass(Yt,It),Mt.restoreDragging()))},o.updateState=function(t,e,i){if(Yt&&Yt.length){if(i?(b.unbind(ne,"click",_),b.bind(ne,"click",m)):(b.unbind(ne,"click",m),b.bind(ne,"click",_)),i)return b.addClass(oe,ct),oe.attr("title",W),b.unbind(oe,"click",S),b.addClass(ie,ct),ie.attr("title",H),b.unbind(ie,"click",v),void b.unbind(ie,"click",v);e?(b.removeClass(ie,ct),ie.attr("title",k+n(re.playback)),b.bind(ie,"click",v)):(b.addClass(ie,ct),ie.attr("title",M),b.unbind(ie,"click",v)),t?(b.removeClass(oe,ct),oe.attr("title",F+n(re.saveTest)),b.bind(oe,"click",S)):(b.addClass(oe,ct),oe.attr("title",U),b.unbind(oe,"click",S))}},o.updateExpandStepsButtonAppearance=function(t){var e=se.children("div");t?(b.removeClass(se.parent(),Et),b.addClass(se.parent(),vt),se.attr("title",Y),se.children("span").html(et),b.removeClass(e,Vt),b.addClass(e,Ot)):(b.removeClass(se.parent(),vt),b.addClass(se.parent(),Et),se.attr("title",G),se.children("span").html(tt),b.removeClass(e,Ot),b.addClass(e,Vt))},o.setExpandStepsButtonState=function(t){t?b.removeClass(se,ct):b.addClass(se,ct)},o.addActionIndicator=function(t){var e=p(t);T(e)},o.updateMaxTopForDragging=function(e){var i=y(t).height();Mt.setMaxTop(e&&e.length?i-e.height():null)}}),i.define("UI.RecorderWidgets.Tooltip",function(i,o){function n(t){this.message=t,this.animationTimeoutId=null,this.visible=null,this.$tooltip=null,this.$closeButton=null,this._createMarkup(),this._init()}var s=e.get("Hammerhead"),r=s.$,a=s.ShadowUI,l=s.Util,d=s.NativeMethods,c="close-button",h="content",p="tooltip",u="toolbar",f="recorder",g=15,E=2e3,v=5e3,_=[];n.prototype._createMarkup=function(){var t=a.select("."+f);this.$tooltip=r("<div>"),a.addClass(this.$tooltip,p),this.$closeButton=r("<div>").appendTo(this.$tooltip),a.addClass(this.$closeButton,c);var e=r("<div>").appendTo(this.$tooltip);a.addClass(e,h);var i=r("<span>").appendTo(e);i.html(this.message),this.hide(),this.$tooltip.appendTo(t)},n.prototype._init=function(){var t=this;this.$tooltip.mouseenter(function(){t._stopAnimation()}),this.$tooltip.mouseleave(function(){t.visible&&t._startAnimation()}),this.$tooltip.mousedown(function(t){l.preventDefault(t)}),a.bind(this.$closeButton,"click",function(){t.hide()})},n.prototype._startAnimation=function(){var e=this;this._makeVisible(),this.animationTimeoutId=d.setTimeout.call(t,function(){e.$tooltip.fadeOut(v,function(){e.hide()})},E)},n.prototype._stopAnimation=function(){this.animationTimeoutId&&(t.clearTimeout(this.animationTimeoutId),this.animationTimeoutId=null),this.$tooltip.stop(!0),this._makeVisible()},n.prototype._makeVisible=function(){this.visible=!0,this.$tooltip.css("display","inline"),this.$tooltip.css("opacity","1")},n.prototype._updatePosition=function(){this.$tooltip.css("right",g+"px");for(var t=[],e=0;e<_.length;e++)_[e]!==this&&_[e].visible&&t.push(_[e]);if(t.length){for(var i=t[0],o=1;o<t.length;o++)parseInt(t[o].$tooltip.css("top"))>parseInt(i.$tooltip.css("top"))&&(i=t[o]);this.$tooltip.css("top",parseInt(i.$tooltip.css("top"))+i.$tooltip.outerHeight(!0)+"px")}var n=a.select("."+u);if(n.length&&n.is(":visible")){var s=l.getElementRectangle(n[0]),r=l.getElementRectangle(this.$tooltip[0]);s.left<r.left+r.width&&r.left<s.left+s.width&&s.top<r.top+r.height&&r.top<s.top+s.height&&s.left-r.width-g>=0&&this.$tooltip.css("right",r.left-s.left+r.width+2*g+"px")}},n.prototype.show=function(){this._stopAnimation(),this._startAnimation(),this._updatePosition()},n.prototype.hide=function(){this.visible=!1,this.$tooltip.css("display","none"),this.$tooltip.css("opacity","0")},o.show=function(t){for(var e=0;e<_.length;e++)if(_[e].message===t)return void _[e].show();var i=new n(t);i.show(),_.push(i)},o.hideAll=function(){for(var t=0;t<_.length;t++)_[t].visible&&_[t].hide()}}),i.define("UI.RecorderWidgets.UnsavedChangesDialog",function(t,i){var o=e.get("Hammerhead"),n=o.$,s=o.Util,r=o.ShadowUI,a=t("UI.RecorderWidgets.ConfirmDialog"),l=t("UI.RecorderWidgets.Button"),d="buttons",c="small",h="Unsaved changes",p=["Do you want to save the changes before you quit the test recorder?"],u=["There are changes that can be saved after all incorrect steps are corrected. Do you want to quit losing all unsaved changes?"];i.SAVE_BUTTON_CLICK_EVENT="saveButtonClick",i.CANCEL_BUTTON_CLICK_EVENT="cancelButtonClick",i.EXIT_BUTTON_CLICK_EVENT="exitButtonClick";var f=null,g=null,E=!1,v=null,_=null,m=null,C=function(){var t=n("<div></div>");return r.addClass(t,d),E?(m=l.create(t,"Yes"),_=l.create(t,"No")):(v=l.create(t,"Yes"),m=l.create(t,"No"),_=l.create(t,"Cancel"),r.addClass(v,c)),r.addClass(m,c),r.addClass(_,c),t},T=function(t){f=new a(t,{headerText:h,message:E?u:p,footerContent:C()}),S()},S=function(){r.bind(_,"click",function(){I(function(){g.emit(i.CANCEL_BUTTON_CLICK_EVENT)})}),r.bind(m,"click",function(){I(function(){g.emit(i.EXIT_BUTTON_CLICK_EVENT)})}),E?f.popup.onkeydown(function(t){t.keyCode===s.KEYS_MAPS.SPECIAL_KEYS.enter&&(m.trigger("click"),s.preventDefault(t)),t.keyCode===s.KEYS_MAPS.SPECIAL_KEYS.esc&&(_.trigger("click"),s.preventDefault(t)),t.target===f.popup.$popup[0]&&s.isArrowKey(t.keyCode)&&s.preventDefault(t)},!0):(r.bind(v,"click",function(){I(function(){g.emit(i.SAVE_BUTTON_CLICK_EVENT)})}),f.popup.onkeydown(function(t){t.keyCode===s.KEYS_MAPS.SPECIAL_KEYS.enter&&(v.trigger("click"),s.preventDefault(t)),t.keyCode===s.KEYS_MAPS.SPECIAL_KEYS.esc&&(_.trigger("click"),s.preventDefault(t)),t.target===f.popup.$popup[0]&&s.isArrowKey(t.keyCode)&&s.preventDefault(t)},!0))},I=function(t){f.popup.close(t)};i.init=function(t,e){g=new s.EventEmitter,E=e,T(t)},i.events={on:function(t,e){g.on(t,e)}}}),i.define("UI.RecorderWidgets.AddAssertionButton",function(i){function n(t){t.eventEmitter=new a.EventEmitter,t.on=function(e,i){t.eventEmitter.on(e,i)}}var s=e.get("Hammerhead"),r=s.$,a=s.Util,l=s.ShadowUI,d=i("UI.RecorderWidgets.Button"),c=["eq","notEq","ok","notOk"],h={eq:"eq-icon",notEq:"not-eq-icon",ok:"ok-icon",notOk:"not-ok-icon"},p="operator-icon",u="add-assertion-button-container",f="add-assertion-button",g="add-assertion-button-popup",E="add-assertion-button-popup-item",v="add-assertion-button-popup-separator",_=this.exports=function(t){var e=this;this.$container=null,this.$button=null,this.$popup=null,n(this),this.$container=r("<div></div>").appendTo(t),l.addClass(this.$container,u),this.$button=d.create(this.$container,"",!0),l.addClass(this.$button,f),this.$button.click(function(){e.$popup?e._closePopup():e._showPopup()})};_.prototype.getContainer=function(){return this.$container},_.ITEM_CLICKED_EVENT="itemClicked",_.POPUP_CLOSED_EVENT="popupClosed",_.prototype._showPopup=function(){var e=this;this.$popup=r("<div></div>"),l.addClass(this.$popup,g);for(var i=0;i<c.length;i++)if(this._addPopupItem(c[i]),i<c.length-1){var n=r("<div></div>").appendTo(this.$popup);l.addClass(n,v)}this.$popup.appendTo(this.$container);var s=this.$popup.height();this.$popup.offset().top-r(o).scrollTop()+s>r(t).height()&&this.$popup.css("top",parseInt(this.$popup.css("top").replace("px",""))-s-this.$button.height());var a=function(t){e.$container.find(t.target).length||e.$button[0]===t.target||e._closePopup()};l.bind(r(o),"mousedown",a),this.on(_.POPUP_CLOSED_EVENT,function(){l.unbind(r(o),"mousedown",a)})},_.prototype._closePopup=function(){if(this.$popup){var t=this.$popup.outerHeight(!0);this.$popup.remove(),this.$popup=null,this.eventEmitter.emit(_.POPUP_CLOSED_EVENT,{popupHeight:t})}},_.prototype._addPopupItem=function(t){var e=this,i=r("<div></div>").appendTo(this.$popup),o=r("<div></div>").appendTo(i);l.addClass(i,E),l.addClass(o,p),l.addClass(o,h[t]),i.click(function(i){return e._closePopup(),e.eventEmitter.emit(_.ITEM_CLICKED_EVENT,{operator:t}),a.preventDefault(i),!1})}}),i.define("UI.RecorderWidgets.Assertion",function(t){function i(t){t.eventEmitter=new r.EventEmitter,t.on=function(e,i){t.eventEmitter.on(e,i)}}function o(t){function e(t,e){for(var i=[t+"("],o=0;o<e.length;o++)o&&i.push(", "),i.push(e[o]||"...");return i.push([")"]),i.join("")}var i=t.arguments[0],o=t.arguments[1];return e(t.operator,o?[i,o]:[i])}var n=e.get("Hammerhead"),s=n.$,r=n.Util,a=n.ShadowUI,l=n.MessageSandbox,d=t("Base.CrossDomainMessages"),c=t("Base.JavascriptExecutor"),h=t("TestRunner.API.Assertions"),p=t("UI.RecorderWidgets.Button"),u={eq:"eq-icon",notEq:"not-eq-icon",ok:"ok-icon",notOk:"not-ok-icon"},f="assertion",g="operator-area",E="operator-icon",v="successful",_="failed",m="message-area",C="remove-assertion-button-area",T=this.exports=function(t,e,n){var s=this;this.options={
enableValidation:n.enableValidation},this.assertionInfo=e,this.$assertion=t,this.$operatorArea=null,this.$messageArea=null,this.$removeButtonArea=null,this.isValid=n.isValid,this.iFrameSelector=n.iFrameSelector||null,this.curError=null,this.failed=e.failed,a.addClass(this.$assertion,f),i(this),this._createOperator(e.operator),this._createMessage(e.message||o(e)),this._createRemoveButton(),this.assertionsAPI=new h(function(t){s.curError=t}),this.validate(),this.$assertion.click(function(){s.eventEmitter.emit(T.ASSERTION_CLICKED_EVENT,{})})};T.ASSERTION_CLICKED_EVENT="assertionClicked",T.ASSERTION_REMOVED_EVENT="assertionRemoved",T.VALIDITY_CHANGED_EVENT="validityChanged",T.prototype.update=function(t,e,i){this.assertionInfo.message!==t.message&&this._setMessage(t.message||o(t)),this.assertionInfo.arguments=t.arguments,this.assertionInfo.message=t.message,this.assertionInfo.operator=t.operator,this.assertionInfo=t,this.isValid=e,this.iFrameSelector=i,this.failed=t.failed,this._updateAssertionState()},T.prototype.getContainer=function(){return this.$assertion},T.prototype.setIFrameSelector=function(t){this.iFrameSelector=t},T.prototype._createOperator=function(t){this.$operatorArea=s("<div></div>").appendTo(this.$assertion),a.addClass(this.$operatorArea,g);var e=s("<div></div>").appendTo(this.$operatorArea);a.addClass(e,E),a.addClass(e,u[t])},T.prototype._createMessage=function(t){this.$messageArea=s("<div></div>").appendTo(this.$assertion),a.addClass(this.$messageArea,m),this._setMessage(t)},T.prototype._createRemoveButton=function(){var t=this;this.$removeButtonArea=s("<div></div>").appendTo(this.$assertion),a.addClass(this.$removeButtonArea,C);var e=p.create(this.$removeButtonArea,"",!0);e.click(function(){return t.eventEmitter.emit(T.ASSERTION_REMOVED_EVENT,{assertion:t}),!1})},T.prototype._setValidity=function(t){var e=t!==this.isValid;this.isValid=t,e&&this.eventEmitter.emit(T.VALIDITY_CHANGED_EVENT,{isValid:t})},T.prototype.validate=function(){function t(i){i.message.cmd===d.ASSERT_RESPONSE_CMD&&(e._setValidity(!i.message.err),e._updateAssertionState(),l.off(l.SERVICE_MSG_RECEIVED,t))}var e=this;if(this.options.enableValidation)if(this.curError=null,this.iFrameSelector){var i=c.parseSelectorSync(this.iFrameSelector).$elements,o=i&&i.length?i[0].contentWindow:null;if(o){var n={cmd:d.ASSERT_REQUEST_CMD,args:this.assertionInfo.arguments,operator:this.assertionInfo.operator};l.on(l.SERVICE_MSG_RECEIVED,t),l.sendServiceMsg(n,o)}}else{var r=s.map(this.assertionInfo.arguments,function(t){return t?c.eval(t,function(t){e.curError=t}):t});r.push(this.assertionInfo.message),this.curError||this.assertionsAPI[this.assertionInfo.operator].apply(this.assertionsAPI,r),e._setValidity(!this.curError),this._updateAssertionState()}else this._updateAssertionState()},T.prototype._updateAssertionState=function(){this.failed?(a.removeClass(this.$operatorArea,v),a.addClass(this.$operatorArea,_)):(a.removeClass(this.$operatorArea,v),a.removeClass(this.$operatorArea,_)),this.options.enableValidation&&(this.isValid?(a.removeClass(this.$operatorArea,_),a.addClass(this.$operatorArea,v)):(a.removeClass(this.$operatorArea,v),a.addClass(this.$operatorArea,_)))},T.prototype._setMessage=function(t){this.$messageArea.text(t||"")}}),i.define("UI.RecorderWidgets.AssertionsBlock",function(){var t=e.get("Hammerhead"),i=t.$,o=t.ShadowUI,n="assertions-block",s="title",r="content",a=this.exports=function(t,e,a){this.$block=i("<div></div>").appendTo(t),this.context=e,this.$title=i("<div></div>").css("display",a?"":"none").appendTo(this.$block),this.$title.text(e?"Assertions in IFrame: "+e:"Assertions in the main window"),this.$content=i("<div></div>").appendTo(this.$block),this.assertions=[],this.assertionsInfo=[],o.addClass(this.$block,n),o.addClass(this.$title,s),o.addClass(this.$content,r)};a.prototype.addAssertion=function(t,e){this.assertions.push(t),this.assertionsInfo.push(e),t.appendTo(this.$content)},a.prototype.removeAssertion=function(t){var e=i.inArray(t,this.assertions);e>-1&&(this.assertions.splice(e,1),this.assertionsInfo.splice(e,1))},a.prototype.showTitle=function(){this.$title.css("display","")},a.prototype.hideTitle=function(){this.$title.css("display","none")},a.prototype.getAssertionsCount=function(){return this.assertions.length},a.prototype.getContext=function(){return this.context},a.prototype.getAssertionsInfo=function(){return this.assertionsInfo},a.prototype.remove=function(){this.$block.remove(),this.$title.remove()}}),i.define("UI.RecorderWidgets.AssertionsStep",function(t){var i=e.get("Hammerhead"),o=i.$,n=i.Util,s=i.ShadowUI,r=t("UI.RecorderWidgets.BaseStep"),a=t("UI.RecorderWidgets.ScrollBar"),l=t("UI.RecorderWidgets.EditAssertionDialog"),d=t("UI.RecorderWidgets.Assertion"),c=t("UI.RecorderWidgets.AssertionsBlock"),h=t("UI.RecorderWidgets.AddAssertionButton"),p=t("UI.UXLog"),u="assertions-step",f="assertions-area",g="assertion-list",E="assertions",v="empty",_=this.exports=function(t,e,i,o){o=o||{},this.options={enableAssertionsValidation:!!o.enableAssertionsValidation,updateAssertionsState:o.updateAssertionsState,parentPopup:o.parentPopup},this.$step=null,this.$assertionsArea=null,this.$assertionList=null,this.$assertions=null,this.blocks=[],this.stepInfo=i,this.addAssertionButton=null,this.scrollBar=null,this.$iFrameContextLabelContainer=null,r.apply(this,[t,e,i,o]),s.addClass(this.$step,u),this._createAssertionsArea()};n.inherit(_,r),_.STEP_NAME_CHANGED_EVENT=r.STEP_NAME_CHANGED_EVENT,_.STEP_INFO_CHANGED_EVENT=r.STEP_INFO_CHANGED_EVENT,_.EDIT_ASSERTION_START_EVENT="editAssertionStart",_.EDIT_ASSERTION_COMPLETE_EVENT="editAssertionComplete",_.START_PICKING_ELEMENT_EVENT="startPickingElement",_.prototype._createAssertionsList=function(){this.$assertionList=o("<div></div>").appendTo(this.$assertionsArea),s.addClass(this.$assertionList,g),this.scrollBar=new a(this.$assertionsArea),this.$assertions=o("<div></div>").appendTo(this.$assertionList),s.addClass(this.$assertions,E),this.scrollBar.init(this.$assertionList,this.$assertions)},_.prototype._createAssertionsArea=function(){this.$assertionsArea=o("<div></div>").appendTo(this.$step),s.addClass(this.$assertionsArea,f),this.stepInfo.blocks.length?this._createAssertionsList():s.addClass(this.$assertionsArea,v),this._createAddAssertionButton();for(var t=0;t<this.stepInfo.blocks.length;t++)for(var e=0;e<this.stepInfo.blocks[t].assertions.length;e++)this._addAssertion(this.stepInfo.blocks[t].assertions[e],this.stepInfo.blocks[t].iFrameSelector);this._updateBlocks(),this.scrollBar&&(this.scrollBar.recalculateSize(),this._scrollAssertionListToBottom())},_.prototype._createAddAssertionButton=function(){var t=this;this.addAssertionButton=new h(this.$step),this.addAssertionButton.on(h.ITEM_CLICKED_EVENT,function(e){p.write("Assertions: add assertion button is pressed"),t._showEditAssertionDialog(t._getEmptyAssertionInfo(e.operator),e.iFrameSelector,function(e){p.write("Assertions: assertion is added"),t._addAssertion(e.assertionInfo,e.iFrameSelector,e.isValid),t._updateBlocks(),t.scrollBar.recalculateSize(),t._scrollAssertionListToBottom(t._findBlock(e.iFrameSelector))})})},_.prototype._onChange=function(){this.eventEmitter.emit(_.STEP_INFO_CHANGED_EVENT,{})},_.prototype._findBlock=function(t){for(var e=0;e<this.blocks.length;e++)if(this.blocks[e].getContext()===t)return this.blocks[e];return null},_.prototype._removeBlock=function(t){var e=o.inArray(t,this.blocks);e>-1&&this.blocks.splice(e,1),this.blocks.length||(this.$assertionsArea.html(""),this.scrollBar=null,this.$assertionList=null)},_.prototype._updateBlocks=function(){var t=0;if(this.blocks.length>1)for(;t<this.blocks.length;t++)this.blocks[t].showTitle();else this.blocks.length&&!this.blocks[0].getContext()&&this.blocks[0].hideTitle();for(this.stepInfo.blocks=[],t=0;t<this.blocks.length;t++)this.stepInfo.blocks.push({assertions:this.blocks[t].assertionsInfo,iFrameSelector:this.blocks[t].getContext()});this.stepInfo.blocks.length?s.removeClass(this.$assertionsArea,v):s.addClass(this.$assertionsArea,v)},_.prototype._addAssertion=function(t,e,i){var n=this,s=this._findBlock(e);this.$assertionList||this._createAssertionsList(),s||(s=new c(this.$assertions,e,(!!e)),this.blocks.push(s));var r=o("<div></div>"),a=new d(r,t,{enableValidation:this.options.enableAssertionsValidation,isValid:i,iFrameSelector:e});s.addAssertion(r,t),this.options.updateAssertionsState&&(t.failed=a.isValid===!1),a.on(d.VALIDITY_CHANGED_EVENT,function(e){t.failed=e.isValid===!1}),a.on(d.ASSERTION_CLICKED_EVENT,function(){p.write("Assertions: edit assertion is started"),n._showEditAssertionDialog(a.assertionInfo,e,function(e){p.write("Assertions: assertion is changed"),t.failed=!!n.options.updateAssertionsState&&!e.isValid,a.update(e.assertionInfo,e.isValid,e.iFrameSelector)})}),a.on(d.ASSERTION_REMOVED_EVENT,function(){p.write("Assertions: assertion is removed");var t=o.inArray(a.$assertion,s.assertions),e=parseInt(n.scrollBar.$scrollBar.css("top").replace("px",""));s.removeAssertion(r),s.getAssertionsCount()||(s.remove(),n._removeBlock(s),n._updateBlocks()),a.getContainer().remove(),n.scrollBar&&(n.scrollBar.recalculateSize(),s.assertions&&s.assertions.length&&(n.scrollBar.restoreScroll(e),n.scrollBar.updateScroll(s.assertions[t]))),n._onChange()})},_.prototype._onScrollableContentHeightChange=function(t){if(this.scrollBar){var e=parseInt(this.$assertions.css("top").replace("px",""));if(e<0){var i=Math.min(e-t,0);this.$assertions.css("top",i+"px"),this.scrollBar.recalculateSize()}}},_.prototype._showEditAssertionDialog=function(t,e,i){var o=this;o.options.parentPopup&&o.options.parentPopup.hide(),this.eventEmitter.emit(_.EDIT_ASSERTION_START_EVENT,{});var n=new l(t,{enableAssertionValidation:o.options.enableAssertionsValidation,iFrameSelector:e});n.on(l.CONFIRM_BUTTON_CLICK_EVENT,function(t){o.options.parentPopup&&o.options.parentPopup.show(),i(t),o._onChange(),o.eventEmitter.emit(_.EDIT_ASSERTION_COMPLETE_EVENT)}),n.on(l.CANCEL_BUTTON_CLICK_EVENT,function(){o.options.parentPopup&&o.options.parentPopup.show(),o.eventEmitter.emit(_.EDIT_ASSERTION_COMPLETE_EVENT)}),n.on(l.START_PICKING_ELEMENT_EVENT,function(t){o.eventEmitter.emit(_.START_PICKING_ELEMENT_EVENT,t)})},_.prototype._getEmptyAssertionInfo=function(t){return{operator:t,message:"",arguments:new Array(/eq/i.test(t)?2:1)}},_.prototype._scrollAssertionListToBottom=function(t){var e=t||this.blocks[this.blocks.length-1],i=e.assertions[e.assertions.length-1];this.scrollBar.updateScroll(i)},_.prototype.isValid=function(){return!!this.stepInfo.blocks.length},_.prototype.getStepInfo=function(){return this.stepInfo}}),i.define("UI.RecorderWidgets.AssertionArgument",function(t){var i=e.get("Hammerhead"),o=i.$,n=i.Util,s=i.ShadowUI,r=t("UI.RecorderWidgets.CodeEditor"),a=t("UI.RecorderWidgets.ChooseSelectorDialog"),l=t("UI.RecorderWidgets.ChoosePropertyDialog"),d=t("UI.ValidationMessageFactory"),c=t("Base.JavascriptExecutor"),h=t("UI.ModalBackground"),p=t("UI.RecorderWidgets.ObjectViewer"),u=t("UI.RecorderWidgets.Button"),f=t("UI.UXLog"),g=364,E=119,v=116,_=" Value:",m="Open assertion argument wizard",C="argument",T="argument-label",S="value-label",I="argument-value",y=this.exports=function(t,e){e=e||{};var i=this;this.value=e.value||"",this.error=null,this.editor=null,this.objectViewer=null,this.iFrameContext=e.iFrameContext||null,this.iFrameSelector=e.iFrameSelector||null,this.enableValidation=e.enableValidation||!1,this.parentPopup=e.parentPopup,this.savedIFrameContext=null,this.lastParsedValue=null,this.parsingInProcess=!1,this.changeDelayed=!1,this.isReproducibleValue=!1,this.$argument=null,this.eventEmitter=new n.EventEmitter,this.on=function(t,e){i.eventEmitter.on(t,e)};var r=this._createLabel(T,e.argumentName+":");r.appendTo(t),this.$argument=o("<div></div>").css("height",E).appendTo(t),s.addClass(this.$argument,C),this._createInput(),this._createOpenWizardButton();var a=this._createLabel(S,e.argumentName+_),l=o("<div></div>");s.addClass(l,I),this.enableValidation&&(a.appendTo(t),l.appendTo(t)),this.objectViewer=new p(l),this._update()};y.ARGUMENT_CHANGED_EVENT="argumentChanged",y.START_PICKING_ELEMENT_EVENT="startPickingElement",y.ARGUMENT_REPRODUCIBLE_STATE_UPDATED="argumentReproducibleStateUpdated",y.prototype._createInput=function(){var t=this,e=o("<div></div>").appendTo(this.$argument);this.editor=new r(e,{width:g,height:v,fixedHeight:!0,text:this.value,allowEdit:!0,floatingWidth:!1}),this.editor.events.on(r.CHANGE_EVENT,function(e){t._setArgumentValue(e.text)})},y.prototype._createLabel=function(t,e){var i=o("<label></label>").text(e);return s.addClass(i,t),i},y.prototype._createOpenWizardButton=function(){function t(){f.write("Assertions: start assertion wizard"),n=o.editor.getText(),o.parentPopup&&o.parentPopup.hide(),h.hide(),o.eventEmitter.emit(y.START_PICKING_ELEMENT_EVENT,{callback:function(t,i){if(t){var n=i&&i.length?c.parseSelectorSync(i[0].selector).$elements:null;o.savedIFrameContext=o.iFrameContext,o.iFrameContext=n&&n.length?n[0].contentWindow:null,o.iFrameSelector=n&&n.length?i[0].selector:null,e(t,0,n)}else h.show(),o.parentPopup&&o.parentPopup.show()},iFrameContext:o.iFrameContext})}function e(t,e,n,s){h.show(!0);var r=new a(t,e,n,s);r.on(a.CONFIRM_BUTTON_CLICK_EVENT,function(t){i({parsedElementSelector:t.parsedElementSelector,elementSelectors:t.elementSelectors,elementSelectorsIndex:t.elementSelectorsIndex,popupPosition:t.popupPosition,iFrameContext:o.iFrameContext,$iFrame:n})}),r.on(a.CLOSE_BUTTON_CLICK_EVENT,function(){o.iFrameContext=this.savedIFrameContext,o.parentPopup&&o.parentPopup.show(),h.show()})}function i(t){h.show();var i=new l(t.parsedElementSelector,t.popupPosition,t.iFrameContext);i.on(l.CONFIRM_BUTTON_CLICK_EVENT,function(t){f.write("Assertions: assertion argument created by wizard"),o.parentPopup&&o.parentPopup.show(),o.editor.focus(),o.editor.setText(t.text),n===t.text&&o._onChange()}),i.on(l.CLOSE_BUTTON_CLICK_EVENT,function(){o.iFrameContext=this.savedIFrameContext,o.parentPopup&&o.parentPopup.show()}),i.on(l.PREVIOUS_BUTTON_CLICK_EVENT,function(i){e(t.elementSelectors,t.elementSelectorsIndex,t.$iFrame,i.popupPosition)})}var o=this,n=null,s=u.create(this.$argument,"",!0);s.attr("title",m),s.click(t)},y.prototype._setArgumentValue=function(t){this.value=t,this._onChange()},y.prototype._onChange=function(){this._update(),this.parsingInProcess?this.changeDelayed=!0:this._emitChangeEvent()},y.prototype._emitChangeEvent=function(){var t=this;this.eventEmitter.emit(y.ARGUMENT_CHANGED_EVENT,{value:t.value,iFrameContext:t.iFrameContext,iFrameSelector:t.iFrameSelector})},y.prototype._update=function(){var t=this;this._resetError(),this.objectViewer.clear(),this.value?(this.parsingInProcess=!0,this.objectViewer.show(this.value,this.iFrameContext,function(e){t.isReproducibleValue=e.isReproducibleValue,t.eventEmitter.emit(y.ARGUMENT_REPRODUCIBLE_STATE_UPDATED),e.error?t._onError(e.error):t.lastParsedValue=e.parsedValue,t.changeDelayed&&(t._emitChangeEvent(),t.changeDelayed=!1),t.parsingInProcess=!1})):this.eventEmitter.emit(y.ARGUMENT_REPRODUCIBLE_STATE_UPDATED)},y.prototype._onError=function(t){this.error=t,d.error(this.editor.getContainer(),t)},y.prototype._resetError=function(){this.error=null,d.success(this.editor.getContainer())},y.prototype.getLastParsedValue=function(){return this.lastParsedValue},y.prototype.isValid=function(){return!this.error},y.prototype.setValue=function(t){this.editor.setText(t)},y.prototype.removeIFrameContext=function(){this.iFrameContext=null,this._onChange()},y.prototype.setIFrameContext=function(t){this.iFrameContext=t,this._onChange()}}),i.define("UI.RecorderWidgets.ChoosePropertyDialog",function(t){function i(t){var e=n("<div></div>").appendTo(t),i=n("<div></div>").text("variable").appendTo(e),o=n("<div></div>").text("value").appendTo(e);r.addClass(e,L),r.addClass(i,A),r.addClass(o,A)}var o=e.get("Hammerhead"),n=o.$,s=o.Util,r=o.ShadowUI,a=t("Recorder.PropertyListGenerator"),l=t("UI.RecorderWidgets.Popup"),d=t("UI.RecorderWidgets.Button"),c=t("UI.RecorderWidgets.ScrollBar"),h=t("UI.RecorderWidgets.Tabs"),p="buttons",u="widget-switcher left",f="widget-switcher right",g="clear",E="choose-property-dialog",v="property-list-container",_="property-list",m="property-list-items",C="property-list-item",T="hovered",S="selected",I="even",y="property-name",$="property-value",b="recorder",x="result",L="column-headers",A="header",w=629,N=this.exports=function(t,e,i){var o=this;this.tabs=null,this.parsedSelector=t,this.popup=null,this.popupPosition=e||null,this.selectedProperty=null,this.iFrameContext=i,this.$selectedPropertyItem=null,this.$backButton=null,this.$nextButton=null,this.$dialog=null,this.$resultBox=null,this.eventEmitter=new s.EventEmitter,this.on=function(t,e){o.eventEmitter.on(t,e)},this._createDialog(),this._init()};N.CONFIRM_BUTTON_CLICK_EVENT="confirmButtonClick",N.CLOSE_BUTTON_CLICK_EVENT="closeButtonClick",N.PREVIOUS_BUTTON_CLICK_EVENT="previousButtonClick",N.prototype._createDialog=function(){var t=this,e=r.select("."+b,r.getRoot());this.$dialog=n("<div></div>"),r.addClass(this.$dialog,E);var i={width:w,headerText:"Choose property",content:this.$dialog,footerContent:this._createButtons(),backgroundOpacity:!0,headerCloseButton:!0};this.popup=new l(e,i),this._createResultBox(),this.tabs=new h(this.$dialog,{titles:["common","css properties","attributes"],getContentCallback:function(e,i){0===e?a.getGeneralProperties(t.parsedSelector.evalResults,t.parsedSelector.selector,function(e){t._createProperties(e,function(e,o){i(e,function(){o(),t.popupPosition&&t.popup.moveTo(t.popupPosition.left,t.popupPosition.top)})})},t.iFrameContext):1===e?a.getCssProperties(t.parsedSelector.evalResults,t.parsedSelector.selector,function(e){t._createProperties(e,i)},t.iFrameContext):a.getAttributes(t.parsedSelector.evalResults,t.parsedSelector.selector,function(e){t._createProperties(e,i)},t.iFrameContext)}}),this.popupPosition?this.popup.moveTo(this.popupPosition.left,this.popupPosition.top):this.popup.showAtWindowCenter()},N.prototype._createButtons=function(){var t=n("<div></div>");return r.addClass(t,p),this.$backButton=d.create(t,"Back",!0),r.addClass(this.$backButton,u),this.$nextButton=d.create(t,"Next",!0),r.addClass(this.$nextButton,f),this.$backButton.css({paddingLeft:s.isMozilla?"6px":"9px",paddingRight:s.isMozilla?"6px":"9px",width:s.isMozilla?"144px":"138px"}),this.$nextButton.css({paddingLeft:s.isMozilla?"6px":"9px",paddingRight:s.isMozilla?"6px":"9px",width:s.isMozilla?"144px":"138px"}),r.addClass(n("<div></div>").appendTo(t),g),t},N.prototype._createResultBox=function(){this.$resultBox=n("<div></div>").text(this.parsedSelector.selector).appendTo(this.$dialog),r.addClass(this.$resultBox,x)},N.prototype._createProperties=function(t,e){var o=n("<div></div>");i(o);var s=n("<div></div>").appendTo(o),a=n("<div></div>").appendTo(s),l=n("<div></div>").appendTo(a);r.addClass(s,v),r.addClass(a,_),r.addClass(l,m);for(var d=0;d<t.length;d++)this._createPropertyListItem(t[d],d%2!==0).appendTo(l);var h=new c(s);h.init(a,l),e(o,function(){h.recalculateSize()})},N.prototype._createPropertyListItem=function(t,e){var i=this,o=n("<div></div>");r.addClass(o,C),e&&r.addClass(o,I),o.data("property",t);var s=n("<div></div>").text(t.name).appendTo(o);r.addClass(s,y);var a=n("<div></div>").text(t.value).appendTo(o);return r.addClass(a,$),a[0].offsetWidth<a[0].scrollWidth&&a.attr("title",t.value),o.click(function(){i.selectedProperty===t?(i._clearSelectedPropertyItem(),i.selectedProperty=null,i.$resultBox.text(i._getGeneratedArgument())):i._setSelectedProperty(o,t)}),o.hover(function(){r.addClass(o,T)},function(){r.removeClass(o,T)}),t.isDefault&&this._setSelectedProperty(o,t),o},N.prototype._clearSelectedPropertyItem=function(){this.$selectedPropertyItem&&r.removeClass(this.$selectedPropertyItem,S)},N.prototype._getGeneratedArgument=function(){return this.selectedProperty?this.selectedProperty.getter:this.parsedSelector.selector},N.prototype._setSelectedProperty=function(t,e){this.selectedProperty=e,this._clearSelectedPropertyItem(),this.$selectedPropertyItem=t,r.addClass(t,S),r.removeClass(t,T),this.$resultBox.text(this._getGeneratedArgument())},N.prototype._init=function(){var t=this;r.bind(this.$backButton,"click",function(){t._close(function(){t.eventEmitter.emit(N.PREVIOUS_BUTTON_CLICK_EVENT,{popupPosition:t.popup.getPosition()})})}),r.bind(this.$nextButton,"click",function(){t._close(function(){t.eventEmitter.emit(N.CONFIRM_BUTTON_CLICK_EVENT,{text:t._getGeneratedArgument()})})}),this.popup.on(l.CLOSE_BUTTON_CLICK_EVENT,function(){t._close(function(){t.eventEmitter.emit(N.CLOSE_BUTTON_CLICK_EVENT,{})})}),this.popup.onkeydown(function(e){e.keyCode===s.KEYS_MAPS.SPECIAL_KEYS.enter&&(t.$nextButton&&"hidden"!==t.$nextButton.css("visibility")&&t.$nextButton.trigger("click"),s.preventDefault(e)),e.target===t.popup.$popup[0]&&s.isArrowKey(e.keyCode)&&s.preventDefault(e)},!0)},N.prototype._close=function(t){this.popup.close(t)}}),i.define("UI.RecorderWidgets.ChooseSelectorDialog",function(t){var i=e.get("Hammerhead"),o=i.$,n=i.Util,s=i.ShadowUI,r=t("UI.RecorderWidgets.Popup"),a=t("UI.RecorderWidgets.Button"),l=t("UI.RecorderWidgets.SelectorEditor"),d=t("Base.JavascriptExecutor"),c="buttons",h="widget-switcher left",p="widget-switcher right",u="clear",f="choose-selector-dialog",g="selector-editor-container",E="recorder",v="Element Selector",_=629,m=this.exports=function(t,e,i,o){var s=this;this.popup=null,this.popupPosition=o||null,this.selectorEditor=null,this.elementSelectors=t,this.elementSelectorsIndex=e||0,this.$nextButton=null,this.$backButton=null,this.$dialog=null,this.eventEmitter=new n.EventEmitter,this.on=function(t,e){s.eventEmitter.on(t,e)},this.$iFrame=i,this._createDialog(),this._init()};m.CONFIRM_BUTTON_CLICK_EVENT="confirmButtonClick",m.CLOSE_BUTTON_CLICK_EVENT="closeButtonClick",m.prototype._createDialog=function(){var t=s.select("."+E,s.getRoot());this.$dialog=o("<div></div>").css("visibility","hidden"),s.addClass(this.$dialog,f);var e={width:_,headerText:v,content:this.$dialog,footerContent:this._createButtons(),backgroundOpacity:!0,headerCloseButton:!0};if(this.popup=new r(t,e),this._createSelectorEditor(),this.popupPosition)this.popup.moveTo(this.popupPosition.left,this.popupPosition.top);else{var i=this.$iFrame||d.parseSelectorSync(this.elementSelectors[0].selector).$elements;this.popup.disposeRelativeToElement(i)}this.selectorEditor.enableElementsMarking(),this.$dialog.css("visibility","")},m.prototype._createButtons=function(){var t=o("<div></div>");return s.addClass(t,c),this.$backButton=a.create(t,"Back",!0),s.addClass(this.$backButton,h),this.$nextButton=a.create(t,"Next",!0),s.addClass(this.$nextButton,p),this.$backButton.css({paddingLeft:n.isMozilla?"6px":"9px",paddingRight:n.isMozilla?"6px":"9px",width:n.isMozilla?"144px":"138px"}),this.$nextButton.css({paddingLeft:n.isMozilla?"6px":"9px",paddingRight:n.isMozilla?"6px":"9px",width:n.isMozilla?"144px":"138px"}),s.addClass(o("<div></div>").appendTo(t),u),t},m.prototype._createSelectorEditor=function(){var t=this,e=o("<div></div>").appendTo(this.$dialog);s.addClass(e,g),this.selectorEditor=new l(e,{selectors:t.elementSelectors,currentSelectorIndex:t.elementSelectorsIndex,enableElementsMarking:!1,parseDomElementsOrJqueryObjectsOnly:!0,allowMultipleElements:!0,allowEdit:!0,$floatingParent:this.popup.getContainer(),enableValidation:!0,context:this.$iFrame?this.$iFrame[0].contentWindow:null})},m.prototype._onError=function(){this.$nextButton.css("visibility","hidden")},m.prototype._onSuccess=function(){this.$nextButton.css("visibility","")},m.prototype._init=function(){function t(){e._close(function(){e.eventEmitter.emit(m.CLOSE_BUTTON_CLICK_EVENT,{})})}var e=this;s.bind(this.$nextButton,"click",function(){e._close(function(){e.eventEmitter.emit(m.CONFIRM_BUTTON_CLICK_EVENT,{elementSelectors:e.elementSelectors,elementSelectorsIndex:e.elementSelectorsIndex,parsedElementSelector:e.selectorEditor.getParsedSelector(),popupPosition:e.popup.getPosition()})})}),s.bind(this.$backButton,"click",t),this.popup.on(r.CLOSE_BUTTON_CLICK_EVENT,t),this.popup.onkeydown(function(t){t.keyCode===n.KEYS_MAPS.SPECIAL_KEYS.enter&&(e.$nextButton&&"hidden"!==e.$nextButton.css("visibility")&&e.$nextButton.trigger("click"),n.preventDefault(t)),t.keyCode===n.KEYS_MAPS.SPECIAL_KEYS.esc&&(e.$backButton.trigger("click"),n.preventDefault(t)),t.target===e.popup.$popup[0]&&n.isArrowKey(t.keyCode)&&n.preventDefault(t)},!0),this.selectorEditor.on(l.SELECTOR_CHANGED_EVENT,function(t){!e.selectorEditor.isValid(!0)||e.selectorEditor.getParsedSelector()&&!e.selectorEditor.getParsedSelector().length?e._onError():(e._onSuccess(),e.elementSelectors=t.selectors,e.elementSelectorsIndex=t.index)}),(!e.selectorEditor.isValid(!0)||e.selectorEditor.getParsedSelector()&&!e.selectorEditor.getParsedSelector().$elements)&&e._onError()},m.prototype._close=function(t){this.selectorEditor.destroy(),this.popup.close(t)}}),i.define("UI.RecorderWidgets.EditAssertionDialog",function(t){var i=e.get("Hammerhead"),o=i.$,n=i.Util,s=i.ShadowUI,r=t("UI.RecorderWidgets.Popup"),a=t("UI.RecorderWidgets.Button"),l=t("TestRunner.API.Assertions"),d=t("UI.RecorderWidgets.AssertionArgument"),c=t("UI.RecorderWidgets.DialogProperty"),h=t("Recorder.IFrameContextLabel"),p=t("Base.JavascriptExecutor"),u=931,f=447,g="startPickingElement",E="Actual",v="Expected",_="Expression",m={eq:"eq-icon",notEq:"not-eq-icon",ok:"ok-icon",notOk:"not-ok-icon"},C="recorder",T="buttons",S="edit-assertion-dialog",I="separator",y="middle-area",$="copy-button",b="header-operator-icon",x="successful",L="failed",A="arguments-area",w="argument-area",N="state-indicator",P="state-text",D="iframe-context",R=this.exports=function(t,e){var i=this;e=e||{},this.options={enableAssertionValidation:e.enableAssertionValidation},this.popup=null,this.$confirmButton=null,this.$cancelButton=null,this.$dialog=null,this.$middleArea=null,this.$copyButton=null,this.$stateIndicator=null,this.$stateText=null,this.$argumentsArea=null,this.messageEditor=null,this.expected=null,this.actual=null,this.operator=t.operator,this.error=null,this.iFrameSelector=e.iFrameSelector||null;var o=this.iFrameSelector?p.parseSelectorSync(this.iFrameSelector).$elements:null;this.iFrameContext=o&&o.length?o[0].contentWindow:null,this.eventEmitter=new n.EventEmitter,this.on=function(t,e){i.eventEmitter.on(t,e)},this._createDialog(t),this._init(),this._validate(),this.iFrameSelector&&this._createIFrameContextLabel(this.iFrameSelector)};R.CONFIRM_BUTTON_CLICK_EVENT="confirmButtonClick",R.CANCEL_BUTTON_CLICK_EVENT="cancelButtonClick",R.START_PICKING_ELEMENT_EVENT=g,R.prototype._createDialog=function(t){this.$dialog=o("<div></div>"),s.addClass(this.$dialog,S);var e={width:2===t.arguments.length?u:f,headerText:"Edit assertion",headerIconClass:b+" "+m[t.operator],content:this.$dialog,footerContent:this._createButtons(),backgroundOpacity:!0,showAtWindowCenter:!0,hasParentPopup:!0},i=s.select("."+C,s.getRoot());this.popup=new r(i.length?i:s.getRoot(),e),this._createMessage(t.message),this._createArgumentsArea(t.arguments),this.options.enableAssertionValidation&&this._createStateIndicator(),this.popup.showAtWindowCenter()},R.prototype._createButtons=function(){var t=o("<div></div>");return s.addClass(t,T),this.$confirmButton=a.create(t,"OK"),this.$cancelButton=a.create(t,"Cancel"),t},R.prototype._createMessage=function(t){this.messageEditor=new c(this.$dialog,"message",t,{maximizeInput:!0});var e=o("<div></div>").appendTo(this.$dialog);s.addClass(e,I)},R.prototype._createIFrameContextLabel=function(t){var e=this,i=o("<div></div>").prependTo(this.$argumentsArea);s.addClass(i,w),s.addClass(i,D),h.create(i,t,function(){e.iFrameContext=e.iFrameSelector=null,e.actual.removeIFrameContext(),e.expected&&e.expected.removeIFrameContext()},!1)},R.prototype._createArgumentsArea=function(t){var e=this.$argumentsArea=o("<div></div>").appendTo(this.$dialog);s.addClass(e,A);var i=o("<div></div>").appendTo(e);if(s.addClass(i,w),this.actual=this._createArgument(i,1===t.length?_:E,t[0]),this.actual.editor.focus(),this.actual.editor.setCursorToEnd(),"eq"!==this.operator&&"notEq"!==this.operator||this._createMiddleArea(e),t.length>1){var n=o("<div></div>").appendTo(e);s.addClass(n,w),this.expected=this._createArgument(n,v,t[1]),this._monitorActualValueStateUpdate()}},R.prototype._createStateIndicator=function(){this.$stateIndicator=o("<div></div>").appendTo(this.$dialog),s.addClass(this.$stateIndicator,N),this.$stateText=o("<div></div>").appendTo(this.$stateIndicator),s.addClass(this.$stateText,P)},R.prototype._createArgument=function(t,e,i){var o=this,n=new d(t,{argumentName:e,value:i,iFrameSelector:o.iFrameSelector,iFrameContext:o.iFrameContext,enableValidation:o.options.enableAssertionValidation,parentPopup:o.popup});return n.on(d.ARGUMENT_CHANGED_EVENT,function(t){t.iFrameContext!==o.iFrameContext&&(o.iFrameContext=t.iFrameContext,o.iFrameSelector=t.iFrameSelector,t.iFrameContext&&o._createIFrameContextLabel(t.iFrameSelector),n!==o.actual?o.actual.setIFrameContext(t.iFrameContext):o.expected&&o.expected.setIFrameContext(t.iFrameContext)),o._onChange()}),n.on(d.START_PICKING_ELEMENT_EVENT,function(t){o.eventEmitter.emit(R.START_PICKING_ELEMENT_EVENT,t)}),n},R.prototype._createMiddleArea=function(t){this.$middleArea=o("<div></div>").appendTo(t),s.addClass(this.$middleArea,y);var e=o("<div></div>").appendTo(this.$middleArea);s.addClass(e,m[this.operator]),"eq"===this.operator&&this.options.enableAssertionValidation&&(this.$copyButton=a.create(this.$middleArea,"",!0),s.addClass(this.$copyButton,$),this._setCopyButtonState())},R.prototype._setCopyButtonState=function(){this.$copyButton&&(this.actual.value&&this.actual.isReproducibleValue?this.$copyButton.removeAttr("disabled"):this.$copyButton.attr("disabled","disabled"))},R.prototype._monitorActualValueStateUpdate=function(){var t=this;this.actual.on(d.ARGUMENT_REPRODUCIBLE_STATE_UPDATED,function(){t._setCopyButtonState()})},R.prototype._onChange=function(){this._validate()},R.prototype._validate=function(){var t=this,e=this._argumentsFilled()&&this.actual.isValid()&&(!this.expected||this.expected.isValid());if(!e)return void this._onError();if(this._onSuccess(),this.options.enableAssertionValidation){this.error=null;var i=this.actual.iFrameContext,o=[i?this.actual.value:this.actual.getLastParsedValue()];this.expected&&o.push(i?this.expected.value:this.expected.getLastParsedValue()),o.push(this.messageEditor.getEditorText()),l.assert(this.operator,o,function(e){t.error=e,t._setState(!t.error)},i)}},R.prototype._onError=function(){this.$stateIndicator&&this.$stateIndicator.css("visibility","hidden"),this.$confirmButton.attr("disabled","disabled")},R.prototype._onSuccess=function(){this.$confirmButton.removeAttr("disabled")},R.prototype._setState=function(t){t?(s.removeClass(this.$stateIndicator,L),s.addClass(this.$stateIndicator,x),this.$stateText.text("passed")):(s.removeClass(this.$stateIndicator,x),s.addClass(this.$stateIndicator,L),this.$stateText.text("failed")),this.$stateIndicator.css("visibility",this._argumentsFilled()?"":"hidden")},R.prototype._argumentsFilled=function(){return this.actual.value&&!(this.expected&&!this.expected.value)},R.prototype._init=function(){var t=this;this.$copyButton&&s.bind(this.$copyButton,"click",function(){t.expected&&t.expected.setValue(t.actual.objectViewer.getText())}),s.bind(this.$confirmButton,"click",function(){t._close(function(){t.eventEmitter.emit(R.CONFIRM_BUTTON_CLICK_EVENT,{assertionInfo:{operator:t.operator,message:t.messageEditor.getEditorText(),arguments:t.expected?[t.actual.value,t.expected.value]:[t.actual.value]},iFrameSelector:t.iFrameSelector,isValid:!t.error})})}),s.bind(this.$cancelButton,"click",function(){t._close(function(){t.eventEmitter.emit(R.CANCEL_BUTTON_CLICK_EVENT,{})})}),this.popup.onkeydown(function(e){e.keyCode===n.KEYS_MAPS.SPECIAL_KEYS.enter&&(t.$confirmButton&&"hidden"!==t.$confirmButton.css("visibility")&&t.$confirmButton.trigger("click"),
n.preventDefault(e)),e.keyCode===n.KEYS_MAPS.SPECIAL_KEYS.esc&&(t.$cancelButton.trigger("click"),n.preventDefault(e)),e.target===t.popup.$popup[0]&&n.isArrowKey(e.keyCode)&&n.preventDefault(e)},!0)},R.prototype._close=function(t){this.popup.close(t)}})},window.initTestCafeRecorderUI(window)}();