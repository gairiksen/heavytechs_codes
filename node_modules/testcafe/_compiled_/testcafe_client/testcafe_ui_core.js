!function(){window.initTestCafeUI=function(t){var e=t.HammerheadClient,o=t.TestCafeClient,i=t.document;o.define("UI",function(o,i){var s=e.get("Hammerhead"),n=s.NativeMethods,r=o("UI.ProgressPanel"),a=100,c=300,u=1e3,l=null,d=null,h=null,p=null;i.showProgressPanel=function(e,o,i){function s(){return Math.round((Date.now()-p)/o*100)}p=Date.now(),d=n.setTimeout.call(t,function(){l=new r(e,s()),d=null,h=n.setInterval.call(t,function(){l.setValue(s())},a),"function"==typeof i&&i()},c)},i.closeProgressPanel=function(e,o){function s(t){l.close(t),l=null,"function"==typeof e&&e()}return l&&o&&l.setSuccess(!0),d&&(t.clearTimeout(d),d=null),h&&(t.clearInterval(h),h=null),o&&l&&p&&Date.now()-p<u?(p=null,void n.setTimeout.call(t,function(){i.closeProgressPanel(e,o)},a)):(l&&(o?n.setTimeout.call(t,s,200):s(!0)),void(p=null))}}),o.define("UI.Cursor",function(o,i){var s=e.get("Hammerhead"),n=s.NativeMethods,r=o("Settings"),a=o("UI.Cursor.Behavior"),c=o("UI.Cursor.IFrameBehavior"),u=null;i.init=function(){u||(u=t.top!==t.self?new c:new a)},i.ensureCursorPosition=function(t,e,o){if(u.isStarted()&&u.getPosition())return void o();var s={x:Math.max(0,t.x-(e?0:50)),y:Math.max(0,t.y-(e?0:50))};i.start(s,o)},i.setPosition=function(t){u.isStarted()?u.cursorPosition=t:i.start(t,function(){})},i.start=function(e,o,i){u.isStarted()?u.move(e,function(){n.setTimeout.call(t,o,0)},i):!r.RECORDING||r.PLAYBACK?(u.start(e,i),u.on(u.STARTED_EVENT,o)):o()},i.move=function(t,e){u.move(t,e)},i.lMouseDown=function(t){u.lMouseDown(t)},i.rMouseDown=function(t){u.rMouseDown(t)},i.mouseUp=function(t){u.mouseUp(t)},i.hide=function(t){u.hide(t)},i.show=function(t){u.show(t)},i.getElementUnderCursor=function(t,e,o){if(u)return u.getElementUnderCursor(t,e,o)},i.getPosition=function(){return u.getPosition?u.getPosition():null},i.getAbsolutePosition=function(){return u.getAbsolutePosition?u.getAbsolutePosition():null}}),o.define("UI.Cursor.BaseBehavior",function(){var t=e.get("Hammerhead"),o=t.$,s=t.Util,n=t.ShadowUI,r="l-mouse-down",a="r-mouse-down",c=[r,a].join(" "),u=this.exports=function(){this.cursorPosition=null,this.pointerOffsetX=0,this.pointerOffsetY=0,this.eventEmitter=new s.EventEmitter,this.started=!1};u.prototype.start=function(){this.started=!0},u.prototype.isStarted=function(){return this.started},u.prototype.on=function(t,e){this.eventEmitter.on(t,e)},u.prototype.STARTED_EVENT="cursorStarted",u.CURSOR_MOVE_REQUEST_CMD="cursorMoveRequest",u.CURSOR_LMOUSEDOWN_REQUEST_CMD="cursorLMouseDownRequest",u.CURSOR_RMOUSEDOWN_REQUEST_CMD="cursorRMouseDownRequest",u.CURSOR_MOUSEUP_REQUEST_CMD="cursorMouseUpRequest",u.CURSOR_HIDE_REQUEST_CMD="cursorHideRequest",u.CURSOR_SHOW_REQUEST_CMD="cursorShowRequest",u.CURSOR_MOVE_RESPONSE_CMD="cursorMoveResponse",u.CURSOR_LMOUSEDOWN_RESPONSE_CMD="cursorLMouseDownResponse",u.CURSOR_RMOUSEDOWN_RESPONSE_CMD="cursorRMouseDownResponse",u.CURSOR_MOUSEUP_RESPONSE_CMD="cursorMouseUpResponse",u.CURSOR_HIDE_RESPONSE_CMD="cursorHideResponse",u.CURSOR_SHOW_RESPONSE_CMD="cursorShowResponse",u.prototype.move=function(t,e,n){this.cursorPosition=s.getFixedPosition(t,n,!0),this.$cursor&&this.$cursor.css({left:this.cursorPosition.x+o(i).scrollLeft()-this.pointerOffsetX+"px",top:this.cursorPosition.y+o(i).scrollTop()-this.pointerOffsetY+"px"}),e&&e()},u.prototype.lMouseDown=function(t){this.$cursor&&(n.removeClass(this.$cursor,c),n.addClass(this.$cursor,r)),t&&t()},u.prototype.rMouseDown=function(t){this.$cursor&&(n.removeClass(this.$cursor,c),n.addClass(this.$cursor,a)),t&&t()},u.prototype.mouseUp=function(t){this.$cursor&&n.removeClass(this.$cursor,c),t&&t()},u.prototype.hide=function(t){this.$cursor&&this.$cursor.css({visibility:"hidden"}),t&&t()},u.prototype.show=function(t){this.$cursor&&this.$cursor.css({visibility:""}),t&&t()},u.prototype.getPosition=function(){return this.cursorPosition}}),o.define("UI.Cursor.Behavior",function(o){function i(){return!l.RECORDING||l.PLAYBACK}var s=e.get("Hammerhead"),n=s.$,r=s.Util,a=s.ShadowUI,c=s.MessageSandbox,u=s.NativeMethods,l=o("Settings"),d=o("UI.Cursor.BaseBehavior"),h="cursor",p="touch",f=this.exports=function(){var e=this;n(t).scroll(function(){var t=e?e.cursorPosition:null;t&&e.move({x:t.x,y:t.y})}),this._initCursorIFrameBehavior(),this.$cursor=n("<div></div>"),a.addClass(this.$cursor,h),this.$cursor.appendTo(a.getRoot()),this.hide(),d.call(this)};r.inherit(f,d),f.prototype.start=function(e,o){var s=this;!r.isTouchDevice||r.isIE&&o||(a.addClass(this.$cursor,p),this.pointerOffsetX=Math.ceil(this.$cursor.width()/2),this.pointerOffsetY=Math.ceil(this.$cursor.height()/2)),this.move(r.getFixedPosition(e,o,!0)),i()&&this.show(),d.prototype.start.call(this),u.setTimeout.call(t,function(){s.eventEmitter.emit(s.STARTED_EVENT,null)},0)},f.prototype._initCursorIFrameBehavior=function(){function t(t){var o=t.message;switch(o.cmd){case d.CURSOR_MOVE_REQUEST_CMD:e.move(o.position,function(){c.sendServiceMsg({cmd:d.CURSOR_MOVE_RESPONSE_CMD},t.source)},t.source);break;case d.CURSOR_LMOUSEDOWN_REQUEST_CMD:e.lMouseDown(function(){c.sendServiceMsg({cmd:d.CURSOR_LMOUSEDOWN_RESPONSE_CMD},t.source)});break;case d.CURSOR_RMOUSEDOWN_REQUEST_CMD:e.rMouseDown(function(){c.sendServiceMsg({cmd:d.CURSOR_RMOUSEDOWN_RESPONSE_CMD},t.source)});break;case d.CURSOR_MOUSEUP_REQUEST_CMD:e.mouseUp(function(){c.sendServiceMsg({cmd:d.CURSOR_MOUSEUP_RESPONSE_CMD},t.source)});break;case d.CURSOR_HIDE_REQUEST_CMD:e.hide(function(){c.sendServiceMsg({cmd:d.CURSOR_HIDE_RESPONSE_CMD},t.source)});break;case d.CURSOR_SHOW_REQUEST_CMD:e.show(function(){c.sendServiceMsg({cmd:d.CURSOR_SHOW_RESPONSE_CMD},t.source)})}}var e=this;c.on(c.SERVICE_MSG_RECEIVED,t)},f.prototype.getElementUnderCursor=function(t,e,o){var i="hidden"!==this.$cursor.css("visibility");i&&this.hide();var s=r.getElementFromPoint(t,e,o);return i&&this.show(),s},f.prototype.getAbsolutePosition=function(){if(this.$cursor){var t=r.getOffsetPosition(this.$cursor[0]),e=Math.round(t.left)+this.pointerOffsetX,o=Math.round(t.top)+this.pointerOffsetY;return{x:e,y:o}}return null}}),o.define("UI.Cursor.IFrameBehavior",function(o){var i=e.get("Hammerhead"),s=i.Util,n=i.MessageSandbox,r=o("UI.Cursor.BaseBehavior"),a=o("Base.CrossDomainMessages"),c=s.isIE?1:0,u=this.exports=function(){r.call(this)};s.inherit(u,r),u.prototype._bindMessageHandler=function(t,e){function o(i){i.message&&i.message.cmd===t&&(n.off(n.SERVICE_MSG_RECEIVED,o),e&&e())}n.on(n.SERVICE_MSG_RECEIVED,o)},u.prototype.start=function(e){var o=this,i={cmd:a.CURSOR_START_REQUEST_CMD,position:{x:e.x+c,y:e.y+c}};this.cursorPosition=e,this._bindMessageHandler(a.CURSOR_START_RESPONSE_CMD,function(){r.prototype.start.call(o),o.eventEmitter.emit(o.STARTED_EVENT,null)}),n.sendServiceMsg(i,t.top)},u.prototype.move=function(e,o){this.cursorPosition=e,this._bindMessageHandler(r.CURSOR_MOVE_RESPONSE_CMD,o);var i={cmd:r.CURSOR_MOVE_REQUEST_CMD,position:{x:e.x+c,y:e.y+c}};n.sendServiceMsg(i,t.top)},u.prototype.lMouseDown=function(e){this._bindMessageHandler(r.CURSOR_LMOUSEDOWN_RESPONSE_CMD,e),n.sendServiceMsg({cmd:r.CURSOR_LMOUSEDOWN_REQUEST_CMD},t.top)},u.prototype.rMouseDown=function(e){this._bindMessageHandler(r.CURSOR_RMOUSEDOWN_RESPONSE_CMD,e),n.sendServiceMsg({cmd:r.CURSOR_RMOUSEDOWN_REQUEST_CMD},t.top)},u.prototype.mouseUp=function(e){this._bindMessageHandler(r.CURSOR_MOUSEUP_RESPONSE_CMD,e),n.sendServiceMsg({cmd:r.CURSOR_MOUSEUP_REQUEST_CMD},t.top)},u.prototype.hide=function(e){this._bindMessageHandler(r.CURSOR_HIDE_RESPONSE_CMD,e),n.sendServiceMsg({cmd:r.CURSOR_HIDE_REQUEST_CMD},t.top)},u.prototype.show=function(e){this._bindMessageHandler(r.CURSOR_SHOW_RESPONSE_CMD,e),n.sendServiceMsg({cmd:r.CURSOR_SHOW_REQUEST_CMD},t.top)},u.prototype.getElementUnderCursor=function(t,e,o){return s.getElementFromPoint(t,e,o)}}),o.define("UI.ModalBackground",function(o,s){function n(){var t=d.getRoot();C=l("<div></div>").appendTo(t),d.addClass(C,f),M=l("<div></div>").appendTo(t).text(p),d.addClass(M,S),O=l("<div></div>").css("visibility","hidden").appendTo(t),d.addClass(O,_)}function r(){var t=v.height(),e=v.width(),o=M.is(":visible");o||(M.attr("visibility","hidden"),M.show()),M.css({left:Math.max((e-M.width())/2,0),top:Math.max((t-M.height())/2,0)}),o||(M.hide(),M.attr("visibility",""))}function a(){var t=function(){var t=v.height(),e=v.width();C.width(e),C.height(t),O.css("top",Math.round((t-O.height())/2)),O.css("left",Math.round((e-O.width())/2))};t(),v.resize(t)}function c(){n(),a(),r(),g=!0}var u=e.get("Hammerhead"),l=u.$,d=u.ShadowUI,h=u.NativeMethods,p="Loading page...",f="modal-background",S="loading-text",E=.7,R=.8,_="loading-icon",v=l(t),C=null,M=null,O=null,g=!1;s.initAndShowLoadingText=function(){var e=!1,o=function(){c(),C.css({opacity:R}),C.show(),M.show(),e=!0},s=function(){e||(i.body?o():h.setTimeout.call(t,s,0))};s(),l(i).ready(function(){e||o()})},s.show=function(t){g||c(),C.css({opacity:t?0:E}),C.show()},s.hide=function(){g&&(M.hide(),C.hide())},s.showLoadingIcon=function(){O.css("visibility","visible")},s.hideLoadingIcon=function(){O.css("visibility","hidden")}}),o.define("UI.ProgressBar",function(){var t=e.get("Hammerhead"),o=t.$,i=t.ShadowUI,s="progress-bar",n="value",r="success",a=this.exports=function(t,e){this.$container=o("<div></div>").appendTo(t),this.$value=o("<div></div>").appendTo(this.$container),i.addClass(this.$container,s),i.addClass(this.$value,n),this.setValue(e)};a.prototype.setValue=function(t){"number"!=typeof t||t<0?t=0:t>100&&(t=100),this.$value.css("width",t+"%")},a.prototype.setSuccess=function(t){t?i.addClass(this.$container,r):i.removeClass(this.$container,r)}}),o.define("UI.ProgressPanel",function(o){function i(t){var e=Math.round(d.height()/2-t.outerHeight()/2),o=Math.round(d.width()/2-t.outerWidth()/2);t.css({top:e,left:o})}var s=e.get("Hammerhead"),n=s.$,r=s.ShadowUI,a=o("UI.ProgressBar"),c="progress-panel",u="title",l="content",d=n(t),h=this.exports=function(t,e){this.$panel=n("<div></div>").css("visibility","hidden").appendTo(r.getRoot());var o=this,s=n("<div></div>").text(t).appendTo(this.$panel),h=n("<div></div>").appendTo(this.$panel);r.addClass(this.$panel,c),r.addClass(s,u),r.addClass(h,l),this.progressBar=new a(h,e),i(this.$panel),this.disposePanel=function(){o._onWindowResize()},r.bind(d,"resize",this.disposePanel),this.$panel.css("display","none").css("visibility",""),this.$panel.fadeIn(200)};h.prototype._onWindowResize=function(){i(this.$panel)},h.prototype.setValue=function(t){this.progressBar.setValue(t)},h.prototype.close=function(t){var e=this;r.unbind(d,"resize",this.disposePanel),this.$panel.fadeOut(t?0:600,function(){e.$panel.remove()})},h.prototype.setSuccess=function(t){this.progressBar.setSuccess(t)}}),o.define("UI.SelectElement",function(o,s){function n(t){(t.target||t.srcElement)!==v[0]&&s.collapseOptionList()}function r(e,o){var i=l("<div></div>").text(e.text).appendTo(o);h.addClass(i,R),e.disabled||"optgroup"===e.parentElement.tagName.toLowerCase()&&e.parentElement.disabled?(h.addClass(i,_),i.css("color",l(e).css("color")),i.click(function(){return!1})):i.click(function(){var e=v[0],o=l.inArray(this,O),i=e.selectedIndex;e.selectedIndex=o,f.setTimeout.call(t,function(){o!==i&&p.change(e),d.isWebKit?p.click(e):p.click(l(e).find("option")[e.selectedIndex])},0),s.collapseOptionList()}),O=O&&O.length?O.add(i):i}function a(t,e){var o=l("<div></div>").text(t.label||" ").appendTo(e);h.addClass(o,E),t.disabled&&(h.addClass(o,_),o.css("color",l(t).css("color"))),c(l(t).children(),o),M=M&&M.length?M.add(o):o}function c(t,e){l.each(t,function(t,o){"option"===o.tagName.toLowerCase()?r(o,e):"optgroup"===o.tagName.toLowerCase()&&a(o,e)})}var u=e.get("Hammerhead"),l=u.$,d=u.Util,h=u.ShadowUI,p=u.EventSimulator,f=u.NativeMethods,S="tcOptionList",E="tcOptionGroup",R="tcOption",_="disabled",v=null,C=null,M=null,O=null;s.expandOptionList=function(e){var o=l(e),r=l(e).children();if(r.length){if(v){var a=o[0]===v[0];if(s.collapseOptionList(),a)return}v=o,C=l("<div></div>").appendTo(h.getRoot()),h.addClass(C,S),c(r,C),f.setTimeout.call(t,function(){l(i).bind("mousedown",n)},0),C.css({position:"absolute",fontSize:v.css("fontSize"),fontFamily:v.css("fontFamily"),minWidth:v.width(),left:d.getOffsetPosition(v[0]).left,height:d.getSelectVisibleChildren(o).length>d.MAX_OPTION_LIST_LENGTH?d.getOptionHeight(l(e))*d.MAX_OPTION_LIST_LENGTH:""});var u=l(t),p=d.getOffsetPosition(v[0]).top,E=C.height(),R=p+v.height()+2;if(R+E>u.scrollTop()+u.height()){var _=p-3-E;_>=u.scrollTop()&&(R=_)}C.css("top",R)}},s.collapseOptionList=function(){C.remove(),l(i).unbind("mousedown",n),C=null,v=null,O=null,M=null},s.isOptionListExpanded=function(t){return t?t.is(v):!!v},s.getEmulatedChildElement=function(t,e){return e?M[t]:O[t]},s.scrollOptionListByChild=function(t){var e=d.getSelectParent(l(t));if(e){var o=l(e),i=d.getSelectSizeValue(o,!0),s=d.getOptionHeight(o),n=0,r=Math.max(o.scrollTop()/s,0),a=r+i-1,c=d.getChildVisibleIndex(o,t);c<r?(n=s*(r-c),o.scrollTop(Math.max(o.scrollTop()-n,0))):c>a&&(n=s*(c-a),o.scrollTop(o.scrollTop()+n))}},s.getSelectChildCenter=function(t){var e=d.getSelectParent(l(t));if(!e)return{x:0,y:0};var o=d.getOptionHeight(l(e)),i=d.getElementRectangle(t);return{x:Math.round(i.left+i.width/2),y:Math.round(i.top+o/2)}},s.switchOptionsByKeys=function(t){var e=l(d.getActiveElement());if("select"===e[0].tagName.toLowerCase()&&(/enter|tab|esc/.test(t)&&s.isOptionListExpanded(e)&&s.collapseOptionList(),/down|up/.test(t)||!d.isIE&&(d.getSelectSizeValue(e)<=1||d.isMozilla)&&(!h.select("."+S).is(":visible")||d.isMozilla)&&/left|right/.test(t))){var o=e.find("option"),i=o.filter(function(){var t=l(this).parent()[0];return!(this.disabled||"optgroup"===t.tagName.toLowerCase()&&t.disabled)}),n=l.inArray(e.find("option:selected")[0],i);n+=/down|right/.test(t)?1:-1,n>=0&&n<i.length&&(e[0].selectedIndex=l.inArray(i[n],o),p.change(e[0]))}}})},window.initTestCafeUI(window)}();