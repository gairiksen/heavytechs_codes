!function(){window.initTestCafeClientCore=function(e){var t=e.HammerheadClient,n=e.TestCafeClient=new t.Mods,o=e.document;n.define("Automation",function(n,o){function i(e,t,n){if(/click|drag|select|type|hover/.test(e.type)&&!e.element)return void n();switch(e.type){case"click":t.run(e.element,e.apiArguments.options,n,{prevSelectedIndex:e.serviceInfo.prevPageState&&e.serviceInfo.prevPageState.affectedElementSelectedIndex?e.serviceInfo.prevPageState.affectedElementSelectedIndex:null});break;case"rclick":t.run(e.element,e.apiArguments.options,n);break;case"dblclick":t.run(e.element,e.apiArguments.options,n);break;case"drag":var o={dragOffsetX:e.apiArguments.dragOffsetX,dragOffsetY:e.apiArguments.dragOffsetY};t.run(e.element,o,e.apiArguments.options,n,{screenPointTo:e.endPosition});break;case"select":var i={startPos:e.apiArguments.startPos,endPos:e.apiArguments.endPos};t.run(e.element,i,n,{screenPointTo:e.endPosition});break;case"type":t.run(e.element,e.apiArguments.text,e.apiArguments.options,n);break;case"press":t.run(e.apiArguments.keysCommand,n);break;case"hover":t.run(e.element,e.apiArguments.options,n);break;default:n()}}function r(e){if(e.selector){var t=d.parseSelectorSync(e.selector).$elements;t&&t.length&&(1===t.length?e.element=t[0]:e.elements=t.toArray())}}var a=t.get("Hammerhead"),s=n("Settings"),l=a.$,c=a.async,E=a.NativeMethods,u=a.EventSandbox,_=a.EventSimulator,f=a.Util,d=n("Base.JavascriptExecutor"),T=n("Automation.Click.Playback"),S=n("Automation.RClick.Playback"),p=n("Automation.DblClick.Playback"),A=n("Automation.Drag.Playback"),m=n("Automation.Select.Playback"),I=n("Automation.Press.Playback"),R=n("Automation.Type.Playback"),g=n("Automation.Hover.Playback"),N=/blur|focus|(dbl)?click|contextmenu|key|mouse|pointer/i,h={type:"",serviceInfo:{prevPageState:null,isDeferred:!1}},C=l.extend(!0,{},h,{element:null,selector:null,serviceInfo:{selectors:[]}});o.AUTOMATION_RUNNERS="tc-ar-73630b99",o.SUPPORTED_SHORTCUTS=["ctrl+a","backspace","delete","left","right","up","down","shift+left","shift+right","shift+up","shift+down","shift+home","shift+end","home","end","enter","tab","shift+tab"],o.ADD_ACTION_SHORTCUTS={wait:"Ctrl+Q",hover:"Ctrl+Space",screenshot:"Ctrl+M"},o.defaultMouseActionDescriptor=l.extend(!0,{},C,{apiArguments:{options:{ctrl:!1,alt:!1,shift:!1,meta:!1,offsetX:"",offsetY:""}},serviceInfo:{useOffsets:!1}}),o.defaultDragActionDescriptor=l.extend(!0,{},o.defaultMouseActionDescriptor,{type:"drag",apiArguments:{dragOffsetX:0,dragOffsetY:0},startPosition:null,endPosition:null}),o.defaultHoverActionDescriptor=l.extend(!0,{},C,{type:"hover"}),o.defaultTypeActionDescriptor=l.extend(!0,{},o.defaultMouseActionDescriptor,{type:"type",apiArguments:{text:"",options:{replace:!1,caretPos:""}}}),o.defaultPressActionDescriptor=l.extend(!0,{},h,{type:"press",apiArguments:{keysCommand:""}}),o.defaultWaitActionDescriptor={type:"wait",apiArguments:{ms:""}},o.defaultScreenshotActionDescriptor={type:"screenshot"},o.defaultSelectActionDescriptor=l.extend(!0,{},C,{type:"select",apiArguments:{startPos:null,endPos:null}});var v=!1,O=function(t,n,o){var i=t.target||t.srcElement;if(N.test(t.type)&&!n&&(!s.RECORDING||s.PLAYBACK||v)&&(!s.PLAYBACK||!f.isShadowUIElement(i))){if("blur"===t.type){var r=l(i);if(f.isIE&&f.browserVersion<12)(!f.isWindowInstance(i)&&"none"===r.css("display")||r.parents().filter(function(){return"none"===this.style.display}).length)&&E.setTimeout.call(e,function(){_.blur(r[0])},0);else if(i!==e&&i!==e.document&&!r.is(":visible"))return}o()}},M=!1;o.init=function(){M||(u.addFirstInternalHandler(e,f.RECORDING_LISTENED_EVENTS,O),M=!0)};var D=e[o.AUTOMATION_RUNNERS]={click:{playback:T},rclick:{playback:S},dblclick:{playback:p},drag:{playback:A},select:{playback:m},press:{playback:I},type:{playback:R},hover:{playback:g}};o.playback=function(e,t){var n=null,o=0;return D[e.type]?(v=!0,r(e),void c.forEachSeries(e.elements||[],function(t,r){return n=l.extend(n,e),n.element=t,delete n.elements,o===e.elements.length-1?void r():void i(n,D[n.type].playback,function(){n={},o++,r()})},function(){n=n||e,i(n,D[n.type].playback,function(){v=!1,t()})})):void t()}}),n.define("Automation.IFrameBehavior",function(e,n){function i(e){var t=e.message,n=null,i=null;switch(t.cmd){case c.CURSOR_START_REQUEST_CMD:l.RECORDING&&!l.PLAYBACK||_.start(t.position,function(){s.sendServiceMsg({cmd:c.CURSOR_START_RESPONSE_CMD},e.source)},e.source);break;case c.MOVE_TO_IFRAME_REQUEST_CMD:var r=_.getPosition();if(!r||!a.getIFrameByWindow(e.source))return void s.sendServiceMsg({cmd:c.MOVE_TO_IFRAME_RESPONSE_CMD,point:null},e.source);var f=a.getFixedPosition(t.point,e.source),d=a.clientToOffsetCoord(r);n=a.getIFrameCoordinates(e.source),a.checkPresenceInRectangle(d,n)&&a.checkPresenceInRectangle(f,n)?s.sendServiceMsg({cmd:c.MOVE_TO_IFRAME_RESPONSE_CMD,point:t.point},e.source):(i=a.findLineAndRectangelIntersection(d,f,n),E.run(i,!1,{},function(){s.sendServiceMsg({cmd:c.MOVE_TO_IFRAME_RESPONSE_CMD,point:a.getFixedPositionForIFrame(i,e.source)},e.source)}));break;case c.MOVE_CURSOR_IN_IFRAME_PING:t.isPingRequest&&s.sendServiceMsg({cmd:c.MOVE_CURSOR_IN_IFRAME_PING,isPingResponse:!0},e.source);break;case c.MOVE_FROM_IFRAME_REQUEST_CMD:var T=o.documentElement,S=T.scrollHeight>T.clientHeight?a.getScrollbarSize():0,p=T.scrollWidth>T.clientWidth?a.getScrollbarSize():0;n={left:t.rectangle.left,right:t.rectangle.right-S,top:t.rectangle.top,bottom:t.rectangle.bottom-p},a.checkPresenceInRectangle(t.endPoint,n)?(_.setPosition(t.cursorPosition),i=a.findLineAndRectangelIntersection(t.startPoint,t.endPoint,n),i={x:i.x-n.left,y:i.y-n.top},E.run(a.clientToOffsetCoord(i),!1,{},function(){s.sendServiceMsg({cmd:c.MOVE_FROM_IFRAME_RESPONSE_CMD,point:i},e.source)})):s.sendServiceMsg({cmd:c.MOVE_FROM_IFRAME_RESPONSE_CMD,point:null},e.source);break;case c.SCROLL_TOP_WINDOW_REQUEST_CMD:u.setScroll(e.source,t.point,t.options,function(){s.sendServiceMsg({cmd:c.SCROLL_TOP_WINDOW_RESPONSE_CMD},e.source)});break;case c.GET_IFRAME_POSITION_DATA_REQUEST_CMD:var A=u.getScrollData(e.source);A.cmd=c.GET_IFRAME_POSITION_DATA_RESPONSE_CMD,s.sendServiceMsg(A,e.source)}}var r=t.get("Hammerhead"),a=r.Util,s=r.MessageSandbox,l=e("Settings"),c=e("Base.CrossDomainMessages"),E=e("Automation.Move.Playback"),u=e("Automation.Scroll"),_=e("UI.Cursor");n.init=function(){s.on(s.SERVICE_MSG_RECEIVED,i)},n.destroy=function(){s.off(s.SERVICE_MSG_RECEIVED,i)}}),n.define("Automation.Scroll",function(e,n){var i=t.get("Hammerhead"),r=i.$,a=i.Util,s=e("Automation.Scroll.Playback");n.setScroll=function(e,t,n,o){var i=a.getIFrameByWindow(e),r=t?a.getFixedPosition(t,e,!0):i,l=t?null:n;s.run(r,l,null,o)},n.getScrollData=function(e){var t=a.getIFrameByWindow(e);return{scroll:a.getElementScroll(r(a.findDocument(o))),iFrameOffset:a.getOffsetPosition(t),iFrameBorders:a.getBordersWidth(r(t)),iFramePadding:a.getElementPadding(r(t))}}}),n.define("Automation.Settings",function(e,t){t.MOVING_SPEED=1e3,t.MOVING_SPEED_IN_DRAGGING=4,t.MINIMUM_MOVING_TIME=25,t.ACTION_STEP_DELAY=80,t.CLICK_STEP_DELAY=160,t.DRAG_ACTION_STEP_DELAY=100}),n.define("Automation.Util",function(e,n){var i=t.get("Hammerhead"),r=i.$,a=i.ContentEditableHelper,s=i.TextSelection,l=e("UI.Cursor"),c=i.Util,E=i.EventSandbox,u=i.NativeMethods,_=r(o);n.getMouseActionPoint=function(e,t,n){var o=c.getOffsetPosition(e),i=e===_[0].documentElement?0:o.left,a=e===_[0].documentElement?0:o.top,s=c.getElementScroll(r(e)),l=c.findCenter(e);return t&&"undefined"!=typeof t.offsetX&&!isNaN(parseInt(t.offsetX))&&(l.x=i+(t.offsetX||0)),t&&"undefined"!=typeof t.offsetY&&!isNaN(parseInt(t.offsetY))&&(l.y=a+(t.offsetY||0)),n?(!/html/i.test(e.tagName)&&c.hasScroll(e,c.findDocument(e))&&(l.x-=s.left,l.y-=s.top),c.offsetToClientCoords(l)):l},n.getEventOptionCoordinates=function(e,t){var n={x:t.x,y:t.y};if(c.isElementInIframe(e)){var o=c.getIFrameByElement(e);if(o){var i=c.getOffsetPosition(o),a=c.getBordersWidth(r(o)),s=c.offsetToClientCoords({x:i.left,y:i.top});n.x-=s.x+a.left,n.y-=s.y+a.top}}return n},n.focusAndSetSelection=function(e,t,o,i){var l=c.getActiveElement(),u=c.isTextEditableElement(e),_=c.isContentEditableElement(e),f=_?a.findContentEditableParent(e):e,d=null,T=u||_,S=r(e).closest("label[for]");o&&c.isWebKit&&u&&s.select(e,0,0),S.length&&!c.isElementFocusable(r(e))?o?n.focusElementByLabel(S,i):i():E.focus(f,function(){if(!_&&o&&e!==c.getActiveElement())return void i();if(T)if(_&&isNaN(parseInt(t.caretPos)))s.setCursorToLastVisiblePosition(e);else{var n=isNaN(parseInt(t.caretPos))?e.value.length:t.caretPos;s.select(e,n,n)}else d=a.findContentEditableParent(f),d&&s.setCursorToLastVisiblePosition(f);o||l===c.getActiveElement()?i():E.focus(l,i,!0,!0)},!o,!0)},n.focusLabelChildElement=function(e,t){var n=r(e).closest("label[for]");if(n.length&&!c.isElementFocusable(r(e))){var o=r("#"+n.attr("for"),c.findDocument(n[0]));if(o.length){var i=o[0];if(c.getActiveElement()!==i)return void E.focus(i,t,!1,!0)}}t&&t()},n.focusElementByLabel=function(e,t){var n=r("#"+e.attr("for"),c.findDocument(e[0]));if(n.length){var o=n[0];if(c.getActiveElement()!==o)return void E.focus(o,t,!1,!0)}t&&t()},n.getDragEndPoint=function(e,t,n){var i=n!==o,a={x:e.x+Math.floor(t.dragOffsetX),y:e.y+Math.floor(t.dragOffsetY)},s=0,l=0;if(i){var E=c.getIFrameByElement(n);if(E){var u=c.getOffsetPosition(E),_=c.getBordersWidth(r(E));s=u.left+_.left,l=u.top+_.top}}return s+=r(n).width(),l+=r(n).height(),a.x=a.x<0?0:a.x,a.x=a.x>s?s:a.x,a.y=a.y<0?0:a.y,a.y=a.y>l?l:a.y,a},n.getElementUnderCursor=function(e,t,n,o){var i=l.getElementUnderCursor(e,t,n);if(!o||!c.isDomElement(o)||i===o||!i)return i;if(c.isMozilla&&"area"===o.tagName.toLowerCase()&&"img"===i.tagName.toLowerCase()){var a=r(o).closest("map")[0];return a&&a.name===i.useMap.substring(1)?o:i}if("a"!==o.tagName.toLowerCase()&&!r(o).parents("a").length||!r(o).text().length)return i;if("a"===o.tagName.toLowerCase()&&r(o).has(i).length&&r(i).text().length)return i;var s=o.getBoundingClientRect(),E=l.getElementUnderCursor(s.right-1,s.top+1,n);return E&&E===o||r(o).has(E).length&&r(E).text().length?E:(E=l.getElementUnderCursor(s.left+1,s.bottom-1),E&&E===o||r(o).has(E).length&&r(E).text().length?E:i)},n.setValue=function(e,t){u.inputValueSetter&&c.isInputElement(e)?u.inputValueSetter.call(e,t):u.textAreaValueSetter&&c.isTextAreaElement(e)?u.textAreaValueSetter.call(e,t):e.value=t}}),n.define("Base.CrossDomainMessages",function(e,t){t.IFRAME_TEST_RUNNER_PING_DISPATCHER_CMD="pingIFrameDispatcher",t.IFRAME_TEST_RUNNER_RUN_CMD="runInIFrameTestRunner",t.IFRAME_TEST_RUNNER_WAITING_STEP_COMPLETION_REQUEST_CMD="waitingStepCompletionRequest",t.IFRAME_TEST_RUNNER_WAITING_STEP_COMPLETION_RESPONSE_CMD="waitingStepCompletionResponse",t.IFRAME_TEST_RUNNER_STEP_COMPLETED_CMD="iframeTestRunnerStepCompleted",t.CURSOR_START_REQUEST_CMD="cursorStartRequest",t.CURSOR_START_RESPONSE_CMD="cursorStartResponse",t.MOVE_TO_IFRAME_REQUEST_CMD="moveToIFrameRequest",t.MOVE_TO_IFRAME_RESPONSE_CMD="moveToIFrameResponse",t.MOVE_CURSOR_IN_IFRAME_PING="moveCursorInIFramePing",t.MOVE_FROM_IFRAME_REQUEST_CMD="moveFromIFrameRequest",t.MOVE_FROM_IFRAME_RESPONSE_CMD="moveFromIFrameResponse",t.SCROLL_TOP_WINDOW_REQUEST_CMD="scrollTopWindowRequest",t.SCROLL_TOP_WINDOW_RESPONSE_CMD="scrollTopWindowResponse",t.GET_IFRAME_POSITION_DATA_REQUEST_CMD="getIFramePositionDataRequest",t.GET_IFRAME_POSITION_DATA_RESPONSE_CMD="getIFramePositionDataResponse",t.GENERATE_GENERAL_PROPERTIES_IN_IFRAME_REQUEST_CMD="generateGeneralPropertiesRequest",t.GENERATE_GENERAL_PROPERTIES_IN_IFRAME_RESPONSE_CMD="generateGeneralPropertiesResponse",t.GENERATE_CSS_PROPERTIES_IN_IFRAME_REQUEST_CMD="generateCssPropertiesRequest",t.GENERATE_CSS_PROPERTIES_IN_IFRAME_RESPONSE_CMD="generateCssPropertiesResponse",t.GENERATE_ATTRIBUTES_IN_IFRAME_REQUEST_CMD="generateAttributesRequest",t.GENERATE_ATTRIBUTES_IN_IFRAME_RESPONSE_CMD="generateAttributesResponse",t.ASSERT_REQUEST_CMD="assertRequest",t.ASSERT_RESPONSE_CMD="assertResponse",t.OBJECT_VIEWER_GET_OBJECT_VIEW_REQUEST_CMD="objectViewerGetObjectViewRequest",t.OBJECT_VIEWER_GET_OBJECT_VIEW_RESPONSE_CMD="objectViewerGetObjectViewResponse",t.OBJECT_VIEWER_GET_OBJECT_PROPERTIES_ROWS_REQUEST_CMD="objectViewerGetObjectPropertiesRowsRequest",t.OBJECT_VIEWER_GET_OBJECT_PROPERTIES_ROWS_RESPONSE_CMD="objectViewerGetObjectPropertiesRowsResponse"}),n.define("Base.IFrameDispatcher",function(n,i){var r=null,a=null;!function(){function s(e){I?e():R.push(e)}function l(e){g?s(function(){a(e.stepName,e.step,0,function(){N.run.apply(N,arguments)})}):(g=!0,r(N,function(e){a=e}),s(function(){a(e.stepName,e.step,0,function(){N.act._start.apply(N,arguments)})}))}function c(t){var n=E.$,i=!1,r=function(){i||(i=!0,t())};n(e).load(r),n(o).ready(function(){f.isIFrameWindowInDOM(e)&&_.setTimeout.call(e,r,h)})}var E=t.get("Hammerhead"),u=E.MessageSandbox,_=E.NativeMethods,f=E.Util,d=n("ActionBarrier.Xhr"),T=n("Base.CrossDomainMessages"),S=n("Automation"),p=n("Automation.IFrameBehavior"),A=n("UI.Cursor"),m=n("TestRunner.IFrameTestRunner"),I=!1,R=[],g=!1,N=new m;i.MESSAGE_RECEIVED="messageReceived",i.init=function(t){S.init(),r=t;var n=new f.EventEmitter;i.on=function(){n.on.apply(n,arguments)},i.off=function(){n.off.apply(n,arguments)},u.on(u.SERVICE_MSG_RECEIVED,function(t){var o=t.message;switch(o.cmd){case T.IFRAME_TEST_RUNNER_RUN_CMD:l(o);break;case T.IFRAME_TEST_RUNNER_PING_DISPATCHER_CMD:o.isPingRequest&&u.sendServiceMsg({cmd:T.IFRAME_TEST_RUNNER_PING_DISPATCHER_CMD,isPingResponse:!0},e.top);break;default:n.emit(i.MESSAGE_RECEIVED,o)}})};var h=3e3,C=200;d.init();var v=!1;p.init(),A.init(),c(function(){v||(v=!0,_.setTimeout.call(e,function(){d.waitPageInitialRequests(function(){u.on(u.SERVICE_MSG_RECEIVED,function(t){var n=t.message;n.cmd===T.IFRAME_TEST_RUNNER_WAITING_STEP_COMPLETION_RESPONSE_CMD&&(N.onStepCompleted(),N.testIterator.state.stopped||u.sendServiceMsg({cmd:T.IFRAME_TEST_RUNNER_STEP_COMPLETED_CMD},e.top))});var t={cmd:T.IFRAME_TEST_RUNNER_WAITING_STEP_COMPLETION_REQUEST_CMD};u.sendServiceMsg(t,e.top),I=!0;for(var n=0;n<R.length;n++)R[n]()})},C))})}()}),n.define("Base.JavascriptExecutor",function(n,i){function r(e){if(e instanceof NodeList||e instanceof HTMLCollection||l.isArray(e)||c.isJQueryObj(e)){for(var t=0;t<e.length;t++)if(!c.isDomElement(e[t]))return!1;return!0}return!1}function a(e){var t=[];return t.push("(function (window, document, jQuery, $) {"),t.push("var savedAlert = window.alert;window.alert = new Function();"),t.push("var savedConfirm = window.confirm;window.confirm = new Function();"),t.push("var savedPrompt = window.prompt;window.prompt = new Function();"),t.push("var savedConsoleLog = null; if(window.console) {savedConsoleLog = window.console.log;window.console.log = new Function();}"),t.push("var saved$ = window.$, savedJQuery = window.jQuery; window.$ = $; window.jQuery = $;"),t.push("var err = null;"),t.push("try { var res = (function () { return "+f.process(e)+"})(); } catch (e) {err = e;}"),t.push("window.alert = savedAlert;"),t.push("window.confirm = savedConfirm;"),t.push("window.prompt = savedPrompt;"),t.push("if(savedConsoleLog){window.console.log = savedConsoleLog;}"),t.push("window.$ = saved$; window.jQuery = savedJQuery;"),t.push("if(err)throw err;"),t.push("return res;"),t.push("})(window.parent, window.parent.document, window.$, window.$)"),g().contentWindow.eval(t.join(""))}var s=t.get("Hammerhead"),l=s.$,c=s.Util,E=s.NativeMethods,u=s.ShadowUI,_=s.MessageSandbox,f=s.JSProcessor,d=n("Base.jQueryExtensions.Selectors"),T="safeExecutor",S="safeExecutorIFrame",p=null,A=null,m=null;i.EMPTY_SELECTOR_ERROR="Empty element selector",i.INVALID_ELEMENTS_IN_JQUERY_OBJECT_ERROR="jQuery object contains invalid elements",i.INVALID_ELEMENTS_IN_ARRAY_ERROR="Array contains invalid elements",i.INVALID_OBJECT_ERROR="Invalid object type",i.RECURSIVE_JQUERY_CALLING_ERROR="Maximum call stack size exceeded",i.SELECTOR_DOES_NOT_CONTAIN_ELEMENT_ERROR="Selector doesn't contain any element",i.JAVASCRIPT_ERROR_PREFIX="Javascript error: ";var I=e.top!==e.self,R=function(){return p&&v(p)||(p=u.getRoot().find(" > div[class]").filter(function(){return 0===l(this).attr("class").indexOf(T)}),p.length||(p=l(E.createElement.call(o,"div")),E.appendChild.call(u.getRoot()[0],p[0]),u.addClass(p,T))),p},g=function(){return A&&v(l(A))||N(),A},N=function(){h(),C()},h=function(){var e=R().find("iframe");e.length||(e=l(E.createElement.call(o,"iframe")),e.css("display","none"),E.appendChild.call(R()[0],e[0]),u.addClass(e,S)),A=e.get(0),e.load(C)},C=function(){A&&v(l(A))||h();try{Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(A.contentWindow.document,"body")&&Object.getOwnPropertyDescriptor(A.contentWindow.document,"body").configurable?(Object.defineProperty(A.contentWindow.document,"body",{get:function(){return e.document.body},configurable:!0}),m=!0):m=!1}catch(t){m=!1}var n=d.create(s.SandboxedJQuery);d.init(),A.contentWindow.$=A.contentWindow.jQuery=function(e,t){if(e===arguments.callee||t===arguments.callee)throw new Error(i.RECURSIVE_JQUERY_CALLING_ERROR);return n(e,t)},A.contentWindow.alert=A.contentWindow.confirm=A.contentWindow.prompt=new Function,A.contentWindow[f.CALL_METHOD_METH_NAME]=e[f.CALL_METHOD_METH_NAME],A.contentWindow[f.GET_LOCATION_METH_NAME]=e[f.GET_LOCATION_METH_NAME],A.contentWindow[f.GET_PROPERTY_METH_NAME]=e[f.GET_PROPERTY_METH_NAME],A.contentWindow[f.PROCESS_SCRIPT_METH_NAME]=e[f.PROCESS_SCRIPT_METH_NAME],A.contentWindow[f.SET_LOCATION_METH_NAME]=new Function,A.contentWindow[f.SET_PROPERTY_METH_NAME]=new Function},v=function(e){return!!e.parents("body").length},O=function(e){var t=null,n=null,o=function(){return{result:t,error:n}};if(c.isJQueryObj(e))return r(e)?t=e:n=i.INVALID_ELEMENTS_IN_JQUERY_OBJECT_ERROR,o();if("string"==typeof e||c.isDomElement(e)||e instanceof NodeList||e instanceof HTMLCollection)try{var a=l(e);return c.isJQueryObj(a)&&(t=a),o()}catch(s){return n=i.JAVASCRIPT_ERROR_PREFIX+s,o()}if(l.isArray(e)){t=l();for(var E=0;E<e.length;E++){var u=O(e[E]);if(u.error)return n=u.error,o();if(!u.result)return n=i.INVALID_ELEMENTS_IN_ARRAY_ERROR,o();t=t.add(u.result)}return o()}return"function"==typeof e?(t=i.eval(e+"()",function(e){n=i.JAVASCRIPT_ERROR_PREFIX+e}),n?o():O(t)):o()};i.eval=function(e,t){try{return m||(e=e.replace(/(^|[^a-z0-9_\$])document.body($|[^a-z0-9_\$])/g,function(e,t,n){return t+(I?"window.document.body":"window.top.document.body")+n})),a(e)}catch(n){t(n)}},i.parseSelector=function(t,n,o,r){if(!r||e.top!==e.self||r.top===r.self)return void o(i.parseSelectorSync(t,n));P=o;var a={cmd:M,selector:t,parseDomElementsOrJqueryObjectsOnly:n};_.sendServiceMsg(a,r)},i.parseSelectorSync=function(e,t){function n(){return 2===a.length&&c.isSelectElement(a[0])&&/option|optgroup/.test(a[1].tagName.toLowerCase())&&a.eq(0).has(a.last()).length}var o=null,a=null,s=null,E="";if(!e.length)return{$elements:null,length:0,$visibleElements:null,visibleLength:0,iframeContext:!1,error:i.EMPTY_SELECTOR_ERROR,selector:e};if(o=i.eval(e,function(e){E=i.JAVASCRIPT_ERROR_PREFIX+e.message}),!E)if(c.isJQueryObj(o))r(o)?a=o:E=i.INVALID_ELEMENTS_IN_JQUERY_OBJECT_ERROR;else if(t)c.isDomElement(o)||r(o)?a=l(o):E=i.SELECTOR_DOES_NOT_CONTAIN_ELEMENT_ERROR;else{var u=O(o);u.error?E=u.error:u.result?a=u.result:E=i.INVALID_OBJECT_ERROR}var _=!1;return a&&!E&&(_=n(),s=_?a:a.filter(function(e){return c.isElementVisible(a[e])})),{$elements:a,length:_?1:a?a.length:0,$visibleElements:s,visibleLength:_?1:s?s.length:0,iframeContext:!1,error:E,selector:e,evalResults:o}},i.init=function(){N()};var M="parseSelectorRequest",D="parseSelectorResponse",P=null;_.on(_.SERVICE_MSG_RECEIVED,function(t){var n=t.message;switch(n.cmd){case M:var o=i.parseSelectorSync(n.selector,n.parseDomElementsOrJqueryObjectsOnly);o.length=o.$elements?o.$elements.length:0,o.iframeContext=!0,delete o.$elements,delete o.$visibleElements,delete o.evalResults;var r={cmd:D,parsedSelector:o,selector:n.selector};_.sendServiceMsg(r,e.top);break;case D:"function"==typeof P&&(P(n.parsedSelector),P=null)}})}),n.define("Base.Transport",function(n,o){function i(t){u&&(e.clearTimeout(_),_=s.setTimeout.call(e,u,t||E))}var r=t.get("Hammerhead"),a=r.Transport,s=r.NativeMethods,l=n("Settings"),c=n("Shared.ServiceCommands"),E=11e4,u=null,_=null;o.syncServiceMsg=function(e,t){return i(),a.syncServiceMsg(e,t)},o.asyncServiceMsg=function(e,t){return i(),a.asyncServiceMsg(e,t)},o.waitForServiceMessagesCompleted=a.waitForServiceMessagesCompleted,o.batchUpdate=a.batchUpdate,o.queuedAsyncServiceMsg=a.queuedAsyncServiceMsg,o.switchToWorkerIdle=function(){e.location.href=l.WORKER_IDLE_URL},o.switchToStartRecordingUrl=function(t){var n=/#.*$/,o=e.location.href.replace(n,"").toLowerCase(),i=t.replace(n,"").toLowerCase();e.location.href=t,e.location.hash&&o===i&&n.test(t)&&e.location.reload(!0)},o.expectInactivity=function(e,t){var n=e+E,r={cmd:c.INACTIVITY_EXPECTED,duration:n};o.asyncServiceMsg(r,function(){i(n),t()})},o.fail=function(t){var n={cmd:c.TEST_FAIL,err:t};throw o.asyncServiceMsg(n,function(){o.switchToWorkerIdle()}),e.onerror=function(){},"STOP"},o.assertionFailed=function(e){var t={cmd:c.ASSERTION_FAILED,err:e};o.asyncServiceMsg(t)},o.startInactivityMonitor=function(e){u=e,i()},o.stopInactivityMonitor=function(){u&&(u=null,e.clearTimeout(_))}}),n.define("TestRunner.SourceIndexTracker",function(e,n){var o=t.get("Hammerhead"),i=o.Util,r=e("Settings"),a=/#(\d+)/;n.currentIndex=null,n.wrapTrackableMethods=function(e,t){i.arrForEach(t,function(t){var o=e[t];e[t]=function(){var e=Array.prototype.slice.call(arguments);if(r.ENABLE_SOURCE_INDEX){var t=e[e.length-1],i="string"==typeof t&&t.match(a);i&&(n.currentIndex=parseInt(i[1],10),e.pop())}return o.apply(this,e)}})}}),n.define("TestRunner.TestIterator",function(n){var i=t.get("Hammerhead"),r=i.$,a=i.async,s=i.Util,l=i.NativeMethods,c=i.JSON,E=n("ActionBarrier"),u=n("ActionBarrier.Xhr"),_=n("Settings"),f=n("Shared.Errors"),d=500,T=3e3,S=30,p=this.exports=function(e){this.state={step:0,stepNames:null,testSteps:null,pageUnloading:!1,stepDelayTimeout:null,inAsyncAction:!1,prolongStepDelay:!1,shortProlongStepDelay:!1,stepsSharedData:{},lastSyncedSharedDataJSON:null,stopped:!1,waitedIFrame:null,needScreeshot:!1},this.pingIFrame=e,this.globalWaitForEvent=null,this.globalWaitForTimeout=null,this.eventEmitter=new s.EventEmitter};p.TEST_COMPLETE_EVENT="testComplete",p.NEXT_STEP_STARTED_EVENT="nextStepStarted",p.ACTION_TARGET_WAITING_STARTED_EVENT="actionTargetWaitingStarted",p.ACTION_RUN_EVENT="actionRun",p.ERROR_EVENT="error",p.ASSERTION_FAILED_EVENT="assertionFailed",p.SET_STEPS_SHARED_DATA_EVENT="setStepsSharedData",p.GET_STEPS_SHARED_DATA_EVENT="getStepsSharedData",p.EXPECT_INACTIVITY_EVENT="expectInactivity",p.TAKE_SCREENSHOT_EVENT="takeScreenshot",p.BEFORE_UNLOAD_EVENT_RAISED="beforeUnload",p.UNLOAD_EVENT_RAISED="unload",p.prototype.on=function(){return this.eventEmitter.on.apply(this.eventEmitter,arguments)},p.prototype._checkSharedDataSerializable=function(){var e=null;return!!c.isSerializable(this.state.stepsSharedData)||(e={code:f.STORE_DOM_NODE_OR_JQUERY_OBJECT,stepName:_.CURRENT_TEST_STEP_NAME,stepNum:this.state.step-1},this.eventEmitter.emit(p.ERROR_EVENT,e),!1)},p.prototype._runStep=function(){this.state.stopped=!1;var e=this;if(e.state.step>0&&!e.state.stepDoneCalled&&"function"==typeof e.state.stepDone&&(e.state.stepDone(),e.state.stepDoneCalled=!0),!this.state.stopped){if(e.state.step>=e.state.testSteps.length)return void this.eventEmitter.emit(p.TEST_COMPLETE_EVENT,{callback:function(){e.state.runningCopmlete=!0}});_.CURRENT_TEST_STEP_NAME=e.state.stepNames[e.state.step];var t=e.state.testSteps[e.state.step];e.state.step++,e.eventEmitter.emit(p.NEXT_STEP_STARTED_EVENT,{nextStep:e.state.step,callback:function(){e.__waitFor(function(){var n=null;"function"==typeof e.state.stepSetup&&e.state.stepSetup(),e.state.stepDoneCalled=!1,e.state.inAsyncAction=!1,e.state.prolongStepDelay=!1,e.state.shortProlongStepDelay=!1;try{e.callWithSharedDataContext(t)}catch(o){n={code:f.UNCAUGHT_JS_ERROR_IN_TEST_CODE_STEP,scriptErr:o&&o.message||o,stepName:_.CURRENT_TEST_STEP_NAME,stepNum:e.state.step-1},e.eventEmitter.emit(p.ERROR_EVENT,n)}if(!e.state.stopped){var i=function(){"function"!=typeof e.state.stepDone||e.state.stepDoneCalled||(e.state.stepDone(),e.state.stepDoneCalled=!0),e._runStep()};if(!e.state.inAsyncAction){if(!e._checkSharedDataSerializable())return;_.TAKE_SCREENSHOT_ON_FAILS&&e.state.needScreeshot?e.takeScreenshot(function(){e.state.needScreeshot=!1,i()},!0):i()}}})}})}},p.prototype._setupUnloadPrediction=function(){function t(){E(),l.setTimeout.call(e,function(){"loading"!==o.readyState||o.activeElement&&"a"===o.activeElement.tagName.toLowerCase()&&null!==o.activeElement.getAttribute("download")||u()},0)}var n=this,a=r("form"),c=function(){n.state.prolongStepDelay=!0},E=function(){n.state.shortProlongStepDelay=!0},u=function(){n.state.pageUnloading=!0,n.eventEmitter.emit(p.BEFORE_UNLOAD_EVENT_RAISED)},_=function(){n.state.pageUnloading=!0,n.eventEmitter.emit(p.UNLOAD_EVENT_RAISED)};r(o).on("submit","form",c),a.each(function(){var e=this.submit;this.submit=function(){c(),e.apply(this,arguments)}});var f=!1;l.addEventListener.call(o,"click",function(e){var t=e.srcElement||e.target;if(!e.defaultPrevented&&t.tagName&&"a"===t.tagName.toLowerCase()){var n=r(t).attr("href");t.hasAttribute("href")&&!/(^javascript:)|(^mailto:)|(^tel:)|(^#)/.test(n)?c():s.isIE&&(f=!0)}}),i.on(i.BEFORE_UNLOAD_EVENT,s.isIE?t:u),i.on(i.BEFORE_UNLOAD_EVENT,function(){f=!1}),l.windowAddEventListener.call(e,"unload",_)},p.prototype._syncSharedDataWithServer=function(e){var t=this,n="";t._checkSharedDataSerializable()&&(n=c.stringify(t.state.stepsSharedData),t.state.lastSyncedSharedDataJSON===n?"function"==typeof e&&e():t.eventEmitter.emit(p.SET_STEPS_SHARED_DATA_EVENT,{stepsSharedData:t.state.stepsSharedData,callback:function(){t.state.lastSyncedSharedDataJSON=n,"function"==typeof e&&e()}}))},p.prototype._completeAsyncAction=function(){var t=this;if(!t.state.stopped){var n=function(){t.state.pageUnloading||(t._runStep(),e.clearTimeout(t.state.stepDelayTimeout),t.state.stepDelayTimeout=null)};t.state.stepDelayTimeout=l.setTimeout.call(e,function(){t.state.prolongStepDelay||t.state.shortProlongStepDelay?t.state.stepDelayTimeout=l.setTimeout.call(e,function(){n()},t.state.prolongStepDelay?T:S):n()},d)}},p.prototype.callWithSharedDataContext=function(e){return e.apply(this.state.stepsSharedData)},p.prototype._checkIFrame=function(t,n){if(e.top!==e.self||!s.isElementInIframe(t))return void n(null);var o=s.getIFrameByElement(t);this.pingIFrame(o,function(){n(o)})},p.prototype.asyncAction=function(e){var t=this;this.state.inAsyncAction=!0;var n=function(){t._syncSharedDataWithServer(function(){E.waitActionSideEffectsCompletion(e,function(){t._completeAsyncAction.apply(t,arguments)})})};_.TAKE_SCREENSHOT_ON_FAILS&&this.state.needScreeshot?this.takeScreenshot(function(){t.state.needScreeshot=!1,n()},!0):n()},p.prototype.asyncActionSeries=function(e,t,n){var o=this,i=function(){var i=function(e,t){a.forEachSeries(e,function(e,t){o._checkIFrame(e,function(i){if(i){var r=i.contentWindow[u.GLOBAL_START_XHR_BARRIER],a=i.contentWindow[u.GLOBAL_WAIT_XHR_BARRIER];E.waitActionSideEffectsCompletion(function(t){function s(){l.windowRemoveEventListener.call(i.contentWindow,"beforeunload",s),c=!0}var c=!1;o.iFrameActionCallback=function(){o.iFrameActionCallback=null,o.waitedIFrame=null,t()},o.waitedIFrame=i,r(function(){c||o.iFrameActionCallback()}),l.windowAddEventListener.call(i.contentWindow,"beforeunload",s,!0),n(e,function(){a()},i)},t)}else E.waitActionSideEffectsCompletion(function(t){n(e,t)},t)})},function(){o.state.stopped||t()})};o._syncSharedDataWithServer(function(){t(e,i,function(){o._completeAsyncAction.apply(o,arguments)})})};o.state.inAsyncAction=!0,_.TAKE_SCREENSHOT_ON_FAILS&&this.state.needScreeshot?this.takeScreenshot(function(){o.state.needScreeshot=!1,i()},!0):i()},p.prototype._init=function(){this.initialized=!0,this._setupUnloadPrediction()},p.prototype.start=function(e,t,n,o,i){this._init(),this.runSteps(e,t,n,o,i)},p.prototype.stop=function(){this.state.stopped=!0},p.prototype.runSteps=function(e,t,n,o,i){this.initialized||this._init();var r=this;r.state.testSteps=t,r.state.stepNames=e,r.state.inAsyncAction=!1,r.state.step=i,r.state.stepSetup=n,r.state.stepDone=o,r.state.runningCopmlete=!1,r.eventEmitter.emit(p.GET_STEPS_SHARED_DATA_EVENT,{callback:function(e){r.state.stepsSharedData=e||{},r.state.lastSyncedSharedDataJSON=c.stringify(r.state.stepsSharedData),r._runStep()}})},p.prototype.getSharedData=function(){return this.state.stepsSharedData},p.prototype.setSharedData=function(e){this.state.stepsSharedData=e,this._syncSharedDataWithServer()},p.prototype.onError=function(e){this.state.stopped||this.eventEmitter.emit(p.ERROR_EVENT,r.extend({stepNum:this.state.step-1},e))},p.prototype.onAssertionFailed=function(e){this.state.stopped||this.eventEmitter.emit(p.ASSERTION_FAILED_EVENT,{err:e,stepNum:this.state.step-1,isAssertion:!0})},p.prototype.expectInactivity=function(e,t){this.eventEmitter.emit(p.EXPECT_INACTIVITY_EVENT,{duration:e,callback:t})},p.prototype.runNext=function(){this._runStep()},p.prototype.runLast=function(){this.state.step--,this.runNext()},p.prototype.getCurrentStep=function(){return this.state.stepNames?this.state.stepNames[this.state.step-1]:_.CURRENT_TEST_STEP_NAME},p.prototype.getCurrentStepNum=function(){return this.state.step-1},p.prototype.onActionTargetWaitingStarted=function(e){this.eventEmitter.emit(p.ACTION_TARGET_WAITING_STARTED_EVENT,e)},p.prototype.onActionRun=function(){this.eventEmitter.emit(p.ACTION_RUN_EVENT,{})},p.prototype.setGlobalWaitFor=function(e,t){this.globalWaitForEvent=e,this.globalWaitForTimeout=t},p.prototype.__waitFor=function(t){var n=this;if("function"!=typeof this.globalWaitForEvent)return void t();"number"!=typeof this.globalWaitForTimeout&&(this.globalWaitForTimeout=0);var o=l.setTimeout.call(e,function(){n.onError({code:f.API_WAIT_FOR_ACTION_TIMEOUT_EXCEEDED,stepName:_.CURRENT_TEST_STEP_NAME})},this.globalWaitForTimeout);this.expectInactivity(this.globalWaitForTimeout,function(){n.callWithSharedDataContext(function(){n.globalWaitForEvent.call(this,function(){e.clearTimeout(o),t()})})})},p.prototype.takeScreenshot=function(e,t){this.eventEmitter.emit(p.TAKE_SCREENSHOT_EVENT,{isFailedStep:t,callback:e})}}),n.define("TestRunner.TestRunner",function(n){var i=t.get("Hammerhead"),r=i.Util,a=i.NativeMethods,s=n("Base.Transport"),l=n("Shared.ServiceCommands"),c=n("Shared.Errors"),E=n("Settings"),u=n("TestRunner.TestRunnerBase"),_=1e3,f=this.exports=function(e){var t=this;u.apply(this,[e]),s.startInactivityMonitor(function(){t._onError({code:c.TEST_INACTIVITY})})};r.inherit(f,u),f.prototype._onTestComplete=function(e){s.waitForServiceMessagesCompleted(function(){var t={cmd:l.TEST_COMPLETE};s.asyncServiceMsg(t,function(){e.callback(),s.switchToWorkerIdle()})},_)},f.prototype._onNextStepStarted=function(e){var t={cmd:l.SET_NEXT_STEP,nextStep:e.nextStep};s.asyncServiceMsg(t,e.callback)},f.prototype._onActionTargetWaitingStarted=function(e){u.prototype._onActionTargetWaitingStarted.apply(this,[e])},f.prototype._onActionRun=function(){u.prototype._onActionRun.apply(this,[])},f.prototype._onError=function(e){var t=this;if(!this.stopped){if(this.testIterator.stop(),u.prototype._onError.call(this,e),!E.TAKE_SCREENSHOT_ON_FAILS)return this.stopped=!0,void s.fail(e);var n={cmd:l.SET_TEST_ERROR,err:e};s.asyncServiceMsg(n),this._onTakeScreenshot({isFailedStep:!0,withoutStepName:!(c.hasErrorStepName(e)&&i.Errs.hasErrorStepName(e)),callback:function(){t.stopped=!0,s.fail(e)}})}},f.prototype._onAssertionFailed=function(e,t){this.testIterator.state.needScreeshot=!t,s.assertionFailed(e.err)},f.prototype._onSetStepsSharedData=function(e){var t={cmd:l.SET_STEPS_SHARED_DATA,stepsSharedData:e.stepsSharedData};s.asyncServiceMsg(t,function(){e.callback()})},f.prototype._onGetStepsSharedData=function(e){var t={cmd:l.GET_STEPS_SHARED_DATA};s.asyncServiceMsg(t,e.callback);
},f.prototype._onExpectInactivity=function(e){s.expectInactivity(e.duration,e.callback)},f.prototype._onTakeScreenshot=function(t){var n=o.title,i="[tc-"+Date.now()+"]",c=null,E=t&&t.callback?t.callback:function(){},_=this;_.eventEmitter.emit(u.SCREENSHOT_CREATING_STARTED_EVENT,{}),r.isMSEdge?c="MSEDGE":r.isSafari?c="SAFARI":r.isOpera||r.isOperaWithWebKit?c="OPERA":r.isWebKit?c="CHROME":r.isMozilla?c="FIREFOX":r.isIE&&(c="IE");var f={cmd:l.TAKE_SCREENSHOT,windowMark:i,browserName:c,isFailedStep:t.isFailedStep,withoutStepName:t.withoutStepName,url:e.location.toString()},d=n+i,T=a.setInterval.call(e,function(){o.title!==d&&(n=o.title,o.title=d)},50);o.title=d,a.setTimeout.call(e,function(){s.asyncServiceMsg(f,function(){e.clearInterval(T),T=null,o.title=n,_.eventEmitter.emit(u.SCREENSHOT_CREATING_FINISHED_EVENT,{}),a.setTimeout.call(e,function(){E()},100)})},500)},f.prototype._onDialogsInfoChanged=function(e){s.asyncServiceMsg({cmd:l.NATIVE_DIALOGS_INFO_SET,info:e,timeStamp:Date.now()})}}),n.define("TestRunner.TestRunnerBase",function(n){function i(t){var n=a.$,i=!1,r=function(){i||(i=!0,t())};n(e).load(r),n(o).ready(function(){l.isIFrameWindowInDOM(e)&&E.setTimeout.call(e,r,v)})}function r(e,t){c.pingIFrame(e,d.IFRAME_TEST_RUNNER_PING_DISPATCHER_CMD,t)}var a=t.get("Hammerhead"),s=a.$,l=a.Util,c=a.MessageSandbox,E=a.NativeMethods,u=n("Base.jQueryExtensions.Selectors"),_=n("Settings"),f=n("Base.Transport"),d=n("Base.CrossDomainMessages"),T=n("Shared.Errors"),S=n("Shared.ServiceCommands"),p=n("TestRunner.TestIterator"),A=n("TestRunner.API.Actions"),m=n("TestRunner.API.Dialogs"),I=n("TestRunner.API.Assertions"),R=n("Automation"),g=n("ActionBarrier"),N=n("UI.ModalBackground"),h=n("UI.Cursor"),C=n("Automation.IFrameBehavior"),v=3e3,O=200,M=500,D=1e3,P="runner|element-waiting|"+_.JOB_UID,y=this.exports=function(){var t=this;this.eventEmitter=new l.EventEmitter,this.testIterator=new p(r),this.executingStepInIFrameWindow=null,this.stopped=!1,this.listenNativeDialogs=!1,this.isFileDownloadingIntervalID=null,this.actionTargetWaitingStarted=e.top===e.self&&!!e.sessionStorage.getItem(P,!0),e.sessionStorage.removeItem(P),this.assertionsAPI=new I(function(e){t.testIterator.onAssertionFailed(e)}),A.init(this.testIterator),this._initNativeDialogs(),R.init(),this._initBarrier(),this._initApi(),this._initIFrameBehavior(),a.on(a.UNCAUGHT_JS_ERROR,function(e){e.inIFrame&&!_.PLAYBACK?t.testIterator.stop():(_.FAIL_ON_JS_ERRORS||_.RECORDING)&&t._onError({code:T.UNCAUGHT_JS_ERROR,scriptErr:e.msg,pageError:!0,pageUrl:e.pageUrl})}),t.testIterator.on(p.ERROR_EVENT,function(e){t._onError(e)}),t.act._onJSError=function(e){t._onError({code:T.UNCAUGHT_JS_ERROR,scriptErr:e&&e.message||e})},t.act._start=function(e,n,o,i){o&&t.actionTargetWaitingStarted&&(o-=1,_.CURRENT_TEST_STEP_NAME=e[o],t.actionTargetWaitingStarted=!1),t._prepareStepsExecuting(function(){delete t.act._onJSError,delete t.act._start,t.eventEmitter.emit(t.TEST_STARTED_EVENT,{nextStep:o}),N.hide(),t.testIterator.on(p.TEST_COMPLETE_EVENT,function(e){t._onTestComplete(e)}),t.testIterator.on(p.NEXT_STEP_STARTED_EVENT,function(e){t._onNextStepStarted(e),t._clearFileDownloadingInterval()}),t.testIterator.on(p.ACTION_TARGET_WAITING_STARTED_EVENT,function(e){t._onActionTargetWaitingStarted(e)}),t.testIterator.on(p.ACTION_RUN_EVENT,function(){t._onActionRun()}),t.testIterator.on(p.ASSERTION_FAILED_EVENT,function(e){t._onAssertionFailed(e)}),t.testIterator.on(p.SET_STEPS_SHARED_DATA_EVENT,function(e){t._onSetStepsSharedData(e)}),t.testIterator.on(p.GET_STEPS_SHARED_DATA_EVENT,function(e){t._onGetStepsSharedData(e)}),t.testIterator.on(p.EXPECT_INACTIVITY_EVENT,function(e){t._onExpectInactivity(e)}),t.testIterator.on(p.TAKE_SCREENSHOT_EVENT,function(e){t._onTakeScreenshot(e)}),t.testIterator.on(p.BEFORE_UNLOAD_EVENT_RAISED,function(){t._onBeforeUnload()}),t.testIterator.on(p.UNLOAD_EVENT_RAISED,function(){t._clearFileDownloadingInterval()}),t.listenNativeDialogs=!0,t.testIterator.start(e,n,m.resetHandlers,m.checkExpectedDialogs,o)},i)}};y.prototype.run=function(e,t,n){this.testIterator.runSteps(e,t,m.resetHandlers,m.checkExpectedDialogs,n)},y.prototype._destroy=function(){m.destroy(),this._destroyIFrameBehavior(),f.stopInactivityMonitor()},y.prototype._initBarrier=function(){g.init()},y.prototype._initIFrameBehavior=function(){function e(e){var n=e.message,o=null;switch(n.cmd){case y.IFRAME_STEP_COMPLETED_CMD:t._onIFrameStepExecuted(),t._clearIFrameExistenceWatcherInterval();break;case y.IFRAME_ERROR_CMD:n.err.stepNum===-1&&(n.err.stepNum=t.testIterator.getCurrentStepNum(),n.err.stepName=t.testIterator.getCurrentStep()),t._onError(n.err),t._clearIFrameExistenceWatcherInterval();break;case y.IFRAME_FAILED_ASSERTION_CMD:t.executingStepInIFrameWindow=null,t._onAssertionFailed(n.err,!0);break;case y.IFRAME_GET_SHARED_DATA_REQUEST_CMD:o={cmd:y.IFRAME_GET_SHARED_DATA_RESPONSE_CMD,sharedData:t.testIterator.getSharedData()},c.sendServiceMsg(o,e.source);break;case y.IFRAME_SET_SHARED_DATA_CMD:t.testIterator.setSharedData(n.sharedData);break;case y.IFRAME_EXPECT_INACTIVITY_CMD:t._onExpectInactivity({duration:n.duration,callback:function(){}});break;case y.IFRAME_NEXT_STEP_STARTED_CMD:t.executingStepInIFrameWindow=e.source,t._clearFileDownloadingInterval();break;case y.IFRAME_ACTION_TARGET_WAITING_STARTED_CMD:t.actionTargetWaitingStarted=!0,t._onActionTargetWaitingStarted(e.message.params);break;case y.IFRAME_ACTION_RUN_CMD:t.actionTargetWaitingStarted=!1,t._onActionRun();break;case d.IFRAME_TEST_RUNNER_WAITING_STEP_COMPLETION_REQUEST_CMD:t.testIterator.waitedIFrame!==l.getIFrameByWindow(e.source)&&t.executingStepInIFrameWindow!==e.source||(o={cmd:d.IFRAME_TEST_RUNNER_WAITING_STEP_COMPLETION_RESPONSE_CMD},c.sendServiceMsg(o,e.source));break;case d.IFRAME_TEST_RUNNER_STEP_COMPLETED_CMD:t.testIterator.waitedIFrame===l.getIFrameByWindow(e.source)?t.testIterator.iFrameActionCallback():t.executingStepInIFrameWindow===e.source&&t._onIFrameStepExecuted();break;case y.IFRAME_TAKE_SCREENSHOT_REQUEST_CMD:t._onTakeScreenshot({isFailedStep:n.isFailedStep,callback:function(){o={cmd:y.IFRAME_TAKE_SCREENSHOT_RESPONSE_CMD},c.sendServiceMsg(o,e.source)}});break;case y.IFRAME_NATIVE_DIALOGS_INFO_CHANGED_CMD:t._onDialogsInfoChanged(n.info);break;case y.IFRAME_BEFORE_UNLOAD_REQUEST_CMD:t._onActionRun(),t._onBeforeUnload(!0,function(t){o={cmd:y.IFRAME_BEFORE_UNLOAD_RESPONSE_CMD,res:t},c.sendServiceMsg(o,e.source)})}}var t=this;C.init(),c.on(c.SERVICE_MSG_RECEIVED,e),t._destroyIFrameBehavior=function(){C.destroy(),c.off(c.SERVICE_MSG_RECEIVED,e)}},y.prototype._prepareStepsExecuting=function(t,n){function o(){h.init(),t()}n?o():i(function(){E.setTimeout.call(e,function(){f.batchUpdate(function(){u.init(),g.waitPageInitialization(function(){h.init(),t()})})},O)})},y.WAITING_FOR_ACTION_TARGET_MESSAGE="Waiting for the target element of the next action to appear",y.prototype.TEST_STARTED_EVENT="testStarted",y.prototype.TEST_COMPLETED_EVENT="testCompleted",y.prototype.NEXT_STEP_STARTED_EVENT="nextStepStarted",y.prototype.ACTION_TARGET_WAITING_STARTED_EVENT="actionTargetWaitingStarted",y.prototype.ACTION_RUN_EVENT="actionRun",y.prototype.TEST_FAILED_EVENT="testFailed",y.SCREENSHOT_CREATING_STARTED_EVENT="screenshotCreatingStarted",y.SCREENSHOT_CREATING_FINISHED_EVENT="screenshotCreatingFinished",y.IFRAME_STEP_COMPLETED_CMD="iframeStepCompleted",y.IFRAME_ERROR_CMD="iframeError",y.IFRAME_FAILED_ASSERTION_CMD="iframeFailedAssertion",y.IFRAME_GET_SHARED_DATA_REQUEST_CMD="getSharedDataRequest",y.IFRAME_GET_SHARED_DATA_RESPONSE_CMD="getSharedDataResponse",y.IFRAME_SET_SHARED_DATA_CMD="setSharedData",y.IFRAME_EXPECT_INACTIVITY_CMD="expectInactivity",y.IFRAME_NEXT_STEP_STARTED_CMD="nextStepStarted",y.IFRAME_ACTION_TARGET_WAITING_STARTED_CMD="actionTargetWaitingStarted",y.IFRAME_ACTION_RUN_CMD="actionRun",y.IFRAME_TAKE_SCREENSHOT_REQUEST_CMD="takeScreenshotRequest",y.IFRAME_TAKE_SCREENSHOT_RESPONSE_CMD="takeScreenshotResponse",y.IFRAME_NATIVE_DIALOGS_INFO_CHANGED_CMD="nativeDialogsInfoChanged",y.IFRAME_BEFORE_UNLOAD_REQUEST_CMD="iframeBeforeUnloadRequest",y.IFRAME_BEFORE_UNLOAD_RESPONSE_CMD="iframeBeforeUnloadResponse",y.prototype.on=function(e,t){this.eventEmitter.on(e,t)},y.prototype._clearIFrameExistenceWatcherInterval=function(){this.iframeExistenceWatcherInterval!==-1&&(e.clearInterval(this.iframeExistenceWatcherInterval),this.iframeExistenceWatcherInterval=-1)},y.prototype._runInIFrame=function(t,n,o,i){function a(){l.isElementInDocument(t)||(s._onIFrameStepExecuted(),s._clearIFrameExistenceWatcherInterval())}var s=this;this.testIterator.state.inAsyncAction=!0;var u={cmd:d.IFRAME_TEST_RUNNER_RUN_CMD,stepName:n,step:o.toString(),stepNum:i};this._clearIFrameExistenceWatcherInterval(),r(t,function(n){n?s._onError({code:T.IN_IFRAME_TARGET_LOADING_TIMEOUT,stepName:_.CURRENT_TEST_STEP_NAME}):(s.iframeExistenceWatcherInterval=E.setInterval.call(e,a,D),c.sendServiceMsg(u,t.contentWindow))})},y.prototype._ensureIFrame=function(e){return e?l.isDomElement(e)?e.tagName&&"iframe"===e.tagName.toLowerCase()?e:(this._onError({code:T.API_IFRAME_ARGUMENT_IS_NOT_IFRAME,stepName:_.CURRENT_TEST_STEP_NAME}),null):("string"==typeof e&&(e=s(e)),l.isJQueryObj(e)?0===e.length?(this._onError({code:T.API_EMPTY_IFRAME_ARGUMENT,stepName:_.CURRENT_TEST_STEP_NAME}),null):e.length>1?(this._onError({code:T.API_MULTIPLE_IFRAME_ARGUMENT,stepName:_.CURRENT_TEST_STEP_NAME}),null):this._ensureIFrame(e[0]):"function"==typeof e?this._ensureIFrame(e()):(this._onError({code:T.API_INCORRECT_IFRAME_ARGUMENT,stepName:_.CURRENT_TEST_STEP_NAME}),null)):(this._onError({code:T.API_EMPTY_IFRAME_ARGUMENT,stepName:_.CURRENT_TEST_STEP_NAME}),null)},y.prototype._initApi=function(){var e=this;this.act=A,this.ok=function(){e.assertionsAPI.ok.apply(e.assertionsAPI,arguments)},this.notOk=function(){e.assertionsAPI.notOk.apply(e.assertionsAPI,arguments)},this.eq=function(){e.assertionsAPI.eq.apply(e.assertionsAPI,arguments)},this.notEq=function(){e.assertionsAPI.notEq.apply(e.assertionsAPI,arguments)},this.handleAlert=m.handleAlert,this.handleConfirm=m.handleConfirm,this.handlePrompt=m.handlePrompt,this.handleBeforeUnload=m.handleBeforeUnload,this.inIFrame=function(t,n){return function(){var o=e.testIterator.state.step,i=e._ensureIFrame(t());i&&e._runInIFrame(i,_.CURRENT_TEST_STEP_NAME,n,o)}}},y.prototype._initNativeDialogs=function(){var e=this;_.NATIVE_DIALOGS_INFO&&(e.listenNativeDialogs=!0),m.init(_.NATIVE_DIALOGS_INFO),m.on(m.UNEXPECTED_DIALOG_ERROR_EVENT,function(t){e.listenNativeDialogs&&e.testIterator.onError({code:T.API_UNEXPECTED_DIALOG,stepName:e.testIterator.getCurrentStep(),dialog:t.dialog,message:t.message})}),m.on(m.WAS_NOT_EXPECTED_DIALOG_ERROR_EVENT,function(t){e.listenNativeDialogs&&e.testIterator.onError({code:T.API_EXPECTED_DIALOG_DOESNT_APPEAR,stepName:e.testIterator.getCurrentStep(),dialog:t.dialog})}),m.on(m.DIALOGS_INFO_CHANGED_EVENT,function(t){e._onDialogsInfoChanged(t.info)})},y.prototype._onTestComplete=function(e){this.eventEmitter.emit(this.TEST_COMPLETED_EVENT,{}),e.callback()},y.prototype._onNextStepStarted=function(e){e.callback()},y.prototype._onActionTargetWaitingStarted=function(t){e.sessionStorage.setItem(P,!0),this.eventEmitter.emit(this.ACTION_TARGET_WAITING_STARTED_EVENT,t)},y.prototype._onActionRun=function(){e.sessionStorage.removeItem(P),this.eventEmitter.emit(this.ACTION_RUN_EVENT,{})},y.prototype._onError=function(e){this.eventEmitter.emit(this.TEST_FAILED_EVENT,{stepNum:this.testIterator.state.step-1,err:e})},y.prototype._onAssertionFailed=function(){},y.prototype._onSetStepsSharedData=function(e){e.callback()},y.prototype._onGetStepsSharedData=function(e){e.callback()},y.prototype._onExpectInactivity=function(e){e.callback()},y.prototype._onTakeScreenshot=function(e){e&&e.callback&&e.callback()},y.prototype._onIFrameStepExecuted=function(){this.executingStepInIFrameWindow=null,this.actionTargetWaitingStarted?(this.actionTargetWaitingStarted=!1,this.testIterator.runLast()):this.testIterator.runNext()},y.prototype._onDialogsInfoChanged=function(){},y.prototype.setGlobalWaitFor=function(e,t){this.testIterator.setGlobalWaitFor(e,t)},y.prototype._onBeforeUnload=function(t,n){var o=this;f.asyncServiceMsg({cmd:S.UNCHECK_FILE_DOWNLOADING_FLAG},function(){o.isFileDownloadingIntervalID=E.setInterval.call(e,function(){f.asyncServiceMsg({cmd:S.GET_AND_UNCHECK_FILE_DOWNLOADING_FLAG},function(i){if(i){if(e.clearInterval(o.isFileDownloadingIntervalID),o.isFileDownloadingIntervalID=null,t)return void n(i);o.testIterator.state.stepDelayTimeout&&(e.clearTimeout(o.testIterator.state.stepDelayTimeout),o.testIterator.state.stepDelayTimeout=null),o.testIterator.state.pageUnloading=!1,o.testIterator._runStep()}})},M)})},y.prototype._clearFileDownloadingInterval=function(){this.isFileDownloadingIntervalID&&(e.clearInterval(this.isFileDownloadingIntervalID),this.isFileDownloadingIntervalID=null)}}),n.define("Automation.Click.Playback",function(n,o){function i(t,n,o,i){var r="option"===t.tagName.toLowerCase(),d=c.getSelectParent(a(t));if(!d)return _.click(t,n),void o();var S=a(d),m=S[0].selectedIndex,I=p.isOptionListExpanded(S),R=c.getChildIndex(S,t),g=null;if(I)g=p.getEmulatedChildElement(R,!r);else{var N=c.getSelectSizeValue(S);if((!l.RECORDING||l.PLAYBACK)&&N<=1)return void i({code:f.API_INVISIBLE_ACTION_ELEMENT,element:c.getElementDescription(t)});g=t}s.series({moveCursorToElement:function(n){var o=null;I?o=g:(p.scrollOptionListByChild(t),o=p.getSelectChildCenter(t)),A.run(o,!1,{},function(){E.setTimeout.call(e,n,T.ACTION_STEP_DELAY)})},click:function(){!I&&(c.isWebKit&&1===c.getSelectSizeValue(S)||c.isIE&&c.getSelectSizeValue(S)>1)?_.click(S[0],n):_.click(g,n),I?o():(r&&!g.disabled&&(S[0].selectedIndex=R),u.focus(S[0],function(){E.setTimeout.call(e,function(){r&&a(t).index()!==m&&_.change(S[0]),o()},c.isTouchDevice?0:T.CLICK_STEP_DELAY)},!1,!0))}})}var r=t.get("Hammerhead"),a=r.$,s=r.async,l=n("Settings"),c=r.Util,E=r.NativeMethods,u=r.EventSandbox,_=r.EventSimulator,f=n("Shared.Errors"),d=n("Automation.Util"),T=n("Automation.Settings"),S=n("UI.Cursor"),p=n("UI.SelectElement"),A=n("Automation.Move.Playback");o.run=function(t,n,o,r){if(n={ctrl:n.ctrl,alt:n.alt,shift:n.shift,meta:n.meta,offsetX:n.offsetX,offsetY:n.offsetY,caretPos:n.caretPos},"option"===t.tagName.toLowerCase()||"optgroup"===t.tagName.toLowerCase())return void i(t,n,o,r);var u=c.isSvgElement(t),f=null,m=null,I=null,R=c.isContainOffset(t,n.offsetX,n.offsetY)?t:d.getMouseActionPoint(t,n,!1),g=!0,N=null,h=!1,C=null,v=!1;n.offsetX&&(n.offsetX=Math.round(n.offsetX)),n.offsetY&&(n.offsetY=Math.round(n.offsetY)),s.series({moveCursorToElement:function(o){return!l.RECORDING||l.PLAYBACK||c.isElementVisible(t)?void A.run(R,!1,n,function(){u&&c.isOpera||a(t).is("tref")?N=t:(f=d.getMouseActionPoint(t,n,!0),m=d.getEventOptionCoordinates(t,f),I=a.extend({clientX:m.x,clientY:m.y},n),N=d.getElementUnderCursor(f.x,f.y,null,R),N||(h=!0,N=t)),E.setTimeout.call(e,o,T.ACTION_STEP_DELAY)}):(N=t,void E.setTimeout.call(e,o,T.ACTION_STEP_DELAY))},touchstart:function(e){c.isTouchDevice&&_.touchstart(N,I),e()},cursorTouchMouseDown:function(e){c.isTouchDevice?S.lMouseDown(e):e()},touchend:function(t){c.isTouchDevice?(_.touchend(N,I),E.setTimeout.call(e,t,T.ACTION_STEP_DELAY)):t()},cursorMouseDown:function(e){c.isTouchDevice?e():S.lMouseDown(e)},mousedown:function(o){var i=(c.isWebKit||c.isIE)&&c.isSelectElement(t),r=null,a=!1,s=c.getActiveElement(),l=!(c.isIE&&s===N)||"body"===N.tagName.toLowerCase()&&c.isContentEditableElement(N),u=function(){E.setTimeout.call(e,o,T.ACTION_STEP_DELAY)};if(i){var S=function(e){r=e.defaultPrevented,c.preventDefault(e),E.removeEventListener.call(t,"mousedown",S,!1)};E.addEventListener.call(t,"mousedown",S,!1)}var p=function(){a=!0,E.removeEventListener.call(s,"blur",p,!0)};if(E.addEventListener.call(s,"blur",p,!0),g=_.mousedown(N,I),!h&&f&&(C=d.getElementUnderCursor(f.x,f.y,null,R),C&&C!==N&&(v=!0,N=C)),c.getActiveElement()===s||a||(c.isIE&&c.browserVersion<12?E.setTimeout.call(e,function(){a||_.blur(s)},0):_.blur(s)),g===!1){if(!i||r)return void u();g=!0}d.focusAndSetSelection(c.isContentEditableElement(t)?t:N,n,l,u)},cursorMouseUp:function(e){S.mouseUp(e)},mouseup:function(e){_.mouseup(N,I),!h&&f&&(C=d.getElementUnderCursor(f.x,f.y,null,R)),e()},click:function(){var e=a(N);if((!l.RECORDING||l.PLAYBACK)&&"option"===N.tagName.toLowerCase())return void o();if("option"===N.tagName.toLowerCase()){var t=c.getSelectParent(e),n=a(t);return t&&(c.isWebKit&&c.getSelectSizeValue(n)<=1||c.isIE&&c.getSelectSizeValue(n)>1)?_.click(n[0],I):_.click(e[0],I),t&&_.change(n[0]),void o()}v||_.click(N,I),d.focusLabelChildElement(N),l.RECORDING&&!l.PLAYBACK||!c.isSelectElement(N)||g===!1||(p.isOptionListExpanded(e)?p.collapseOptionList():p.expandOptionList(N)),o()}})}}),n.define("Automation.DblClick.Playback",function(n,o){var i=t.get("Hammerhead"),r=i.$,a=i.Util,s=i.NativeMethods,l=n("UI.SelectElement"),c=i.async,E=i.EventSimulator,u=n("Settings"),_=n("UI.Cursor"),f=n("Automation.Util"),d=n("Automation.Settings"),T=n("Automation.Click.Playback");o.run=function(t,n,o){n={ctrl:n.ctrl,alt:n.alt,shift:n.shift,meta:n.meta,offsetX:n.offsetX,offsetY:n.offsetY,caretPos:n.caretPos};var i=null,S=null,p=null,A=!1;a.isContainOffset(t,n.offsetX,n.offsetY)||(S=f.getMouseActionPoint(t,n,!0),i=_.getElementUnderCursor(S.x,S.y)),i||(i=t);var m=u.RECORDING&&!u.PLAYBACK&&!a.isElementVisible(t),I=f.getMouseActionPoint(t,n,!0),R=f.getEventOptionCoordinates(t,I),g=r.extend({clientX:R.x,clientY:R.y},n);c.series({firstClick:function(o){T.run(t,n,function(){m||(p=f.getElementUnderCursor(I.x,I.y,null,t),p&&p!==i&&(i=p)),s.setTimeout.call(e,o,d.CLICK_STEP_DELAY)})},secondClick:function(o){var T=!0;c.series({touchstart:function(e){a.isTouchDevice&&E.touchstart(i,g),e()},cursorTouchMouseDown:function(e){a.isTouchDevice?_.lMouseDown(e):e()},touchend:function(t){a.isTouchDevice?(E.touchend(i,g),s.setTimeout.call(e,t,d.ACTION_STEP_DELAY)):t()},cursorMouseDown:function(e){a.isTouchDevice?e():_.lMouseDown(e)},mousedown:function(e){var o=(a.isWebKit||a.isIE)&&a.isSelectElement(i),r=null,l=a.getActiveElement(),c=!(a.isIE&&l===i);if(o){var u=function(e){r=e.defaultPrevented,a.preventDefault(e),s.removeEventListener.call(i,"mousedown",u,!1)};s.addEventListener.call(i,"mousedown",u,!1)}if(T=E.mousedown(i,g),m||(p=f.getElementUnderCursor(I.x,I.y,null,t),p&&p!==i&&(A=!0,i=p)),T===!1){if(!o||r)return void e();T=!0}a.isIE?e():f.focusAndSetSelection(a.isContentEditableElement(t)?t:i,n,c,e)},cursorMouseUp:function(e){_.mouseUp(e)},mouseup:function(e){E.mouseup(i,g),e()},click:function(){"option"===i.tagName.toLowerCase()?o():(A||E.click(i,g),u.RECORDING&&!u.PLAYBACK||!a.isSelectElement(i)||T===!1||(l.isOptionListExpanded(r(i))?l.collapseOptionList():l.expandOptionList(i)),o())}})},dblclick:function(){A||E.dblclick(i,g),o()}})}}),n.define("Automation.Drag.Playback",function(n,o){var i=t.get("Hammerhead"),r=i.$,a=i.async,s=i.Util,l=i.NativeMethods,c=i.EventSandbox,E=i.EventSimulator,u=n("Settings"),_=n("Automation.Util"),f=n("Automation.Settings"),d=n("UI.Cursor"),T=i.ContentEditableHelper,S=n("Automation.Move.Playback");o.run=function(t,n,o,i){var p=s.isContainOffset(t,o.offsetX,o.offsetY)?t:_.getMouseActionPoint(t,o,!1),A=null,m=null,I=null,R=null,g=u.RECORDING&&!u.PLAYBACK&&!s.isElementVisible(t),N=null,h=s.findDocument(t),C=null,v=null,O=null,M=null,D=null;return o.offsetX&&(o.offsetX=Math.round(o.offsetX)),o.offsetY&&(o.offsetY=Math.round(o.offsetY)),g?void i(t):void a.series({moveCursorToElement:function(a){S.run(p,!1,o,function(){return v=_.getMouseActionPoint(t,o,!1),A=s.offsetToClientCoords(v),m=_.getEventOptionCoordinates(t,A),I=r.extend({clientX:m.x,clientY:m.y},o),C=s.isDomElement(n)?s.findCenter(n):_.getDragEndPoint(v,n,h),(R=d.getElementUnderCursor(A.x,A.y))?void l.setTimeout.call(e,a,f.DRAG_ACTION_STEP_DELAY):void i(t)})},cursorMouseDown:function(e){d.lMouseDown(e)},take:function(n){s.isTouchDevice?E.touchstart(R,I):E.mousedown(R,I),c.focus(s.isContentEditableElement(t)?T.findContentEditableParent(t):R,function(){l.setTimeout.call(e,n,f.DRAG_ACTION_STEP_DELAY)},!1,!0)},drag:function(t){N={x:o.offsetX,y:o.offsetY},delete o.offsetX,delete o.offsetY,S.run(s.isDomElement(n)?n:C,!0,o,function(){o.offsetX=N.x,o.offsetY=N.y,l.setTimeout.call(e,t,f.DRAG_ACTION_STEP_DELAY)},h)},cursorMouseUp:function(e){if(C)O=s.offsetToClientCoords(C);else{var n=s.getOffsetPosition(t);O=s.offsetToClientCoords({x:n.left,y:n.top})}if(M=_.getEventOptionCoordinates(t,O),s.isElementInIframe(t)){var a=s.getIFrameByElement(t);if(a){var l={x:O.x-r(a.contentWindow).scrollLeft(),y:O.y-r(a.contentWindow).scrollTop()};R=d.getElementUnderCursor(l.x,l.y)}}else R=d.getElementUnderCursor(O.x,O.y);return R?(D=r.extend({clientX:M.x,clientY:M.y},o),void d.mouseUp(e)):void i()},mouseUp:function(e){s.isTouchDevice?E.touchend(R,D):E.mouseup(R,D),e()},click:function(){d.getElementUnderCursor(O.x,O.y)===R&&E.click(R,D),i()}})}}),n.define("Automation.Hover.Playback",function(n,o){var i=t.get("Hammerhead"),r=i.Util,a=n("Settings"),s=i.NativeMethods,l=n("Automation.Settings"),c=n("Automation.Move.Playback");o.run=function(t,n,o){return!a.RECORDING||a.PLAYBACK||r.isElementVisible(t)?(n.offsetX&&(n.offsetX=Math.round(n.offsetX)),n.offsetY&&(n.offsetY=Math.round(n.offsetY)),void c.run(t,!1,n,o)):void s.setTimeout.call(e,o,l.ACTION_STEP_DELAY)}}),n.define("Automation.Press.KeyPressSimulator",function(n,o){function i(e){var t=e.value,n=_.hasInverseSelection(e),o=n?_.getSelectionStart(e):_.getSelectionEnd(e);return t&&o?l.getTextareaIndentInLine(e,o):0}var r=t.get("Hammerhead"),a=r.$,s=r.async,l=r.Util,c=r.NativeMethods,E=r.EventSandbox,u=r.EventSimulator,_=r.TextSelection,f=n("Automation.TypeChar.Playback"),d=n("Automation.Util"),T=80,S=function(e,t){function n(){return!!o||(l.isWebKit||l.isMSEdge?13===d:l.isIE&&l.browserVersion<=11?13===d||27===d:!!l.isMozilla&&(d&&"capslock"!==i))}var o=1===e.length||"space"===e,i=o?e:e.toLowerCase(),r=null,s=null;l.KEYS_MAPS.MODIFIERS_MAP[i]&&(i=l.KEYS_MAPS.MODIFIERS_MAP[i]);var c=null,E=null,_=l.KEYS_MAPS.MODIFIERS[i],d=l.KEYS_MAPS.SPECIAL_KEYS[i];return o&&"space"!==e?c=l.getKeyCodeByChar(i):_?c=_:d&&(c=d),{down:function(n){var o=l.getActiveElement();return r=o,_&&(n[i]=!0),E=l.KEYS_MAPS.KEY_PROPERTY[t]||t,n.shift&&l.isLetter(e)&&(E=l.changeLetterCase(E)),u.keydown(o,a.extend({keyCode:c,key:E},n))},press:function(e){function t(t){if("space"===t)return" ";if(e.shift){if(l.isLetter(t))return l.changeLetterCase(t);if(l.KEYS_MAPS.REVERSED_SHIFT_MAP[t])return l.KEYS_MAPS.REVERSED_SHIFT_MAP[t]}return t}var _=l.getActiveElement();if(!n())return!0;var T=o?t(i):null,S=d||T.charCodeAt(0);if(l.isWebKit&&_!==r&&l.isElementInIframe(_)!==l.isElementInIframe(r))return!0;s=_;var p=u.keypress(_,a.extend({keyCode:c,charCode:S,key:E},e));if(_=l.getActiveElement(),p){if(T&&!e.ctrl&&!e.alt)try{if(s===_||(!l.isMozilla||l.isEditableElement(s))&&(!l.isWebKit||l.isElementInIframe(_)===l.isElementInIframe(s)||l.isEditableElement(s))){var A=_;!l.isIE&&_!==s&&l.isEditableElement(s)&&l.isEditableElement(_)&&(A=s),f.run(A,T)}}catch(m){}"enter"===i&&_.tagName&&"input"===_.tagName.toLowerCase()&&/button|submit|reset/.test(_.type)&&_.click()}return p},up:function(e){_&&(e[i]=!1);var t=u.keyup(l.getActiveElement(),a.extend({keyCode:c,key:E},e)),n=l.getActiveElement();return t&&"space"===i&&n.tagName&&"input"===n.tagName.toLowerCase()&&/button|submit|reset|radio|checkbox/.test(n.type)&&n.click(),t},getKey:function(){return i}}},p=function(){function e(){b=null,L=null,c.removeEventListener.call(this,"blur",e,!0)}function t(t){"textarea"===t.tagName.toLowerCase()&&(b!==t&&(c.addEventListener.call(t,"blur",e,!0),b=t),L=i(t))}function n(e,n){var o=e.value;if(o){var i=_.hasInverseSelection(e),a=_.getSelectionStart(e),s=_.getSelectionEnd(e),l=o.substring(0,i?a:s),c=l.lastIndexOf("\n"),E=l.substring(0,c);null!==L&&b===e||t(e);var u=Math.min(E.lastIndexOf("\n")+1+L,E.length);r(e,a,s,i,u,n)}}function o(e,n){var o=e.value;if(o){var i=_.hasInverseSelection(e),a=_.getSelectionStart(e),s=_.getSelectionEnd(e),l=o.substring(i?a:s),c=l.indexOf("\n")===-1?l.length:l.indexOf("\n")+1,E=l.substring(c),u=(i?a:s)+c,f=E.indexOf("\n")===-1?E.length:E.indexOf("\n");null!==L&&b===e||t(e),u+=L>=f?f:L,r(e,a,s,i,u,n)}}function r(e,t,n,o,i,r){var a=null,s=null,l=null;r?t===n?i<t?(a=i,s=t,l=!0):(a=t,s=i):o?i>n?(a=n,s=i):(a=i,s=n,l=!0):i<t?(a=i,s=t,l=!0):(a=t,s=i):s=a=i,_.select(e,a,s,l)}function s(e,t,n,o){"-"===t.charAt(0)&&"."===t.charAt(1)&&(t=t.substring(1)),"."===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),d.setValue(e,t),_.select(e,n,o),u.input(e)}function f(e,t){l.isEditableElement(e)&&_.select(e),t()}function T(e,t){if(l.isTextEditableElementAndEditingAllowed(e)){var n=_.getSelectionStart(e),o=_.getSelectionEnd(e),i=e.value.replace(/\r\n/g,"\n"),r="";o===n?n>0&&(r=i.substring(0,n-1)+i.substring(o,i.length),s(e,r,n-1,n-1)):(r=i.substring(0,n)+i.substring(o,i.length),s(e,r,n,n))}else l.isContentEditableElement(e)&&_.deleteSelectionContents(e);t()}function S(e,t){if(l.isTextEditableElementAndEditingAllowed(e)){var n=_.getSelectionStart(e),o=_.getSelectionEnd(e),i=e.value.replace(/\r\n/g,"\n"),r="";o===n?n<i.length&&(r=i.substring(0,n)+i.substring(o+1,i.length),s(e,r,n,n)):(r=i.substring(0,n)+i.substring(o,i.length),s(e,r,n,n))}else l.isContentEditableElement(e)&&_.deleteSelectionContents(e);t()}function p(e,n){var o=null,i=null;if(l.isTextEditableElement(e)){o=_.getSelectionStart(e),i=_.getSelectionEnd(e);var r=o?o===i?o-1:o:0;_.select(e,r,r),t(e)}else if(l.isContentEditableElement(e)&&(o=_.getSelectionStart(e),i=_.getSelectionEnd(e),o!==i)){var a=_.getSelectionByElement(e),s=_.hasInverseSelectionContentEditable(e),c=s?a.focusNode:a.anchorNode,E=s?a.focusOffset:a.anchorOffset;_.selectByNodesAndOffsets(c,E,c,E,!0,!1)}n()}function A(e,n){var o=null,i=null;if(l.isTextEditableElement(e)){o=_.getSelectionStart(e),i=_.getSelectionEnd(e);var r=o===e.value.length?o:o===i?o+1:i;_.select(e,r,r),t(e)}else if(l.isContentEditableElement(e)&&(o=_.getSelectionStart(e),i=_.getSelectionEnd(e),o!==i)){var a=_.getSelectionByElement(e),s=_.hasInverseSelectionContentEditable(e),c=s?a.anchorNode:a.focusNode,E=s?a.anchorOffset:a.focusOffset;_.selectByNodesAndOffsets(c,E,c,E,!0,!1)}n()}function m(e,t){return l.isWebKit&&e.tagName&&"input"===e.tagName.toLowerCase()?void R(e,t):(e.tagName&&"textarea"===e.tagName.toLowerCase()&&n(e,!1),void t())}function I(e,t){return l.isWebKit&&e.tagName&&"input"===e.tagName.toLowerCase()?void g(e,t):(e.tagName&&"textarea"===e.tagName.toLowerCase()&&o(e,!1),void t())}function R(e,t,n){if(l.isTextEditableElement(e)){var o=e.value,i=_.getSelectionStart(e),r=_.getSelectionEnd(e),a=_.hasInverseSelection(e),s="textarea"!==e.tagName.toLocaleLowerCase()||l.getTextareaLineNumberByPosition(e,i)===l.getTextareaLineNumberByPosition(e,r),c=null;c=s?a?r:i:a?i:r;var E=o.substring(0,c),u=E.lastIndexOf("\n")===-1?0:E.lastIndexOf("\n")+1;s?_.select(e,u,n?c:u,n):_.select(e,a?u:i,a?r:u,a)}t()}function g(e,t,n){if(l.isTextEditableElement(e)){var o=e.value,i=_.getSelectionStart(e),r=_.getSelectionEnd(e),a=_.hasInverseSelection(e),s="textarea"!==e.tagName.toLocaleLowerCase()||l.getTextareaLineNumberByPosition(e,i)===l.getTextareaLineNumberByPosition(e,r),c=null;c=s?a?r:i:a?i:r;var E=o.substring(c),u=c;u+=E.indexOf("\n")===-1?E.length:E.indexOf("\n"),s?_.select(e,n?c:u,u):_.select(e,a?u:i,a?r:u,a)}t()}function N(e,t){return l.isWebKit&&e.tagName&&"input"===e.tagName.toLowerCase()?void O(e,t):(e.tagName&&"textarea"===e.tagName.toLowerCase()&&n(e,!0),void t())}function h(e,t){return l.isWebKit&&e.tagName&&"input"===e.tagName.toLowerCase()?void M(e,t):(e.tagName&&"textarea"===e.tagName.toLowerCase()&&o(e,!0),void t())}function C(e,n){if(l.isTextEditableElement(e)){var o=_.getSelectionStart(e),i=_.getSelectionEnd(e);o===i||_.hasInverseSelection(e)?_.select(e,Math.max(o-1,0),i,!0):_.select(e,o,Math.max(i-1,0),i-1<o),t(e)}n()}function v(e,n){if(l.isTextEditableElement(e)){var o=_.getSelectionStart(e),i=_.getSelectionEnd(e);o!==i&&_.hasInverseSelection(e)?_.select(e,Math.min(o+1,e.value.length),i,o+1<i):_.select(e,o,Math.min(i+1,e.value.length)),t(e)}n()}function O(e,t){R(e,t,!0)}function M(e,t){g(e,t,!0)}function D(e,t){if(/input/i.test(e.tagName)){l.isIE||E.processElementChanging(e);var n=a(e).parents("form:first");if(n.length){var o=n.find("input[type=submit]:enabled,button[type=submit]:enabled");if(o.length||(o=n.find("button:enabled").filter(function(){return"submit"===this.type})),o.length)u.click(o[0]);else{var i=l.isWebKit?/^(text|search|url|number|tel|password|number|email)$/i:/^(text|search|url|number|tel|password|number|email|date|time)$/i;if(i.test(e.type)){var r=n.find("input").filter(function(){return i.test(this.type)});1!==r.length||r[0]!==e||e.validity&&!e.validity.valid||u.submit(n[0])&&n[0].submit()}}}}else if(e.tagName&&"textarea"===e.tagName.toLowerCase()){var c=_.getSelectionStart(e),f=e.value,d=_.getSelectionStart(e)+1,T=f.substring(0,c)+String.fromCharCode(10)+f.substring(c);s(e,T,d,d)}else e.tagName&&"a"===e.tagName.toLowerCase()&&u.click(e);t()}function P(e,t){var n=l.getNextFocusableElement(e);n&&E.focus(n,function(){l.isTextEditableInput(n)&&_.select(n),t()})}function y(e,t){var n=l.getNextFocusableElement(e,!0);n&&E.focus(n,function(){l.isTextEditableInput(n)&&_.select(n),t()})}var b=null,L=null;return{"ctrl+a":f,backspace:T,"delete":S,left:p,right:A,up:m,down:I,"shift+left":C,"shift+right":v,"shift+up":N,"shift+down":h,"shift+home":O,"shift+end":M,home:R,end:g,enter:D,tab:P,"shift+tab":y}}();o.press=function(t,n){var o=l.getShortcutsByKeyCombination(p,t.toLowerCase()),i={},r="",E=t,u=0;for(u=0;u<o.length;u++){var _=o[u].toLowerCase(),f=E.indexOf(_),d=_.length;r+=E.substring(0,f+d),i[r]=l.getShortcutHandlerByKeyCombination(p,_),E=E.substring(f+d)}var A={ctrl:!1,alt:!1,shift:!1,meta:!1},m=l.getArrayByKeyCombination(t),I=m.slice();for(u=0;u<m.length;u++){var R=m[u];if("shift"===R.toLowerCase()){var g=m[u+1];if(!g)continue;l.KEYS_MAPS.SHIFT_MAP[g]?m[u+1]=l.KEYS_MAPS.SHIFT_MAP[g]:l.KEYS_MAPS.REVERSED_SHIFT_MAP[g]&&(I[u+1]=l.KEYS_MAPS.REVERSED_SHIFT_MAP[g])}!l.KEYS_MAPS.SHIFT_MAP[R]||m[u-1]&&"shift"===m[u-1].toLowerCase()||(m[u]=l.KEYS_MAPS.SHIFT_MAP[R],m.splice(u,0,"shift"),I.splice(u,0,"shift"),u++)}var N=a.map(m,function(e,t){return S(e,I[t])}),h=[],C="";s.series({keydown:function(t){s.forEachSeries(N,function(t,n){var o=!t.down(A),r=t.getKey();h.push(t),C+=(C?"+":"")+r;var a=function(){c.setTimeout.call(e,n,T)};if(o)a();else{var s=i[C];(!s||l.isMozilla||/^(enter|esc)$/.test(r))&&(o=!t.press(A)),!o&&s?s(l.getActiveElement(),a):a()}},function(){t()})},keyup:function(){s.whilst(function(){return h.length},function(t){h.pop().up(A),c.setTimeout.call(e,t,T)},function(){n()})}})}}),n.define("Automation.Move.Playback",function(n,i){var r=t.get("Hammerhead"),a=r.$,s=r.async,l=r.Util,c=r.NativeMethods,E=r.EventSimulator,u=r.MessageSandbox,_=n("Base.CrossDomainMessages"),f=n("Automation.Util"),d=n("Automation.Settings"),T=n("Automation.Scroll.Playback"),S=n("UI.Cursor"),p=null;i.run=function(t,n,i,r,A,m,I){function R(e){s.series({setPosition:function(t){if(l.isTouchDevice&&!n)return L=h,void S.move(L,e);P||(P=l.dateNow(),y=P+b);var o=Math.min(l.dateNow(),y),i=(o-P)/(y-P);if(L={x:Math.round(C+M*i),y:Math.round(v+D*i)},L.x===C&&L.y===v){if(I)return void e();0!==M?L.x=L.x+(M>0?1:-1):0!==D&&(L.y=L.y+(D>0?1:-1))}S.move(L,t)},emulateEvents:function(){if(!m){var t=S.getElementUnderCursor(L.x,L.y),o=L;n&&!O&&(O=t),t&&(o=f.getEventOptionCoordinates(t,L));var r=a.extend({clientX:o.x,clientY:o.y,button:0,which:l.isWebKit?n?l.WHICH_PARAMETER.LEFT_BUTTON:l.WHICH_PARAMETER.NO_BUTTON:1,buttons:n?l.BUTTONS_PARAMETER.LEFT:l.BUTTONS_PARAMETER.NO_BUTTON},i),s=!0,c=p&&l.isElementInIframe(p)&&!l.getIFrameByElement(p);l.isIE&&c?(p=null,s=!0):s=t!==p,s&&p&&E.mouseout(p,a.extend({relatedTarget:t},r));var u=l.isTouchDevice?"touchmove":"mousemove",_=l.isTouchDevice?O:t;l.isIE&&t&&E[u](_,r),s&&(t&&E.mouseover(t,a.extend({
relatedTarget:p},r)),p=t),!l.isIE&&t&&E[u](_,r),s&&t&&E[u](_,r)}e()}})}A=A||o;var g=l.isDomElement(t)?f.getMouseActionPoint(t,i,!1):{x:Math.floor(t.x),y:Math.floor(t.y)},N=A!==o,h=null,C=null,v=null,O=null,M=null,D=null,P=null,y=null,b=null,L=S.getPosition(),F=a(e);s.series({scrollToTarget:function(e){var n=l.isDomElement(t)?l.getOffsetPosition(t):null;T.run(l.isDomElement(t)?t:g,i,A,function(){if(l.isDomElement(t)){var i=l.getOffsetPosition(t),r=l.getElementScroll(a(t));t!==o.documentElement&&(g.x+=i.left-n.left,g.y+=i.top-n.top),!/html/i.test(t.tagName)&&l.hasScroll(t,A)&&(g.x-=r.left,g.y-=r.top)}h=l.offsetToClientCoords(g),e()})},setCursor:function(t){if(g.x<0||h.x>F.width()||h.y<0||h.y>F.height)return void r();var n=null;if(e.top===e.self){var o=S.getPosition(),i=o?S.getElementUnderCursor(o.x,o.y):null;if(!i||!i.tagName||"iframe"!==i.tagName.toLowerCase())return void S.ensureCursorPosition(h,!1,t);var a=l.clientToOffsetCoord(o),s=l.getFixedPositionForIFrame(a,i.contentWindow);(s.x<=0||s.y<=0)&&S.ensureCursorPosition(h,!1,t),u.pingIFrame(i,_.MOVE_CURSOR_IN_IFRAME_PING,function(o){return o?void S.ensureCursorPosition(h,!1,t):(n=function(o){o.message.cmd===_.MOVE_FROM_IFRAME_RESPONSE_CMD&&(u.off(u.SERVICE_MSG_RECEIVED,n),o.message.point?S.getPosition()?(S.setPosition(l.getFixedPosition(o.message.point,i.contentWindow,!0)),c.setTimeout.call(e,t,0)):S.ensureCursorPosition(l.getFixedPosition(o.message.point,i.contentWindow,!0),!0,t):S.ensureCursorPosition(h,!1,t))},u.on(u.SERVICE_MSG_RECEIVED,n),u.sendServiceMsg({cmd:_.MOVE_FROM_IFRAME_REQUEST_CMD,rectangle:l.getIFrameCoordinates(i.contentWindow),startPoint:l.clientToOffsetCoord(h),endPoint:a,cursorPosition:l.getFixedPositionForIFrame(a,i.contentWindow)},i.contentWindow),void 0)},!0)}else n=function(o){o.message.cmd===_.MOVE_TO_IFRAME_RESPONSE_CMD&&(u.off(u.SERVICE_MSG_RECEIVED,n),!o.message.point||o.message.point.x===h.x&&o.message.point.y===h.y?S.ensureCursorPosition(h,!1,t):S.getPosition()?(S.setPosition(o.message.point),c.setTimeout.call(e,t,0)):S.ensureCursorPosition(o.message.point,!0,t))},u.on(u.SERVICE_MSG_RECEIVED,n),u.sendServiceMsg({cmd:_.MOVE_TO_IFRAME_REQUEST_CMD,point:h},e.top)},moveToTarget:function(t){return(L=S.getPosition())?(C=L.x,v=L.y,M=h.x-C,D=h.y-v,N&&(C-=a(A).scrollLeft(),v-=a(A).scrollTop()),b=Math.max(Math.abs(M),Math.abs(D))/(n?d.MOVING_SPEED_IN_DRAGGING:d.MOVING_SPEED),n&&(b=Math.max(b,d.MINIMUM_MOVING_TIME)),void s.whilst(function(){return N?L.x+a(A).scrollLeft()!==h.x||L.y+a(A).scrollTop()!==h.y:L.x!==h.x||L.y!==h.y},function(t){c.setTimeout.call(e,function(){R(t)},0)},function(e){e||t()})):void r()},callback:function(){r()}})}}),n.define("Automation.Press.Playback",function(n,o){var i=t.get("Hammerhead"),r=i.async,a=i.Util,s=i.NativeMethods,l=n("Settings"),c=n("Automation.Press.KeyPressSimulator"),E=n("Automation.Util"),u=n("UI.SelectElement");o.run=function(t,n){var o=a.parseKeysString(t),i=o.commands;r.forEachSeries(i,function(t,n){a.isSelectElement(a.getActiveElement())&&(/enter|tab/.test(t)&&(l.RECORDING&&!l.PLAYBACK||!/enter|tab/.test(t))||u.switchOptionsByKeys(t)),c.press(t,function(){s.setTimeout.call(e,n,E.ACTION_STEP_DELAY)})},function(){n()})}}),n.define("Automation.RClick.Playback",function(n,o){var i=t.get("Hammerhead"),r=i.$,a=i.async,s=i.Util,l=i.EventSimulator,c=i.NativeMethods,E=n("Settings"),u=n("Automation.Util"),_=n("Automation.Settings"),f=n("UI.Cursor"),d=n("Automation.Move.Playback");o.run=function(t,n,o){n={ctrl:n.ctrl,alt:n.alt,shift:n.shift,meta:n.meta,offsetX:n.offsetX,offsetY:n.offsetY,caretPos:n.caretPos};var i=s.isSvgElement(t),T=s.isContainOffset(t,n.offsetX,n.offsetY)?t:u.getMouseActionPoint(t,n,!1),S=!0,p=null,A=null,m=null,I=null,R=!1,g=null;n.offsetX&&(n.offsetX=Math.round(n.offsetX)),n.offsetY&&(n.offsetY=Math.round(n.offsetY)),a.series({moveCursorToElement:function(o){return!E.RECORDING||E.PLAYBACK||s.isElementVisible(t)?void d.run(T,!1,n,function(){i&&s.isOpera||r(t).is("tref")?I=t:(p=u.getMouseActionPoint(t,n,!0),A=u.getEventOptionCoordinates(t,p),m=r.extend({clientX:A.x,clientY:A.y,button:s.BUTTON.RIGHT,which:s.WHICH_PARAMETER.RIGHT_BUTTON,buttons:s.BUTTONS_PARAMETER.RIGHT_BUTTON},n),I=u.getElementUnderCursor(p.x,p.y,null,T),I||(R=!0,I=t)),c.setTimeout.call(e,o,_.ACTION_STEP_DELAY)}):(I=t,void c.setTimeout.call(e,o,_.ACTION_STEP_DELAY))},cursorMouseDown:function(e){f.rMouseDown(e)},mousedown:function(e){var o=s.getActiveElement(),i=!(s.isIE&&o===I);return S=l.mousedown(I,m),!R&&p&&(g=u.getElementUnderCursor(p.x,p.y,null,T),g&&(I=g)),S===!1?void e():void u.focusAndSetSelection(s.isContentEditableElement(t)?t:I,n,i,e)},cursorMouseUp:function(e){f.mouseUp(e)},mouseup:function(t){l.mouseup(I,m),!R&&p&&(g=f.getElementUnderCursor(p.x,p.y,null,T),g&&(I=g)),c.setTimeout.call(e,t,_.ACTION_STEP_DELAY)},contextmenu:function(){l.contextmenu(I,m),u.focusLabelChildElement(I),o()}})}}),n.define("Automation.Scroll.Playback",function(n,i){function r(e,t,n,i){i=i||o;var r=_.getClientDimensions(e),a=_.getElementFromPoint(r.left+t,r.top+n);return a&&"fixed"===_.getComputedStyle(a,i).position}function a(t){var n=Math.min(e.innerWidth,e.innerHeight);return t>=n/2}function s(e,t,n,o,i){var r=_.getClientDimensions(t),a=_.getClientDimensions(e[0]),s=null,l=null,c=Math.min(i,Math.floor(a.width/2)),E=Math.min(i,Math.floor(a.height/2)),u=-1,f=-1,d={top:r.top-(a.top+a.border.top+E),bottom:a.bottom-a.border.bottom-a.scrollbar.bottom-E-r.bottom,left:r.left-(a.left+a.border.left+c),right:a.right-a.border.right-a.scrollbar.right-c-r.right};d.top<0?s=Math.round(a.scroll.top+d.top-E):d.top>0&&d.bottom<0&&(s=Math.round(a.scroll.top+Math.min(d.top,-d.bottom)+E),u=1),d.left<0?l=Math.round(a.scroll.left+d.left-c):d.left>0&&d.right<0&&(l=Math.round(a.scroll.left+Math.min(d.left,-d.right)+c),f=1);var T=Math.abs(r.right-r.left),S=Math.abs(r.bottom-r.top);return a.width<=T&&n>=a.width-(a.border.left+a.border.right)&&(l=(null===l?n:l+n-f*c)-c),a.height<=S&&o>=a.height-(a.border.top+a.border.bottom)&&(s=(null===s?o:s+o-u*E)-E),null!==l||null!==s?{top:s,left:l}:null}function l(t,n,o,i){function r(e,t){return null===e?0:e>(t?E:f)?1:-1}function a(){t.scrollLeft(p),t.scrollTop(R),g=p,N=R}var s=null,l=null,c=_.getElementScroll(t),E=c.left,f=c.top,T=0,S=0,p=null,R=null,g=null,N=null,h=e.requestAnimationFrame||e.webkitRequestAnimationFrame,C=null,v=null;T=r(n,!0),S=r(o,!1),s=Math.max(Math.abs(n-E)/m,A),l=Math.max(Math.abs(o-f)/m,A),u.whilst(function(){return!(!T&&!S)&&(p=Math.round(_.getElementScroll(t).left+T*s),p=1===T?Math.min(p,n):Math.max(p,n),R=Math.round(_.getElementScroll(t).top+S*l),R=1===S?Math.min(R,o):Math.max(R,o),p!==g||R!==N)},function(t){_.isSafari&&h?(C=function(e){v||(v=e),a(),e-v>=m?t():h(C)},h(C)):(a(),d.setTimeout.call(e,function(){t()},I))},function(){i()})}var c=t.get("Hammerhead"),E=c.$,u=c.async,_=c.Util,f=c.MessageSandbox,d=c.NativeMethods,T=n("Base.CrossDomainMessages"),S=50,p=20,A=10,m=1,I=10;i.run=function(t,n,i,c){function A(t,n){k=function(e){e.message.cmd===T.SCROLL_TOP_WINDOW_RESPONSE_CMD&&(f.off(f.SERVICE_MSG_RECEIVED,k),k=null,n())},f.on(f.SERVICE_MSG_RECEIVED,k),f.sendServiceMsg(t,e.top)}function m(e){if(N=R?_.getScrollableParents(t,i):[o.documentElement],!N.length)return void e();var n=h?h:t;w=C?D-C.scrollLeft():D,G=C?P-C.scrollTop():P,u.forEachSeries(N,function(e,t){function o(){var o=_.getClientDimensions(n),r=_.getClientDimensions(i[0]);w=o.left-r.left+r.border.left+D,G=o.top-r.top+r.border.top+P,n=e,t()}var i=E(e),r=s(i,n,Math.max(0,w),Math.max(0,G),y);return r?void u.series({scrollBody:function(t){var n=/html/i.test(e.tagName)&&i.find("body");n.length?l(n,r.left,r.top,t):t()},ownScroll:function(){l(i,r.left,r.top,o)}}):void o()},function(){e()})}if(!t)return void c();var I=_.isTouchDevice&&_.isMozilla?200:0,R=_.isDomElement(t),g=R&&/html/i.test(t.tagName),N=[],h=null,C=null,v=null,O=null,M=null,D=null,P=null,y=n&&n.maxScrollMargin||S,b=null,L=null,F=null,x=null,U=null,w=0,G=0,k=null;u.series({scrollElement:function(e){return R?(C=E(t),v=C[0].getBoundingClientRect(),O=g?C[0].clientWidth:v.width,M=g?C[0].clientHeight:v.height,D=n&&"undefined"!=typeof n.offsetX?n.offsetX:Math.round(O/2),P=n&&"undefined"!=typeof n.offsetY?n.offsetY:Math.round(M/2),b=Math.min(y,Math.floor(O/2)),L=Math.min(y,Math.floor(M/2)),F=_.getElementScroll(C),_.hasScroll(t,i)?(D>=F.left+O?x=D-b:D<=F.left&&(x=D-b),P>=F.top+M?U=P-L:P<=F.top&&(U=P-L),void u.series({scrollBody:function(e){g?l(C.find("body"),x,U,e):e()},ownScroll:function(e){l(C,x,U,e)},callback:function(){e()}})):void e()):void e()},scrollElementParents:m,checkScrolling:function(e){u.whilst(function(){return!a(y)&&r(t,D,P,i)},function(e){y+=p,m(e)},e)},callback:function(){d.setTimeout.call(e,function(){if(e.top===e.self)return void c();if(R){var n={cmd:T.SCROLL_TOP_WINDOW_REQUEST_CMD,options:{offsetX:Math.max(0,w),offsetY:Math.max(0,G),maxScrollMargin:y}};A(n,c)}else k=function(e){if(e.message.cmd===T.GET_IFRAME_POSITION_DATA_RESPONSE_CMD){f.off(f.SERVICE_MSG_RECEIVED,k),k=null;var n=_.getElementScroll(E(o)),i={cmd:T.SCROLL_TOP_WINDOW_REQUEST_CMD,point:{x:t.x-n.left+e.message.scroll.left,y:t.y-n.top+e.message.scroll.top,maxScrollMargin:y}};A(i,c)}},f.on(f.SERVICE_MSG_RECEIVED,k),f.sendServiceMsg({cmd:T.GET_IFRAME_POSITION_DATA_REQUEST_CMD},e.top)},I)}})}}),n.define("Automation.Select.Playback",function(n,o){var i=t.get("Hammerhead"),r=i.$,a=i.async,s=i.Util,l=i.EventSandbox,c=i.EventSimulator,E=i.NativeMethods,u=n("Settings"),_=i.ContentEditableHelper,f=n("UI.Cursor"),d=i.TextSelection,T=n("Automation.Settings"),S=n("Automation.Util"),p=n("Automation.Select.Util"),A=n("Automation.Scroll.Playback"),m=n("Automation.Move.Playback");o.run=function(t,n,o){var i="textarea"===t.tagName.toLowerCase(),I=s.isTextEditableElement(t),R=s.isContentEditableElement(t),g=null,N=null,h=null,C=null,v=null,O=null,M=null,D=null,P=null,y=null,b=null,L=null,F=!0,x=null,U=null,w=p.getProcessedOptions(t,n);return h=w.startPosition,C=w.endPosition,!u.RECORDING||u.PLAYBACK||s.isElementVisible(t)?void a.series({scrollToElement:function(e){A.run(t,{},null,function(){p.getCorrectOptions(t,function(t){U=t,e()})})},moveToStart:function(a){I&&t.value.length>0||R&&_.getContentEditableValue(t).length?(v=p.getSelectPositionCoordinates(t,h,C,!0,U),O=p.getSelectPositionCoordinates(t,h,C,!1,U)):(v=s.findCenter(t),O=v),p.scrollElementByPoint(t,v),x=p.updatePointByScrollElement(t,v),m.run(x,!1,n,function(){return D=s.offsetToClientCoords(x),y=S.getEventOptionCoordinates(t,D),b=r.extend({clientX:y.x,clientY:y.y},n),g=f.getElementUnderCursor(D.x,D.y),g&&s.isEditableElement(g)?(I=s.isTextEditableElement(g),i="textarea"===g.tagName.toLowerCase(),void E.setTimeout.call(e,a,T.DRAG_ACTION_STEP_DELAY)):void o()})},cursorMousseDown:function(e){f.lMouseDown(e)},mousedown:function(e){var o=(s.isWebKit||s.isIE)&&s.isSelectElement(t),i=null;if(o){var r=function(e){i=e.defaultPrevented,s.preventDefault(e),E.removeEventListener.call(t,"mousedown",r,!1)};E.addEventListener.call(t,"mousedown",r,!1)}if(F=s.isTouchDevice?c.touchstart(g,b):c.mousedown(g,b),N=f.getElementUnderCursor(D.x,D.y),N&&(g=N),F===!1){if(!o||i)return void e();F=!0}R&&(g=t),l.focus(R?_.findContentEditableParent(g):g,function(){O=p.getSelectPositionCoordinates(g,h,C,!1,U),R&&!O&&(O=p.getSelectionLastVisiblePosition(t,h,C,U)||s.findCenter(t)),p.scrollElementByPoint(g,O),O=p.updatePointByScrollElement(g,O),m.run(O,!1,n,function(){e()})},!1,!0)},getCorrectOptions:function(e){if(I&&g.value.length>0||R&&_.getContentEditableValue(g).length){if(O)return x=O,void e();p.getCorrectOptions(g,function(t){x=p.getSelectPositionCoordinates(g,h,C,!1,t),e()})}else e()},setFinalSelection:function(e){x||(x=s.findCenter(g)),p.scrollElementByPoint(g,x),x=p.updatePointByScrollElement(g,x),M=s.offsetToClientCoords(x),P=S.getEventOptionCoordinates(g,M),L=r.extend({clientX:P.x,clientY:P.y},n),(I||R)&&F!==!1&&(R&&n.startNode&&n.endNode?p.selectContentEditableByOptions(t,h,C,n):d.select(g,h,C)),e()},cursorMouseUp:function(e){f.mouseUp(e)},mouseup:function(){s.isTouchDevice?c.touchend(g,L):c.mouseup(g,L),o()}}):(g=t,void E.setTimeout.call(e,o,T.ACTION_STEP_DELAY))}}),n.define("Automation.Select.Util",function(n,i){function r(e,t,n){var o=_.getPositionCoordinates(e,t,n);if(o){var i={x:o.left,y:o.top+(o.bottom-o.top)/2},r=E.getElementScroll(c(e));return E.isIE&&(i.x+=r.left,i.y+=r.top),i}}function a(e,t,n){return t.x+(e-t.y)*(n.x-t.x)/(n.y-t.y)}function s(e,t,n,o,i){function r(e,t){var n=u.slice(e+1),o=e+1;return n.length?(c.each(n,function(e,r){if(s){if(r.point.x>t)return o+=e,!1}else if(r.point.x>=a(n[e].point.y,u[0].point,null===i?u[u.length-1].point:i))return o+=e,!1}),o):e}var s=t.endPos>t.startPos,l=t.startPosition>t.endPosition,E=0===t.startPos&&l?2:1,u=[{position:t.startPosition,point:n}],_=null,f=null;u=u.concat(c.extend(!0,[],e));var d=0,T=0;if(s){for(d=E;d<u.length;d++)if(u[d].point.x<u[d-1].point.x){for(_=r(d,u[d-1].point.x),T=d;T<_;T++)u[T].point.x=a(u[T].point.y,u[d-1].point,u[_].point);d=_}}else for(d=E;d<u.length&&u[d].position!==(null===o?u[u.length-1].position:o);d++)if(f=a(u[d].point.y,u[0].point,null===i?u[u.length-1].point:i),u[d].point.x<f){for(_=r(d),T=d;T<_;T++)u[T].point.x=a(u[T].point.y,u[d-1].point,u[_].point);d=_}return u}var l=t.get("Hammerhead"),c=l.$,E=l.Util,u=l.MessageSandbox,_=l.TextSelection,f=l.ContentEditableHelper,d=n("Base.CrossDomainMessages");i.getSelectPositionCoordinates=function(e,t,n,o,i){var r=t>n,a=_.getPositionCoordinates(e,t,i),s=_.getPositionCoordinates(e,n,i),l=null;return o||t===n?a?l=t!==n?{x:a.left,y:r?a.bottom:a.top}:{x:a.left,y:a.top+(a.bottom-a.top)/2}:E.findCenter(e):s?{x:s.left,y:r?s.top:s.bottom}:null},i.scrollElementByPoint=function(e,t){var n="textarea"===e.tagName.toLowerCase();if(E.isEditableElement(e)){var o=E.getOffsetPosition(e),i=E.getBordersWidth(c(e)),r=E.getElementScroll(c(e)),a=E.getIFrameByElement(e),s=a?E.getElementScroll(c(a.contentWindow.document)):null;if(!(E.isMozilla||E.isIE&&E.browserVersion>10)||n){var l=t.x-(o.left+i.left+(n&&a?s.left:0)),u=t.y-(o.top+i.top+(n&&a?s.top:0)),_=null;n?(u<r.top?_=u:u>e.clientHeight+r.top&&(_=u-e.clientHeight),null!==_&&c(e).scrollTop(Math.round(_))):(l<r.left?_=l:l>e.clientWidth+r.left&&(_=l-e.clientWidth),null!==_&&c(e).scrollLeft(Math.round(_)))}}},i.updatePointByScrollElement=function(e,t){var n=E.isTextEditableElement(e),o="textarea"===e.tagName.toLowerCase();if(!n&&!E.isContentEditableElement(e))return t;var i=t.x,r=t.y,a=E.getOffsetPosition(e),s=E.getBordersWidth(c(e)),l=E.getElementScroll(c(e)),u=E.isElementInIframe(e)?E.getElementScroll(c(E.findDocument(e))):null;return n&&(E.isMozilla||E.isIE&&E.browserVersion>10)&&!o?{x:Math.min(i,a.left+s.left+e.clientWidth)-(u?u.left:0),y:r-(u?u.top:0)}:{x:i-l.left-(u?u.left:0),y:r-l.top-(u?u.top:0)}},i.getProcessedOptions=function(e,t){var n="textarea"===e.tagName.toLowerCase(),o=E.isTextEditableElement(e),i=E.isContentEditableElement(e),r=null,a=null,s=[],l=null,u=null,_=null,d=null,T=null,S=null;return n&&(s=e.value.length?e.value.split("\n"):[]),o?e.value.length?"undefined"!=typeof t.offset||c.isEmptyObject(t)?(r=0,"undefined"==typeof t.offset?a=e.value.length:t.offset>=0?a=Math.min(t.offset,e.value.length):(a=Math.max(0,e.value.length+t.offset),r=e.value.length)):"undefined"!=typeof t.startLine&&n?(t.startLine>=s.length?(T=e.value.length,_=s.length-1):(_=t.startLine,T=E.getTextareaPositionByLineAndOffset(e,_,0)),t.endLine>=s.length?(S=e.value.length,d=s.length-1):(d=t.endLine,S=E.getTextareaPositionByLineAndOffset(e,d,0)),l=Math.min(t.startPos,s[_].length),r=T+l,"undefined"==typeof t.endPos?(u=s[d].length,a=S+u):(u=Math.min(t.endPos,s[d].length),a=S+u)):(r=Math.min(t.startPos,e.value.length),a=Math.min(t.endPos,e.value.length)):r=a=0:i&&(f.getContentEditableValue(e).length||(r=a=0),"undefined"!=typeof t.startNode&&"undefined"!=typeof t.endNode?(r=f.getFirstVisiblePosition(t.startNode),r=f.calculatePositionByNodeAndOffset(e,t.startNode,r),a=f.getLastVisiblePosition(t.endNode),a=f.calculatePositionByNodeAndOffset(e,t.endNode,a),r>a&&(r=f.getLastVisiblePosition(t.startNode),r=f.calculatePositionByNodeAndOffset(e,t.startNode,r),a=f.getFirstVisiblePosition(t.endNode),a=f.calculatePositionByNodeAndOffset(e,t.endNode,a))):"undefined"!=typeof t.offset||c.isEmptyObject(t)?(r=f.getFirstVisiblePosition(e),"undefined"==typeof t.offset?a=f.getLastVisiblePosition(e):t.offset>=0?a=Math.min(t.offset,f.getLastVisiblePosition(e)):(a=Math.max(0,f.getLastVisiblePosition(e)+t.offset),r=f.getLastVisiblePosition(e))):(r=Math.min(t.startPos,f.getLastVisiblePosition(e)),a=Math.min(t.endPos,f.getLastVisiblePosition(e)))),n&&"undefined"==typeof t.endLine&&e.value.length&&(_=E.getTextareaLineNumberByPosition(e,r),l=E.getTextareaIndentInLine(e,r),d=E.getTextareaLineNumberByPosition(e,a),u=E.getTextareaIndentInLine(e,a)),{startPosition:r,endPosition:a,startLine:_,endLine:d,startPos:l,endPos:u}},i.getSelectionPath=function(e,t,n,o,i){function a(t){g&&null===v&&(C=t,v=r(e,t,i))}function l(t){t===_?N.push({position:_,point:o}):N.push({position:t,point:r(e,t,i)})}var c="textarea"===e.tagName.toLowerCase(),u=t.startPosition,_=t.endPosition,f=u>_,d=[],T=null,S=null,p=null,A=null,m=u,I=null,R=null,g=!1,N=[],h=null,C=null,v=null;if(c&&(d=e.value.length?e.value.split("\n"):[],T=t.startPos,S=t.endPos,p=t.startLine,A=t.endLine),c&&p!==A)for(I=E.getTextareaLineNumberByPosition(e,m),R=E.getTextareaIndentInLine(e,m);m!==_;)I!==A?(g||(g=1!==Math.abs(u-_)),I=f?I-1:I+1,R!==S?I!==A||0!==S&&S!==d[I].length?I!==A&&(0===S||S===d[A].length&&0!==T)||(R=R>S?R-1:R+1):(!N[N.length-1]||f&&E.getTextareaIndentInLine(e,N[N.length-1].position)<S||a(N[N.length-1]?N[N.length-1].position:null),R=S):E.isIE||I===A||0!==S||(R=f?1:R+1),m=E.getTextareaPositionByLineAndOffset(e,I,Math.min(R,d[I].length))):(m=m>_?m-1:m+1,a(m)),l(m);else for(;m!==_;)m=f?m-1:m+1,l(m);return N.push({position:_,point:o||h}),g?s(N,t,n,C,v):N},i.getSelectionLastVisiblePosition=function(e,t,n,o){for(var i=t>n,a=n+(i?1:-1),s=null;a!==t&&(a=i?a+1:a-1,!(s=r(e,a,o))););return s},i.selectContentEditableByOptions=function(e,t,n,o){var i=t>n,r=f.calculateNodeAndOffsetByPosition(e,t),a=f.calculateNodeAndOffsetByPosition(e,n),s=null,l=null;o.startNode!==r.node&&!E.isElementContainsNode(o.startNode,r.node)||o.endNode!==a.node&&!E.isElementContainsNode(o.endNode,a.node)?(i?(s=f.getLastVisiblePosition(o.startNode),l=f.getFirstVisiblePosition(o.endNode)):(s=f.getFirstVisiblePosition(o.startNode),l=f.getLastVisiblePosition(o.endNode)),r=f.calculateNodeAndOffsetByPosition(o.startNode,s),a=f.calculateNodeAndOffsetByPosition(o.endNode,l),_.selectByNodesAndOffsets(r.node,r.offset,a.node,a.offset,!0,i)):_.select(e,t,n)},i.getCorrectOptions=function(t,n){var i=t.getBoundingClientRect(),r=t.scrollHeight||i.height,a=E.isElementInIframe(t),s=E.getIFrameByElement(t),l=null,_={isTextarea:"textarea"===t.tagName.toLowerCase(),isContentEditable:E.isContentEditableElement(t),elementBorders:E.getBordersWidth(c(t)),elementRect:i,elementHeight:r,elementOffset:E.getOffsetPosition(t),isInIFrame:a,isInProcessedIFrame:e.top!==e.self,iFrame:s,documentScroll:E.getElementScroll(c(o)),iFrameDocumentScroll:a?E.getElementScroll(c(E.findDocument(t))):{left:0,top:0}};a&&(_.iFrame=E.getIFrameByElement(t),_.iFrameOffset=E.getOffsetPosition(s),_.iFrameBorders=E.getBordersWidth(c(s)),_.iFrameMargin=E.getElementMargin(c(s)),_.iFramePadding=E.getElementPadding(c(s))),E.isIE&&E.browserVersion<11&&_.isInProcessedIFrame?(l=function(e){e.message.cmd===d.GET_IFRAME_POSITION_DATA_RESPONSE_CMD&&(u.off(u.SERVICE_MSG_RECEIVED,l),l=null,_.windowTopScroll=e.message.scroll,_.crossDomainIFrameOffset=e.message.iFrameOffset,_.crossDomainIFrameBorders=e.message.iFrameBorders,_.crossDomainIFramePadding=e.message.iFramePadding,n(_))},u.on(u.SERVICE_MSG_RECEIVED,l),u.sendServiceMsg({cmd:d.GET_IFRAME_POSITION_DATA_REQUEST_CMD},e.top)):n(_)}}),n.define("Automation.Type.Playback",function(n,o){function i(e){var t=l.isContentEditableElement(e);if(!l.isTextEditableElement(e)&&!t){var n=a(e).find("*").filter(function(){return l.isTextEditableElementAndEditingAllowed(this)});if(n.length)return n[0]}return e}var r=t.get("Hammerhead"),a=r.$,s=r.async,l=r.Util,c=r.EventSandbox,E=r.EventSimulator,u=r.NativeMethods,_=n("Settings"),f=r.TextSelection,d=r.ContentEditableHelper,T=n("Automation.Settings"),S=n("Automation.TypeChar.Playback"),p=n("Automation.Click.Playback");o.run=function(t,n,o,r){n=n.toString();var A=n.length,m=null,I=null,R=0,g=null,N=l.isContentEditableElement(t),h=!0;return o.offsetX&&(o.offsetX=Math.round(o.offsetX)),o.offsetY&&(o.offsetY=Math.round(o.offsetY)),m=i(t),g=l.isTextEditableElementAndEditingAllowed(m),!_.RECORDING||_.PLAYBACK||l.isElementVisible(m)?void s.series({click:function(t){l.getActiveElement()!==m?p.run(m,o,function(){u.setTimeout.call(e,t,T.ACTION_STEP_DELAY)}):(g&&c.watchElementEditing(m),(g||N)&&(isNaN(parseInt(o.caretPos))||o.caretPos===f.getSelectionStart(m)||f.select(m,o.caretPos,o.caretPos)),t())},calculateTargetElement:function(e){return!N&&l.getActiveElement()!==m||N&&l.getActiveElement()!==d.findContentEditableParent(m)?void r():(m=N?t:l.getActiveElement(),void e())},type:function(){o.replace&&(g?f.select(m):N&&f.deleteSelectionContents(m,!0));var t=/^\d/.test(n);s.whilst(function(){return R<A},function(r){var _=n.charAt(R),d=l.getKeyCodeByChar(_),p=n.charCodeAt(R),A=13===d?"Enter":_;s.series({startTypeSymbol:function(r){if(h=E.keydown(m,a.extend(o,{keyCode:d,key:A})),delete o.keyCode,h!==!1){if(N||m===l.getActiveElement()||(m=l.getActiveElement(),m=i(m),g=l.isTextEditableElementAndEditingAllowed(m)),I=m,h=E.keypress(m,a.extend(o,{keyCode:d,charCode:p,key:A})),delete o.charCode,N||m===l.getActiveElement()||(m=l.getActiveElement(),m=i(m)),h===!1)return c.restartWatchingElementEditing(I),void u.setTimeout.call(e,r,T.ACTION_STEP_DELAY);var s=n.charAt(R),_=/^\d$/.test(s),C=0===R?null:n.charAt(R-1),v=l.isInputTypeNumber(I);if(v){var O=f.getSelectionStart(I),M=I.value.length;return _?("."===C||"-"===C&&!M?S.run(I,C+s):S.run(I,s),void u.setTimeout.call(e,r,T.ACTION_STEP_DELAY)):(!t&&("."===s||"-"===s&&M)&&0===O&&S.run(I,s),void u.setTimeout.call(e,r,T.ACTION_STEP_DELAY))}S.run(I,s)}u.setTimeout.call(e,r,T.ACTION_STEP_DELAY)},endTypeSymbol:function(){E.keyup(m,a.extend(o,{keyCode:d,key:A})),delete o.keyCode,R++,r()}})},function(){r()})}}):void r()}}),n.define("Automation.TypeChar.Playback",function(n,i){function r(e){var t=f.getSelectionByElement(e),n=f.hasInverseSelectionContentEditable(e);if(f.hasElementContainsSelection(e))t=d.getSelection(e,t,n);else{var o=d.calculateNodeAndOffsetByPosition(e,0),i=d.calculateNodeAndOffsetByPosition(e,0);t={},t.startNode=o.node,t.startOffset=o.offset,t.endNode=i.node,t.endOffset=i.offset}return t}function a(t,n){function i(){a=!0}var a=!1;u.addInternalEventListener(e,["input"],i);var s=" "===n?String.fromCharCode(160):n,l=r(t),T=l.startNode,S=l.startOffset,p=l.endNode,A=l.endOffset;if(T&&c.isContentEditableElement(T)&&p&&c.isContentEditableElement(p)){var m=d.getFirstNonWhitespaceSymbolIndex(T.nodeValue),I=d.getLastNonWhitespaceSymbolIndex(T.nodeValue),R=T.parentNode,g=!c.isTheSameNode(T,p),N=null,h=null,C=null,v=null,O=null,M=null;if(g){if(f.deleteSelectionContents(t),(c.isWebKit||!T.parentNode||!T.parentElement||!c.isElementContainsNode(t,T))&&(l=r(t),N=f.hasInverseSelectionContentEditable(t),T=N?l.endNode:l.startNode,S=N?l.endOffset:l.startOffset,!T||!c.isContentEditableElement(T)))return;A=S}if(c.isRenderedNode(T)){if(1===T.nodeType)return h=o.createTextNode(s),"br"===T.tagName.toLowerCase()?R.insertBefore(h,T):T.appendChild(h),O=s.length,f.selectByNodesAndOffsets(h,O,h,O),void E.setTimeout.call(e,function(){a||_.input(t),u.removeInternalEventListener(e,["input"],i)},0);S<m&&0!==S?(C=m,v=A+(m-S)):A>I&&A!==T.nodeValue.length?(C=T.nodeValue.length,v=A+(T.nodeValue.length-S)):(C=S,v=A),h=h||T,M=h.nodeValue,h.nodeValue=M.substring(0,C)+s+M.substring(v,M.length),O=C+s.length,f.selectByNodesAndOffsets(h,O,h,O),E.setTimeout.call(e,function(){a||_.input(t),u.removeInternalEventListener(e,["input"],i)},0)}}}var s=t.get("Hammerhead"),l=s.$,c=s.Util,E=s.NativeMethods,u=s.EventSandbox,_=s.EventSimulator,f=s.TextSelection,d=s.ContentEditableHelper,T=n("Automation.Util");i.run=function(e,t){if(c.isContentEditableElement(e))return void a(e,t);if(c.isTextEditableElementAndEditingAllowed(e)){var n=f.getSelectionStart(e),o=f.getSelectionEnd(e),i=c.isInputTypeNumber(e),r=!c.isIE&&i?null:parseInt(l(e).attr("maxLength")),s=e.value;(null===r||isNaN(r)||r>s.length)&&(i&&c.isIOS&&"."===s[s.length-1]&&(n+=1,o+=1),T.setValue(e,s.substring(0,n)+t+s.substring(o,s.length)),f.select(e,n+t.length,n+t.length)),_.input(e)}}}),n.define("ActionBarrier",function(t,n){var o=t("ActionBarrier.Xhr");n.init=function(){o.init()},n.waitPageInitialization=function(e){o.waitPageInitialRequests(e)},n.waitActionSideEffectsCompletion=function(t,n){o.startBarrier(n),t.call(e,function(){o.waitBarrier()})}}),n.define("ActionBarrier.Xhr",function(n,o){function i(t){T={passed:!1,collectingReqs:!0,requests:[],reqCount:0,callback:function(){T.passed||(T.passed=!0,T.watchdog&&e.clearTimeout(T.watchdog),t.apply(e,arguments))},watchdog:null}}function r(){T.collectingReqs=!1,T.reqCount?T.watchdog=c.setTimeout.call(e,function(){p.emit(o.XHR_BARRIER_ERROR,{code:E.XHR_REQUEST_TIMEOUT}),T.callback()},o.BARRIER_TIMEOUT):T.callback()}function a(e){for(var t=0;t<T.requests.length;t++)if(e===T.requests[t])return T.requests.splice(t,1),!0;return!1}var s=t.get("Hammerhead"),l=s.Util,c=s.NativeMethods,E=n("Shared.Errors"),u=300,_=100,f=50,d=100;o.BARRIER_TIMEOUT=3e3,o.XHR_BARRIER_ERROR="error",o.GLOBAL_START_XHR_BARRIER="tc-gsxb-d1417385",o.GLOBAL_WAIT_XHR_BARRIER="tc-gwxb-d1417385";var T=null,S=null,p=new l.EventEmitter;o.events=p,o.init=function(){function t(e){a(e)&&T.reqCount--,T.collectingReqs||T.reqCount||T.callback()}S=!1,i(function(){S=!0}),s.on(s.XHR_SEND,function(e){T&&(T.reqCount++,T.requests.push(e.xhr))}),s.on(s.XHR_ERROR,function(n){e.console&&e.console.log&&e.console.log("TestCafe encountered XHR error on page: "+n.err),o.events.emit(o.XHR_BARRIER_ERROR,n.err),t(n.xhr)}),s.on(s.XHR_COMPLETED,function(n){c.setTimeout.call(e,function(){t(n.xhr)},_)})},o.waitPageInitialRequests=function(t){r();var n=function(){S?c.setTimeout.call(e,t,d):c.setTimeout.call(e,n,f)};n()},o.startBarrier=function(e){i(e)},o.waitBarrier=function(){c.setTimeout.call(e,r,u)},e[o.GLOBAL_START_XHR_BARRIER]=o.startBarrier,e[o.GLOBAL_WAIT_XHR_BARRIER]=o.waitBarrier}),n.define("Base.jQueryExtensions.Selectors",function(e,n){var o=t.get("Hammerhead"),i=o.$;n.create=function(e){function t(){e.expr[":"][s]=function(e,t,n){if(!n[3])return!1;var i=o(e);return!!(i&&i.indexOf(n[3])>=0)},e.expr[":"][a]=function(e,t,n){var o,a,s=n[3];return!!s&&(s.indexOf(i)>0&&s.lastIndexOf(r)===s.length-r.length&&s.indexOf(i)<s.length-r.length-i.length&&(o=s.substr(0,s.indexOf(i)),a=s.substring(s.indexOf(i)+i.length,s.lastIndexOf(r)),new RegExp(a).test(e.getAttribute(o))))}}function o(t){if(!t||!l.test(t.tagName.toLowerCase()))return"";for(var n="",o=0;o<t.childNodes.length;o++)3===t.childNodes[o].nodeType&&t.childNodes[o].data&&(n+=t.childNodes[o].data);return n&&(n=e.trim(n.replace(/[^a-z0-9- \xC0-\xFF]+/gi,"")),n=n.replace(/\s+/g," "),/\S/.test(n))?n:""}var i=":/",r="/",a="attrRegExp",s="containsExcludeChildren",l=/^i$|^b$|^big$|^small$|^em$|^strong$|^dfn$|^code$|^samp$|^kbd$|^var$|^cite$|^abbr$|^acronym$|^sub$|^sup$|span$|^bdo$|^address$|^div$|^a$|^object$|^p$|^h\d$|^pre$|^q$|^ins$|^del$|^dt$|^dd$|^li$|^label$|^option$|^textarea$|^fieldset$|^legend$|^button$|^caption$|^td$|^th$|^title$/;return n.REGEXP_START_SUBSTR=i,n.REGEXP_END_SUBSTR=r,n.ATTR_REGEXP_METHOD_NAME=a,n.CONTAINS_OWN_TEXT_METHOD_NAME=s,n.getOwnTextForSelector=o,n.init=t,e},n.create(i)}),n.define("Base.jQueryExtensions.DataMethodProxy",function(t,n){n.setup=function(t){t.fn._data=t.fn.data,t!==e.jQuery&&!function(n){t.fn.data=function(){var o=this[0],i=e.jQuery,r=arguments[0],a=arguments[1];if(2===arguments.length)return this._data(r,a);if(!i||"function"!=typeof i(o).data)return this._data(r);if(!o)return this._data(r);var s=this._data(r);if(r===n)return t.extend(s,i(o).data());if(s!==n)return s;var l=i(o);return l.length?l.data(r):n}}()}}),n.define("TestRunner.API.Actions",function(n,o){function i(e,t){var n={code:e,stepName:R.CURRENT_TEST_STEP_NAME,__sourceIndex:g.currentIndex};t&&S.forEachKey(t,function(e){n[e]=t[e]}),U.onError(n)}function r(t,n,r){var a=!1,s=function(){var e=null;if("function"==typeof t){var o=t();if(e=S.ensureArray(o),o&&(!S.isJQueryObj(o)||o.length)&&e.length)return r(e),!0}else if("string"==typeof t&&(e=S.parseActionArgument(t,n),e&&e.length))return r(e),!0;return!1};if(!s()){var l=A.setInterval.call(e,function(){s()&&(a=!0,e.clearInterval(l))},L);A.setTimeout.call(e,function(){a||(e.clearInterval(l),i(m.API_EMPTY_FIRST_ARGUMENT,{action:n}))},o.ELEMENT_AVAILABILITY_WAITING_TIMEOUT)}}function a(t,n,r){var a=!1;if(S.isElementVisible(t)||"option"===t.tagName.toLowerCase()||"optgroup"===t.tagName.toLowerCase())return void r();var s=A.setInterval.call(e,function(){S.isElementVisible(t)&&(a=!0,e.clearInterval(s),r())},L);A.setTimeout.call(e,function(){a||(e.clearInterval(s),i(m.API_INVISIBLE_ACTION_ELEMENT,{element:S.getElementDescription(t),action:n}))},o.ELEMENT_AVAILABILITY_WAITING_TIMEOUT)}function s(e){var t=null,n=function(n,a){if(d.isArray(n))o(n,a);else if("function"==typeof n)r(n,e,function(e){o(e,a)});else if("string"==typeof n)r(n,e,function(e){t(e,a)});else{var s=S.parseActionArgument(n,e);!s||s.length<1?i(m.API_EMPTY_FIRST_ARGUMENT,{action:e}):t(s,a)}},o=function(t,o){t.length?T.forEachSeries(t,function(e,t){n(e,t)},function(){o()}):i(m.API_EMPTY_FIRST_ARGUMENT,{action:e})};return{run:function(e,n,i){c(),t=n,o(e,i)}}}function l(){return{run:function(e,t,n){t(e,n)}}}function c(e){U.onActionTargetWaitingStarted({maxTimeout:o.ELEMENT_AVAILABILITY_WAITING_TIMEOUT,isWaitAction:e})}function E(){U.onActionRun()}function u(t,n){w=A.setInterval.call(e,function(){U.callWithSharedDataContext(t)&&n()},x)}function _(){null!==w&&(e.clearInterval(w),w=null)}var f=t.get("Hammerhead"),d=f.$,T=f.async,S=f.Util,p=f.JSProcessor,A=f.NativeMethods,m=n("Shared.Errors"),I=n("Shared.Const"),R=n("Settings"),g=n("TestRunner.SourceIndexTracker"),N=f.ContentEditableHelper,h=n("Automation"),C=n("Automation.Click.Playback"),v=n("Automation.RClick.Playback"),O=n("Automation.DblClick.Playback"),M=n("Automation.Drag.Playback"),D=n("Automation.Select.Playback"),P=n("Automation.Type.Playback"),y=n("Automation.Press.Playback"),b=n("Automation.Hover.Playback");o.ELEMENT_AVAILABILITY_WAITING_TIMEOUT=1e4;var L=200,F=1e4,x=50,U=null;o.init=function(e){U=e},o.click=function(e,t){var n=!1,o=S.ensureArray(e);U.asyncActionSeries(o,s("click").run,function(e,o,r){a(e,"click",function(){function a(e){i(e.code,{element:e.element,action:"click"})}n||(n=!0,E()),r?r.contentWindow[h.AUTOMATION_RUNNERS].click.playback.run(e,t||{},o,a):C.run(e,t||{},o,a)})})},o.rclick=function(e,t){var n=!1,o=S.ensureArray(e);U.asyncActionSeries(o,s("rclick").run,function(e,o,i){a(e,"rclick",function(){n||(n=!0,E()),i?i.contentWindow[h.AUTOMATION_RUNNERS].rclick.playback.run(e,t||{},o):v.run(e,t||{},o)})})},o.dblclick=function(e,t){var n=!1,o=S.ensureArray(e);U.asyncActionSeries(o,s("dblclick").run,function(e,o,i){a(e,"dblclick",function(){n||(n=!0,E()),i?i.contentWindow[h.AUTOMATION_RUNNERS].dblclick.playback.run(e,t||{},o):O.run(e,t||{},o)})})},o.drag=function(e){var t=!1,n=arguments,o=S.ensureArray(e),r=!isNaN(parseInt(n[1])),l=n.length>2&&r?{dragOffsetX:n[1],dragOffsetY:n[2]}:n[1];if(!l)return void i(m.API_INCORRECT_DRAGGING_SECOND_ARGUMENT);if(S.isJQueryObj(l)){if(l.length<1)return void i(m.API_INCORRECT_DRAGGING_SECOND_ARGUMENT);l=l[0]}else if(!S.isDomElement(l)&&(isNaN(parseInt(l.dragOffsetX))||isNaN(parseInt(l.dragOffsetY))))return void i(m.API_INCORRECT_DRAGGING_SECOND_ARGUMENT);var c=r?n[3]:n[2];U.asyncActionSeries(o,s("drag").run,function(e,n,o){a(e,"drag",function(){
t||(t=!0,E()),o?o.contentWindow[h.AUTOMATION_RUNNERS].drag.playback.run(e,l,c||{},n):M.run(e,l,c||{},n)})})},o.select=function(){var e=!1,t=S.ensureArray(arguments[0]),n=d.makeArray(arguments).slice(1),o=null,r={},l=!1,c=null;if(arguments[0]||i(m.API_INCORRECT_SELECT_ACTION_ARGUMENTS),1===n.length)if(S.isJQueryObj(n[0])){if(n[0].length<1)return void i(m.API_INCORRECT_SELECT_ACTION_ARGUMENTS);o=n[0][0]}else o=n[0];return 1===n.length&&(S.isDomElement(o)||S.isTextNode(o))?S.isNotVisibleNode(o)?l=!0:(r.startNode=S.isJQueryObj(t[0])?t[0][0]:t[0],r.endNode=o,S.isContentEditableElement(r.startNode)&&S.isContentEditableElement(r.endNode)?(c=N.getNearestCommonAncestor(r.startNode,r.endNode),c?S.isTextNode(c)?c.parentElement?t=[c.parentElement]:l=!0:t=[c]:l=!0):l=!0):d.each(n,function(e,t){if(isNaN(parseInt(t))||n.length>1&&t<0)return l=!0,!1}),l?void i(m.API_INCORRECT_SELECT_ACTION_ARGUMENTS):void U.asyncActionSeries(t,s("select").run,function(t,o,i){1!==n.length||r.startNode?2===n.length||n.length>2&&"textarea"!==t.tagName.toLowerCase()?r={startPos:n[0],endPos:n[1]}:n.length>2&&(r={startLine:n[0],startPos:n[1],endLine:n[2],endPos:n[3]}):r={offset:n[0]},a(t,"select",function(){e||(e=!0,E()),i?i.contentWindow[h.AUTOMATION_RUNNERS].select.playback.run(t,r,o):D.run(t,r,o)})})},o.type=function(e,t,n){if(!t)return void i(m.API_EMPTY_TYPE_ACTION_ARGUMENT);var o=!1,r=S.ensureArray(e);U.asyncActionSeries(r,s("type").run,function(e,i,r){a(e,"type",function(){o||(o=!0,E()),r?r.contentWindow[h.AUTOMATION_RUNNERS].type.playback.run(e,t,n||{},i):P.run(e,t,n||{},i)})})},o.hover=function(e,t){var n=!1,o=S.ensureArray(e);U.asyncActionSeries(o,s("hover").run,function(e,o,i){a(e,"hover",function(){n||(n=!0,E()),i?i.contentWindow[h.AUTOMATION_RUNNERS].hover.playback.run(e,o):b.run(e,t||{},o)})})},o.press=function(){U.asyncActionSeries(arguments,l().run,function(e,t){S.parseKeysString(e).error?i(m.API_INCORRECT_PRESS_ACTION_ARGUMENT):y.run(e,t)})};var w=null;o.wait=function(t,n){return n="function"==typeof n?n:null,"number"!=typeof t||t<0?void i(m.API_INCORRECT_WAIT_ACTION_MILLISECONDS_ARGUMENT):void U.asyncAction(function(o){U.expectInactivity(t,function(){function i(){e.clearTimeout(r),_(),o()}var r=A.setTimeout.call(e,i,t||0);n&&u(n,i)})})},o.waitFor=function(t,n){var o=S.isStringOrStringArray(t,!0),r=!1;return"function"==typeof t||o?("undefined"==typeof n&&(n=F),"number"!=typeof n||n<0?void i(m.API_INCORRECT_WAIT_FOR_ACTION_TIMEOUT_ARGUMENT):(c(!0),void U.asyncAction(function(a){function s(){r||(o&&_(),e.clearTimeout(l),E(),a())}var l=A.setTimeout.call(e,function(){o&&_(),r=!0,i(m.API_WAIT_FOR_ACTION_TIMEOUT_EXCEEDED)},n);U.expectInactivity(n,function(){var e=null;o?(e="string"==typeof t?function(){return!!d(t).length}:function(){for(var e=!0,n=0;n<t.length;n++)if(!d(t[n]).length){e=!1;break}return e},u(e,s)):U.callWithSharedDataContext(function(){t.call(this,function(){s()})})})}))):void i(m.API_INCORRECT_WAIT_FOR_ACTION_EVENT_ARGUMENT)},o.navigateTo=function(t){var n=1e3;U.asyncAction(function(o){e[p.SET_PROPERTY_METH_NAME](e,"location",t),A.setTimeout.call(e,o,n)})},o.upload=function(e,t){var n=!1,o=S.ensureArray(e);!S.isStringOrStringArray(t)&&t&&i(m.API_UPLOAD_INVALID_FILE_PATH_ARGUMENT),U.asyncActionSeries(o,s("upload").run,function(e,o){S.isFileInput(e)?(n||(n=!0,E()),f.upload(e,t,function(e){if(e.length){var t=e.map(function(e){return e.filePath});i(m.API_UPLOAD_CAN_NOT_FIND_FILE_TO_UPLOAD,{filePaths:t})}else o()})):i(m.API_UPLOAD_ELEMENT_IS_NOT_FILE_INPUT)})},o.screenshot=function(){U.asyncAction(function(e){U.takeScreenshot(function(){e()},!1)})},g.wrapTrackableMethods(o,I.ACTION_FUNC_NAMES)}),n.define("TestRunner.API.Assertions",function(e){function n(e,t){return{actual:u(e),expected:u(t)}}function o(e){return e instanceof NodeList||e instanceof HTMLCollection}function i(e,t,a,_){if(_||(_={actual:{},expected:{}}),e===t)return null;if(e instanceof Date&&t instanceof Date){var f=e.getTime(),S=t.getTime();return f===S?null:{actual:f,expected:S,isDates:!0}}if("string"==typeof e&&"string"==typeof t)return l(e,t);if(d.isArray(e)||d.isArray(t))return d.isArray(e)&&d.isArray(t)?c(e,t):n(e,t);if(o(e)||o(t)){if(!o(e)||!o(t))return n(e,t);var p=d(e),A=d(t);return c(p.get(),A.get())?n(p,A):null}if(T.isDomElement(e)||T.isDomElement(t))return T.isDomElement(e)&&T.isDomElement(t)&&e===t?null:n(e,t);if(T.isJQueryObj(e)||T.isJQueryObj(t))return T.isJQueryObj(e)&&T.isJQueryObj(t)&&!c(e.get(),t.get())?null:n(e,t);if(null===e||"undefined"==typeof e||null===t||"undefined"==typeof t)return n(e,t);if("function"==typeof e||"function"==typeof t)return"function"!=typeof e||"function"!=typeof t||e!==t?n(e,t):null;if("object"!=typeof e||"object"!=typeof t)return e==t?null:n(e,t);if(e.prototype!==t.prototype)return n(e,t);var m=E(e),I=E(t);m.sort(),I.sort();var R=s(m,I);if(R){var g=R.actual||R.expected;return{key:a?[a,g].join("."):g,actual:u(e[g],!0),expected:u(t[g],!0),isObjects:!0}}for(var N=null,h=null,C=0;C<m.length;C++){N=m[C];var v=a?[a,N].join("."):N;if(r(_.actual,e[N])&&r(_.expected,t[N]))return null;if(_.actual[v]=e[N],_.expected[v]=t[N],h=i(e[N],t[N],v,_))return{key:h.key?h.key:v,actual:h.isArrays?u(e[N]):h.actual,expected:h.isArrays?u(t[N]):h.expected,isObjects:!0,diffType:{isObjects:h.isObjects,isArrays:h.isArrays,isStrings:h.isStrings,isDates:h.isDates}}}return null}function r(e,t){if("object"!=typeof t||null===t)return!1;for(var n in e)if(e.hasOwnProperty(n)&&e[n]===t)return!0;return!1}function a(e,t){for(var n=0;n<Math.min(e.length,t.length);n++)if(i(e[n],t[n]))return n;return e.length!==t.length?Math.min(e.length,t.length):-1}function s(e,t){for(var n=-1,o=0;o<Math.min(e.length,t.length);o++)e[o]!==t[o]&&(n=o);return e.length!==t.length&&(n=Math.min(Math.max(e.length-1,0),Math.max(t.length-1,0))),n>-1?{key:n,actual:u(e[n],!0),expected:u(t[n],!0),isArrays:!0}:null}function l(e,t){for(var n=-1,o=Math.min(e.length,t.length),i=0;i<o;i++)if(e[i]!==t[i]){n=i;break}return n<0&&e.length!==t.length&&(n=o?o-1:0),n>-1?{key:n,actual:u(e),expected:u(t),isStrings:!0}:null}function c(e,t){var n=a(e,t),o={};return"string"==typeof e[n]&&"string"==typeof t[n]?(o.isStrings=!0,o.diffIndex=l(e[n],t[n]).key):e[n]instanceof Date&&t[n]instanceof Date&&(o.isDates=!0),n>-1?{key:n,actual:o.isDates?e[n].getTime():u(e[n]),expected:o.isDates?t[n].getTime():u(t[n]),isArrays:!0,diffType:o}:null}function E(e){var t=[];return T.forEachKey(e,function(e){t.push(e)}),t}function u(e,t){if("string"==typeof e&&!t)return"'"+e+"'";if(e instanceof Date||/string|number|boolean|function/.test(typeof e))return e.toString();if(d.isArray(e))return _(e);if(T.isJQueryObj(e))return _(d.makeArray(e));if(null===e)return"null";if("undefined"==typeof e)return"undefined";if(T.isDomElement(e))return T.getElementDescription(e);try{return JSON.stringify(e)}catch(n){return e.toString()}}function _(e){for(var t=[],n=0;n<e.length;n++)t.push(u(e[n]));return"["+t.join(", ")+"]"}var f=t.get("Hammerhead"),d=f.$,T=f.Util,S=f.MessageSandbox,p=e("TestRunner.SourceIndexTracker"),A=e("Base.CrossDomainMessages"),m=e("Shared.Errors"),I=e("Shared.Const"),R=e("Settings"),g=this.exports=function(e){this.onAssertionFailed=e};g.prototype._fail=function(e){e.stepName=R.CURRENT_TEST_STEP_NAME,e.__sourceIndex=p.currentIndex,this.onAssertionFailed(e)},g.prototype.ok=function(e,t){e||this._fail({code:m.API_OK_ASSERTION_FAILED,message:t,actual:u(e)})},g.prototype.notOk=function(e,t){e&&this._fail({code:m.API_NOT_OK_ASSERTION_FAILED,message:t,actual:u(e)})},g.prototype.eq=function(e,t,n){var o=i(e,t);o&&this._fail({code:m.API_EQUAL_ASSERTION_FAILED,message:n,actual:o.actual,expected:o.expected,key:o.key,isStrings:o.isStrings,isArrays:o.isArrays,isObjects:o.isObjects,isDates:o.isDates,diffType:o.diffType||{}})},g.prototype.notEq=function(e,t,n,o){var r=i(e,t);r?o&&o():this._fail({code:m.API_NOT_EQUAL_ASSERTION_FAILED,message:n,actual:u(e),callback:o})},g.assert=function(e,t,n,o){function i(e){e.message.cmd===A.ASSERT_RESPONSE_CMD&&(S.off(S.SERVICE_MSG_RECEIVED,i),n(e.message.err))}if(o){S.on(S.SERVICE_MSG_RECEIVED,i);var r={cmd:A.ASSERT_REQUEST_CMD,operator:e,args:t};return void S.sendServiceMsg(r,o)}var a=null,s=new g(function(e){a=e});s[e].apply(s,t),n(a)},p.wrapTrackableMethods(g.prototype,I.ASSERTION_FUNC_NAMES)}),n.define("TestRunner.API.Dialogs",function(n,o){function i(e){_=e?e:{expectAlertCount:0,expectConfirmCount:0,expectPromptCount:0,expectedConfirmRetValues:[],expectedPromptRetValues:[],expectBeforeUnload:!1,alerts:[],confirms:[],prompts:[],beforeUnloadDialogAppeared:!1}}function r(){T.emit(o.DIALOGS_INFO_CHANGED_EVENT,{info:_})}function a(e){_.beforeUnloadDialogAppeared=!!e.prevented,d=!0,_.beforeUnloadDialogAppeared&&r(),_.beforeUnloadDialogAppeared&&!_.expectBeforeUnload&&l("beforeUnload",e.returnValue===!0?"":e.returnValue.toString())}function s(){f={alert:function(e){_.alerts.push(e),r(),_.alerts.length>_.expectAlertCount&&l("alert",e)},confirm:function(e){var t=_.expectedConfirmRetValues[_.confirms.length];return _.confirms.push(e),r(),_.confirms.length>_.expectConfirmCount&&l("confirm",e),t},prompt:function(e){var t=_.expectedPromptRetValues[_.prompts.length];return _.prompts.push(e),r(),_.prompts.length>_.expectPromptCount&&l("prompt",e),t}}}function l(e,t){/alert|confirm|prompt/.test(e)&&d||T.emit(o.UNEXPECTED_DIALOG_ERROR_EVENT,{dialog:e,message:t})}function c(e){T.emit(o.WAS_NOT_EXPECTED_DIALOG_ERROR_EVENT,{dialog:e})}var E=t.get("Hammerhead"),u=E.Util.EventEmitter;o.UNEXPECTED_DIALOG_ERROR_EVENT="unexpectedDialogError",o.WAS_NOT_EXPECTED_DIALOG_ERROR_EVENT="wasNotExpectedDialogError",o.DIALOGS_INFO_CHANGED_EVENT="dialogsInfoChangedEvent";var _=null,f={alert:function(){},confirm:function(){},prompt:function(){}},d=!1,T=new u;o.on=function(e,t){T.on(e,t)},o.init=function(t){E.on(E.BEFORE_UNLOAD_EVENT,a),d=!1,i(t),e.alert=function(e){f.alert(e)},e.confirm=function(e){return f.confirm(e)},e.prompt=function(e){return f.prompt(e)},s(),o.destroy=function(){E.off(E.BEFORE_UNLOAD_EVENT,a)},o.handleAlert=function(){_.expectAlertCount++,r()},o.handleConfirm=function(e){_.expectConfirmCount++,_.expectedConfirmRetValues.push(!(!e||"Cancel"===e)),r()},o.handlePrompt=function(e){_.expectPromptCount++,_.expectedPromptRetValues.push(e||""===e?e:null),r()},o.handleBeforeUnload=function(){_.expectBeforeUnload=!0,r()},o.resetHandlers=function(){i(),s(),r()},o.hasUnexpectedBeforeUnloadDialog=function(){return _&&_.beforeUnloadDialogAppeared&&!_.expectBeforeUnload},o.checkExpectedDialogs=function(){_.expectAlertCount&&_.alerts.length<_.expectAlertCount&&c("alert"),_.expectConfirmCount&&_.confirms.length<_.expectConfirmCount&&c("confirm"),_.expectPromptCount&&_.prompts.length<_.expectPromptCount&&c("prompt"),_.alerts.length>_.expectAlertCount&&l("alert",_.alerts[_.expectAlertCount]),_.confirms.length>_.expectConfirmCount&&l("confirm",_.confirms[_.expectConfirmCount]),_.prompts.length>_.expectPromptCount&&l("prompt",_.prompts[_.expectPromptCount]),_.expectBeforeUnload&&!_.beforeUnloadDialogAppeared&&c("beforeUnload")}}}),n.define("TestRunner.APIv2",function(e,t){var n=e("TestRunner.APIv2.Select");t.REPRODUCE_SELECTION_CHAIN_FUNC_KEY=n.REPRODUCE_SELECTION_CHAIN_FUNC_KEY,t.create=function(e){return{select:new n.SelectOperator(e)}}}),n.define("TestRunner.APIv2.Select",function(e,n){function o(e,t){return function(){for(var n=null,o=0;o<t.length;o++){var i=t[o].type,r=t[o].selector,u="function"==typeof r;i===a?n=u?e("*").filter(r):e(r):i===s?n=n.filter(r):i===l?n=u?n.find("*").filter(r):n.find(r):i===c?n=r:i===E&&(n=n.eq(r))}return n}}var i=t.get("Hammerhead"),r=i.Util;n.REPRODUCE_SELECTION_CHAIN_FUNC_KEY="__#TC_REPRODUCE_SELECTION_CHAIN_FUNC_KEY";var a=0,s=1,l=2,c=3,E=4,u=function(e){this.hostOperator=e};u.prototype.id=function(e){return"string"==typeof e?this.hostOperator.$("#"+e):e instanceof RegExp?this.attr("id",e):this.hostOperator.$("")},u.prototype.tag=function(e){return this.hostOperator.$(e)},u.prototype["class"]=function(e){return this.hostOperator.$("."+e)},u.prototype.text=function(e){var t=e instanceof RegExp;return"string"==typeof e||t?this.hostOperator.$(function(){var n=this,o="",i=n.tagName.toLowerCase();if("script"===i||"style"===i)return!1;for(var r=0;r<n.childNodes.length;r++)3===n.childNodes[r].nodeType&&n.childNodes[r].data&&(o+=n.childNodes[r].data);return t?e.test(o):o.indexOf(e)>-1}):this.hostOperator.$("")},u.prototype.attr=function(e,t){return"string"!=typeof e?this.hostOperator.$(""):"string"==typeof t?this.hostOperator.$("["+e+"='"+t+"']"):t instanceof RegExp?this.hostOperator.$(function(){return this.hasAttribute(e)&&t.test(this.getAttribute(e))}):this.hostOperator.$("["+e+"]")},u.prototype.name=function(e){return"string"==typeof e||e instanceof RegExp?this.attr("name",e):this.hostOperator.$("")};var _=function(e,t,n){this.chainTokens=t||[],this.jQuery=e,this.allowCacheForAndOperator=!0,this.$cachedSelection=n};_.prototype._addSelectorToTokenSequence=null,_.prototype.$=function(e){var t=null,i=this.chainTokens.slice(0);this._addSelectorToTokenSequence(e,i);var r=o(this.jQuery,i);return this.$cachedSelection?(i=[{type:c,selector:this.$cachedSelection}],this._addSelectorToTokenSequence(e,i),t=o(this.jQuery,i)()):t=r(),t["in"]=new T(this.jQuery,i,t),t.and=new S(this.jQuery,i,this.allowCacheForAndOperator&&t),t[n.REPRODUCE_SELECTION_CHAIN_FUNC_KEY]=r,t};var f=function(e,t,n){_.call(this,e,t,n)};r.inherit(f,_),f.prototype.nth=function(e){var t=this.chainTokens.slice(0);t.splice(0,0,{type:E,selector:e});var n=new this.constructor(this.jQuery,t,null);return n.allowCacheForAndOperator=!1,n};var d=n.SelectOperator=function(e){f.call(this,e),this.by=this["with"]=new u(this)};r.inherit(d,f),d.prototype._addSelectorToTokenSequence=function(e,t){t.splice(0,0,{type:a,selector:e})};var T=function(e,t,n){f.call(this,e,t,n),this.allowCacheForAndOperator=!1,this["with"]=this.by=new u(this)};r.inherit(T,f),T.prototype._addSelectorToTokenSequence=function(e,t){for(var n=0;n<t.length;n++)if(t[n].type!==E){t[n].type=l;break}t.splice(0,0,{type:a,selector:e})};var S=function(e,t,n){u.call(this,this),_.call(this,e,t,n),this["with"]=this.by=this};r.inherit(S,_),r.inherit(S,u),S.prototype._addSelectorToTokenSequence=function(e,t){t.splice(1,0,{type:s,selector:e})}}),n.define("TestRunner.IFrameTestRunner",function(n){var o=t.get("Hammerhead"),i=o.Util,r=o.MessageSandbox,a=n("Base.jQueryExtensions.Selectors"),s=n("TestRunner.API.Dialogs"),l=n("TestRunner.TestRunnerBase"),c=n("Settings"),E=this.exports=function(e){l.apply(this,[e])};i.inherit(E,l),E.prototype._initPageLoadBarrier=function(){},E.prototype._prepareStepsExecuting=function(e){a.init(),e()},E.prototype._onTestComplete=function(t){var n={cmd:l.IFRAME_STEP_COMPLETED_CMD};this._onSetStepsSharedData({stepsSharedData:this.testIterator.getSharedData(),callback:function(){r.sendServiceMsg(n,e.top),t.callback()}})},E.prototype._onNextStepStarted=function(t){var n={cmd:l.IFRAME_NEXT_STEP_STARTED_CMD};r.sendServiceMsg(n,e.top),t.callback()},E.prototype._onActionTargetWaitingStarted=function(t){var n={cmd:l.IFRAME_ACTION_TARGET_WAITING_STARTED_CMD,params:t};r.sendServiceMsg(n,e.top)},E.prototype._onActionRun=function(){r.sendServiceMsg({cmd:l.IFRAME_ACTION_RUN_CMD},e.top)},E.prototype._onError=function(t){c.PLAYBACK&&!t.dialog||this.testIterator.stop();var n={cmd:l.IFRAME_ERROR_CMD,err:t};r.sendServiceMsg(n,e.top)},E.prototype._onAssertionFailed=function(t){var n={cmd:l.IFRAME_FAILED_ASSERTION_CMD,err:t};this.testIterator.state.needScreeshot=!0,r.sendServiceMsg(n,e.top),c.PLAYBACK&&this.testIterator.stop()},E.prototype._onSetStepsSharedData=function(t){var n={cmd:l.IFRAME_SET_SHARED_DATA_CMD,sharedData:t.stepsSharedData};r.sendServiceMsg(n,e.top),t.callback()},E.prototype._onGetStepsSharedData=function(t){function n(e){e.message.cmd===l.IFRAME_GET_SHARED_DATA_RESPONSE_CMD&&(r.off(r.SERVICE_MSG_RECEIVED,n),t.callback(e.message.sharedData))}var o={cmd:l.IFRAME_GET_SHARED_DATA_REQUEST_CMD};r.sendServiceMsg(o,e.top),r.on(r.SERVICE_MSG_RECEIVED,n)},E.prototype._onExpectInactivity=function(t){var n={cmd:l.IFRAME_EXPECT_INACTIVITY_CMD,duration:t.duration};r.sendServiceMsg(n,e.top),t.callback()},E.prototype._onTakeScreenshot=function(t){function n(e){e.message.cmd===l.IFRAME_TAKE_SCREENSHOT_RESPONSE_CMD&&(r.off(r.SERVICE_MSG_RECEIVED,n),t&&t.callback&&t.callback())}var o={cmd:l.IFRAME_TAKE_SCREENSHOT_REQUEST_CMD,isFailedStep:t.isFailedStep};r.sendServiceMsg(o,e.top),r.on(r.SERVICE_MSG_RECEIVED,n)},E.prototype.onStepCompleted=function(){s.checkExpectedDialogs()},E.prototype._onDialogsInfoChanged=function(t){var n={cmd:l.IFRAME_NATIVE_DIALOGS_INFO_CHANGED_CMD,info:t};r.sendServiceMsg(n,e.top)},E.prototype._onBeforeUnload=function(){function t(o){o.message.cmd===l.IFRAME_BEFORE_UNLOAD_RESPONSE_CMD&&(r.off(r.SERVICE_MSG_RECEIVED,t),o.message.res&&(n.testIterator.state.stepDelayTimeout&&(e.clearTimeout(n.testIterator.state.stepDelayTimeout),n.testIterator.state.stepDelayTimeout=null),n.testIterator.state.pageUnloading=!1,n.testIterator._runStep()))}var n=this,o={cmd:l.IFRAME_BEFORE_UNLOAD_REQUEST_CMD};r.on(r.SERVICE_MSG_RECEIVED,t),r.sendServiceMsg(o,e.top)}}),function(){var e="undefined"!=typeof module&&module.exports?exports:n;e.UNCAUGHT_JS_ERROR="CLIENT_UNCAUGHT_JS_ERROR",e.UNCAUGHT_JS_ERROR_IN_TEST_CODE_STEP="CLIENT_UNCAUGHT_JS_ERROR_IN_TEST_CODE_STEP",e.STORE_DOM_NODE_OR_JQUERY_OBJECT="CLIENT_STORE_DOM_NODE_OR_JQUERY_OBJECT",e.TEST_INACTIVITY="CLIENT_TEST_INACTIVITY",e.API_EMPTY_FIRST_ARGUMENT="CLIENT_API_EMPTY_FIRST_ARGUMENT",e.API_INVISIBLE_ACTION_ELEMENT="CLIENT_API_INVISIBLE_ACTION_ELEMENT",e.API_INCORRECT_DRAGGING_SECOND_ARGUMENT="CLIENT_API_INCORRECT_DRAGGING_SECOND_ARGUMENT",e.API_OK_ASSERTION_FAILED="CLIENT_API_OK_ASSERTION_FAILED",e.API_EQUAL_ASSERTION_FAILED="CLIENT_API_EQUAL_ASSERTION_FAILED",e.API_NOT_OK_ASSERTION_FAILED="CLIENT_API_NOT_OK_ASSERTION_FAILED",e.API_NOT_EQUAL_ASSERTION_FAILED="CLIENT_API_NOT_EQUAL_ASSERTION_FAILED",e.API_INCORRECT_PRESS_ACTION_ARGUMENT="CLIENT_API_INCORRECT_PRESS_ACTION_ARGUMENT",e.API_EMPTY_TYPE_ACTION_ARGUMENT="CLIENT_API_EMPTY_TYPE_ACTION_ARGUMENT",e.API_UNEXPECTED_DIALOG="CLIENT_API_UNEXPECTED_DIALOG",e.API_EXPECTED_DIALOG_DOESNT_APPEAR="CLIENT_API_EXPECTED_DIALOG_DOESNT_APPEAR",e.API_INCORRECT_SELECT_ACTION_ARGUMENTS="CLIENT_API_INCORRECT_SELECT_ACTION_ARGUMENTS",e.API_INCORRECT_WAIT_ACTION_MILLISECONDS_ARGUMENT="CLIENT_API_INCORRECT_WAIT_ACTION_FIRST_ARGUMENT",e.API_INCORRECT_WAIT_FOR_ACTION_EVENT_ARGUMENT="CLIENT_API_INCORRECT_WAIT_FOR_ACTION_EVENT_ARGUMENT",e.API_INCORRECT_WAIT_FOR_ACTION_TIMEOUT_ARGUMENT="CLIENT_API_INCORRECT_WAIT_FOR_ACTION_TIMEOUT_ARGUMENT",e.API_WAIT_FOR_ACTION_TIMEOUT_EXCEEDED="CLIENT_API_WAIT_FOR_ACTION_TIMEOUT_EXCEEDED",e.API_EMPTY_IFRAME_ARGUMENT="CLIENT_API_EMPTY_IFRAME_ARGUMENT",e.API_IFRAME_ARGUMENT_IS_NOT_IFRAME="CLIENT_API_IFRAME_ARGUMENT_IS_NOT_IFRAME",e.API_MULTIPLE_IFRAME_ARGUMENT="CLIENT_API_MULTIPLE_IFRAME_ARGUMENT",e.API_INCORRECT_IFRAME_ARGUMENT="CLIENT_API_INCORRECT_IFRAME_ARGUMENT",e.API_UPLOAD_CAN_NOT_FIND_FILE_TO_UPLOAD="CLIENT_API_UPLOAD_CAN_NOT_FIND_FILE_TO_UPLOAD",e.API_UPLOAD_ELEMENT_IS_NOT_FILE_INPUT="CLIENT_API_UPLOAD_ELEMENT_IS_NOT_FILE_INPUT",e.API_UPLOAD_INVALID_FILE_PATH_ARGUMENT="CLIENT_API_UPLOAD_INVALID_FILE_PATH_ARGUMENT",e.IFRAME_LOADING_TIMEOUT="CLIENT_IFRAME_LOADING_TIMEOUT",e.IN_IFRAME_TARGET_LOADING_TIMEOUT="CLIENT_IN_IFRAME_TARGET_LOADING_TIMEOUT",e.XHR_REQUEST_TIMEOUT="CLIENT_XHR_REQUEST_TIMEOUT",e.hasErrorStepName=function(t){return t.code!==e.UNCAUGHT_JS_ERROR&&t.code!==e.XHR_REQUEST_TIMEOUT&&t.code!==e.IFRAME_LOADING_TIMEOUT&&t.code!==e.TEST_INACTIVITY},"undefined"!=typeof module&&module.exports?module.exports=e:n.define("Shared.Errors",function(){this.exports=e})}(),function(){var e={};e.IFRAME_WATCH_PROPERTY="tc_iwp_cf65bc15",e.OLD_ATTR_VALUES="tc-1b082-oldAttrValues",e.UPLOADED_FILES_PATH="./uploads/",e.PROPERTY_PREFIX="tc-1b082a6cec-51966-",e.ACTION_FUNC_NAMES=["click","rclick","dblclick","drag","type","wait","waitFor","hover","press","select","navigateTo","upload","screenshot"],e.ASSERTION_FUNC_NAMES=["ok","notOk","eq","notEq"],"undefined"!=typeof module&&module.exports?module.exports=e:n.define("Shared.Const",function(){this.exports=e})}(),function(){var e={TEST_FAIL:"CMD_TEST_FAIL",ASSERTION_FAILED:"CMD_ASSERTION_FAILED",TEST_COMPLETE:"CMD_TEST_COMPLETE",INACTIVITY_EXPECTED:"CMD_INACTIVITY_EXPECTED",SET_STEPS_SHARED_DATA:"CMD_SET_STEPS_SHARED_DATA",GET_STEPS_SHARED_DATA:"CMD_GET_STEPS_SHARED_DATA",STEPS_INFO_GET:"CMD_STEPS_INFO_GET",STEPS_INFO_SET:"CMD_STEPS_INFO_SET",WERE_ACTIONS_RECORDED:"CMD_WERE_ACTIONS_RECORDED",SET_NEXT_STEP:"CMD_SET_NEXT_STEP",SET_TEST_ERROR:"CMD_SET_TEST_ERROR",TOOLBAR_POSITION_SET:"CMD_TOOLBAR_POSITION_SET",CHANGE_SHOW_STEPS:"CMD_CHANGE_SHOW_STEPS",SET_HAS_UNSAVED_CHANGES:"CMD_SET_HAS_UNSAVED_CHANGES",RESTART_RECORDING:"CMD_RESTART_RECORDING",GET_AND_UNCHECK_FILE_DOWNLOADING_FLAG:"GET_AND_UNCHECK_FILE_DOWNLOADING_FLAG",UNCHECK_FILE_DOWNLOADING_FLAG:"CMD_UNCHECK_FILE_DOWNLOADING_FLAG",SAVE_TEST:"CMD_SAVE_TEST",EXIT_RECORDING:"CMD_EXIT_RECORDING",START_PLAYBACK:"CMD_START_PLAYBACK",CANCEL_AUTHENTICATION:"CMD_CANCEL_AUTHENTICATION",FAILED_STEP_IN_PLAYBACK:"CMD_FAILED_STEP_IN_PLAYBACK",END_PLAYBACK:"CMD_END_PLAYBACK",SET_NEXT_STEP_PLAYBACK:"CMD_SET_NEXT_STEP_PLAYBACK",AUTH_CREDENTIALS_SET:"CMD_AUTH_CREDENTIALS_SET",UXLOG:"CMD_UXLOG",TAKE_SCREENSHOT:"CMD_TAKE_SCREENSHOT",NATIVE_DIALOGS_INFO_SET:"CMD_NATIVE_DIALOGS_INFO_SET",SET_NATIVE_DIALOGS_QUEUE:"CMD_SET_NATIVE_DIALOGS_QUEUE"};"undefined"!=typeof module&&module.exports?module.exports=e:n.define("Shared.ServiceCommands",function(){this.exports=e})}()},window.initTestCafeClientCore(window)}();