(self.webpackChunkmarketplace_template_poc=self.webpackChunkmarketplace_template_poc||[]).push([[511],{3759:function(h,c,o){"use strict";o.r(c);var r=o(4396);const m=function(){const t=this;t.settings={},t.settings.container=document.querySelector("[data-cart]"),t.settings.lineItem="[data-lineitem]",t.settings.itemIdAttr="data-lineitem-id",t.settings.sellerIdAttr="data-lineitem-sellerid",t.settings.sellerNameSelector="[data-lineitem-seller]",t.settings.unitPriceSelector="[data-lineitem-unitprice]",t.settings.quantityInputSelector="[data-lineitem-quantity]",t.settings.totalPriceSelector="[data-lineitem-totalprice]",t.settings.removeSelector="[data-lineitem-remove]",t.settings.errorFieldSelector="[data-lineitem-errors]",t.settings.total=document.querySelector("[data-total]"),t.settings.submit=document.querySelector("[data-cart-checkout]"),t.settings.empty=document.querySelector("[data-cart-empty]"),t.settings.summary=document.querySelector("[data-cart-summary]"),t.settings.loading=document.querySelector("[data-cart-loading]"),t.init=()=>{t.settings.container.addEventListener("click",s=>{if(s.target.matches(t.settings.removeSelector)){let a=s.target.closest(t.settings.lineItem).getAttribute(t.settings.itemIdAttr);t.removeItem(a)}});let e;const i=s=>{s.target.matches(t.settings.quantityInputSelector)&&(clearTimeout(e),t.settings.submit.disabled=!0,t.settings.loading.classList.add("card-overlay"),t.settings.loading.classList.remove("hidden"),e=setTimeout(()=>{let a=s.target.closest(t.settings.lineItem).getAttribute(t.settings.itemIdAttr);t.calculateItemTotalPrice(a,s.target.value)},400))};t.settings.container.addEventListener("input",s=>{i(s)});let n;document.addEventListener("cart-lineItems-changed",()=>{clearTimeout(n),n=setTimeout(()=>{t.updateTotal()},200)}),document.addEventListener("cart-changed",()=>{t.settings.submit.disabled=!1,t.settings.loading.classList.add("hidden"),t.settings.loading.classList.remove("card-overlay")}),document.addEventListener("cart-changed",s=>{s.detail.total_quantity||(t.settings.container.remove(),t.settings.summary.remove(),t.settings.empty.classList.remove("hidden"))})},t.removeItem=e=>{t.settings.submit.disabled=!0,t.settings.loading.classList.remove("hidden"),(0,r.Z)("/api/line_items/delete",{method:"DELETE",body:JSON.stringify({id:e})}).then(i=>{if(i.valid){let n=t.settings.container.querySelector(`[${t.settings.itemIdAttr}="${e}"]`),s=n.getAttribute(t.settings.sellerIdAttr);n.remove(),t.settings.container.querySelectorAll(`${t.settings.lineItem}[${t.settings.sellerIdAttr}="${s}"]`).length===0&&t.settings.container.querySelector(`${t.settings.sellerNameSelector}[${t.settings.sellerIdAttr}="${s}"]`).remove(),document.dispatchEvent(new CustomEvent("cart-lineItems-changed"))}})},t.calculateItemTotalPrice=(e,i)=>{const n=t.settings.container.querySelector(`[${t.settings.itemIdAttr}="${e}"]`),s=n.querySelector(`${t.settings.quantityInputSelector}`),a=t.settings.container.querySelector(`${t.settings.errorFieldSelector}[${t.settings.itemIdAttr}="${e}"]`),d={show:()=>{s.classList.add("border-danger"),a.innerText=api.strings.quantityExceeded,t.settings.loading.classList.add("hidden"),t.settings.loading.classList.remove("card-overlay"),t.settings.summary.classList.add("text-danger")},hide:()=>{s.classList.remove("border-danger"),a.innerText="",t.settings.summary.classList.remove("text-danger")}},g=l=>{n.querySelector(t.settings.totalPriceSelector).innerText=l},u=()=>(0,r.Z)("/api/line_items/update",{method:"PUT",body:JSON.stringify({id:e,line_item:{quantity:i}})}).then(l=>{l.errors?d.show():(d.hide(),g(l.total_price),document.dispatchEvent(new CustomEvent("cart-lineItems-changed")))});i<=0||i>parseInt(s.getAttribute("max"))?d.show():(d.hide(),u())},t.updateTotal=()=>{(0,r.Z)("/api/cart/show",{method:"GET"}).then(e=>{t.settings.total.innerText=e.total,document.dispatchEvent(new CustomEvent("cart-changed",{detail:e}))})},t.init()};api.cart=new m;const p=new function(){const t=this;t.settings={},t.settings.counters=document.querySelectorAll("[data-cart-counter]"),t.settings.lineItems=document.querySelectorAll("[data-lineitem]"),t.init=()=>{document.addEventListener("cart-changed",e=>{t.settings.counters.forEach(i=>{i.innerText=e.detail.total_quantity})})},t.init()},y=new function(){const t=this;t.settings={},t.settings.container=document,t.settings.addToWishlist="[data-lineItem-wishlist]",t.settings.endpoint="/api/relationships/create.json",t.settings.headerIcon=document.querySelector('[data-header-wishlist] [data-icon="heartFull"]'),t.init=()=>{t.settings.container.addEventListener("click",e=>{e.target.matches(t.settings.addToWishlist)&&(e.target.disabled=!0,e.target.innerText=api.strings.saving,t.moveToWishlist(e.target.dataset.itemId,e.target.dataset.lineitemId))}),t.settings.headerIcon.addEventListener("animationend",()=>{t.settings.headerIcon.classList.remove("wishlist-added")})},t.moveToWishlist=(e,i)=>{let n={name:"wishlist",l_id:api.profile.id.toString(),r_id:e};(0,r.Z)(t.settings.endpoint,{body:JSON.stringify(n)}).then(s=>{s.valid?(t.settings.headerIcon.classList.add("wishlist-added"),api.cart.removeItem(i),new api.flash("success",api.strings.addedToWishlist)):new api.flash("error",api.strings.cantAddToWishlist)})},t.init()}}}]);
