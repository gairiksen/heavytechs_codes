(self.webpackChunkmarketplace_template_poc=self.webpackChunkmarketplace_template_poc||[]).push([[149],{4112:function(Q,v,r){"use strict";r.r(v);var D=r(9046),g=r.n(D),M=r(2921),u=r.n(M),I=r(6260),X=r.n(I),U=r(4222),T=r.n(U),b=r(5519),w=r.n(b),m=r(4396),A=Object.defineProperty,C=Object.defineProperties,S=Object.getOwnPropertyDescriptors,P=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,y=(t,e,o)=>e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,L=(t,e)=>{for(var o in e||(e={}))B.call(e,o)&&y(t,o,e[o]);if(P)for(var o of P(e))F.call(e,o)&&y(t,o,e[o]);return t},R=(t,e)=>C(t,S(e)),K=(t,e,o)=>new Promise((d,s)=>{var G=l=>{try{i(o.next(l))}catch(c){s(c)}},H=l=>{try{i(o.throw(l))}catch(c){s(c)}},i=l=>l.done?d(l.value):Promise.resolve(l.value).then(G,H);i((o=o.apply(t,e)).next())});const a=document.querySelector('[data-s3-uppy-photo="form"]'),W=a.dataset.s3UppyMaxNumberOfFiles,j=a.dataset.s3UppyNote,_=JSON.parse(a.dataset.s3UppyPhotos||"[]")||[],h=a.dataset.updateImgSelector;let p=_.map(t=>t.id);const f=document.querySelector('[name="item[photo_ids]"]'),E=!!f,n=g()({autoProceed:_.length==0,restrictions:{maxFileSize:2097152,maxNumberOfFiles:W,allowedFileTypes:["image/png","image/jpeg","image/webp"]}}),N=t=>{const e=a.dataset.s3UppyObjectUuid,o=a.dataset.s3UppyPhotoType;return(0,m.Z)("/api/photos",{body:JSON.stringify({photo:{direct_url:t,photo_type:o,object_uuid:e}})})},x=t=>{if(E)V(t);else return(0,m.Z)("/api/photos",{method:"DELETE",body:JSON.stringify({photo:{id:t}})})},J=t=>K(void 0,null,function*(){for(let e=0;e<t.length;e++){const o=t[e],s=yield(yield fetch(o.photo.url)).blob();n.addFile({name:o.photo.file_name,type:s.type,data:s,meta:{photoId:o.id},remote:!0})}n.getFiles().forEach(e=>{n.setFileState(e.id,{progress:{uploadComplete:!0,percentage:100,uploadStarted:Date.now()}})})}),Z=t=>{if(h){const e=t.preview;document.querySelectorAll(h).forEach(o=>{o.src=e})}},z=t=>{p=p.concat(t.map(e=>e.id)),O(p)},V=t=>{var e=p.indexOf(t);e>-1&&p.splice(e,1),O(p)},O=()=>{f.value=p.join(",")};n.use(u(),{inline:!0,replaceTargetContent:!0,showProgressDetails:!0,target:"#drag-drop-area",note:j,width:"100%",height:150,proudlyDisplayPoweredByUppy:!1,showRemoveButtonAfterComplete:!0,locale:{strings:{dropPasteImport:"Drag & drop, paste, or %{browse} to upload file",browse:"browse your computer"}}}).use(w(),{target:u(),modes:["picture"]}).use(T(),{getUploadParameters(){const t=a.getAttribute("action"),o=Array.from(new FormData(a)).reduce((d,s)=>R(L({},d),{[s[0]]:s[1]}),{});return Promise.resolve({method:"POST",url:t,fields:o})}}),n.on("complete",({failed:t,successful:e})=>{Promise.all(e.map(o=>N(o.response.body.location).then(d=>(n.setFileMeta(o.id,{photoId:d.id}),d)))).then(o=>{E&&z(o),Z(e[0])})}),n.on("file-removed",(t,e)=>{t.meta.photoId&&x(t.meta.photoId)}),J(_)}}]);
