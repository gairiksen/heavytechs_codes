(self.webpackChunkmarketplace_template_poc=self.webpackChunkmarketplace_template_poc||[]).push([[391],{7919:function(Q,v,r){"use strict";r.r(v);var D=r(9046),g=r.n(D),I=r(2921),c=r.n(I),M=r(6260),X=r.n(M),U=r(4222),T=r.n(U),b=r(5519),w=r.n(b),m=r(4396),A=Object.defineProperty,C=Object.defineProperties,S=Object.getOwnPropertyDescriptors,y=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,P=(t,e,o)=>e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,L=(t,e)=>{for(var o in e||(e={}))B.call(e,o)&&P(t,o,e[o]);if(y)for(var o of y(e))F.call(e,o)&&P(t,o,e[o]);return t},R=(t,e)=>C(t,S(e)),K=(t,e,o)=>new Promise((s,p)=>{var G=l=>{try{i(o.next(l))}catch(u){p(u)}},H=l=>{try{i(o.throw(l))}catch(u){p(u)}},i=l=>l.done?s(l.value):Promise.resolve(l.value).then(G,H);i((o=o.apply(t,e)).next())});const a=document.querySelector('[data-s3-uppy-truck-photo="form"]'),W=a.dataset.s3UppyMaxNumberOfFiles,j=a.dataset.s3UppyNote,_=JSON.parse(a.dataset.s3UppyPhotos||"[]")||[],h=a.dataset.updateImgSelector;let n=_.map(t=>t.id);const f=document.querySelector('[name="item[photo_ids]"]'),E=!!f,d=g()({autoProceed:_.length==0,restrictions:{maxFileSize:9097152,maxNumberOfFiles:W,allowedFileTypes:["image/png","image/jpeg","image/webp"]}}),N=t=>{const e=a.dataset.s3UppyObjectUuid,o=a.dataset.s3UppyPhotoType,s=a.dataset.s3UppyUserId;return(0,m.Z)("/api/truck_photos",{body:JSON.stringify({photo:{direct_url:t,photo_type:o,object_uuid:e,user_id:s}})})},x=t=>{if(E)V(t);else return(0,m.Z)("/api/photos",{method:"DELETE",body:JSON.stringify({photo:{id:t}})})},J=t=>K(void 0,null,function*(){for(let e=0;e<t.length;e++){const o=t[e],p=yield(yield fetch(o.photo.url)).blob();d.addFile({name:o.photo.file_name,type:p.type,data:p,meta:{photoId:o.id},remote:!0})}d.getFiles().forEach(e=>{d.setFileState(e.id,{progress:{uploadComplete:!0,percentage:100,uploadStarted:Date.now()}})})}),Z=t=>{if(h){const e=t.preview;document.querySelectorAll(h).forEach(o=>{o.src=e})}},z=t=>{n=n.concat(t.map(e=>e.id)),O(n)},V=t=>{var e=n.indexOf(t);e>-1&&n.splice(e,1),O(n)},O=()=>{f.value=n.join(",")};d.use(c(),{inline:!0,replaceTargetContent:!0,showProgressDetails:!0,target:"#truck-images",note:j,width:"100%",height:300,proudlyDisplayPoweredByUppy:!1,showRemoveButtonAfterComplete:!0,locale:{strings:{dropPasteImport:"Drag & drop, paste, or %{browse} to upload file",browse:"browse your computer"}}}).use(w(),{target:c(),modes:["picture"]}).use(T(),{getUploadParameters(){const t=a.getAttribute("action"),o=Array.from(new FormData(a)).reduce((s,p)=>R(L({},s),{[p[0]]:p[1]}),{});return Promise.resolve({method:"POST",url:t,fields:o})}}),d.on("complete",({failed:t,successful:e})=>{Promise.all(e.map(o=>N(o.response.body.location).then(s=>(d.setFileMeta(o.id,{photoId:s.id}),s)))).then(o=>{E&&z(o),Z(e[0])})}),d.on("file-removed",(t,e)=>{t.meta.photoId&&x(t.meta.photoId)}),J(_)}}]);
