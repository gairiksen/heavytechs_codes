(self.webpackChunkmarketplace_template_poc=self.webpackChunkmarketplace_template_poc||[]).push([[376],{7965:function(H,v,r){"use strict";r.r(v);var D=r(9046),g=r.n(D),I=r(2921),U=r.n(I),M=r(6260),Q=r.n(M),C=r(4222),T=r.n(C),A=r(5519),X=r.n(A),m=r(4396),b=Object.defineProperty,w=Object.defineProperties,S=Object.getOwnPropertyDescriptors,y=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,P=(t,e,o)=>e in t?b(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,L=(t,e)=>{for(var o in e||(e={}))B.call(e,o)&&P(t,o,e[o]);if(y)for(var o of y(e))F.call(e,o)&&P(t,o,e[o]);return t},R=(t,e)=>w(t,S(e)),K=(t,e,o)=>new Promise((p,s)=>{var i=l=>{try{c(o.next(l))}catch(u){s(u)}},G=l=>{try{c(o.throw(l))}catch(u){s(u)}},c=l=>l.done?p(l.value):Promise.resolve(l.value).then(i,G);c((o=o.apply(t,e)).next())});const a=document.querySelector('[data-s3-uppy-upload-type="pdf"]'),W=a.dataset.s3UppyMaxNumberOfFiles,j=a.dataset.s3UppyNote,_=JSON.parse(a.dataset.s3UppyPhotos||"[]")||[],f=a.dataset.updateImgSelector;let n=_.map(t=>t.id);const h=document.querySelector('[name="item[photo_ids]"]'),E=!!h,d=g()({autoProceed:_.length==0,restrictions:{maxFileSize:209715200,maxNumberOfFiles:W,allowedFileTypes:["application/pdf"]}}),N=t=>{const e=a.dataset.s3UppyObjectUuid,o=a.dataset.s3UppyPhotoType,p=a.dataset.s3UppyPageCategory,s=a.dataset.s3UppyItemCategory,i=a.dataset.s3UppyUserId;return(0,m.Z)("/api/pdf",{body:JSON.stringify({pdfDetails:{direct_url:t,photo_type:o,object_uuid:e,page_category:p,item_category:s,user_id:i}})})},x=t=>{if(E)V(t);else return(0,m.Z)("/api/photos",{method:"DELETE",body:JSON.stringify({photo:{id:t}})})},J=t=>K(void 0,null,function*(){for(let e=0;e<t.length;e++){const o=t[e],s=yield(yield fetch(o.photo.url)).blob();d.addFile({name:o.photo.file_name,type:s.type,data:s,meta:{photoId:o.id},remote:!0})}d.getFiles().forEach(e=>{d.setFileState(e.id,{progress:{uploadComplete:!0,percentage:100,uploadStarted:Date.now()}})})}),Z=t=>{if(f){const e=t.preview;document.querySelectorAll(f).forEach(o=>{o.src=e})}},z=t=>{n=n.concat(t.map(e=>e.id)),O(n)},V=t=>{var e=n.indexOf(t);e>-1&&n.splice(e,1),O(n)},O=()=>{h.value=n.join(",")};d.use(U(),{inline:!0,replaceTargetContent:!0,showProgressDetails:!0,target:".pdf-upload-area",note:j,width:"100%",height:300,proudlyDisplayPoweredByUppy:!1,showRemoveButtonAfterComplete:!0,locale:{strings:{dropPasteImport:"Drag & drop, paste, or %{browse} to upload file",browse:"browse your computer"}}}).use(T(),{getUploadParameters(){const t=a.getAttribute("action"),o=Array.from(new FormData(a)).reduce((p,s)=>R(L({},p),{[s[0]]:s[1]}),{});return Promise.resolve({method:"POST",url:t,fields:o})}}),d.on("complete",({failed:t,successful:e})=>{Promise.all(e.map(o=>N(o.response.body.location).then(p=>(d.setFileMeta(o.id,{photoId:p.id}),p)))).then(o=>{E&&z(o),Z(e[0])})}),d.on("file-removed",(t,e)=>{t.meta.photoId&&x(t.meta.photoId)}),J(_)}}]);
